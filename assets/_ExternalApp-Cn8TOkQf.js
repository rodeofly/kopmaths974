import{g as s}from"./canStore-DaSrd7sp.js";import{e as u,r as n,g as h}from"./generalStore-C3E9FHtR.js";import{s as f}from"./tableauMathlive-xx-nDjq0.js";import{E as p}from"./Exercice-DtXhjCyI.js";import"./index-BUDQz6-w.js";import"./embellissements-BYV7mIDn.js";import"mathjs";import"decimal.js";import"katex";import"earcut";import"roughjs";import"seedrandom";import"./comparisonFunctions-B45ZZ3C7.js";import"./compute-engine.min.umd-BwAhpA7x.js";import"./Hms-u2AUyU1C.js";import"./ListeDeroulanteElement-CXmzV-cr.js";import"./sizeTools-DfTC1Dgv.js";import"./time-DMC-jnVL.js";import"./exerciseMethods-CtbYPwln.js";import"crypto-js";class T extends p{typeExercice;container;iframe;url;state;type="app";constructor(t){super(),this.url=new URL(t),this.typeExercice="html",this.state="",this.container=document.createElement("div"),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("width","400px"),this.iframe.setAttribute("height","300px"),this.iframe.classList.add("my-10"),this.iframe.setAttribute("allowfullscreen",""),this.container.appendChild(this.iframe);const i=()=>{window.innerWidth>window.innerHeight?(this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("height",(document.body.offsetWidth*.75).toString())):(this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("height",(document.body.offsetWidth*1.5).toString()))};window.addEventListener("resize",i),window.addEventListener("orientationchange",i),this.container.addEventListener("addedToDom",i),window.addEventListener("message",e=>{e.data?.type==="mathaleaSettings"&&e.data?.numeroExercice===this.numeroExercice&&(this.sup=e.data.urlParams,u.update(r=>(this.numeroExercice!==void 0&&(r[this.numeroExercice].sup=e.data.urlParams),r))),e.data?.type==="height"&&e.data?.numeroExercice===this.numeroExercice&&(this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("height",e.data.height+20))})}get html(){if(u.update(t=>(this.numeroExercice!==void 0&&(t[this.numeroExercice].type="app"),t)),this.handleScore(),this.sup!==void 0){const t=new URLSearchParams(this.sup);for(const[i,e]of t.entries())this.url.searchParams.set(i,e)}return s(h).v==="eleve"&&this.url.searchParams.set("v","eleve"),this.numeroExercice!==void 0&&this.url.searchParams.set("numeroExercice",this.numeroExercice.toString()),this.url.searchParams.set("seed",this.seed??""),this.iframe.setAttribute("src",this.url.toString()),this.container}handleScore(){window.addEventListener("message",t=>{if(t.data?.numeroExercice===this.numeroExercice){if(t.data?.type==="mathaleaSendScore"){this.state="done";const i=parseInt(t.data.score),e=parseInt(t.data.numeroExercice),r=parseInt(t.data.numberOfQuestions),a=Array.isArray(t.data.finalState)?t.data.finalState:[t.data.finalState],o="app";let m=s(n)[e]?.numberOfPoints||0;i>m&&(m=i),n.update(d=>(d[e]={numberOfPoints:i,bestScore:m,numberOfQuestions:r,indice:e,answers:a,type:o},d)),s(h).recorder==="capytale"&&f({indiceExercice:this.numeroExercice})}else if(t.data?.type==="mathaleaHasScore"){const i=parseInt(t.data.score),e=parseInt(t.data.numeroExercice),r=parseInt(t.data.numberOfQuestions),a=Array.isArray(t.data.finalState)?t.data.finalState:[t.data.finalState];n.update(c=>(c[e]={numberOfPoints:i,numberOfQuestions:r,indice:e,answers:a},c));const o={type:"mathaleaHasScore",score:i,numeroExercice:e,numberOfQuestions:r,finalState:a};this.iframe!==null&&this.iframe.contentWindow!==null&&this.iframe.contentWindow.postMessage(o,"*")}else if(t.data?.type==="mathaleaAskScore"){const i=parseInt(t.data.numeroExercice)||0,e=s(n)[i];if(typeof e<"u"){const r={type:"mathaleaHasScore",score:e.numberOfPoints,numeroExercice:i,numberOfQuestions:e.numberOfQuestions,finalState:e.answers};this.iframe!==null&&this.iframe.contentWindow!==null&&this.iframe.contentWindow.postMessage(r,"*")}}}})}}export{T as default};
