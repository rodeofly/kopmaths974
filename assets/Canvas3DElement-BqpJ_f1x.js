import{bI as so}from"./embellissements-BYV7mIDn.js";import{g as lo,V as be,h as yt,T as vt,Q as cr,i as ur,j as Be,R as ho,k as co,l as Gr,m as et,n as uo,o as fo,p as po,q as mo,U as go,r as vo,a as Ge,s as Ir,t as tn,u as yo,I as bo,v as _o,f as Pt,w as wo,x as xo,L as fr,y as So,z as dr,e as zr,c as On,G as Ze,d as Ue,F as Ne,H as bt,J as Ye,K as Ke,N as Rn,O as Nr,B as Bn,b as Gn,E as To,X as jr,M as Eo,Y as Wr,Z as pr,_ as mr,$ as gr,P as Zt,a0 as vr,a1 as Uo,D as ko,a2 as Do,W as Tn,S as En}from"./three.module-6qJVdblD.js";const yr={type:"change"},In={type:"start"},Vr={type:"end"},Jt=new ho,br=new co,Ao=Math.cos(70*Gr.DEG2RAD),Le=new be,He=2*Math.PI,Se={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Un=1e-6;class _r extends lo{constructor(n,c=null){super(n,c),this.state=Se.NONE,this.target=new be,this.cursor=new be,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:yt.ROTATE,MIDDLE:yt.DOLLY,RIGHT:yt.PAN},this.touches={ONE:vt.ROTATE,TWO:vt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new be,this._lastQuaternion=new cr,this._lastTargetPosition=new be,this._quat=new cr().setFromUnitVectors(n.up,new be(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new ur,this._sphericalDelta=new ur,this._scale=1,this._panOffset=new be,this._rotateStart=new Be,this._rotateEnd=new Be,this._rotateDelta=new Be,this._panStart=new Be,this._panEnd=new Be,this._panDelta=new Be,this._dollyStart=new Be,this._dollyEnd=new Be,this._dollyDelta=new Be,this._dollyDirection=new be,this._mouse=new Be,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Mo.bind(this),this._onPointerDown=Co.bind(this),this._onPointerUp=Fo.bind(this),this._onContextMenu=Io.bind(this),this._onMouseWheel=Oo.bind(this),this._onKeyDown=Ro.bind(this),this._onTouchStart=Bo.bind(this),this._onTouchMove=Go.bind(this),this._onMouseDown=Po.bind(this),this._onMouseMove=Lo.bind(this),this._interceptControlDown=zo.bind(this),this._interceptControlUp=No.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(n){super.connect(n),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(n){n.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=n}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(yr),this.update(),this.state=Se.NONE}update(n=null){const c=this.object.position;Le.copy(c).sub(this.target),Le.applyQuaternion(this._quat),this._spherical.setFromVector3(Le),this.autoRotate&&this.state===Se.NONE&&this._rotateLeft(this._getAutoRotationAngle(n)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let u=this.minAzimuthAngle,t=this.maxAzimuthAngle;isFinite(u)&&isFinite(t)&&(u<-Math.PI?u+=He:u>Math.PI&&(u-=He),t<-Math.PI?t+=He:t>Math.PI&&(t-=He),u<=t?this._spherical.theta=Math.max(u,Math.min(t,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(u+t)/2?Math.max(u,this._spherical.theta):Math.min(t,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let e=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),e=o!=this._spherical.radius}if(Le.setFromSpherical(this._spherical),Le.applyQuaternion(this._quatInverse),c.copy(this.target).add(Le),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const i=Le.length();o=this._clampDistance(i*this._scale);const r=i-o;this.object.position.addScaledVector(this._dollyDirection,r),this.object.updateMatrixWorld(),e=!!r}else if(this.object.isOrthographicCamera){const i=new be(this._mouse.x,this._mouse.y,0);i.unproject(this.object);const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),e=r!==this.object.zoom;const a=new be(this._mouse.x,this._mouse.y,0);a.unproject(this.object),this.object.position.sub(a).add(i),this.object.updateMatrixWorld(),o=Le.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Jt.origin.copy(this.object.position),Jt.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Jt.direction))<Ao?this.object.lookAt(this.target):(br.setFromNormalAndCoplanarPoint(this.object.up,this.target),Jt.intersectPlane(br,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),e=!0)}return this._scale=1,this._performCursorZoom=!1,e||this._lastPosition.distanceToSquared(this.object.position)>Un||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Un||this._lastTargetPosition.distanceToSquared(this.target)>Un?(this.dispatchEvent(yr),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(n){return n!==null?He/60*this.autoRotateSpeed*n:He/60/60*this.autoRotateSpeed}_getZoomScale(n){const c=Math.abs(n*.01);return Math.pow(.95,this.zoomSpeed*c)}_rotateLeft(n){this._sphericalDelta.theta-=n}_rotateUp(n){this._sphericalDelta.phi-=n}_panLeft(n,c){Le.setFromMatrixColumn(c,0),Le.multiplyScalar(-n),this._panOffset.add(Le)}_panUp(n,c){this.screenSpacePanning===!0?Le.setFromMatrixColumn(c,1):(Le.setFromMatrixColumn(c,0),Le.crossVectors(this.object.up,Le)),Le.multiplyScalar(n),this._panOffset.add(Le)}_pan(n,c){const u=this.domElement;if(this.object.isPerspectiveCamera){const t=this.object.position;Le.copy(t).sub(this.target);let e=Le.length();e*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*n*e/u.clientHeight,this.object.matrix),this._panUp(2*c*e/u.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(n*(this.object.right-this.object.left)/this.object.zoom/u.clientWidth,this.object.matrix),this._panUp(c*(this.object.top-this.object.bottom)/this.object.zoom/u.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(n){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(n){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(n,c){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const u=this.domElement.getBoundingClientRect(),t=n-u.left,e=c-u.top,o=u.width,i=u.height;this._mouse.x=t/o*2-1,this._mouse.y=-(e/i)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(n){return Math.max(this.minDistance,Math.min(this.maxDistance,n))}_handleMouseDownRotate(n){this._rotateStart.set(n.clientX,n.clientY)}_handleMouseDownDolly(n){this._updateZoomParameters(n.clientX,n.clientX),this._dollyStart.set(n.clientX,n.clientY)}_handleMouseDownPan(n){this._panStart.set(n.clientX,n.clientY)}_handleMouseMoveRotate(n){this._rotateEnd.set(n.clientX,n.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const c=this.domElement;this._rotateLeft(He*this._rotateDelta.x/c.clientHeight),this._rotateUp(He*this._rotateDelta.y/c.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(n){this._dollyEnd.set(n.clientX,n.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(n){this._panEnd.set(n.clientX,n.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(n){this._updateZoomParameters(n.clientX,n.clientY),n.deltaY<0?this._dollyIn(this._getZoomScale(n.deltaY)):n.deltaY>0&&this._dollyOut(this._getZoomScale(n.deltaY)),this.update()}_handleKeyDown(n){let c=!1;switch(n.code){case this.keys.UP:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateUp(He*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),c=!0;break;case this.keys.BOTTOM:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateUp(-He*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),c=!0;break;case this.keys.LEFT:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateLeft(He*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),c=!0;break;case this.keys.RIGHT:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateLeft(-He*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),c=!0;break}c&&(n.preventDefault(),this.update())}_handleTouchStartRotate(n){if(this._pointers.length===1)this._rotateStart.set(n.pageX,n.pageY);else{const c=this._getSecondPointerPosition(n),u=.5*(n.pageX+c.x),t=.5*(n.pageY+c.y);this._rotateStart.set(u,t)}}_handleTouchStartPan(n){if(this._pointers.length===1)this._panStart.set(n.pageX,n.pageY);else{const c=this._getSecondPointerPosition(n),u=.5*(n.pageX+c.x),t=.5*(n.pageY+c.y);this._panStart.set(u,t)}}_handleTouchStartDolly(n){const c=this._getSecondPointerPosition(n),u=n.pageX-c.x,t=n.pageY-c.y,e=Math.sqrt(u*u+t*t);this._dollyStart.set(0,e)}_handleTouchStartDollyPan(n){this.enableZoom&&this._handleTouchStartDolly(n),this.enablePan&&this._handleTouchStartPan(n)}_handleTouchStartDollyRotate(n){this.enableZoom&&this._handleTouchStartDolly(n),this.enableRotate&&this._handleTouchStartRotate(n)}_handleTouchMoveRotate(n){if(this._pointers.length==1)this._rotateEnd.set(n.pageX,n.pageY);else{const u=this._getSecondPointerPosition(n),t=.5*(n.pageX+u.x),e=.5*(n.pageY+u.y);this._rotateEnd.set(t,e)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const c=this.domElement;this._rotateLeft(He*this._rotateDelta.x/c.clientHeight),this._rotateUp(He*this._rotateDelta.y/c.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(n){if(this._pointers.length===1)this._panEnd.set(n.pageX,n.pageY);else{const c=this._getSecondPointerPosition(n),u=.5*(n.pageX+c.x),t=.5*(n.pageY+c.y);this._panEnd.set(u,t)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(n){const c=this._getSecondPointerPosition(n),u=n.pageX-c.x,t=n.pageY-c.y,e=Math.sqrt(u*u+t*t);this._dollyEnd.set(0,e),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(n.pageX+c.x)*.5,i=(n.pageY+c.y)*.5;this._updateZoomParameters(o,i)}_handleTouchMoveDollyPan(n){this.enableZoom&&this._handleTouchMoveDolly(n),this.enablePan&&this._handleTouchMovePan(n)}_handleTouchMoveDollyRotate(n){this.enableZoom&&this._handleTouchMoveDolly(n),this.enableRotate&&this._handleTouchMoveRotate(n)}_addPointer(n){this._pointers.push(n.pointerId)}_removePointer(n){delete this._pointerPositions[n.pointerId];for(let c=0;c<this._pointers.length;c++)if(this._pointers[c]==n.pointerId){this._pointers.splice(c,1);return}}_isTrackingPointer(n){for(let c=0;c<this._pointers.length;c++)if(this._pointers[c]==n.pointerId)return!0;return!1}_trackPointer(n){let c=this._pointerPositions[n.pointerId];c===void 0&&(c=new Be,this._pointerPositions[n.pointerId]=c),c.set(n.pageX,n.pageY)}_getSecondPointerPosition(n){const c=n.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[c]}_customWheelEvent(n){const c=n.deltaMode,u={clientX:n.clientX,clientY:n.clientY,deltaY:n.deltaY};switch(c){case 1:u.deltaY*=16;break;case 2:u.deltaY*=100;break}return n.ctrlKey&&!this._controlActive&&(u.deltaY*=10),u}}function Co(h){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(h)&&(this._addPointer(h),h.pointerType==="touch"?this._onTouchStart(h):this._onMouseDown(h)))}function Mo(h){this.enabled!==!1&&(h.pointerType==="touch"?this._onTouchMove(h):this._onMouseMove(h))}function Fo(h){switch(this._removePointer(h),this._pointers.length){case 0:this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Vr),this.state=Se.NONE;break;case 1:const n=this._pointers[0],c=this._pointerPositions[n];this._onTouchStart({pointerId:n,pageX:c.x,pageY:c.y});break}}function Po(h){let n;switch(h.button){case 0:n=this.mouseButtons.LEFT;break;case 1:n=this.mouseButtons.MIDDLE;break;case 2:n=this.mouseButtons.RIGHT;break;default:n=-1}switch(n){case yt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(h),this.state=Se.DOLLY;break;case yt.ROTATE:if(h.ctrlKey||h.metaKey||h.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(h),this.state=Se.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(h),this.state=Se.ROTATE}break;case yt.PAN:if(h.ctrlKey||h.metaKey||h.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(h),this.state=Se.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(h),this.state=Se.PAN}break;default:this.state=Se.NONE}this.state!==Se.NONE&&this.dispatchEvent(In)}function Lo(h){switch(this.state){case Se.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(h);break;case Se.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(h);break;case Se.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(h);break}}function Oo(h){this.enabled===!1||this.enableZoom===!1||this.state!==Se.NONE||(h.preventDefault(),this.dispatchEvent(In),this._handleMouseWheel(this._customWheelEvent(h)),this.dispatchEvent(Vr))}function Ro(h){this.enabled!==!1&&this._handleKeyDown(h)}function Bo(h){switch(this._trackPointer(h),this._pointers.length){case 1:switch(this.touches.ONE){case vt.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(h),this.state=Se.TOUCH_ROTATE;break;case vt.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(h),this.state=Se.TOUCH_PAN;break;default:this.state=Se.NONE}break;case 2:switch(this.touches.TWO){case vt.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(h),this.state=Se.TOUCH_DOLLY_PAN;break;case vt.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(h),this.state=Se.TOUCH_DOLLY_ROTATE;break;default:this.state=Se.NONE}break;default:this.state=Se.NONE}this.state!==Se.NONE&&this.dispatchEvent(In)}function Go(h){switch(this._trackPointer(h),this.state){case Se.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(h),this.update();break;case Se.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(h),this.update();break;case Se.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(h),this.update();break;case Se.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(h),this.update();break;default:this.state=Se.NONE}}function Io(h){this.enabled!==!1&&h.preventDefault()}function zo(h){h.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function No(h){h.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function jo(h,n=!1){const c=h[0].index!==null,u=new Set(Object.keys(h[0].attributes)),t=new Set(Object.keys(h[0].morphAttributes)),e={},o={},i=h[0].morphTargetsRelative,r=new et;let a=0;for(let s=0;s<h.length;++s){const l=h[s];let f=0;if(c!==(l.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+s+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const d in l.attributes){if(!u.has(d))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+s+'. All geometries must have compatible attributes; make sure "'+d+'" attribute exists among all geometries, or in none of them.'),null;e[d]===void 0&&(e[d]=[]),e[d].push(l.attributes[d]),f++}if(f!==u.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+s+". Make sure all geometries have the same number of attributes."),null;if(i!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+s+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const d in l.morphAttributes){if(!t.has(d))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+s+".  .morphAttributes must be consistent throughout all geometries."),null;o[d]===void 0&&(o[d]=[]),o[d].push(l.morphAttributes[d])}if(n){let d;if(c)d=l.index.count;else if(l.attributes.position!==void 0)d=l.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+s+". The geometry must have either an index or a position attribute"),null;r.addGroup(a,d,s),a+=d}}if(c){let s=0;const l=[];for(let f=0;f<h.length;++f){const d=h[f].index;for(let p=0;p<d.count;++p)l.push(d.getX(p)+s);s+=h[f].attributes.position.count}r.setIndex(l)}for(const s in e){const l=wr(e[s]);if(!l)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+s+" attribute."),null;r.setAttribute(s,l)}for(const s in o){const l=o[s][0].length;if(l===0)break;r.morphAttributes=r.morphAttributes||{},r.morphAttributes[s]=[];for(let f=0;f<l;++f){const d=[];for(let m=0;m<o[s].length;++m)d.push(o[s][m][f]);const p=wr(d);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+s+" morphAttribute."),null;r.morphAttributes[s].push(p)}}return r}function wr(h){let n,c,u,t=-1,e=0;for(let a=0;a<h.length;++a){const s=h[a];if(n===void 0&&(n=s.array.constructor),n!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(c===void 0&&(c=s.itemSize),c!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(u===void 0&&(u=s.normalized),u!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(t===-1&&(t=s.gpuType),t!==s.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;e+=s.count*c}const o=new n(e),i=new uo(o,c,u);let r=0;for(let a=0;a<h.length;++a){const s=h[a];if(s.isInterleavedBufferAttribute){const l=r/c;for(let f=0,d=s.count;f<d;f++)for(let p=0;p<c;p++){const m=s.getComponent(f,p);i.setComponent(f+l,p,m)}}else o.set(s.array,r);r+=s.count*c}return t!==void 0&&(i.gpuType=t),i}function Wo(){var h=Object.create(null);function n(t,e){var o=t.id,i=t.name,r=t.dependencies;r===void 0&&(r=[]);var a=t.init;a===void 0&&(a=function(){});var s=t.getTransferables;if(s===void 0&&(s=null),!h[o])try{r=r.map(function(f){return f&&f.isWorkerModule&&(n(f,function(d){if(d instanceof Error)throw d}),f=h[f.id].value),f}),a=u("<"+i+">.init",a),s&&(s=u("<"+i+">.getTransferables",s));var l=null;typeof a=="function"?l=a.apply(void 0,r):console.error("worker module init function failed to rehydrate"),h[o]={id:o,value:l,getTransferables:s},e(l)}catch(f){f&&f.noLog||console.error(f),e(f)}}function c(t,e){var o,i=t.id,r=t.args;(!h[i]||typeof h[i].value!="function")&&e(new Error("Worker module "+i+": not found or its 'init' did not return a function"));try{var a=(o=h[i]).value.apply(o,r);a&&typeof a.then=="function"?a.then(s,function(l){return e(l instanceof Error?l:new Error(""+l))}):s(a)}catch(l){e(l)}function s(l){try{var f=h[i].getTransferables&&h[i].getTransferables(l);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),e(l,f)}catch(d){console.error(d),e(d)}}}function u(t,e){var o=void 0;self.troikaDefine=function(r){return o=r};var i=URL.createObjectURL(new Blob(["/** "+t.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(i)}catch(r){console.error(r)}return URL.revokeObjectURL(i),delete self.troikaDefine,o}self.addEventListener("message",function(t){var e=t.data,o=e.messageId,i=e.action,r=e.data;try{i==="registerModule"&&n(r,function(a){a instanceof Error?postMessage({messageId:o,success:!1,error:a.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof a=="function"}})}),i==="callModule"&&c(r,function(a,s){a instanceof Error?postMessage({messageId:o,success:!1,error:a.message}):postMessage({messageId:o,success:!0,result:a},s||void 0)})}catch(a){postMessage({messageId:o,success:!1,error:a.stack})}})}function Vo(h){var n=function(){for(var c=[],u=arguments.length;u--;)c[u]=arguments[u];return n._getInitResult().then(function(t){if(typeof t=="function")return t.apply(void 0,c);throw new Error("Worker module function was called but `init` did not return a callable function")})};return n._getInitResult=function(){var c=h.dependencies,u=h.init;c=Array.isArray(c)?c.map(function(e){return e&&(e=e.onMainThread||e,e._getInitResult&&(e=e._getInitResult())),e}):[];var t=Promise.all(c).then(function(e){return u.apply(null,e)});return n._getInitResult=function(){return t},t},n}var Hr=function(){var h=!1;if(typeof window<"u"&&typeof window.document<"u")try{var n=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));n.terminate(),h=!0}catch(c){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+c.message+"]")}return Hr=function(){return h},h},Ho=0,Yo=0,kn=!1,Lt=Object.create(null),Ot=Object.create(null),Cn=Object.create(null);function _t(h){if((!h||typeof h.init!="function")&&!kn)throw new Error("requires `options.init` function");var n=h.dependencies,c=h.init,u=h.getTransferables,t=h.workerId,e=Vo(h);t==null&&(t="#default");var o="workerModule"+ ++Ho,i=h.name||o,r=null;n=n&&n.map(function(s){return typeof s=="function"&&!s.workerModuleData&&(kn=!0,s=_t({workerId:t,name:"<"+i+"> function dependency: "+s.name,init:`function(){return (
`+$t(s)+`
)}`}),kn=!1),s&&s.workerModuleData&&(s=s.workerModuleData),s});function a(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];if(!Hr())return e.apply(void 0,s);if(!r){r=xr(t,"registerModule",a.workerModuleData);var f=function(){r=null,Ot[t].delete(f)};(Ot[t]||(Ot[t]=new Set)).add(f)}return r.then(function(d){var p=d.isCallable;if(p)return xr(t,"callModule",{id:o,args:s});throw new Error("Worker module function was called but `init` did not return a callable function")})}return a.workerModuleData={isWorkerModule:!0,id:o,name:i,dependencies:n,init:$t(c),getTransferables:u&&$t(u)},a.onMainThread=e,a}function Xo(h){Ot[h]&&Ot[h].forEach(function(n){n()}),Lt[h]&&(Lt[h].terminate(),delete Lt[h])}function $t(h){var n=h.toString();return!/^function/.test(n)&&/^\w+\s*\(/.test(n)&&(n="function "+n),n}function Ko(h){var n=Lt[h];if(!n){var c=$t(Wo);n=Lt[h]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+h.replace(/\*/g,"")+` **/

;(`+c+")()"],{type:"application/javascript"}))),n.onmessage=function(u){var t=u.data,e=t.messageId,o=Cn[e];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete Cn[e],o(t)}}return n}function xr(h,n,c){return new Promise(function(u,t){var e=++Yo;Cn[e]=function(o){o.success?u(o.result):t(new Error("Error in worker "+n+" call: "+o.error))},Ko(h).postMessage({messageId:e,action:n,data:c})})}function Yr(){var h=function(n){function c(G,O,v,_,D,C,U,z){var L=1-U;z.x=L*L*G+2*L*U*v+U*U*D,z.y=L*L*O+2*L*U*_+U*U*C}function u(G,O,v,_,D,C,U,z,L,I){var X=1-L;I.x=X*X*X*G+3*X*X*L*v+3*X*L*L*D+L*L*L*U,I.y=X*X*X*O+3*X*X*L*_+3*X*L*L*C+L*L*L*z}function t(G,O){for(var v=/([MLQCZ])([^MLQCZ]*)/g,_,D,C,U,z;_=v.exec(G);){var L=_[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(I){return parseFloat(I)});switch(_[1]){case"M":U=D=L[0],z=C=L[1];break;case"L":(L[0]!==U||L[1]!==z)&&O("L",U,z,U=L[0],z=L[1]);break;case"Q":{O("Q",U,z,U=L[2],z=L[3],L[0],L[1]);break}case"C":{O("C",U,z,U=L[4],z=L[5],L[0],L[1],L[2],L[3]);break}case"Z":(U!==D||z!==C)&&O("L",U,z,D,C);break}}}function e(G,O,v){v===void 0&&(v=16);var _={x:0,y:0};t(G,function(D,C,U,z,L,I,X,$,V){switch(D){case"L":O(C,U,z,L);break;case"Q":{for(var N=C,me=U,ce=1;ce<v;ce++)c(C,U,I,X,z,L,ce/(v-1),_),O(N,me,_.x,_.y),N=_.x,me=_.y;break}case"C":{for(var J=C,ee=U,se=1;se<v;se++)u(C,U,I,X,$,V,z,L,se/(v-1),_),O(J,ee,_.x,_.y),J=_.x,ee=_.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",r=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(G,O){var v=G.getContext?G.getContext("webgl",a):G,_=r.get(v);if(!_){let X=function(J){var ee=C[J];if(!ee&&(ee=C[J]=v.getExtension(J),!ee))throw new Error(J+" not supported");return ee},$=function(J,ee){var se=v.createShader(ee);return v.shaderSource(se,J),v.compileShader(se),se},V=function(J,ee,se,W){if(!U[J]){var te={},Q={},B=v.createProgram();v.attachShader(B,$(ee,v.VERTEX_SHADER)),v.attachShader(B,$(se,v.FRAGMENT_SHADER)),v.linkProgram(B),U[J]={program:B,transaction:function(Z){v.useProgram(B),Z({setUniform:function(K,_e){for(var re=[],ie=arguments.length-2;ie-- >0;)re[ie]=arguments[ie+2];var he=Q[_e]||(Q[_e]=v.getUniformLocation(B,_e));v["uniform"+K].apply(v,[he].concat(re))},setAttribute:function(K,_e,re,ie,he){var de=te[K];de||(de=te[K]={buf:v.createBuffer(),loc:v.getAttribLocation(B,K),data:null}),v.bindBuffer(v.ARRAY_BUFFER,de.buf),v.vertexAttribPointer(de.loc,_e,v.FLOAT,!1,0,0),v.enableVertexAttribArray(de.loc),D?v.vertexAttribDivisor(de.loc,ie):X("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(de.loc,ie),he!==de.data&&(v.bufferData(v.ARRAY_BUFFER,he,re),de.data=he)}})}}}U[J].transaction(W)},N=function(J,ee){L++;try{v.activeTexture(v.TEXTURE0+L);var se=z[J];se||(se=z[J]=v.createTexture(),v.bindTexture(v.TEXTURE_2D,se),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST)),v.bindTexture(v.TEXTURE_2D,se),ee(se,L)}finally{L--}},me=function(J,ee,se){var W=v.createFramebuffer();I.push(W),v.bindFramebuffer(v.FRAMEBUFFER,W),v.activeTexture(v.TEXTURE0+ee),v.bindTexture(v.TEXTURE_2D,J),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,J,0);try{se(W)}finally{v.deleteFramebuffer(W),v.bindFramebuffer(v.FRAMEBUFFER,I[--I.length-1]||null)}},ce=function(){C={},U={},z={},L=-1,I.length=0};var D=typeof WebGL2RenderingContext<"u"&&v instanceof WebGL2RenderingContext,C={},U={},z={},L=-1,I=[];v.canvas.addEventListener("webglcontextlost",function(J){ce(),J.preventDefault()},!1),r.set(v,_={gl:v,isWebGL2:D,getExtension:X,withProgram:V,withTexture:N,withTextureFramebuffer:me,handleContextLoss:ce})}O(_)}function l(G,O,v,_,D,C,U,z){U===void 0&&(U=15),z===void 0&&(z=null),s(G,function(L){var I=L.gl,X=L.withProgram,$=L.withTexture;$("copy",function(V,N){I.texImage2D(I.TEXTURE_2D,0,I.RGBA,D,C,0,I.RGBA,I.UNSIGNED_BYTE,O),X("copy",o,i,function(me){var ce=me.setUniform,J=me.setAttribute;J("aUV",2,I.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",N),I.bindFramebuffer(I.FRAMEBUFFER,z||null),I.disable(I.BLEND),I.colorMask(U&8,U&4,U&2,U&1),I.viewport(v,_,D,C),I.scissor(v,_,D,C),I.drawArrays(I.TRIANGLES,0,3)})})})}function f(G,O,v){var _=G.width,D=G.height;s(G,function(C){var U=C.gl,z=new Uint8Array(_*D*4);U.readPixels(0,0,_,D,U.RGBA,U.UNSIGNED_BYTE,z),G.width=O,G.height=v,l(U,z,0,0,_,D)})}var d=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:l,resizeWebGLCanvasWithoutClearing:f});function p(G,O,v,_,D,C){C===void 0&&(C=1);var U=new Uint8Array(G*O),z=_[2]-_[0],L=_[3]-_[1],I=[];e(v,function(J,ee,se,W){I.push({x1:J,y1:ee,x2:se,y2:W,minX:Math.min(J,se),minY:Math.min(ee,W),maxX:Math.max(J,se),maxY:Math.max(ee,W)})}),I.sort(function(J,ee){return J.maxX-ee.maxX});for(var X=0;X<G;X++)for(var $=0;$<O;$++){var V=me(_[0]+z*(X+.5)/G,_[1]+L*($+.5)/O),N=Math.pow(1-Math.abs(V)/D,C)/2;V<0&&(N=1-N),N=Math.max(0,Math.min(255,Math.round(N*255))),U[$*G+X]=N}return U;function me(J,ee){for(var se=1/0,W=1/0,te=I.length;te--;){var Q=I[te];if(Q.maxX+W<=J)break;if(J+W>Q.minX&&ee-W<Q.maxY&&ee+W>Q.minY){var B=A(J,ee,Q.x1,Q.y1,Q.x2,Q.y2);B<se&&(se=B,W=Math.sqrt(se))}}return ce(J,ee)&&(W=-W),W}function ce(J,ee){for(var se=0,W=I.length;W--;){var te=I[W];if(te.maxX<=J)break;var Q=te.y1>ee!=te.y2>ee&&J<(te.x2-te.x1)*(ee-te.y1)/(te.y2-te.y1)+te.x1;Q&&(se+=te.y1<te.y2?1:-1)}return se!==0}}function m(G,O,v,_,D,C,U,z,L,I){C===void 0&&(C=1),z===void 0&&(z=0),L===void 0&&(L=0),I===void 0&&(I=0),g(G,O,v,_,D,C,U,null,z,L,I)}function g(G,O,v,_,D,C,U,z,L,I,X){C===void 0&&(C=1),L===void 0&&(L=0),I===void 0&&(I=0),X===void 0&&(X=0);for(var $=p(G,O,v,_,D,C),V=new Uint8Array($.length*4),N=0;N<$.length;N++)V[N*4+X]=$[N];l(U,V,L,I,G,O,1<<3-X,z)}function A(G,O,v,_,D,C){var U=D-v,z=C-_,L=U*U+z*z,I=L?Math.max(0,Math.min(1,((G-v)*U+(O-_)*z)/L)):0,X=G-(v+I*U),$=O-(_+I*z);return X*X+$*$}var w=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:m,generateIntoFramebuffer:g}),T="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",b="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",S="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",M=new Float32Array([0,0,2,0,0,2]),x=null,E=!1,R={},P=new WeakMap;function Y(G){if(!E&&!H(G))throw new Error("WebGL generation not supported")}function y(G,O,v,_,D,C,U){if(C===void 0&&(C=1),U===void 0&&(U=null),!U&&(U=x,!U)){var z=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!z)throw new Error("OffscreenCanvas or DOM canvas not supported");U=x=z.getContext("webgl",{depth:!1})}Y(U);var L=new Uint8Array(G*O*4);s(U,function(V){var N=V.gl,me=V.withTexture,ce=V.withTextureFramebuffer;me("readable",function(J,ee){N.texImage2D(N.TEXTURE_2D,0,N.RGBA,G,O,0,N.RGBA,N.UNSIGNED_BYTE,null),ce(J,ee,function(se){k(G,O,v,_,D,C,N,se,0,0,0),N.readPixels(0,0,G,O,N.RGBA,N.UNSIGNED_BYTE,L)})})});for(var I=new Uint8Array(G*O),X=0,$=0;X<L.length;X+=4)I[$++]=L[X];return I}function F(G,O,v,_,D,C,U,z,L,I){C===void 0&&(C=1),z===void 0&&(z=0),L===void 0&&(L=0),I===void 0&&(I=0),k(G,O,v,_,D,C,U,null,z,L,I)}function k(G,O,v,_,D,C,U,z,L,I,X){C===void 0&&(C=1),L===void 0&&(L=0),I===void 0&&(I=0),X===void 0&&(X=0),Y(U);var $=[];e(v,function(V,N,me,ce){$.push(V,N,me,ce)}),$=new Float32Array($),s(U,function(V){var N=V.gl,me=V.isWebGL2,ce=V.getExtension,J=V.withProgram,ee=V.withTexture,se=V.withTextureFramebuffer,W=V.handleContextLoss;if(ee("rawDistances",function(te,Q){(G!==te._lastWidth||O!==te._lastHeight)&&N.texImage2D(N.TEXTURE_2D,0,N.RGBA,te._lastWidth=G,te._lastHeight=O,0,N.RGBA,N.UNSIGNED_BYTE,null),J("main",T,b,function(B){var fe=B.setAttribute,Z=B.setUniform,oe=!me&&ce("ANGLE_instanced_arrays"),K=!me&&ce("EXT_blend_minmax");fe("aUV",2,N.STATIC_DRAW,0,M),fe("aLineSegment",4,N.DYNAMIC_DRAW,1,$),Z.apply(void 0,["4f","uGlyphBounds"].concat(_)),Z("1f","uMaxDistance",D),Z("1f","uExponent",C),se(te,Q,function(_e){N.enable(N.BLEND),N.colorMask(!0,!0,!0,!0),N.viewport(0,0,G,O),N.scissor(0,0,G,O),N.blendFunc(N.ONE,N.ONE),N.blendEquationSeparate(N.FUNC_ADD,me?N.MAX:K.MAX_EXT),N.clear(N.COLOR_BUFFER_BIT),me?N.drawArraysInstanced(N.TRIANGLES,0,3,$.length/4):oe.drawArraysInstancedANGLE(N.TRIANGLES,0,3,$.length/4)})}),J("post",o,S,function(B){B.setAttribute("aUV",2,N.STATIC_DRAW,0,M),B.setUniform("1i","tex",Q),N.bindFramebuffer(N.FRAMEBUFFER,z),N.disable(N.BLEND),N.colorMask(X===0,X===1,X===2,X===3),N.viewport(L,I,G,O),N.scissor(L,I,G,O),N.drawArrays(N.TRIANGLES,0,3)})}),N.isContextLost())throw W(),new Error("webgl context lost")})}function H(G){var O=!G||G===x?R:G.canvas||G,v=P.get(O);if(v===void 0){E=!0;var _=null;try{var D=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],C=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,G);v=C&&D.length===C.length&&C.every(function(U,z){return U===D[z]}),v||(_="bad trial run results",console.info(D,C))}catch(U){v=!1,_=U.message}_&&console.warn("WebGL SDF generation not supported:",_),E=!1,P.set(O,v)}return v}var j=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:F,generateIntoFramebuffer:k,isSupported:H});function q(G,O,v,_,D,C){D===void 0&&(D=Math.max(_[2]-_[0],_[3]-_[1])/2),C===void 0&&(C=1);try{return y.apply(j,arguments)}catch(U){return console.info("WebGL SDF generation failed, falling back to JS",U),p.apply(w,arguments)}}function ne(G,O,v,_,D,C,U,z,L,I){D===void 0&&(D=Math.max(_[2]-_[0],_[3]-_[1])/2),C===void 0&&(C=1),z===void 0&&(z=0),L===void 0&&(L=0),I===void 0&&(I=0);try{return F.apply(j,arguments)}catch(X){return console.info("WebGL SDF generation failed, falling back to JS",X),m.apply(w,arguments)}}return n.forEachPathCommand=t,n.generate=q,n.generateIntoCanvas=ne,n.javascript=w,n.pathToLineSegments=e,n.webgl=j,n.webglUtils=d,Object.defineProperty(n,"__esModule",{value:!0}),n}({});return h}function Zo(){var h=function(n){var c={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},u={},t={};u.L=1,t[1]="L",Object.keys(c).forEach(function(W,te){u[W]=1<<te+1,t[u[W]]=W}),Object.freeze(u);var e=u.LRI|u.RLI|u.FSI,o=u.L|u.R|u.AL,i=u.B|u.S|u.WS|u.ON|u.FSI|u.LRI|u.RLI|u.PDI,r=u.BN|u.RLE|u.LRE|u.RLO|u.LRO|u.PDF,a=u.S|u.WS|u.B|e|u.PDI|r,s=null;function l(){if(!s){s=new Map;var W=function(Q){if(c.hasOwnProperty(Q)){var B=0;c[Q].split(",").forEach(function(fe){var Z=fe.split("+"),oe=Z[0],K=Z[1];oe=parseInt(oe,36),K=K?parseInt(K,36):0,s.set(B+=oe,u[Q]);for(var _e=0;_e<K;_e++)s.set(++B,u[Q])})}};for(var te in c)W(te)}}function f(W){return l(),s.get(W.codePointAt(0))||u.L}function d(W){return t[f(W)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(W,te){var Q=36,B=0,fe=new Map,Z=te&&new Map,oe;return W.split(",").forEach(function K(_e){if(_e.indexOf("+")!==-1)for(var re=+_e;re--;)K(oe);else{oe=_e;var ie=_e.split(">"),he=ie[0],de=ie[1];he=String.fromCodePoint(B+=parseInt(he,Q)),de=String.fromCodePoint(B+=parseInt(de,Q)),fe.set(he,de),te&&Z.set(de,he)}}),{map:fe,reverseMap:Z}}var g,A,w;function T(){if(!g){var W=m(p.pairs,!0),te=W.map,Q=W.reverseMap;g=te,A=Q,w=m(p.canonical,!1).map}}function b(W){return T(),g.get(W)||null}function S(W){return T(),A.get(W)||null}function M(W){return T(),w.get(W)||null}var x=u.L,E=u.R,R=u.EN,P=u.ES,Y=u.ET,y=u.AN,F=u.CS,k=u.B,H=u.S,j=u.ON,q=u.BN,ne=u.NSM,G=u.AL,O=u.LRO,v=u.RLO,_=u.LRE,D=u.RLE,C=u.PDF,U=u.LRI,z=u.RLI,L=u.FSI,I=u.PDI;function X(W,te){for(var Q=125,B=new Uint32Array(W.length),fe=0;fe<W.length;fe++)B[fe]=f(W[fe]);var Z=new Map;function oe(We,Qe){var Ve=B[We];B[We]=Qe,Z.set(Ve,Z.get(Ve)-1),Ve&i&&Z.set(i,Z.get(i)-1),Z.set(Qe,(Z.get(Qe)||0)+1),Qe&i&&Z.set(i,(Z.get(i)||0)+1)}for(var K=new Uint8Array(W.length),_e=new Map,re=[],ie=null,he=0;he<W.length;he++)ie||re.push(ie={start:he,end:W.length-1,level:te==="rtl"?1:te==="ltr"?0:lr(he,!1)}),B[he]&k&&(ie.end=he,ie=null);for(var de=D|_|v|O|e|I|C|k,Te=function(We){return We+(We&1?1:2)},Ce=function(We){return We+(We&1?2:1)},ge=0;ge<re.length;ge++){ie=re[ge];var ve=[{_level:ie.level,_override:0,_isolate:0}],le=void 0,Me=0,ke=0,je=0;Z.clear();for(var Ee=ie.start;Ee<=ie.end;Ee++){var ue=B[Ee];if(le=ve[ve.length-1],Z.set(ue,(Z.get(ue)||0)+1),ue&i&&Z.set(i,(Z.get(i)||0)+1),ue&de)if(ue&(D|_)){K[Ee]=le._level;var we=(ue===D?Ce:Te)(le._level);we<=Q&&!Me&&!ke?ve.push({_level:we,_override:0,_isolate:0}):Me||ke++}else if(ue&(v|O)){K[Ee]=le._level;var rt=(ue===v?Ce:Te)(le._level);rt<=Q&&!Me&&!ke?ve.push({_level:rt,_override:ue&v?E:x,_isolate:0}):Me||ke++}else if(ue&e){ue&L&&(ue=lr(Ee+1,!0)===1?z:U),K[Ee]=le._level,le._override&&oe(Ee,le._override);var xe=(ue===z?Ce:Te)(le._level);xe<=Q&&Me===0&&ke===0?(je++,ve.push({_level:xe,_override:0,_isolate:1,_isolInitIndex:Ee})):Me++}else if(ue&I){if(Me>0)Me--;else if(je>0){for(ke=0;!ve[ve.length-1]._isolate;)ve.pop();var ye=ve[ve.length-1]._isolInitIndex;ye!=null&&(_e.set(ye,Ee),_e.set(Ee,ye)),ve.pop(),je--}le=ve[ve.length-1],K[Ee]=le._level,le._override&&oe(Ee,le._override)}else ue&C?(Me===0&&(ke>0?ke--:!le._isolate&&ve.length>1&&(ve.pop(),le=ve[ve.length-1])),K[Ee]=le._level):ue&k&&(K[Ee]=ie.level);else K[Ee]=le._level,le._override&&ue!==q&&oe(Ee,le._override)}for(var Fe=[],De=null,pe=ie.start;pe<=ie.end;pe++){var Ae=B[pe];if(!(Ae&r)){var Ie=K[pe],Re=Ae&e,Pe=Ae===I;De&&Ie===De._level?(De._end=pe,De._endsWithIsolInit=Re):Fe.push(De={_start:pe,_end:pe,_level:Ie,_startsWithPDI:Pe,_endsWithIsolInit:Re})}}for(var Je=[],ot=0;ot<Fe.length;ot++){var tt=Fe[ot];if(!tt._startsWithPDI||tt._startsWithPDI&&!_e.has(tt._start)){for(var it=[De=tt],lt=void 0;De&&De._endsWithIsolInit&&(lt=_e.get(De._end))!=null;)for(var nt=ot+1;nt<Fe.length;nt++)if(Fe[nt]._start===lt){it.push(De=Fe[nt]);break}for(var ze=[],ht=0;ht<it.length;ht++)for(var jn=it[ht],rn=jn._start;rn<=jn._end;rn++)ze.push(rn);for(var to=K[ze[0]],Wn=ie.level,Rt=ze[0]-1;Rt>=0;Rt--)if(!(B[Rt]&r)){Wn=K[Rt];break}var on=ze[ze.length-1],no=K[on],Vn=ie.level;if(!(B[on]&e)){for(var Bt=on+1;Bt<=ie.end;Bt++)if(!(B[Bt]&r)){Vn=K[Bt];break}}Je.push({_seqIndices:ze,_sosType:Math.max(Wn,to)%2?E:x,_eosType:Math.max(Vn,no)%2?E:x})}}for(var an=0;an<Je.length;an++){var sn=Je[an],ae=sn._seqIndices,wt=sn._sosType,ro=sn._eosType,ft=K[ae[0]]&1?E:x;if(Z.get(ne))for(var Gt=0;Gt<ae.length;Gt++){var Hn=ae[Gt];if(B[Hn]&ne){for(var ln=wt,It=Gt-1;It>=0;It--)if(!(B[ae[It]]&r)){ln=B[ae[It]];break}oe(Hn,ln&(e|I)?j:ln)}}if(Z.get(R))for(var zt=0;zt<ae.length;zt++){var Yn=ae[zt];if(B[Yn]&R)for(var Nt=zt-1;Nt>=-1;Nt--){var Xn=Nt===-1?wt:B[ae[Nt]];if(Xn&o){Xn===G&&oe(Yn,y);break}}}if(Z.get(G))for(var hn=0;hn<ae.length;hn++){var Kn=ae[hn];B[Kn]&G&&oe(Kn,E)}if(Z.get(P)||Z.get(F))for(var xt=1;xt<ae.length-1;xt++){var cn=ae[xt];if(B[cn]&(P|F)){for(var dt=0,un=0,fn=xt-1;fn>=0&&(dt=B[ae[fn]],!!(dt&r));fn--);for(var dn=xt+1;dn<ae.length&&(un=B[ae[dn]],!!(un&r));dn++);dt===un&&(B[cn]===P?dt===R:dt&(R|y))&&oe(cn,dt)}}if(Z.get(R))for(var $e=0;$e<ae.length;$e++){var oo=ae[$e];if(B[oo]&R){for(var jt=$e-1;jt>=0&&B[ae[jt]]&(Y|r);jt--)oe(ae[jt],R);for($e++;$e<ae.length&&B[ae[$e]]&(Y|r|R);$e++)B[ae[$e]]!==R&&oe(ae[$e],R)}}if(Z.get(Y)||Z.get(P)||Z.get(F))for(var St=0;St<ae.length;St++){var Zn=ae[St];if(B[Zn]&(Y|P|F)){oe(Zn,j);for(var Wt=St-1;Wt>=0&&B[ae[Wt]]&r;Wt--)oe(ae[Wt],j);for(var Vt=St+1;Vt<ae.length&&B[ae[Vt]]&r;Vt++)oe(ae[Vt],j)}}if(Z.get(R))for(var pn=0,Jn=wt;pn<ae.length;pn++){var qn=ae[pn],mn=B[qn];mn&R?Jn===x&&oe(qn,x):mn&o&&(Jn=mn)}if(Z.get(i)){var Tt=E|R|y,Qn=Tt|x,Ht=[];{for(var pt=[],mt=0;mt<ae.length;mt++)if(B[ae[mt]]&i){var Et=W[ae[mt]],$n=void 0;if(b(Et)!==null)if(pt.length<63)pt.push({char:Et,seqIndex:mt});else break;else if(($n=S(Et))!==null)for(var Ut=pt.length-1;Ut>=0;Ut--){var gn=pt[Ut].char;if(gn===$n||gn===S(M(Et))||b(M(gn))===Et){Ht.push([pt[Ut].seqIndex,mt]),pt.length=Ut;break}}}Ht.sort(function(We,Qe){return We[0]-Qe[0]})}for(var vn=0;vn<Ht.length;vn++){for(var er=Ht[vn],Yt=er[0],yn=er[1],tr=!1,qe=0,bn=Yt+1;bn<yn;bn++){var nr=ae[bn];if(B[nr]&Qn){tr=!0;var rr=B[nr]&Tt?E:x;if(rr===ft){qe=rr;break}}}if(tr&&!qe){qe=wt;for(var _n=Yt-1;_n>=0;_n--){var or=ae[_n];if(B[or]&Qn){var ir=B[or]&Tt?E:x;ir!==ft?qe=ir:qe=ft;break}}}if(qe){if(B[ae[Yt]]=B[ae[yn]]=qe,qe!==ft){for(var kt=Yt+1;kt<ae.length;kt++)if(!(B[ae[kt]]&r)){f(W[ae[kt]])&ne&&(B[ae[kt]]=qe);break}}if(qe!==ft){for(var Dt=yn+1;Dt<ae.length;Dt++)if(!(B[ae[Dt]]&r)){f(W[ae[Dt]])&ne&&(B[ae[Dt]]=qe);break}}}}for(var at=0;at<ae.length;at++)if(B[ae[at]]&i){for(var ar=at,wn=at,xn=wt,At=at-1;At>=0;At--)if(B[ae[At]]&r)ar=At;else{xn=B[ae[At]]&Tt?E:x;break}for(var sr=ro,Ct=at+1;Ct<ae.length;Ct++)if(B[ae[Ct]]&(i|r))wn=Ct;else{sr=B[ae[Ct]]&Tt?E:x;break}for(var Sn=ar;Sn<=wn;Sn++)B[ae[Sn]]=xn===sr?xn:ft;at=wn}}}for(var Xe=ie.start;Xe<=ie.end;Xe++){var io=K[Xe],Xt=B[Xe];if(io&1?Xt&(x|R|y)&&K[Xe]++:Xt&E?K[Xe]++:Xt&(y|R)&&(K[Xe]+=2),Xt&r&&(K[Xe]=Xe===0?ie.level:K[Xe-1]),Xe===ie.end||f(W[Xe])&(H|k))for(var Kt=Xe;Kt>=0&&f(W[Kt])&a;Kt--)K[Kt]=ie.level}}return{levels:K,paragraphs:re};function lr(We,Qe){for(var Ve=We;Ve<W.length;Ve++){var st=B[Ve];if(st&(E|G))return 1;if(st&(k|x)||Qe&&st===I)return 0;if(st&e){var hr=ao(Ve);Ve=hr===-1?W.length:hr}}return 0}function ao(We){for(var Qe=1,Ve=We+1;Ve<W.length;Ve++){var st=B[Ve];if(st&k)break;if(st&I){if(--Qe===0)return Ve}else st&e&&Qe++}return-1}}var $="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function N(){if(!V){var W=m($,!0),te=W.map,Q=W.reverseMap;Q.forEach(function(B,fe){te.set(fe,B)}),V=te}}function me(W){return N(),V.get(W)||null}function ce(W,te,Q,B){var fe=W.length;Q=Math.max(0,Q==null?0:+Q),B=Math.min(fe-1,B==null?fe-1:+B);for(var Z=new Map,oe=Q;oe<=B;oe++)if(te[oe]&1){var K=me(W[oe]);K!==null&&Z.set(oe,K)}return Z}function J(W,te,Q,B){var fe=W.length;Q=Math.max(0,Q==null?0:+Q),B=Math.min(fe-1,B==null?fe-1:+B);var Z=[];return te.paragraphs.forEach(function(oe){var K=Math.max(Q,oe.start),_e=Math.min(B,oe.end);if(K<_e){for(var re=te.levels.slice(K,_e+1),ie=_e;ie>=K&&f(W[ie])&a;ie--)re[ie]=oe.level;for(var he=oe.level,de=1/0,Te=0;Te<re.length;Te++){var Ce=re[Te];Ce>he&&(he=Ce),Ce<de&&(de=Ce|1)}for(var ge=he;ge>=de;ge--)for(var ve=0;ve<re.length;ve++)if(re[ve]>=ge){for(var le=ve;ve+1<re.length&&re[ve+1]>=ge;)ve++;ve>le&&Z.push([le+K,ve+K])}}}),Z}function ee(W,te,Q,B){var fe=se(W,te,Q,B),Z=[].concat(W);return fe.forEach(function(oe,K){Z[K]=(te.levels[oe]&1?me(W[oe]):null)||W[oe]}),Z.join("")}function se(W,te,Q,B){for(var fe=J(W,te,Q,B),Z=[],oe=0;oe<W.length;oe++)Z[oe]=oe;return fe.forEach(function(K){for(var _e=K[0],re=K[1],ie=Z.slice(_e,re+1),he=ie.length;he--;)Z[re-he]=ie[he]}),Z}return n.closingToOpeningBracket=S,n.getBidiCharType=f,n.getBidiCharTypeName=d,n.getCanonicalBracket=M,n.getEmbeddingLevels=X,n.getMirroredCharacter=me,n.getMirroredCharactersMap=ce,n.getReorderSegments=J,n.getReorderedIndices=se,n.getReorderedString=ee,n.openingToClosingBracket=b,Object.defineProperty(n,"__esModule",{value:!0}),n}({});return h}const Xr=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Mn(h){const n=/^[ \t]*#include +<([\w\d./]+)>/gm;function c(u,t){let e=vo[t];return e?Mn(e):u}return h.replace(n,c)}const Oe=[];for(let h=0;h<256;h++)Oe[h]=(h<16?"0":"")+h.toString(16);function Jo(){const h=Math.random()*4294967295|0,n=Math.random()*4294967295|0,c=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Oe[h&255]+Oe[h>>8&255]+Oe[h>>16&255]+Oe[h>>24&255]+"-"+Oe[n&255]+Oe[n>>8&255]+"-"+Oe[n>>16&15|64]+Oe[n>>24&255]+"-"+Oe[c&63|128]+Oe[c>>8&255]+"-"+Oe[c>>16&255]+Oe[c>>24&255]+Oe[u&255]+Oe[u>>8&255]+Oe[u>>16&255]+Oe[u>>24&255]).toUpperCase()}const ct=Object.assign||function(){let h=arguments[0];for(let n=1,c=arguments.length;n<c;n++){let u=arguments[n];if(u)for(let t in u)Object.prototype.hasOwnProperty.call(u,t)&&(h[t]=u[t])}return h},qo=Date.now(),Sr=new WeakMap,Tr=new Map;let Qo=1e10;function Fn(h,n){const c=ni(n);let u=Sr.get(h);if(u||Sr.set(h,u=Object.create(null)),u[c])return new u[c];const t=`_onBeforeCompile${c}`,e=function(a,s){h.onBeforeCompile.call(this,a,s);const l=this.customProgramCacheKey()+"|"+a.vertexShader+"|"+a.fragmentShader;let f=Tr[l];if(!f){const d=$o(this,a,n,c);f=Tr[l]=d}a.vertexShader=f.vertexShader,a.fragmentShader=f.fragmentShader,ct(a.uniforms,this.uniforms),n.timeUniform&&(a.uniforms[n.timeUniform]={get value(){return Date.now()-qo}}),this[t]&&this[t](a)},o=function(){return i(n.chained?h:h.clone())},i=function(a){const s=Object.create(a,r);return Object.defineProperty(s,"baseMaterial",{value:h}),Object.defineProperty(s,"id",{value:Qo++}),s.uuid=Jo(),s.uniforms=ct({},a.uniforms,n.uniforms),s.defines=ct({},a.defines,n.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${c}`]="",s.extensions=ct({},a.extensions,n.extensions),s._listeners=void 0,s},r={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>h.type,set:a=>{h.type=a}},isDerivedFrom:{writable:!0,configurable:!0,value:function(a){const s=this.baseMaterial;return a===s||s.isDerivedMaterial&&s.isDerivedFrom(a)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return h.customProgramCacheKey()+"|"+c}},onBeforeCompile:{get(){return e},set(a){this[t]=a}},copy:{writable:!0,configurable:!0,value:function(a){return h.copy.call(this,a),!h.isShaderMaterial&&!h.isDerivedMaterial&&(ct(this.extensions,a.extensions),ct(this.defines,a.defines),ct(this.uniforms,go.clone(a.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const a=new h.constructor;return i(a).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let a=this._depthMaterial;return a||(a=this._depthMaterial=Fn(h.isDerivedMaterial?h.getDepthMaterial():new po({depthPacking:mo}),n),a.defines.IS_DEPTH_MATERIAL="",a.uniforms=this.uniforms),a}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let a=this._distanceMaterial;return a||(a=this._distanceMaterial=Fn(h.isDerivedMaterial?h.getDistanceMaterial():new fo,n),a.defines.IS_DISTANCE_MATERIAL="",a.uniforms=this.uniforms),a}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:a,_distanceMaterial:s}=this;a&&a.dispose(),s&&s.dispose(),h.dispose.call(this)}}};return u[c]=o,new o}function $o(h,{vertexShader:n,fragmentShader:c},u,t){let{vertexDefs:e,vertexMainIntro:o,vertexMainOutro:i,vertexTransform:r,fragmentDefs:a,fragmentMainIntro:s,fragmentMainOutro:l,fragmentColorTransform:f,customRewriter:d,timeUniform:p}=u;if(e=e||"",o=o||"",i=i||"",a=a||"",s=s||"",l=l||"",(r||d)&&(n=Mn(n)),(f||d)&&(c=c.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),c=Mn(c)),d){let m=d({vertexShader:n,fragmentShader:c});n=m.vertexShader,c=m.fragmentShader}if(f){let m=[];c=c.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(m.push(g),"")),l=`${f}
${m.join(`
`)}
${l}`}if(p){const m=`
uniform float ${p};
`;e=m+e,a=m+a}return r&&(n=`vec3 troika_position_${t};
vec3 troika_normal_${t};
vec2 troika_uv_${t};
${n}
`,e=`${e}
void troikaVertexTransform${t}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${r}
}
`,o=`
troika_position_${t} = vec3(position);
troika_normal_${t} = vec3(normal);
troika_uv_${t} = vec2(uv);
troikaVertexTransform${t}(troika_position_${t}, troika_normal_${t}, troika_uv_${t});
${o}
`,n=n.replace(/\b(position|normal|uv)\b/g,(m,g,A,w)=>/\battribute\s+vec[23]\s+$/.test(w.substr(0,A))?g:`troika_${g}_${t}`),h.map&&h.map.channel>0||(n=n.replace(/\bMAP_UV\b/g,`troika_uv_${t}`))),n=Er(n,t,e,o,i),c=Er(c,t,a,s,l),{vertexShader:n,fragmentShader:c}}function Er(h,n,c,u,t){return(u||t||c)&&(h=h.replace(Xr,`
${c}
void troikaOrigMain${n}() {`),h+=`
void main() {
  ${u}
  troikaOrigMain${n}();
  ${t}
}`),h}function ei(h,n){return h==="uniforms"?void 0:typeof n=="function"?n.toString():n}let ti=0;const Ur=new Map;function ni(h){const n=JSON.stringify(h,ei);let c=Ur.get(n);return c==null&&Ur.set(n,c=++ti),c}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function ri(){return typeof window>"u"&&(self.window=self),function(h){var n={parse:function(t){var e=n._bin,o=new Uint8Array(t);if(e.readASCII(o,0,4)=="ttcf"){var i=4;e.readUshort(o,i),i+=2,e.readUshort(o,i),i+=2;var r=e.readUint(o,i);i+=4;for(var a=[],s=0;s<r;s++){var l=e.readUint(o,i);i+=4,a.push(n._readFont(o,l))}return a}return[n._readFont(o,0)]},_readFont:function(t,e){var o=n._bin,i=e;o.readFixed(t,e),e+=4;var r=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2;for(var a=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:t,_offset:i},l={},f=0;f<r;f++){var d=o.readASCII(t,e,4);e+=4,o.readUint(t,e),e+=4;var p=o.readUint(t,e);e+=4;var m=o.readUint(t,e);e+=4,l[d]={offset:p,length:m}}for(f=0;f<a.length;f++){var g=a[f];l[g]&&(s[g.trim()]=n[g.trim()].parse(t,l[g].offset,l[g].length,s))}return s},_tabOffset:function(t,e,o){for(var i=n._bin,r=i.readUshort(t,o+4),a=o+12,s=0;s<r;s++){var l=i.readASCII(t,a,4);a+=4,i.readUint(t,a),a+=4;var f=i.readUint(t,a);if(a+=4,i.readUint(t,a),a+=4,l==e)return f}return 0}};n._bin={readFixed:function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<8|t[e+3])/65540},readF2dot14:function(t,e){return n._bin.readShort(t,e)/16384},readInt:function(t,e){return n._bin._view(t).getInt32(e)},readInt8:function(t,e){return n._bin._view(t).getInt8(e)},readShort:function(t,e){return n._bin._view(t).getInt16(e)},readUshort:function(t,e){return n._bin._view(t).getUint16(e)},readUshorts:function(t,e,o){for(var i=[],r=0;r<o;r++)i.push(n._bin.readUshort(t,e+2*r));return i},readUint:function(t,e){return n._bin._view(t).getUint32(e)},readUint64:function(t,e){return 4294967296*n._bin.readUint(t,e)+n._bin.readUint(t,e+4)},readASCII:function(t,e,o){for(var i="",r=0;r<o;r++)i+=String.fromCharCode(t[e+r]);return i},readUnicode:function(t,e,o){for(var i="",r=0;r<o;r++){var a=t[e++]<<8|t[e++];i+=String.fromCharCode(a)}return i},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(t,e,o){var i=n._bin._tdec;return i&&e==0&&o==t.length?i.decode(t):n._bin.readASCII(t,e,o)},readBytes:function(t,e,o){for(var i=[],r=0;r<o;r++)i.push(t[e+r]);return i},readASCIIArray:function(t,e,o){for(var i=[],r=0;r<o;r++)i.push(String.fromCharCode(t[e+r]));return i},_view:function(t){return t._dataView||(t._dataView=t.buffer?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(new Uint8Array(t).buffer))}},n._lctf={},n._lctf.parse=function(t,e,o,i,r){var a=n._bin,s={},l=e;a.readFixed(t,e),e+=4;var f=a.readUshort(t,e);e+=2;var d=a.readUshort(t,e);e+=2;var p=a.readUshort(t,e);return e+=2,s.scriptList=n._lctf.readScriptList(t,l+f),s.featureList=n._lctf.readFeatureList(t,l+d),s.lookupList=n._lctf.readLookupList(t,l+p,r),s},n._lctf.readLookupList=function(t,e,o){var i=n._bin,r=e,a=[],s=i.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var f=i.readUshort(t,e);e+=2;var d=n._lctf.readLookupTable(t,r+f,o);a.push(d)}return a},n._lctf.readLookupTable=function(t,e,o){var i=n._bin,r=e,a={tabs:[]};a.ltype=i.readUshort(t,e),e+=2,a.flag=i.readUshort(t,e),e+=2;var s=i.readUshort(t,e);e+=2;for(var l=a.ltype,f=0;f<s;f++){var d=i.readUshort(t,e);e+=2;var p=o(t,l,r+d,a);a.tabs.push(p)}return a},n._lctf.numOfOnes=function(t){for(var e=0,o=0;o<32;o++)t>>>o&1&&e++;return e},n._lctf.readClassDef=function(t,e){var o=n._bin,i=[],r=o.readUshort(t,e);if(e+=2,r==1){var a=o.readUshort(t,e);e+=2;var s=o.readUshort(t,e);e+=2;for(var l=0;l<s;l++)i.push(a+l),i.push(a+l),i.push(o.readUshort(t,e)),e+=2}if(r==2){var f=o.readUshort(t,e);for(e+=2,l=0;l<f;l++)i.push(o.readUshort(t,e)),e+=2,i.push(o.readUshort(t,e)),e+=2,i.push(o.readUshort(t,e)),e+=2}return i},n._lctf.getInterval=function(t,e){for(var o=0;o<t.length;o+=3){var i=t[o],r=t[o+1];if(t[o+2],i<=e&&e<=r)return o}return-1},n._lctf.readCoverage=function(t,e){var o=n._bin,i={};i.fmt=o.readUshort(t,e),e+=2;var r=o.readUshort(t,e);return e+=2,i.fmt==1&&(i.tab=o.readUshorts(t,e,r)),i.fmt==2&&(i.tab=o.readUshorts(t,e,3*r)),i},n._lctf.coverageIndex=function(t,e){var o=t.tab;if(t.fmt==1)return o.indexOf(e);if(t.fmt==2){var i=n._lctf.getInterval(o,e);if(i!=-1)return o[i+2]+(e-o[i])}return-1},n._lctf.readFeatureList=function(t,e){var o=n._bin,i=e,r=[],a=o.readUshort(t,e);e+=2;for(var s=0;s<a;s++){var l=o.readASCII(t,e,4);e+=4;var f=o.readUshort(t,e);e+=2;var d=n._lctf.readFeatureTable(t,i+f);d.tag=l.trim(),r.push(d)}return r},n._lctf.readFeatureTable=function(t,e){var o=n._bin,i=e,r={},a=o.readUshort(t,e);e+=2,a>0&&(r.featureParams=i+a);var s=o.readUshort(t,e);e+=2,r.tab=[];for(var l=0;l<s;l++)r.tab.push(o.readUshort(t,e+2*l));return r},n._lctf.readScriptList=function(t,e){var o=n._bin,i=e,r={},a=o.readUshort(t,e);e+=2;for(var s=0;s<a;s++){var l=o.readASCII(t,e,4);e+=4;var f=o.readUshort(t,e);e+=2,r[l.trim()]=n._lctf.readScriptTable(t,i+f)}return r},n._lctf.readScriptTable=function(t,e){var o=n._bin,i=e,r={},a=o.readUshort(t,e);e+=2,a>0&&(r.default=n._lctf.readLangSysTable(t,i+a));var s=o.readUshort(t,e);e+=2;for(var l=0;l<s;l++){var f=o.readASCII(t,e,4);e+=4;var d=o.readUshort(t,e);e+=2,r[f.trim()]=n._lctf.readLangSysTable(t,i+d)}return r},n._lctf.readLangSysTable=function(t,e){var o=n._bin,i={};o.readUshort(t,e),e+=2,i.reqFeature=o.readUshort(t,e),e+=2;var r=o.readUshort(t,e);return e+=2,i.features=o.readUshorts(t,e,r),i},n.CFF={},n.CFF.parse=function(t,e,o){var i=n._bin;(t=new Uint8Array(t.buffer,e,o))[e=0],t[++e],t[++e],t[++e],e++;var r=[];e=n.CFF.readIndex(t,e,r);for(var a=[],s=0;s<r.length-1;s++)a.push(i.readASCII(t,e+r[s],r[s+1]-r[s]));e+=r[r.length-1];var l=[];e=n.CFF.readIndex(t,e,l);var f=[];for(s=0;s<l.length-1;s++)f.push(n.CFF.readDict(t,e+l[s],e+l[s+1]));e+=l[l.length-1];var d=f[0],p=[];e=n.CFF.readIndex(t,e,p);var m=[];for(s=0;s<p.length-1;s++)m.push(i.readASCII(t,e+p[s],p[s+1]-p[s]));if(e+=p[p.length-1],n.CFF.readSubrs(t,e,d),d.CharStrings){e=d.CharStrings,p=[],e=n.CFF.readIndex(t,e,p);var g=[];for(s=0;s<p.length-1;s++)g.push(i.readBytes(t,e+p[s],p[s+1]-p[s]));d.CharStrings=g}if(d.ROS){e=d.FDArray;var A=[];for(e=n.CFF.readIndex(t,e,A),d.FDArray=[],s=0;s<A.length-1;s++){var w=n.CFF.readDict(t,e+A[s],e+A[s+1]);n.CFF._readFDict(t,w,m),d.FDArray.push(w)}e+=A[A.length-1],e=d.FDSelect,d.FDSelect=[];var T=t[e];if(e++,T!=3)throw T;var b=i.readUshort(t,e);for(e+=2,s=0;s<b+1;s++)d.FDSelect.push(i.readUshort(t,e),t[e+2]),e+=3}return d.Encoding&&(d.Encoding=n.CFF.readEncoding(t,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=n.CFF.readCharset(t,d.charset,d.CharStrings.length)),n.CFF._readFDict(t,d,m),d},n.CFF._readFDict=function(t,e,o){var i;for(var r in e.Private&&(i=e.Private[1],e.Private=n.CFF.readDict(t,i,i+e.Private[0]),e.Private.Subrs&&n.CFF.readSubrs(t,i+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(r)!=-1&&(e[r]=o[e[r]-426+35])},n.CFF.readSubrs=function(t,e,o){var i=n._bin,r=[];e=n.CFF.readIndex(t,e,r);var a,s=r.length;a=s<1240?107:s<33900?1131:32768,o.Bias=a,o.Subrs=[];for(var l=0;l<r.length-1;l++)o.Subrs.push(i.readBytes(t,e+r[l],r[l+1]-r[l]))},n.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],n.CFF.glyphByUnicode=function(t,e){for(var o=0;o<t.charset.length;o++)if(t.charset[o]==e)return o;return-1},n.CFF.glyphBySE=function(t,e){return e<0||e>255?-1:n.CFF.glyphByUnicode(t,n.CFF.tableSE[e])},n.CFF.readEncoding=function(t,e,o){n._bin;var i=[".notdef"],r=t[e];if(e++,r!=0)throw"error: unknown encoding format: "+r;var a=t[e];e++;for(var s=0;s<a;s++)i.push(t[e+s]);return i},n.CFF.readCharset=function(t,e,o){var i=n._bin,r=[".notdef"],a=t[e];if(e++,a==0)for(var s=0;s<o;s++){var l=i.readUshort(t,e);e+=2,r.push(l)}else{if(a!=1&&a!=2)throw"error: format: "+a;for(;r.length<o;){l=i.readUshort(t,e),e+=2;var f=0;for(a==1?(f=t[e],e++):(f=i.readUshort(t,e),e+=2),s=0;s<=f;s++)r.push(l),l++}}return r},n.CFF.readIndex=function(t,e,o){var i=n._bin,r=i.readUshort(t,e)+1,a=t[e+=2];if(e++,a==1)for(var s=0;s<r;s++)o.push(t[e+s]);else if(a==2)for(s=0;s<r;s++)o.push(i.readUshort(t,e+2*s));else if(a==3)for(s=0;s<r;s++)o.push(16777215&i.readUint(t,e+3*s-1));else if(r!=1)throw"unsupported offset size: "+a+", count: "+r;return(e+=r*a)-1},n.CFF.getCharString=function(t,e,o){var i=n._bin,r=t[e],a=t[e+1];t[e+2],t[e+3],t[e+4];var s=1,l=null,f=null;r<=20&&(l=r,s=1),r==12&&(l=100*r+a,s=2),21<=r&&r<=27&&(l=r,s=1),r==28&&(f=i.readShort(t,e+1),s=3),29<=r&&r<=31&&(l=r,s=1),32<=r&&r<=246&&(f=r-139,s=1),247<=r&&r<=250&&(f=256*(r-247)+a+108,s=2),251<=r&&r<=254&&(f=256*-(r-251)-a-108,s=2),r==255&&(f=i.readInt(t,e+1)/65535,s=5),o.val=f??"o"+l,o.size=s},n.CFF.readCharString=function(t,e,o){for(var i=e+o,r=n._bin,a=[];e<i;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var f=1,d=null,p=null;s<=20&&(d=s,f=1),s==12&&(d=100*s+l,f=2),s!=19&&s!=20||(d=s,f=2),21<=s&&s<=27&&(d=s,f=1),s==28&&(p=r.readShort(t,e+1),f=3),29<=s&&s<=31&&(d=s,f=1),32<=s&&s<=246&&(p=s-139,f=1),247<=s&&s<=250&&(p=256*(s-247)+l+108,f=2),251<=s&&s<=254&&(p=256*-(s-251)-l-108,f=2),s==255&&(p=r.readInt(t,e+1)/65535,f=5),a.push(p??"o"+d),e+=f}return a},n.CFF.readDict=function(t,e,o){for(var i=n._bin,r={},a=[];e<o;){var s=t[e],l=t[e+1];t[e+2],t[e+3],t[e+4];var f=1,d=null,p=null;if(s==28&&(p=i.readShort(t,e+1),f=3),s==29&&(p=i.readInt(t,e+1),f=5),32<=s&&s<=246&&(p=s-139,f=1),247<=s&&s<=250&&(p=256*(s-247)+l+108,f=2),251<=s&&s<=254&&(p=256*-(s-251)-l-108,f=2),s==255)throw p=i.readInt(t,e+1)/65535,f=5,"unknown number";if(s==30){var m=[];for(f=1;;){var g=t[e+f];f++;var A=g>>4,w=15&g;if(A!=15&&m.push(A),w!=15&&m.push(w),w==15)break}for(var T="",b=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<m.length;S++)T+=b[m[S]];p=parseFloat(T)}s<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],f=1,s==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],f=2)),d!=null?(r[d]=a.length==1?a[0]:a,a=[]):a.push(p),e+=f}return r},n.cmap={},n.cmap.parse=function(t,e,o){t=new Uint8Array(t.buffer,e,o),e=0;var i=n._bin,r={};i.readUshort(t,e),e+=2;var a=i.readUshort(t,e);e+=2;var s=[];r.tables=[];for(var l=0;l<a;l++){var f=i.readUshort(t,e);e+=2;var d=i.readUshort(t,e);e+=2;var p=i.readUint(t,e);e+=4;var m="p"+f+"e"+d,g=s.indexOf(p);if(g==-1){var A;g=r.tables.length,s.push(p);var w=i.readUshort(t,p);w==0?A=n.cmap.parse0(t,p):w==4?A=n.cmap.parse4(t,p):w==6?A=n.cmap.parse6(t,p):w==12?A=n.cmap.parse12(t,p):console.debug("unknown format: "+w,f,d,p),r.tables.push(A)}if(r[m]!=null)throw"multiple tables for one platform+encoding";r[m]=g}return r},n.cmap.parse0=function(t,e){var o=n._bin,i={};i.format=o.readUshort(t,e),e+=2;var r=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2,i.map=[];for(var a=0;a<r-6;a++)i.map.push(t[e+a]);return i},n.cmap.parse4=function(t,e){var o=n._bin,i=e,r={};r.format=o.readUshort(t,e),e+=2;var a=o.readUshort(t,e);e+=2,o.readUshort(t,e),e+=2;var s=o.readUshort(t,e);e+=2;var l=s/2;r.searchRange=o.readUshort(t,e),e+=2,r.entrySelector=o.readUshort(t,e),e+=2,r.rangeShift=o.readUshort(t,e),e+=2,r.endCount=o.readUshorts(t,e,l),e+=2*l,e+=2,r.startCount=o.readUshorts(t,e,l),e+=2*l,r.idDelta=[];for(var f=0;f<l;f++)r.idDelta.push(o.readShort(t,e)),e+=2;for(r.idRangeOffset=o.readUshorts(t,e,l),e+=2*l,r.glyphIdArray=[];e<i+a;)r.glyphIdArray.push(o.readUshort(t,e)),e+=2;return r},n.cmap.parse6=function(t,e){var o=n._bin,i={};i.format=o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,o.readUshort(t,e),e+=2,i.firstCode=o.readUshort(t,e),e+=2;var r=o.readUshort(t,e);e+=2,i.glyphIdArray=[];for(var a=0;a<r;a++)i.glyphIdArray.push(o.readUshort(t,e)),e+=2;return i},n.cmap.parse12=function(t,e){var o=n._bin,i={};i.format=o.readUshort(t,e),e+=2,e+=2,o.readUint(t,e),e+=4,o.readUint(t,e),e+=4;var r=o.readUint(t,e);e+=4,i.groups=[];for(var a=0;a<r;a++){var s=e+12*a,l=o.readUint(t,s+0),f=o.readUint(t,s+4),d=o.readUint(t,s+8);i.groups.push([l,f,d])}return i},n.glyf={},n.glyf.parse=function(t,e,o,i){for(var r=[],a=0;a<i.maxp.numGlyphs;a++)r.push(null);return r},n.glyf._parseGlyf=function(t,e){var o=n._bin,i=t._data,r=n._tabOffset(i,"glyf",t._offset)+t.loca[e];if(t.loca[e]==t.loca[e+1])return null;var a={};if(a.noc=o.readShort(i,r),r+=2,a.xMin=o.readShort(i,r),r+=2,a.yMin=o.readShort(i,r),r+=2,a.xMax=o.readShort(i,r),r+=2,a.yMax=o.readShort(i,r),r+=2,a.xMin>=a.xMax||a.yMin>=a.yMax)return null;if(a.noc>0){a.endPts=[];for(var s=0;s<a.noc;s++)a.endPts.push(o.readUshort(i,r)),r+=2;var l=o.readUshort(i,r);if(r+=2,i.length-r<l)return null;a.instructions=o.readBytes(i,r,l),r+=l;var f=a.endPts[a.noc-1]+1;for(a.flags=[],s=0;s<f;s++){var d=i[r];if(r++,a.flags.push(d),(8&d)!=0){var p=i[r];r++;for(var m=0;m<p;m++)a.flags.push(d),s++}}for(a.xs=[],s=0;s<f;s++){var g=(2&a.flags[s])!=0,A=(16&a.flags[s])!=0;g?(a.xs.push(A?i[r]:-i[r]),r++):A?a.xs.push(0):(a.xs.push(o.readShort(i,r)),r+=2)}for(a.ys=[],s=0;s<f;s++)g=(4&a.flags[s])!=0,A=(32&a.flags[s])!=0,g?(a.ys.push(A?i[r]:-i[r]),r++):A?a.ys.push(0):(a.ys.push(o.readShort(i,r)),r+=2);var w=0,T=0;for(s=0;s<f;s++)w+=a.xs[s],T+=a.ys[s],a.xs[s]=w,a.ys[s]=T}else{var b;a.parts=[];do{b=o.readUshort(i,r),r+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(a.parts.push(S),S.glyphIndex=o.readUshort(i,r),r+=2,1&b){var M=o.readShort(i,r);r+=2;var x=o.readShort(i,r);r+=2}else M=o.readInt8(i,r),r++,x=o.readInt8(i,r),r++;2&b?(S.m.tx=M,S.m.ty=x):(S.p1=M,S.p2=x),8&b?(S.m.a=S.m.d=o.readF2dot14(i,r),r+=2):64&b?(S.m.a=o.readF2dot14(i,r),r+=2,S.m.d=o.readF2dot14(i,r),r+=2):128&b&&(S.m.a=o.readF2dot14(i,r),r+=2,S.m.b=o.readF2dot14(i,r),r+=2,S.m.c=o.readF2dot14(i,r),r+=2,S.m.d=o.readF2dot14(i,r),r+=2)}while(32&b);if(256&b){var E=o.readUshort(i,r);for(r+=2,a.instr=[],s=0;s<E;s++)a.instr.push(i[r]),r++}}return a},n.GDEF={},n.GDEF.parse=function(t,e,o,i){var r=e;e+=4;var a=n._bin.readUshort(t,e);return{glyphClassDef:a===0?null:n._lctf.readClassDef(t,r+a)}},n.GPOS={},n.GPOS.parse=function(t,e,o,i){return n._lctf.parse(t,e,o,i,n.GPOS.subt)},n.GPOS.subt=function(t,e,o,i){var r=n._bin,a=o,s={};if(s.fmt=r.readUshort(t,o),o+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var l=r.readUshort(t,o);o+=2,s.coverage=n._lctf.readCoverage(t,l+a)}if(e==1&&s.fmt==1){var f=r.readUshort(t,o);o+=2,f!=0&&(s.pos=n.GPOS.readValueRecord(t,o,f))}else if(e==2&&s.fmt>=1&&s.fmt<=2){f=r.readUshort(t,o),o+=2;var d=r.readUshort(t,o);o+=2;var p=n._lctf.numOfOnes(f),m=n._lctf.numOfOnes(d);if(s.fmt==1){s.pairsets=[];var g=r.readUshort(t,o);o+=2;for(var A=0;A<g;A++){var w=a+r.readUshort(t,o);o+=2;var T=r.readUshort(t,w);w+=2;for(var b=[],S=0;S<T;S++){var M=r.readUshort(t,w);w+=2,f!=0&&(y=n.GPOS.readValueRecord(t,w,f),w+=2*p),d!=0&&(F=n.GPOS.readValueRecord(t,w,d),w+=2*m),b.push({gid2:M,val1:y,val2:F})}s.pairsets.push(b)}}if(s.fmt==2){var x=r.readUshort(t,o);o+=2;var E=r.readUshort(t,o);o+=2;var R=r.readUshort(t,o);o+=2;var P=r.readUshort(t,o);for(o+=2,s.classDef1=n._lctf.readClassDef(t,a+x),s.classDef2=n._lctf.readClassDef(t,a+E),s.matrix=[],A=0;A<R;A++){var Y=[];for(S=0;S<P;S++){var y=null,F=null;f!=0&&(y=n.GPOS.readValueRecord(t,o,f),o+=2*p),d!=0&&(F=n.GPOS.readValueRecord(t,o,d),o+=2*m),Y.push({val1:y,val2:F})}s.matrix.push(Y)}}}else if(e==4&&s.fmt==1)s.markCoverage=n._lctf.readCoverage(t,r.readUshort(t,o)+a),s.baseCoverage=n._lctf.readCoverage(t,r.readUshort(t,o+2)+a),s.markClassCount=r.readUshort(t,o+4),s.markArray=n.GPOS.readMarkArray(t,r.readUshort(t,o+6)+a),s.baseArray=n.GPOS.readBaseArray(t,r.readUshort(t,o+8)+a,s.markClassCount);else if(e==6&&s.fmt==1)s.mark1Coverage=n._lctf.readCoverage(t,r.readUshort(t,o)+a),s.mark2Coverage=n._lctf.readCoverage(t,r.readUshort(t,o+2)+a),s.markClassCount=r.readUshort(t,o+4),s.mark1Array=n.GPOS.readMarkArray(t,r.readUshort(t,o+6)+a),s.mark2Array=n.GPOS.readBaseArray(t,r.readUshort(t,o+8)+a,s.markClassCount);else{if(e==9&&s.fmt==1){var k=r.readUshort(t,o);o+=2;var H=r.readUint(t,o);if(o+=4,i.ltype==9)i.ltype=k;else if(i.ltype!=k)throw"invalid extension substitution";return n.GPOS.subt(t,i.ltype,a+H)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},n.GPOS.readValueRecord=function(t,e,o){var i=n._bin,r=[];return r.push(1&o?i.readShort(t,e):0),e+=1&o?2:0,r.push(2&o?i.readShort(t,e):0),e+=2&o?2:0,r.push(4&o?i.readShort(t,e):0),e+=4&o?2:0,r.push(8&o?i.readShort(t,e):0),e+=8&o?2:0,r},n.GPOS.readBaseArray=function(t,e,o){var i=n._bin,r=[],a=e,s=i.readUshort(t,e);e+=2;for(var l=0;l<s;l++){for(var f=[],d=0;d<o;d++)f.push(n.GPOS.readAnchorRecord(t,a+i.readUshort(t,e))),e+=2;r.push(f)}return r},n.GPOS.readMarkArray=function(t,e){var o=n._bin,i=[],r=e,a=o.readUshort(t,e);e+=2;for(var s=0;s<a;s++){var l=n.GPOS.readAnchorRecord(t,o.readUshort(t,e+2)+r);l.markClass=o.readUshort(t,e),i.push(l),e+=4}return i},n.GPOS.readAnchorRecord=function(t,e){var o=n._bin,i={};return i.fmt=o.readUshort(t,e),i.x=o.readShort(t,e+2),i.y=o.readShort(t,e+4),i},n.GSUB={},n.GSUB.parse=function(t,e,o,i){return n._lctf.parse(t,e,o,i,n.GSUB.subt)},n.GSUB.subt=function(t,e,o,i){var r=n._bin,a=o,s={};if(s.fmt=r.readUshort(t,o),o+=2,e!=1&&e!=2&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==2||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var l=r.readUshort(t,o);o+=2,s.coverage=n._lctf.readCoverage(t,a+l)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=r.readShort(t,o),o+=2;else if(s.fmt==2){var f=r.readUshort(t,o);o+=2,s.newg=r.readUshorts(t,o,f),o+=2*s.newg.length}}else if(e==2&&s.fmt==1){f=r.readUshort(t,o),o+=2,s.seqs=[];for(var d=0;d<f;d++){var p=r.readUshort(t,o)+a;o+=2;var m=r.readUshort(t,p);s.seqs.push(r.readUshorts(t,p+2,m))}}else if(e==4)for(s.vals=[],f=r.readUshort(t,o),o+=2,d=0;d<f;d++){var g=r.readUshort(t,o);o+=2,s.vals.push(n.GSUB.readLigatureSet(t,a+g))}else if(e==5&&s.fmt==2){if(s.fmt==2){var A=r.readUshort(t,o);o+=2,s.cDef=n._lctf.readClassDef(t,a+A),s.scset=[];var w=r.readUshort(t,o);for(o+=2,d=0;d<w;d++){var T=r.readUshort(t,o);o+=2,s.scset.push(T==0?null:n.GSUB.readSubClassSet(t,a+T))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(d=0;d<3;d++){f=r.readUshort(t,o),o+=2;for(var b=[],S=0;S<f;S++)b.push(n._lctf.readCoverage(t,a+r.readUshort(t,o+2*S)));o+=2*f,d==0&&(s.backCvg=b),d==1&&(s.inptCvg=b),d==2&&(s.ahedCvg=b)}f=r.readUshort(t,o),o+=2,s.lookupRec=n.GSUB.readSubstLookupRecords(t,o,f)}}else{if(e==7&&s.fmt==1){var M=r.readUshort(t,o);o+=2;var x=r.readUint(t,o);if(o+=4,i.ltype==9)i.ltype=M;else if(i.ltype!=M)throw"invalid extension substitution";return n.GSUB.subt(t,i.ltype,a+x)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},n.GSUB.readSubClassSet=function(t,e){var o=n._bin.readUshort,i=e,r=[],a=o(t,e);e+=2;for(var s=0;s<a;s++){var l=o(t,e);e+=2,r.push(n.GSUB.readSubClassRule(t,i+l))}return r},n.GSUB.readSubClassRule=function(t,e){var o=n._bin.readUshort,i={},r=o(t,e),a=o(t,e+=2);e+=2,i.input=[];for(var s=0;s<r-1;s++)i.input.push(o(t,e)),e+=2;return i.substLookupRecords=n.GSUB.readSubstLookupRecords(t,e,a),i},n.GSUB.readSubstLookupRecords=function(t,e,o){for(var i=n._bin.readUshort,r=[],a=0;a<o;a++)r.push(i(t,e),i(t,e+2)),e+=4;return r},n.GSUB.readChainSubClassSet=function(t,e){var o=n._bin,i=e,r=[],a=o.readUshort(t,e);e+=2;for(var s=0;s<a;s++){var l=o.readUshort(t,e);e+=2,r.push(n.GSUB.readChainSubClassRule(t,i+l))}return r},n.GSUB.readChainSubClassRule=function(t,e){for(var o=n._bin,i={},r=["backtrack","input","lookahead"],a=0;a<r.length;a++){var s=o.readUshort(t,e);e+=2,a==1&&s--,i[r[a]]=o.readUshorts(t,e,s),e+=2*i[r[a]].length}return s=o.readUshort(t,e),e+=2,i.subst=o.readUshorts(t,e,2*s),e+=2*i.subst.length,i},n.GSUB.readLigatureSet=function(t,e){var o=n._bin,i=e,r=[],a=o.readUshort(t,e);e+=2;for(var s=0;s<a;s++){var l=o.readUshort(t,e);e+=2,r.push(n.GSUB.readLigature(t,i+l))}return r},n.GSUB.readLigature=function(t,e){var o=n._bin,i={chain:[]};i.nglyph=o.readUshort(t,e),e+=2;var r=o.readUshort(t,e);e+=2;for(var a=0;a<r-1;a++)i.chain.push(o.readUshort(t,e)),e+=2;return i},n.head={},n.head.parse=function(t,e,o){var i=n._bin,r={};return i.readFixed(t,e),e+=4,r.fontRevision=i.readFixed(t,e),e+=4,i.readUint(t,e),e+=4,i.readUint(t,e),e+=4,r.flags=i.readUshort(t,e),e+=2,r.unitsPerEm=i.readUshort(t,e),e+=2,r.created=i.readUint64(t,e),e+=8,r.modified=i.readUint64(t,e),e+=8,r.xMin=i.readShort(t,e),e+=2,r.yMin=i.readShort(t,e),e+=2,r.xMax=i.readShort(t,e),e+=2,r.yMax=i.readShort(t,e),e+=2,r.macStyle=i.readUshort(t,e),e+=2,r.lowestRecPPEM=i.readUshort(t,e),e+=2,r.fontDirectionHint=i.readShort(t,e),e+=2,r.indexToLocFormat=i.readShort(t,e),e+=2,r.glyphDataFormat=i.readShort(t,e),e+=2,r},n.hhea={},n.hhea.parse=function(t,e,o){var i=n._bin,r={};return i.readFixed(t,e),e+=4,r.ascender=i.readShort(t,e),e+=2,r.descender=i.readShort(t,e),e+=2,r.lineGap=i.readShort(t,e),e+=2,r.advanceWidthMax=i.readUshort(t,e),e+=2,r.minLeftSideBearing=i.readShort(t,e),e+=2,r.minRightSideBearing=i.readShort(t,e),e+=2,r.xMaxExtent=i.readShort(t,e),e+=2,r.caretSlopeRise=i.readShort(t,e),e+=2,r.caretSlopeRun=i.readShort(t,e),e+=2,r.caretOffset=i.readShort(t,e),e+=2,e+=8,r.metricDataFormat=i.readShort(t,e),e+=2,r.numberOfHMetrics=i.readUshort(t,e),e+=2,r},n.hmtx={},n.hmtx.parse=function(t,e,o,i){for(var r=n._bin,a={aWidth:[],lsBearing:[]},s=0,l=0,f=0;f<i.maxp.numGlyphs;f++)f<i.hhea.numberOfHMetrics&&(s=r.readUshort(t,e),e+=2,l=r.readShort(t,e),e+=2),a.aWidth.push(s),a.lsBearing.push(l);return a},n.kern={},n.kern.parse=function(t,e,o,i){var r=n._bin,a=r.readUshort(t,e);if(e+=2,a==1)return n.kern.parseV1(t,e-2,o,i);var s=r.readUshort(t,e);e+=2;for(var l={glyph1:[],rval:[]},f=0;f<s;f++){e+=2,o=r.readUshort(t,e),e+=2;var d=r.readUshort(t,e);e+=2;var p=d>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;e=n.kern.readFormat0(t,e,l)}return l},n.kern.parseV1=function(t,e,o,i){var r=n._bin;r.readFixed(t,e),e+=4;var a=r.readUint(t,e);e+=4;for(var s={glyph1:[],rval:[]},l=0;l<a;l++){r.readUint(t,e),e+=4;var f=r.readUshort(t,e);e+=2,r.readUshort(t,e),e+=2;var d=f>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;e=n.kern.readFormat0(t,e,s)}return s},n.kern.readFormat0=function(t,e,o){var i=n._bin,r=-1,a=i.readUshort(t,e);e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2,i.readUshort(t,e),e+=2;for(var s=0;s<a;s++){var l=i.readUshort(t,e);e+=2;var f=i.readUshort(t,e);e+=2;var d=i.readShort(t,e);e+=2,l!=r&&(o.glyph1.push(l),o.rval.push({glyph2:[],vals:[]}));var p=o.rval[o.rval.length-1];p.glyph2.push(f),p.vals.push(d),r=l}return e},n.loca={},n.loca.parse=function(t,e,o,i){var r=n._bin,a=[],s=i.head.indexToLocFormat,l=i.maxp.numGlyphs+1;if(s==0)for(var f=0;f<l;f++)a.push(r.readUshort(t,e+(f<<1))<<1);if(s==1)for(f=0;f<l;f++)a.push(r.readUint(t,e+(f<<2)));return a},n.maxp={},n.maxp.parse=function(t,e,o){var i=n._bin,r={},a=i.readUint(t,e);return e+=4,r.numGlyphs=i.readUshort(t,e),e+=2,a==65536&&(r.maxPoints=i.readUshort(t,e),e+=2,r.maxContours=i.readUshort(t,e),e+=2,r.maxCompositePoints=i.readUshort(t,e),e+=2,r.maxCompositeContours=i.readUshort(t,e),e+=2,r.maxZones=i.readUshort(t,e),e+=2,r.maxTwilightPoints=i.readUshort(t,e),e+=2,r.maxStorage=i.readUshort(t,e),e+=2,r.maxFunctionDefs=i.readUshort(t,e),e+=2,r.maxInstructionDefs=i.readUshort(t,e),e+=2,r.maxStackElements=i.readUshort(t,e),e+=2,r.maxSizeOfInstructions=i.readUshort(t,e),e+=2,r.maxComponentElements=i.readUshort(t,e),e+=2,r.maxComponentDepth=i.readUshort(t,e),e+=2),r},n.name={},n.name.parse=function(t,e,o){var i=n._bin,r={};i.readUshort(t,e),e+=2;var a=i.readUshort(t,e);e+=2,i.readUshort(t,e);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=e+=2,d=0;d<a;d++){var p=i.readUshort(t,e);e+=2;var m=i.readUshort(t,e);e+=2;var g=i.readUshort(t,e);e+=2;var A=i.readUshort(t,e);e+=2;var w=i.readUshort(t,e);e+=2;var T=i.readUshort(t,e);e+=2;var b,S=l[A],M=f+12*a+T;if(p==0)b=i.readUnicode(t,M,w/2);else if(p==3&&m==0)b=i.readUnicode(t,M,w/2);else if(m==0)b=i.readASCII(t,M,w);else if(m==1)b=i.readUnicode(t,M,w/2);else if(m==3)b=i.readUnicode(t,M,w/2);else{if(p!=1)throw"unknown encoding "+m+", platformID: "+p;b=i.readASCII(t,M,w),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var x="p"+p+","+g.toString(16);r[x]==null&&(r[x]={}),r[x][S!==void 0?S:A]=b,r[x]._lang=g}for(var E in r)if(r[E].postScriptName!=null&&r[E]._lang==1033)return r[E];for(var E in r)if(r[E].postScriptName!=null&&r[E]._lang==0)return r[E];for(var E in r)if(r[E].postScriptName!=null&&r[E]._lang==3084)return r[E];for(var E in r)if(r[E].postScriptName!=null)return r[E];for(var E in r){s=E;break}return console.debug("returning name table with languageID "+r[s]._lang),r[s]},n["OS/2"]={},n["OS/2"].parse=function(t,e,o){var i=n._bin.readUshort(t,e);e+=2;var r={};if(i==0)n["OS/2"].version0(t,e,r);else if(i==1)n["OS/2"].version1(t,e,r);else if(i==2||i==3||i==4)n["OS/2"].version2(t,e,r);else{if(i!=5)throw"unknown OS/2 table version: "+i;n["OS/2"].version5(t,e,r)}return r},n["OS/2"].version0=function(t,e,o){var i=n._bin;return o.xAvgCharWidth=i.readShort(t,e),e+=2,o.usWeightClass=i.readUshort(t,e),e+=2,o.usWidthClass=i.readUshort(t,e),e+=2,o.fsType=i.readUshort(t,e),e+=2,o.ySubscriptXSize=i.readShort(t,e),e+=2,o.ySubscriptYSize=i.readShort(t,e),e+=2,o.ySubscriptXOffset=i.readShort(t,e),e+=2,o.ySubscriptYOffset=i.readShort(t,e),e+=2,o.ySuperscriptXSize=i.readShort(t,e),e+=2,o.ySuperscriptYSize=i.readShort(t,e),e+=2,o.ySuperscriptXOffset=i.readShort(t,e),e+=2,o.ySuperscriptYOffset=i.readShort(t,e),e+=2,o.yStrikeoutSize=i.readShort(t,e),e+=2,o.yStrikeoutPosition=i.readShort(t,e),e+=2,o.sFamilyClass=i.readShort(t,e),e+=2,o.panose=i.readBytes(t,e,10),e+=10,o.ulUnicodeRange1=i.readUint(t,e),e+=4,o.ulUnicodeRange2=i.readUint(t,e),e+=4,o.ulUnicodeRange3=i.readUint(t,e),e+=4,o.ulUnicodeRange4=i.readUint(t,e),e+=4,o.achVendID=[i.readInt8(t,e),i.readInt8(t,e+1),i.readInt8(t,e+2),i.readInt8(t,e+3)],e+=4,o.fsSelection=i.readUshort(t,e),e+=2,o.usFirstCharIndex=i.readUshort(t,e),e+=2,o.usLastCharIndex=i.readUshort(t,e),e+=2,o.sTypoAscender=i.readShort(t,e),e+=2,o.sTypoDescender=i.readShort(t,e),e+=2,o.sTypoLineGap=i.readShort(t,e),e+=2,o.usWinAscent=i.readUshort(t,e),e+=2,o.usWinDescent=i.readUshort(t,e),e+=2},n["OS/2"].version1=function(t,e,o){var i=n._bin;return e=n["OS/2"].version0(t,e,o),o.ulCodePageRange1=i.readUint(t,e),e+=4,o.ulCodePageRange2=i.readUint(t,e),e+=4},n["OS/2"].version2=function(t,e,o){var i=n._bin;return e=n["OS/2"].version1(t,e,o),o.sxHeight=i.readShort(t,e),e+=2,o.sCapHeight=i.readShort(t,e),e+=2,o.usDefault=i.readUshort(t,e),e+=2,o.usBreak=i.readUshort(t,e),e+=2,o.usMaxContext=i.readUshort(t,e),e+=2},n["OS/2"].version5=function(t,e,o){var i=n._bin;return e=n["OS/2"].version2(t,e,o),o.usLowerOpticalPointSize=i.readUshort(t,e),e+=2,o.usUpperOpticalPointSize=i.readUshort(t,e),e+=2},n.post={},n.post.parse=function(t,e,o){var i=n._bin,r={};return r.version=i.readFixed(t,e),e+=4,r.italicAngle=i.readFixed(t,e),e+=4,r.underlinePosition=i.readShort(t,e),e+=2,r.underlineThickness=i.readShort(t,e),e+=2,r},n==null&&(n={}),n.U==null&&(n.U={}),n.U.codeToGlyph=function(t,e){var o=t.cmap,i=-1;if(o.p0e4!=null?i=o.p0e4:o.p3e1!=null?i=o.p3e1:o.p1e0!=null?i=o.p1e0:o.p0e3!=null&&(i=o.p0e3),i==-1)throw"no familiar platform and encoding!";var r=o.tables[i];if(r.format==0)return e>=r.map.length?0:r.map[e];if(r.format==4){for(var a=-1,s=0;s<r.endCount.length;s++)if(e<=r.endCount[s]){a=s;break}return a==-1||r.startCount[a]>e?0:65535&(r.idRangeOffset[a]!=0?r.glyphIdArray[e-r.startCount[a]+(r.idRangeOffset[a]>>1)-(r.idRangeOffset.length-a)]:e+r.idDelta[a])}if(r.format==12){if(e>r.groups[r.groups.length-1][1])return 0;for(s=0;s<r.groups.length;s++){var l=r.groups[s];if(l[0]<=e&&e<=l[1])return l[2]+(e-l[0])}return 0}throw"unknown cmap table format "+r.format},n.U.glyphToPath=function(t,e){var o={cmds:[],crds:[]};if(t.SVG&&t.SVG.entries[e]){var i=t.SVG.entries[e];return i==null?o:(typeof i=="string"&&(i=n.SVG.toPath(i),t.SVG.entries[e]=i),i)}if(t.CFF){var r={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:t.CFF.Private?t.CFF.Private.defaultWidthX:0,open:!1},a=t.CFF,s=t.CFF.Private;if(a.ROS){for(var l=0;a.FDSelect[l+2]<=e;)l+=2;s=a.FDArray[a.FDSelect[l+1]].Private}n.U._drawCFF(t.CFF.CharStrings[e],r,a,s,o)}else t.glyf&&n.U._drawGlyf(e,t,o);return o},n.U._drawGlyf=function(t,e,o){var i=e.glyf[t];i==null&&(i=e.glyf[t]=n.glyf._parseGlyf(e,t)),i!=null&&(i.noc>-1?n.U._simpleGlyph(i,o):n.U._compoGlyph(i,e,o))},n.U._simpleGlyph=function(t,e){for(var o=0;o<t.noc;o++){for(var i=o==0?0:t.endPts[o-1]+1,r=t.endPts[o],a=i;a<=r;a++){var s=a==i?r:a-1,l=a==r?i:a+1,f=1&t.flags[a],d=1&t.flags[s],p=1&t.flags[l],m=t.xs[a],g=t.ys[a];if(a==i)if(f){if(!d){n.U.P.moveTo(e,m,g);continue}n.U.P.moveTo(e,t.xs[s],t.ys[s])}else d?n.U.P.moveTo(e,t.xs[s],t.ys[s]):n.U.P.moveTo(e,(t.xs[s]+m)/2,(t.ys[s]+g)/2);f?d&&n.U.P.lineTo(e,m,g):p?n.U.P.qcurveTo(e,m,g,t.xs[l],t.ys[l]):n.U.P.qcurveTo(e,m,g,(m+t.xs[l])/2,(g+t.ys[l])/2)}n.U.P.closePath(e)}},n.U._compoGlyph=function(t,e,o){for(var i=0;i<t.parts.length;i++){var r={cmds:[],crds:[]},a=t.parts[i];n.U._drawGlyf(a.glyphIndex,e,r);for(var s=a.m,l=0;l<r.crds.length;l+=2){var f=r.crds[l],d=r.crds[l+1];o.crds.push(f*s.a+d*s.b+s.tx),o.crds.push(f*s.c+d*s.d+s.ty)}for(l=0;l<r.cmds.length;l++)o.cmds.push(r.cmds[l])}},n.U._getGlyphClass=function(t,e){var o=n._lctf.getInterval(e,t);return o==-1?0:e[o+2]},n.U._applySubs=function(t,e,o,i){for(var r=t.length-e-1,a=0;a<o.tabs.length;a++)if(o.tabs[a]!=null){var s,l=o.tabs[a];if(!l.coverage||(s=n._lctf.coverageIndex(l.coverage,t[e]))!=-1){if(o.ltype==1)t[e],l.fmt==1?t[e]=t[e]+l.delta:t[e]=l.newg[s];else if(o.ltype==4)for(var f=l.vals[s],d=0;d<f.length;d++){var p=f[d],m=p.chain.length;if(!(m>r)){for(var g=!0,A=0,w=0;w<m;w++){for(;t[e+A+(1+w)]==-1;)A++;p.chain[w]!=t[e+A+(1+w)]&&(g=!1)}if(g){for(t[e]=p.nglyph,w=0;w<m+A;w++)t[e+w+1]=-1;break}}}else if(o.ltype==5&&l.fmt==2)for(var T=n._lctf.getInterval(l.cDef,t[e]),b=l.cDef[T+2],S=l.scset[b],M=0;M<S.length;M++){var x=S[M],E=x.input;if(!(E.length>r)){for(g=!0,w=0;w<E.length;w++){var R=n._lctf.getInterval(l.cDef,t[e+1+w]);if(T==-1&&l.cDef[R+2]!=E[w]){g=!1;break}}if(g){var P=x.substLookupRecords;for(d=0;d<P.length;d+=2)P[d],P[d+1]}}}else if(o.ltype==6&&l.fmt==3){if(!n.U._glsCovered(t,l.backCvg,e-l.backCvg.length)||!n.U._glsCovered(t,l.inptCvg,e)||!n.U._glsCovered(t,l.ahedCvg,e+l.inptCvg.length))continue;var Y=l.lookupRec;for(M=0;M<Y.length;M+=2){T=Y[M];var y=i[Y[M+1]];n.U._applySubs(t,e+T,y,i)}}}}},n.U._glsCovered=function(t,e,o){for(var i=0;i<e.length;i++)if(n._lctf.coverageIndex(e[i],t[o+i])==-1)return!1;return!0},n.U.glyphsToPath=function(t,e,o){for(var i={cmds:[],crds:[]},r=0,a=0;a<e.length;a++){var s=e[a];if(s!=-1){for(var l=a<e.length-1&&e[a+1]!=-1?e[a+1]:0,f=n.U.glyphToPath(t,s),d=0;d<f.crds.length;d+=2)i.crds.push(f.crds[d]+r),i.crds.push(f.crds[d+1]);for(o&&i.cmds.push(o),d=0;d<f.cmds.length;d++)i.cmds.push(f.cmds[d]);o&&i.cmds.push("X"),r+=t.hmtx.aWidth[s],a<e.length-1&&(r+=n.U.getPairAdjustment(t,s,l))}}return i},n.U.P={},n.U.P.moveTo=function(t,e,o){t.cmds.push("M"),t.crds.push(e,o)},n.U.P.lineTo=function(t,e,o){t.cmds.push("L"),t.crds.push(e,o)},n.U.P.curveTo=function(t,e,o,i,r,a,s){t.cmds.push("C"),t.crds.push(e,o,i,r,a,s)},n.U.P.qcurveTo=function(t,e,o,i,r){t.cmds.push("Q"),t.crds.push(e,o,i,r)},n.U.P.closePath=function(t){t.cmds.push("Z")},n.U._drawCFF=function(t,e,o,i,r){for(var a=e.stack,s=e.nStems,l=e.haveWidth,f=e.width,d=e.open,p=0,m=e.x,g=e.y,A=0,w=0,T=0,b=0,S=0,M=0,x=0,E=0,R=0,P=0,Y={val:0,size:0};p<t.length;){n.CFF.getCharString(t,p,Y);var y=Y.val;if(p+=Y.size,y=="o1"||y=="o18")a.length%2!=0&&!l&&(f=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if(y=="o3"||y=="o23")a.length%2!=0&&!l&&(f=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0;else if(y=="o4")a.length>1&&!l&&(f=a.shift()+i.nominalWidthX,l=!0),d&&n.U.P.closePath(r),g+=a.pop(),n.U.P.moveTo(r,m,g),d=!0;else if(y=="o5")for(;a.length>0;)m+=a.shift(),g+=a.shift(),n.U.P.lineTo(r,m,g);else if(y=="o6"||y=="o7")for(var F=a.length,k=y=="o6",H=0;H<F;H++){var j=a.shift();k?m+=j:g+=j,k=!k,n.U.P.lineTo(r,m,g)}else if(y=="o8"||y=="o24"){F=a.length;for(var q=0;q+6<=F;)A=m+a.shift(),w=g+a.shift(),T=A+a.shift(),b=w+a.shift(),m=T+a.shift(),g=b+a.shift(),n.U.P.curveTo(r,A,w,T,b,m,g),q+=6;y=="o24"&&(m+=a.shift(),g+=a.shift(),n.U.P.lineTo(r,m,g))}else{if(y=="o11")break;if(y=="o1234"||y=="o1235"||y=="o1236"||y=="o1237")y=="o1234"&&(w=g,T=(A=m+a.shift())+a.shift(),P=b=w+a.shift(),M=b,E=g,m=(x=(S=(R=T+a.shift())+a.shift())+a.shift())+a.shift(),n.U.P.curveTo(r,A,w,T,b,R,P),n.U.P.curveTo(r,S,M,x,E,m,g)),y=="o1235"&&(A=m+a.shift(),w=g+a.shift(),T=A+a.shift(),b=w+a.shift(),R=T+a.shift(),P=b+a.shift(),S=R+a.shift(),M=P+a.shift(),x=S+a.shift(),E=M+a.shift(),m=x+a.shift(),g=E+a.shift(),a.shift(),n.U.P.curveTo(r,A,w,T,b,R,P),n.U.P.curveTo(r,S,M,x,E,m,g)),y=="o1236"&&(A=m+a.shift(),w=g+a.shift(),T=A+a.shift(),P=b=w+a.shift(),M=b,x=(S=(R=T+a.shift())+a.shift())+a.shift(),E=M+a.shift(),m=x+a.shift(),n.U.P.curveTo(r,A,w,T,b,R,P),n.U.P.curveTo(r,S,M,x,E,m,g)),y=="o1237"&&(A=m+a.shift(),w=g+a.shift(),T=A+a.shift(),b=w+a.shift(),R=T+a.shift(),P=b+a.shift(),S=R+a.shift(),M=P+a.shift(),x=S+a.shift(),E=M+a.shift(),Math.abs(x-m)>Math.abs(E-g)?m=x+a.shift():g=E+a.shift(),n.U.P.curveTo(r,A,w,T,b,R,P),n.U.P.curveTo(r,S,M,x,E,m,g));else if(y=="o14"){if(a.length>0&&!l&&(f=a.shift()+o.nominalWidthX,l=!0),a.length==4){var ne=a.shift(),G=a.shift(),O=a.shift(),v=a.shift(),_=n.CFF.glyphBySE(o,O),D=n.CFF.glyphBySE(o,v);n.U._drawCFF(o.CharStrings[_],e,o,i,r),e.x=ne,e.y=G,n.U._drawCFF(o.CharStrings[D],e,o,i,r)}d&&(n.U.P.closePath(r),d=!1)}else if(y=="o19"||y=="o20")a.length%2!=0&&!l&&(f=a.shift()+i.nominalWidthX),s+=a.length>>1,a.length=0,l=!0,p+=s+7>>3;else if(y=="o21")a.length>2&&!l&&(f=a.shift()+i.nominalWidthX,l=!0),g+=a.pop(),m+=a.pop(),d&&n.U.P.closePath(r),n.U.P.moveTo(r,m,g),d=!0;else if(y=="o22")a.length>1&&!l&&(f=a.shift()+i.nominalWidthX,l=!0),m+=a.pop(),d&&n.U.P.closePath(r),n.U.P.moveTo(r,m,g),d=!0;else if(y=="o25"){for(;a.length>6;)m+=a.shift(),g+=a.shift(),n.U.P.lineTo(r,m,g);A=m+a.shift(),w=g+a.shift(),T=A+a.shift(),b=w+a.shift(),m=T+a.shift(),g=b+a.shift(),n.U.P.curveTo(r,A,w,T,b,m,g)}else if(y=="o26")for(a.length%2&&(m+=a.shift());a.length>0;)A=m,w=g+a.shift(),m=T=A+a.shift(),g=(b=w+a.shift())+a.shift(),n.U.P.curveTo(r,A,w,T,b,m,g);else if(y=="o27")for(a.length%2&&(g+=a.shift());a.length>0;)w=g,T=(A=m+a.shift())+a.shift(),b=w+a.shift(),m=T+a.shift(),g=b,n.U.P.curveTo(r,A,w,T,b,m,g);else if(y=="o10"||y=="o29"){var C=y=="o10"?i:o;if(a.length==0)console.debug("error: empty stack");else{var U=a.pop(),z=C.Subrs[U+C.Bias];e.x=m,e.y=g,e.nStems=s,e.haveWidth=l,e.width=f,e.open=d,n.U._drawCFF(z,e,o,i,r),m=e.x,g=e.y,s=e.nStems,l=e.haveWidth,f=e.width,d=e.open}}else if(y=="o30"||y=="o31"){var L=a.length,I=(q=0,y=="o31");for(q+=L-(F=-3&L);q<F;)I?(w=g,T=(A=m+a.shift())+a.shift(),g=(b=w+a.shift())+a.shift(),F-q==5?(m=T+a.shift(),q++):m=T,I=!1):(A=m,w=g+a.shift(),T=A+a.shift(),b=w+a.shift(),m=T+a.shift(),F-q==5?(g=b+a.shift(),q++):g=b,I=!0),n.U.P.curveTo(r,A,w,T,b,m,g),q+=4}else{if((y+"").charAt(0)=="o")throw console.debug("Unknown operation: "+y,t),y;a.push(y)}}}e.x=m,e.y=g,e.nStems=s,e.haveWidth=l,e.width=f,e.open=d};var c=n,u={Typr:c};return h.Typr=c,h.default=u,Object.defineProperty(h,"__esModule",{value:!0}),h}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function oi(){return function(h){var n=Uint8Array,c=Uint16Array,u=Uint32Array,t=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(y,F){for(var k=new c(31),H=0;H<31;++H)k[H]=F+=1<<y[H-1];var j=new u(k[30]);for(H=1;H<30;++H)for(var q=k[H];q<k[H+1];++q)j[q]=q-k[H]<<5|H;return[k,j]},r=i(t,2),a=r[0],s=r[1];a[28]=258,s[258]=28;for(var l=i(e,0)[0],f=new c(32768),d=0;d<32768;++d){var p=(43690&d)>>>1|(21845&d)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,f[d]=((65280&p)>>>8|(255&p)<<8)>>>1}var m=function(y,F,k){for(var H=y.length,j=0,q=new c(F);j<H;++j)++q[y[j]-1];var ne,G=new c(F);for(j=0;j<F;++j)G[j]=G[j-1]+q[j-1]<<1;{ne=new c(1<<F);var O=15-F;for(j=0;j<H;++j)if(y[j])for(var v=j<<4|y[j],_=F-y[j],D=G[y[j]-1]++<<_,C=D|(1<<_)-1;D<=C;++D)ne[f[D]>>>O]=v}return ne},g=new n(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var A=new n(32);for(d=0;d<32;++d)A[d]=5;var w=m(g,9),T=m(A,5),b=function(y){for(var F=y[0],k=1;k<y.length;++k)y[k]>F&&(F=y[k]);return F},S=function(y,F,k){var H=F/8|0;return(y[H]|y[H+1]<<8)>>(7&F)&k},M=function(y,F){var k=F/8|0;return(y[k]|y[k+1]<<8|y[k+2]<<16)>>(7&F)},x=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(y,F,k){var H=new Error(F||x[y]);if(H.code=y,Error.captureStackTrace&&Error.captureStackTrace(H,E),!k)throw H;return H},R=function(y,F,k){var H=y.length;if(!H||k&&!k.l&&H<5)return F||new n(0);var j=!F||k,q=!k||k.i;k||(k={}),F||(F=new n(3*H));var ne,G=function(le){var Me=F.length;if(le>Me){var ke=new n(Math.max(2*Me,le));ke.set(F),F=ke}},O=k.f||0,v=k.p||0,_=k.b||0,D=k.l,C=k.d,U=k.m,z=k.n,L=8*H;do{if(!D){k.f=O=S(y,v,1);var I=S(y,v+1,3);if(v+=3,!I){var X=y[(Q=((ne=v)/8|0)+(7&ne&&1)+4)-4]|y[Q-3]<<8,$=Q+X;if($>H){q&&E(0);break}j&&G(_+X),F.set(y.subarray(Q,$),_),k.b=_+=X,k.p=v=8*$;continue}if(I==1)D=w,C=T,U=9,z=5;else if(I==2){var V=S(y,v,31)+257,N=S(y,v+10,15)+4,me=V+S(y,v+5,31)+1;v+=14;for(var ce=new n(me),J=new n(19),ee=0;ee<N;++ee)J[o[ee]]=S(y,v+3*ee,7);v+=3*N;var se=b(J),W=(1<<se)-1,te=m(J,se);for(ee=0;ee<me;){var Q,B=te[S(y,v,W)];if(v+=15&B,(Q=B>>>4)<16)ce[ee++]=Q;else{var fe=0,Z=0;for(Q==16?(Z=3+S(y,v,3),v+=2,fe=ce[ee-1]):Q==17?(Z=3+S(y,v,7),v+=3):Q==18&&(Z=11+S(y,v,127),v+=7);Z--;)ce[ee++]=fe}}var oe=ce.subarray(0,V),K=ce.subarray(V);U=b(oe),z=b(K),D=m(oe,U),C=m(K,z)}else E(1);if(v>L){q&&E(0);break}}j&&G(_+131072);for(var _e=(1<<U)-1,re=(1<<z)-1,ie=v;;ie=v){var he=(fe=D[M(y,v)&_e])>>>4;if((v+=15&fe)>L){q&&E(0);break}if(fe||E(2),he<256)F[_++]=he;else{if(he==256){ie=v,D=null;break}var de=he-254;if(he>264){var Te=t[ee=he-257];de=S(y,v,(1<<Te)-1)+a[ee],v+=Te}var Ce=C[M(y,v)&re],ge=Ce>>>4;if(Ce||E(3),v+=15&Ce,K=l[ge],ge>3&&(Te=e[ge],K+=M(y,v)&(1<<Te)-1,v+=Te),v>L){q&&E(0);break}j&&G(_+131072);for(var ve=_+de;_<ve;_+=4)F[_]=F[_-K],F[_+1]=F[_+1-K],F[_+2]=F[_+2-K],F[_+3]=F[_+3-K];_=ve}}k.l=D,k.p=ie,k.b=_,D&&(O=1,k.m=U,k.d=C,k.n=z)}while(!O);return _==F.length?F:function(le,Me,ke){(ke==null||ke>le.length)&&(ke=le.length);var je=new(le instanceof c?c:le instanceof u?u:n)(ke-Me);return je.set(le.subarray(Me,ke)),je}(F,0,_)},P=new n(0),Y=typeof TextDecoder<"u"&&new TextDecoder;try{Y.decode(P,{stream:!0})}catch{}return h.convert_streams=function(y){var F=new DataView(y),k=0;function H(){var V=F.getUint16(k);return k+=2,V}function j(){var V=F.getUint32(k);return k+=4,V}function q(V){X.setUint16($,V),$+=2}function ne(V){X.setUint32($,V),$+=4}for(var G={signature:j(),flavor:j(),length:j(),numTables:H(),reserved:H(),totalSfntSize:j(),majorVersion:H(),minorVersion:H(),metaOffset:j(),metaLength:j(),metaOrigLength:j(),privOffset:j(),privLength:j()},O=0;Math.pow(2,O)<=G.numTables;)O++;O--;for(var v=16*Math.pow(2,O),_=16*G.numTables-v,D=12,C=[],U=0;U<G.numTables;U++)C.push({tag:j(),offset:j(),compLength:j(),origLength:j(),origChecksum:j()}),D+=16;var z,L=new Uint8Array(12+16*C.length+C.reduce(function(V,N){return V+N.origLength+4},0)),I=L.buffer,X=new DataView(I),$=0;return ne(G.flavor),q(G.numTables),q(v),q(O),q(_),C.forEach(function(V){ne(V.tag),ne(V.origChecksum),ne(D),ne(V.origLength),V.outOffset=D,(D+=V.origLength)%4!=0&&(D+=4-D%4)}),C.forEach(function(V){var N,me=y.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var ce=new Uint8Array(V.origLength);N=new Uint8Array(me,2),R(N,ce)}else ce=new Uint8Array(me);L.set(ce,V.outOffset);var J=0;(D=V.outOffset+V.origLength)%4!=0&&(J=4-D%4),L.set(new Uint8Array(J).buffer,V.outOffset+V.origLength),z=D+J}),I.slice(0,z)},Object.defineProperty(h,"__esModule",{value:!0}),h}({}).convert_streams}function ii(h,n){const c={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},t=1,e=2,o=4,i=8,r=16,a=32;let s;function l(x){if(!s){const E={R:e,L:t,D:o,C:r,U:a,T:i};s=new Map;for(let R in u){let P=0;u[R].split(",").forEach(Y=>{let[y,F]=Y.split("+");y=parseInt(y,36),F=F?parseInt(F,36):0,s.set(P+=y,E[R]);for(let k=F;k--;)s.set(++P,E[R])})}}return s.get(x)||a}const f=1,d=2,p=3,m=4,g=[null,"isol","init","fina","medi"];function A(x){const E=new Uint8Array(x.length);let R=a,P=f,Y=-1;for(let y=0;y<x.length;y++){const F=x.codePointAt(y);let k=l(F)|0,H=f;k&i||(R&(t|o|r)?k&(e|o|r)?(H=p,(P===f||P===p)&&E[Y]++):k&(t|a)&&(P===d||P===m)&&E[Y]--:R&(e|a)&&(P===d||P===m)&&E[Y]--,P=E[y]=H,R=k,Y=y,F>65535&&y++)}return E}function w(x,E){const R=[];for(let Y=0;Y<E.length;Y++){const y=E.codePointAt(Y);y>65535&&Y++,R.push(h.U.codeToGlyph(x,y))}const P=x.GSUB;if(P){const{lookupList:Y,featureList:y}=P;let F;const k=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,H=[];y.forEach(j=>{if(k.test(j.tag))for(let q=0;q<j.tab.length;q++){if(H[j.tab[q]])continue;H[j.tab[q]]=!0;const ne=Y[j.tab[q]],G=/^(isol|init|fina|medi)$/.test(j.tag);G&&!F&&(F=A(E));for(let O=0;O<R.length;O++)(!F||!G||g[F[O]]===j.tag)&&h.U._applySubs(R,O,ne,Y)}})}return R}function T(x,E){const R=new Int16Array(E.length*3);let P=0;for(;P<E.length;P++){const k=E[P];if(k===-1)continue;R[P*3+2]=x.hmtx.aWidth[k];const H=x.GPOS;if(H){const j=H.lookupList;for(let q=0;q<j.length;q++){const ne=j[q];for(let G=0;G<ne.tabs.length;G++){const O=ne.tabs[G];if(ne.ltype===1){if(h._lctf.coverageIndex(O.coverage,k)!==-1&&O.pos){F(O.pos,P);break}}else if(ne.ltype===2){let v=null,_=Y();if(_!==-1){const D=h._lctf.coverageIndex(O.coverage,E[_]);if(D!==-1){if(O.fmt===1){const C=O.pairsets[D];for(let U=0;U<C.length;U++)C[U].gid2===k&&(v=C[U])}else if(O.fmt===2){const C=h.U._getGlyphClass(E[_],O.classDef1),U=h.U._getGlyphClass(k,O.classDef2);v=O.matrix[C][U]}if(v){v.val1&&F(v.val1,_),v.val2&&F(v.val2,P);break}}}}else if(ne.ltype===4){const v=h._lctf.coverageIndex(O.markCoverage,k);if(v!==-1){const _=Y(y),D=_===-1?-1:h._lctf.coverageIndex(O.baseCoverage,E[_]);if(D!==-1){const C=O.markArray[v],U=O.baseArray[D][C.markClass];R[P*3]=U.x-C.x+R[_*3]-R[_*3+2],R[P*3+1]=U.y-C.y+R[_*3+1];break}}}else if(ne.ltype===6){const v=h._lctf.coverageIndex(O.mark1Coverage,k);if(v!==-1){const _=Y();if(_!==-1){const D=E[_];if(b(x,D)===3){const C=h._lctf.coverageIndex(O.mark2Coverage,D);if(C!==-1){const U=O.mark1Array[v],z=O.mark2Array[C][U.markClass];R[P*3]=z.x-U.x+R[_*3]-R[_*3+2],R[P*3+1]=z.y-U.y+R[_*3+1];break}}}}}}}}else if(x.kern&&!x.cff){const j=Y();if(j!==-1){const q=x.kern.glyph1.indexOf(E[j]);if(q!==-1){const ne=x.kern.rval[q].glyph2.indexOf(k);ne!==-1&&(R[j*3+2]+=x.kern.rval[q].vals[ne])}}}}return R;function Y(k){for(let H=P-1;H>=0;H--)if(E[H]!==-1&&(!k||k(E[H])))return H;return-1}function y(k){return b(x,k)===1}function F(k,H){for(let j=0;j<3;j++)R[H*3+j]+=k[j]||0}}function b(x,E){const R=x.GDEF&&x.GDEF.glyphClassDef;return R?h.U._getGlyphClass(E,R):0}function S(...x){for(let E=0;E<x.length;E++)if(typeof x[E]=="number")return x[E]}function M(x){const E=Object.create(null),R=x["OS/2"],P=x.hhea,Y=x.head.unitsPerEm,y=S(R&&R.sTypoAscender,P&&P.ascender,Y),F={unitsPerEm:Y,ascender:y,descender:S(R&&R.sTypoDescender,P&&P.descender,0),capHeight:S(R&&R.sCapHeight,y),xHeight:S(R&&R.sxHeight,y),lineGap:S(R&&R.sTypoLineGap,P&&P.lineGap),supportsCodePoint(k){return h.U.codeToGlyph(x,k)>0},forEachGlyph(k,H,j,q){let ne=0;const G=1/F.unitsPerEm*H,O=w(x,k);let v=0;const _=T(x,O);return O.forEach((D,C)=>{if(D!==-1){let U=E[D];if(!U){const{cmds:z,crds:L}=h.U.glyphToPath(x,D);let I="",X=0;for(let ce=0,J=z.length;ce<J;ce++){const ee=c[z[ce]];I+=z[ce];for(let se=1;se<=ee;se++)I+=(se>1?",":"")+L[X++]}let $,V,N,me;if(L.length){$=V=1/0,N=me=-1/0;for(let ce=0,J=L.length;ce<J;ce+=2){let ee=L[ce],se=L[ce+1];ee<$&&($=ee),se<V&&(V=se),ee>N&&(N=ee),se>me&&(me=se)}}else $=N=V=me=0;U=E[D]={index:D,advanceWidth:x.hmtx.aWidth[D],xMin:$,yMin:V,xMax:N,yMax:me,path:I}}q.call(null,U,ne+_[C*3]*G,_[C*3+1]*G,v),ne+=_[C*3+2]*G,j&&(ne+=j*H)}v+=k.codePointAt(v)>65535?2:1}),ne}};return F}return function(E){const R=new Uint8Array(E,0,4),P=h._bin.readASCII(R,0,4);if(P==="wOFF")E=n(E);else if(P==="wOF2")throw new Error("woff2 fonts not supported");return M(h.parse(E)[0])}}const ai=_t({name:"Typr Font Parser",dependencies:[ri,oi,ii],init(h,n,c){const u=h(),t=n();return c(u,t)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function si(){return function(h){var n=function(){this.buckets=new Map};n.prototype.add=function(T){var b=T>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&T))},n.prototype.has=function(T){var b=this.buckets.get(T>>5);return b!==void 0&&(b&1<<(31&T))!=0},n.prototype.serialize=function(){var T=[];return this.buckets.forEach(function(b,S){T.push((+S).toString(36)+":"+b.toString(36))}),T.join(",")},n.prototype.deserialize=function(T){var b=this;this.buckets.clear(),T.split(",").forEach(function(S){var M=S.split(":");b.buckets.set(parseInt(M[0],36),parseInt(M[1],36))})};var c=Math.pow(2,8),u=c-1,t=~u;function e(T){var b=function(M){return M&t}(T).toString(16),S=function(M){return(M&t)+c-1}(T).toString(16);return"codepoint-index/plane"+(T>>16)+"/"+b+"-"+S+".json"}function o(T,b){var S=T&u,M=b.codePointAt(S/6|0);return((M=(M||48)-48)&1<<S%6)!=0}function i(T,b){var S;(S=T,S.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(M){return M.split("-").map(function(x){return parseInt(x.trim(),16)})})).forEach(function(M){var x=M[0],E=M[1];E===void 0&&(E=x),b(x,E)})}function r(T,b){i(T,function(S,M){for(var x=S;x<=M;x++)b(x)})}var a={},s={},l=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(T){var b=l.get(T);return b||(b=new n,r(T.ranges,function(S){return b.add(S)}),l.set(T,b)),b}var p,m=new Map;function g(T,b,S){return T[b]?b:T[S]?S:function(M){for(var x in M)return x}(T)}function A(T,b){var S=b;if(!T.includes(S)){S=1/0;for(var M=0;M<T.length;M++)Math.abs(T[M]-b)<Math.abs(S-b)&&(S=T[M])}return S}function w(T){return p||(p=new Set,r("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(b){p.add(b)})),p.has(T)}return h.CodePointSet=n,h.clearCache=function(){a={},s={}},h.getFontsForString=function(T,b){b===void 0&&(b={});var S,M=b.lang;M===void 0&&(M=/\p{Script=Hangul}/u.test(S=T)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(S)?"ja":"en");var x=b.category;x===void 0&&(x="sans-serif");var E=b.style;E===void 0&&(E="normal");var R=b.weight;R===void 0&&(R=400);var P=(b.dataUrl||f).replace(/\/$/g,""),Y=new Map,y=new Uint8Array(T.length),F={},k={},H=new Array(T.length),j=new Map,q=!1;function ne(v){var _=m.get(v);return _||(_=fetch(P+"/"+v).then(function(D){if(!D.ok)throw new Error(D.statusText);return D.json().then(function(C){if(!Array.isArray(C)||C[0]!==1)throw new Error("Incorrect schema version; need 1, got "+C[0]);return C[1]})}).catch(function(D){if(P!==f)return q||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+P+'", trying default CDN. '+D.message),q=!0),P=f,m.delete(v),ne(v);throw D}),m.set(v,_)),_}for(var G=function(v){var _=T.codePointAt(v),D=e(_);H[v]=D,a[D]||j.has(D)||j.set(D,ne(D).then(function(C){a[D]=C})),_>65535&&(v++,O=v)},O=0;O<T.length;O++)G(O);return Promise.all(j.values()).then(function(){j.clear();for(var v=function(D){var C=T.codePointAt(D),U=null,z=a[H[D]],L=void 0;for(var I in z){var X=k[I];if(X===void 0&&(X=k[I]=new RegExp(I).test(M||"en")),X){for(var $ in L=I,z[I])if(o(C,z[I][$])){U=$;break}break}}if(!U){e:for(var V in z)if(V!==L){for(var N in z[V])if(o(C,z[V][N])){U=N;break e}}}U||(console.debug("No font coverage for U+"+C.toString(16)),U="latin"),H[D]=U,s[U]||j.has(U)||j.set(U,ne("font-meta/"+U+".json").then(function(me){s[U]=me})),C>65535&&(D++,_=D)},_=0;_<T.length;_++)v(_);return Promise.all(j.values())}).then(function(){for(var v,_=null,D=0;D<T.length;D++){var C=T.codePointAt(D);if(_&&(w(C)||d(_).has(C)))y[D]=y[D-1];else{_=s[H[D]];var U=F[_.id];if(!U){var z=_.typeforms,L=g(z,x,"sans-serif"),I=g(z[L],E,"normal"),X=A((v=z[L])===null||v===void 0?void 0:v[I],R);U=F[_.id]=P+"/font-files/"+_.id+"/"+L+"."+I+"."+X+".woff"}var $=Y.get(U);$==null&&($=Y.size,Y.set(U,$)),y[D]=$}C>65535&&(D++,y[D]=y[D-1])}return{fontUrls:Array.from(Y.keys()),chars:y}})},Object.defineProperty(h,"__esModule",{value:!0}),h}({})}function li(h,n){const c=Object.create(null),u=Object.create(null);function t(o,i){const r=a=>{console.error(`Failure loading font ${o}`,a)};try{const a=new XMLHttpRequest;a.open("get",o,!0),a.responseType="arraybuffer",a.onload=function(){if(a.status>=400)r(new Error(a.statusText));else if(a.status>0)try{const s=h(a.response);s.src=o,i(s)}catch(s){r(s)}},a.onerror=r,a.send()}catch(a){r(a)}}function e(o,i){let r=c[o];r?i(r):u[o]?u[o].push(i):(u[o]=[i],t(o,a=>{a.src=o,c[o]=a,u[o].forEach(s=>s(a)),delete u[o]}))}return function(o,i,{lang:r,fonts:a=[],style:s="normal",weight:l="normal",unicodeFontsURL:f}={}){const d=new Uint8Array(o.length),p=[];o.length||w();const m=new Map,g=[];if(s!=="italic"&&(s="normal"),typeof l!="number"&&(l=l==="bold"?700:400),a&&!Array.isArray(a)&&(a=[a]),a=a.slice().filter(b=>!b.lang||b.lang.test(r)).reverse(),a.length){let x=0;(function E(R=0){for(let P=R,Y=o.length;P<Y;P++){const y=o.codePointAt(P);if(x===1&&p[d[P-1]].supportsCodePoint(y)||P>0&&/\s/.test(o[P]))d[P]=d[P-1],x===2&&(g[g.length-1][1]=P);else for(let F=d[P],k=a.length;F<=k;F++)if(F===k){const H=x===2?g[g.length-1]:g[g.length]=[P,P];H[1]=P,x=2}else{d[P]=F;const{src:H,unicodeRange:j}=a[F];if(!j||T(y,j)){const q=c[H];if(!q){e(H,()=>{E(P)});return}if(q.supportsCodePoint(y)){let ne=m.get(q);typeof ne!="number"&&(ne=p.length,p.push(q),m.set(q,ne)),d[P]=ne,x=1;break}}}y>65535&&P+1<Y&&(d[P+1]=d[P],P++,x===2&&(g[g.length-1][1]=P))}A()})()}else g.push([0,o.length-1]),A();function A(){if(g.length){const b=g.map(S=>o.substring(S[0],S[1]+1)).join(`
`);n.getFontsForString(b,{lang:r||void 0,style:s,weight:l,dataUrl:f}).then(({fontUrls:S,chars:M})=>{const x=p.length;let E=0;g.forEach(P=>{for(let Y=0,y=P[1]-P[0];Y<=y;Y++)d[P[0]+Y]=M[E++]+x;E++});let R=0;S.forEach((P,Y)=>{e(P,y=>{p[Y+x]=y,++R===S.length&&w()})})})}else w()}function w(){i({chars:d,fonts:p})}function T(b,S){for(let M=0;M<S.length;M++){const[x,E=x]=S[M];if(x<=b&&b<=E)return!0}return!1}}}const hi=_t({name:"FontResolver",dependencies:[li,ai,si],init(h,n,c){return h(n,c())}});function ci(h,n){const u=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,t="[^\\S\\u00A0]",e=new RegExp(`${t}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:p,lang:m,fonts:g,style:A,weight:w,preResolvedFonts:T,unicodeFontsURL:b},S){const M=({chars:x,fonts:E})=>{let R,P;const Y=[];for(let y=0;y<x.length;y++)x[y]!==P?(P=x[y],Y.push(R={start:y,end:y,fontObj:E[x[y]]})):R.end=y;S(Y)};T?M(T):h(p,M,{lang:m,fonts:g,style:A,weight:w,unicodeFontsURL:b})}function i({text:p="",font:m,lang:g,sdfGlyphSize:A=64,fontSize:w=400,fontWeight:T=1,fontStyle:b="normal",letterSpacing:S=0,lineHeight:M="normal",maxWidth:x=1/0,direction:E,textAlign:R="left",textIndent:P=0,whiteSpace:Y="normal",overflowWrap:y="normal",anchorX:F=0,anchorY:k=0,metricsOnly:H=!1,unicodeFontsURL:j,preResolvedFonts:q=null,includeCaretPositions:ne=!1,chunkedBoundsSize:G=8192,colorRanges:O=null},v){const _=l(),D={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),w=+w,S=+S,x=+x,M=M||"normal",P=+P,o({text:p,lang:g,style:b,weight:T,fonts:typeof m=="string"?[{src:m}]:m,unicodeFontsURL:j,preResolvedFonts:q},C=>{D.fontLoad=l()-_;const U=isFinite(x);let z=null,L=null,I=null,X=null,$=null,V=null,N=null,me=null,ce=0,J=0,ee=Y!=="nowrap";const se=new Map,W=l();let te=P,Q=0,B=new f;const fe=[B];C.forEach(re=>{const{fontObj:ie}=re,{ascender:he,descender:de,unitsPerEm:Te,lineGap:Ce,capHeight:ge,xHeight:ve}=ie;let le=se.get(ie);if(!le){const ue=w/Te,we=M==="normal"?(he-de+Ce)*ue:M*w,rt=(we-(he-de)*ue)/2,xe=Math.min(we,(he-de)*ue),ye=(he+de)/2*ue+xe/2;le={index:se.size,src:ie.src,fontObj:ie,fontSizeMult:ue,unitsPerEm:Te,ascender:he*ue,descender:de*ue,capHeight:ge*ue,xHeight:ve*ue,lineHeight:we,baseline:-rt-he*ue,caretTop:ye,caretBottom:ye-xe},se.set(ie,le)}const{fontSizeMult:Me}=le,ke=p.slice(re.start,re.end+1);let je,Ee;ie.forEachGlyph(ke,w,S,(ue,we,rt,xe)=>{we+=Q,xe+=re.start,je=we,Ee=ue;const ye=p.charAt(xe),Fe=ue.advanceWidth*Me,De=B.count;let pe;if("isEmpty"in ue||(ue.isWhitespace=!!ye&&new RegExp(t).test(ye),ue.canBreakAfter=!!ye&&e.test(ye),ue.isEmpty=ue.xMin===ue.xMax||ue.yMin===ue.yMax||u.test(ye)),!ue.isWhitespace&&!ue.isEmpty&&J++,ee&&U&&!ue.isWhitespace&&we+Fe+te>x&&De){if(B.glyphAt(De-1).glyphObj.canBreakAfter)pe=new f,te=-we;else for(let Ie=De;Ie--;)if(Ie===0&&y==="break-word"){pe=new f,te=-we;break}else if(B.glyphAt(Ie).glyphObj.canBreakAfter){pe=B.splitAt(Ie+1);const Re=pe.glyphAt(0).x;te-=Re;for(let Pe=pe.count;Pe--;)pe.glyphAt(Pe).x-=Re;break}pe&&(B.isSoftWrapped=!0,B=pe,fe.push(B),ce=x)}let Ae=B.glyphAt(B.count);Ae.glyphObj=ue,Ae.x=we+te,Ae.y=rt,Ae.width=Fe,Ae.charIndex=xe,Ae.fontData=le,ye===`
`&&(B=new f,fe.push(B),te=-(we+Fe+S*w)+P)}),Q=je+Ee.advanceWidth*Me+S*w});let Z=0;fe.forEach(re=>{let ie=!0;for(let he=re.count;he--;){const de=re.glyphAt(he);ie&&!de.glyphObj.isWhitespace&&(re.width=de.x+de.width,re.width>ce&&(ce=re.width),ie=!1);let{lineHeight:Te,capHeight:Ce,xHeight:ge,baseline:ve}=de.fontData;Te>re.lineHeight&&(re.lineHeight=Te);const le=ve-re.baseline;le<0&&(re.baseline+=le,re.cap+=le,re.ex+=le),re.cap=Math.max(re.cap,re.baseline+Ce),re.ex=Math.max(re.ex,re.baseline+ge)}re.baseline-=Z,re.cap-=Z,re.ex-=Z,Z+=re.lineHeight});let oe=0,K=0;if(F&&(typeof F=="number"?oe=-F:typeof F=="string"&&(oe=-ce*(F==="left"?0:F==="center"?.5:F==="right"?1:a(F)))),k&&(typeof k=="number"?K=-k:typeof k=="string"&&(K=k==="top"?0:k==="top-baseline"?-fe[0].baseline:k==="top-cap"?-fe[0].cap:k==="top-ex"?-fe[0].ex:k==="middle"?Z/2:k==="bottom"?Z:k==="bottom-baseline"?-fe[fe.length-1].baseline:a(k)*Z)),!H){const re=n.getEmbeddingLevels(p,E);z=new Uint16Array(J),L=new Uint8Array(J),I=new Float32Array(J*2),X={},N=[1/0,1/0,-1/0,-1/0],me=[],ne&&(V=new Float32Array(p.length*4)),O&&($=new Uint8Array(J*3));let ie=0,he=-1,de=-1,Te,Ce;if(fe.forEach((ge,ve)=>{let{count:le,width:Me}=ge;if(le>0){let ke=0;for(let xe=le;xe--&&ge.glyphAt(xe).glyphObj.isWhitespace;)ke++;let je=0,Ee=0;if(R==="center")je=(ce-Me)/2;else if(R==="right")je=ce-Me;else if(R==="justify"&&ge.isSoftWrapped){let xe=0;for(let ye=le-ke;ye--;)ge.glyphAt(ye).glyphObj.isWhitespace&&xe++;Ee=(ce-Me)/xe}if(Ee||je){let xe=0;for(let ye=0;ye<le;ye++){let Fe=ge.glyphAt(ye);const De=Fe.glyphObj;Fe.x+=je+xe,Ee!==0&&De.isWhitespace&&ye<le-ke&&(xe+=Ee,Fe.width+=Ee)}}const ue=n.getReorderSegments(p,re,ge.glyphAt(0).charIndex,ge.glyphAt(ge.count-1).charIndex);for(let xe=0;xe<ue.length;xe++){const[ye,Fe]=ue[xe];let De=1/0,pe=-1/0;for(let Ae=0;Ae<le;Ae++)if(ge.glyphAt(Ae).charIndex>=ye){let Ie=Ae,Re=Ae;for(;Re<le;Re++){let Pe=ge.glyphAt(Re);if(Pe.charIndex>Fe)break;Re<le-ke&&(De=Math.min(De,Pe.x),pe=Math.max(pe,Pe.x+Pe.width))}for(let Pe=Ie;Pe<Re;Pe++){const Je=ge.glyphAt(Pe);Je.x=pe-(Je.x+Je.width-De)}break}}let we;const rt=xe=>we=xe;for(let xe=0;xe<le;xe++){const ye=ge.glyphAt(xe);we=ye.glyphObj;const Fe=we.index,De=re.levels[ye.charIndex]&1;if(De){const pe=n.getMirroredCharacter(p[ye.charIndex]);pe&&ye.fontData.fontObj.forEachGlyph(pe,0,0,rt)}if(ne){const{charIndex:pe,fontData:Ae}=ye,Ie=ye.x+oe,Re=ye.x+ye.width+oe;V[pe*4]=De?Re:Ie,V[pe*4+1]=De?Ie:Re,V[pe*4+2]=ge.baseline+Ae.caretBottom+K,V[pe*4+3]=ge.baseline+Ae.caretTop+K;const Pe=pe-he;Pe>1&&s(V,he,Pe),he=pe}if(O){const{charIndex:pe}=ye;for(;pe>de;)de++,O.hasOwnProperty(de)&&(Ce=O[de])}if(!we.isWhitespace&&!we.isEmpty){const pe=ie++,{fontSizeMult:Ae,src:Ie,index:Re}=ye.fontData,Pe=X[Ie]||(X[Ie]={});Pe[Fe]||(Pe[Fe]={path:we.path,pathBounds:[we.xMin,we.yMin,we.xMax,we.yMax]});const Je=ye.x+oe,ot=ye.y+ge.baseline+K;I[pe*2]=Je,I[pe*2+1]=ot;const tt=Je+we.xMin*Ae,it=ot+we.yMin*Ae,lt=Je+we.xMax*Ae,nt=ot+we.yMax*Ae;tt<N[0]&&(N[0]=tt),it<N[1]&&(N[1]=it),lt>N[2]&&(N[2]=lt),nt>N[3]&&(N[3]=nt),pe%G===0&&(Te={start:pe,end:pe,rect:[1/0,1/0,-1/0,-1/0]},me.push(Te)),Te.end++;const ze=Te.rect;if(tt<ze[0]&&(ze[0]=tt),it<ze[1]&&(ze[1]=it),lt>ze[2]&&(ze[2]=lt),nt>ze[3]&&(ze[3]=nt),z[pe]=Fe,L[pe]=Re,O){const ht=pe*3;$[ht]=Ce>>16&255,$[ht+1]=Ce>>8&255,$[ht+2]=Ce&255}}}}}),V){const ge=p.length-he;ge>1&&s(V,he,ge)}}const _e=[];se.forEach(({index:re,src:ie,unitsPerEm:he,ascender:de,descender:Te,lineHeight:Ce,capHeight:ge,xHeight:ve})=>{_e[re]={src:ie,unitsPerEm:he,ascender:de,descender:Te,lineHeight:Ce,capHeight:ge,xHeight:ve}}),D.typesetting=l()-W,v({glyphIds:z,glyphFontIndices:L,glyphPositions:I,glyphData:X,fontData:_e,caretPositions:V,glyphColors:$,chunkedBounds:me,fontSize:w,topBaseline:K+fe[0].baseline,blockBounds:[oe,K-Z,oe+ce,K],visibleBounds:N,timings:D})})}function r(p,m){i({...p,metricsOnly:!0},g=>{const[A,w,T,b]=g.blockBounds;m({width:T-A,height:b-w})})}function a(p){let m=p.match(/^([\d.]+)%$/),g=m?parseFloat(m[1]):NaN;return isNaN(g)?0:g/100}function s(p,m,g){const A=p[m*4],w=p[m*4+1],T=p[m*4+2],b=p[m*4+3],S=(w-A)/g;for(let M=0;M<g;M++){const x=(m+M)*4;p[x]=A+S*M,p[x+1]=A+S*(M+1),p[x+2]=T,p[x+3]=b}}function l(){return(self.performance||Date).now()}function f(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(p){let m=f.flyweight;return m.data=this.data,m.index=p,m},splitAt(p){let m=new f;return m.data=this.data.splice(p*d.length),m}},f.flyweight=d.reduce((p,m,g,A)=>(Object.defineProperty(p,m,{get(){return this.data[this.index*d.length+g]},set(w){this.data[this.index*d.length+g]=w}}),p),{data:null,index:0}),{typeset:i,measure:r}}const ut=()=>(self.performance||Date).now(),nn=Yr();let kr;function ui(h,n,c,u,t,e,o,i,r,a,s=!0){return s?di(h,n,c,u,t,e,o,i,r,a).then(null,l=>(kr||(console.warn("WebGL SDF generation failed, falling back to JS",l),kr=!0),Ar(h,n,c,u,t,e,o,i,r,a))):Ar(h,n,c,u,t,e,o,i,r,a)}const en=[],fi=5;let Pn=0;function Kr(){const h=ut();for(;en.length&&ut()-h<fi;)en.shift()();Pn=en.length?setTimeout(Kr,0):0}const di=(...h)=>new Promise((n,c)=>{en.push(()=>{const u=ut();try{nn.webgl.generateIntoCanvas(...h),n({timing:ut()-u})}catch(t){c(t)}}),Pn||(Pn=setTimeout(Kr,0))}),pi=4,mi=2e3,Dr={};let gi=0;function Ar(h,n,c,u,t,e,o,i,r,a){const s="TroikaTextSDFGenerator_JS_"+gi++%pi;let l=Dr[s];return l||(l=Dr[s]={workerModule:_t({name:s,workerId:s,dependencies:[Yr,ut],init(f,d){const p=f().javascript.generate;return function(...m){const g=d();return{textureData:p(...m),timing:d()-g}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),l.requests++,clearTimeout(l.idleTimer),l.workerModule(h,n,c,u,t,e).then(({textureData:f,timing:d})=>{const p=ut(),m=new Uint8Array(f.length*4);for(let g=0;g<f.length;g++)m[g*4+a]=f[g];return nn.webglUtils.renderImageData(o,m,i,r,h,n,1<<3-a),d+=ut()-p,--l.requests===0&&(l.idleTimer=setTimeout(()=>{Xo(s)},mi)),{timing:d}})}function vi(h){h._warm||(nn.webgl.isSupported(h),h._warm=!0)}const yi=nn.webglUtils.resizeWebGLCanvasWithoutClearing,Ft={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},bi=new tn;function gt(){return(self.performance||Date).now()}const Cr=Object.create(null);function _i(h,n){h=xi({},h);const c=gt(),u=[];if(h.font&&u.push({label:"user",src:Si(h.font)}),h.font=u,h.text=""+h.text,h.sdfGlyphSize=h.sdfGlyphSize||Ft.sdfGlyphSize,h.unicodeFontsURL=h.unicodeFontsURL||Ft.unicodeFontsURL,h.colorRanges!=null){let f={};for(let d in h.colorRanges)if(h.colorRanges.hasOwnProperty(d)){let p=h.colorRanges[d];typeof p!="number"&&(p=bi.set(p).getHex()),f[d]=p}h.colorRanges=f}Object.freeze(h);const{textureWidth:t,sdfExponent:e}=Ft,{sdfGlyphSize:o}=h,i=t/o*4;let r=Cr[o];if(!r){const f=document.createElement("canvas");f.width=t,f.height=o*256/i,r=Cr[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:f,sdfTexture:new xo(f,void 0,void 0,void 0,fr,fr),contextLost:!1,glyphsByFont:new Map},r.sdfTexture.generateMipmaps=!1,wi(r)}const{sdfTexture:a,sdfCanvas:s}=r;qr(h).then(f=>{const{glyphIds:d,glyphFontIndices:p,fontData:m,glyphPositions:g,fontSize:A,timings:w}=f,T=[],b=new Float32Array(d.length*4);let S=0,M=0;const x=gt(),E=m.map(F=>{let k=r.glyphsByFont.get(F.src);return k||r.glyphsByFont.set(F.src,k=new Map),k});d.forEach((F,k)=>{const H=p[k],{src:j,unitsPerEm:q}=m[H];let ne=E[H].get(F);if(!ne){const{path:D,pathBounds:C}=f.glyphData[j][F],U=Math.max(C[2]-C[0],C[3]-C[1])/o*(Ft.sdfMargin*o+.5),z=r.glyphCount++,L=[C[0]-U,C[1]-U,C[2]+U,C[3]+U];E[H].set(F,ne={path:D,atlasIndex:z,sdfViewBox:L}),T.push(ne)}const{sdfViewBox:G}=ne,O=g[M++],v=g[M++],_=A/q;b[S++]=O+G[0]*_,b[S++]=v+G[1]*_,b[S++]=O+G[2]*_,b[S++]=v+G[3]*_,d[k]=ne.atlasIndex}),w.quads=(w.quads||0)+(gt()-x);const R=gt();w.sdf={};const P=s.height,Y=Math.ceil(r.glyphCount/i),y=Math.pow(2,Math.ceil(Math.log2(Y*o)));y>P&&(console.info(`Increasing SDF texture size ${P}->${y}`),yi(s,t,y),a.dispose()),Promise.all(T.map(F=>Zr(F,r,h.gpuAccelerateSDF).then(({timing:k})=>{w.sdf[F.atlasIndex]=k}))).then(()=>{T.length&&!r.contextLost&&(Jr(r),a.needsUpdate=!0),w.sdfTotal=gt()-R,w.total=gt()-c,n(Object.freeze({parameters:h,sdfTexture:a,sdfGlyphSize:o,sdfExponent:e,glyphBounds:b,glyphAtlasIndices:d,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{r.contextLost||vi(s)})}function Zr({path:h,atlasIndex:n,sdfViewBox:c},{sdfGlyphSize:u,sdfCanvas:t,contextLost:e},o){if(e)return Promise.resolve({timing:-1});const{textureWidth:i,sdfExponent:r}=Ft,a=Math.max(c[2]-c[0],c[3]-c[1]),s=Math.floor(n/4),l=s%(i/u)*u,f=Math.floor(s/(i/u))*u,d=n%4;return ui(u,u,h,c,a,r,t,l,f,d,o)}function wi(h){const n=h.sdfCanvas;n.addEventListener("webglcontextlost",c=>{console.log("Context Lost",c),c.preventDefault(),h.contextLost=!0}),n.addEventListener("webglcontextrestored",c=>{console.log("Context Restored",c),h.contextLost=!1;const u=[];h.glyphsByFont.forEach(t=>{t.forEach(e=>{u.push(Zr(e,h,!0))})}),Promise.all(u).then(()=>{Jr(h),h.sdfTexture.needsUpdate=!0})})}function xi(h,n){for(let c in n)n.hasOwnProperty(c)&&(h[c]=n[c]);return h}let qt;function Si(h){return qt||(qt=typeof document>"u"?{}:document.createElement("a")),qt.href=h,qt.href}function Jr(h){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:n,sdfTexture:c}=h,{width:u,height:t}=n,e=h.sdfCanvas.getContext("webgl");let o=c.image.data;(!o||o.length!==u*t*4)&&(o=new Uint8Array(u*t*4),c.image={width:u,height:t,data:o},c.flipY=!1,c.isDataTexture=!0),e.readPixels(0,0,u,t,e.RGBA,e.UNSIGNED_BYTE,o)}}const Ti=_t({name:"Typesetter",dependencies:[ci,hi,Zo],init(h,n,c){return h(n,c())}}),qr=_t({name:"Typesetter",dependencies:[Ti],init(h){return function(n){return new Promise(c=>{h.typeset(n,c)})}},getTransferables(h){const n=[];for(let c in h)h[c]&&h[c].buffer&&n.push(h[c].buffer);return n}});qr.onMainThread;const Mr={};function Ei(h){let n=Mr[h];return n||(n=Mr[h]=new On(1,1,h,h).translate(.5,.5,0)),n}const Ui="aTroikaGlyphBounds",Fr="aTroikaGlyphIndex",ki="aTroikaGlyphColor";class Di extends bo{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new _o,this.boundingBox=new Pt}computeBoundingSphere(){}computeBoundingBox(){}set detail(n){if(n!==this._detail){this._detail=n,(typeof n!="number"||n<1)&&(n=1);let c=Ei(n);["position","normal","uv"].forEach(u=>{this.attributes[u]=c.attributes[u].clone()}),this.setIndex(c.getIndex().clone())}}get detail(){return this._detail}set curveRadius(n){n!==this._curveRadius&&(this._curveRadius=n,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(n,c,u,t,e){this.updateAttributeData(Ui,n,4),this.updateAttributeData(Fr,c,1),this.updateAttributeData(ki,e,3),this._blockBounds=u,this._chunkedBounds=t,this.instanceCount=c.length,this._updateBounds()}_updateBounds(){const n=this._blockBounds;if(n){const{curveRadius:c,boundingBox:u}=this;if(c){const{PI:t,floor:e,min:o,max:i,sin:r,cos:a}=Math,s=t/2,l=t*2,f=Math.abs(c),d=n[0]/f,p=n[2]/f,m=e((d+s)/l)!==e((p+s)/l)?-f:o(r(d)*f,r(p)*f),g=e((d-s)/l)!==e((p-s)/l)?f:i(r(d)*f,r(p)*f),A=e((d+t)/l)!==e((p+t)/l)?f*2:i(f-a(d)*f,f-a(p)*f);u.min.set(m,n[1],c<0?-A:0),u.max.set(g,n[3],c<0?0:A)}else u.min.set(n[0],n[1],0),u.max.set(n[2],n[3],0);u.getBoundingSphere(this.boundingSphere)}}applyClipRect(n){let c=this.getAttribute(Fr).count,u=this._chunkedBounds;if(u)for(let t=u.length;t--;){c=u[t].end;let e=u[t].rect;if(e[1]<n.w&&e[3]>n.y&&e[0]<n.z&&e[2]>n.x)break}this.instanceCount=c}updateAttributeData(n,c,u){const t=this.getAttribute(n);c?t&&t.array.length===c.length?(t.array.set(c),t.needsUpdate=!0):(this.setAttribute(n,new wo(c,u)),delete this._maxInstanceCount,this.dispose()):t&&this.deleteAttribute(n)}}const Ai=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Ci=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Mi=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Fi=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function Pi(h){const n=Fn(h,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Be},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new dr(0,0,0,0)},uTroikaClipRect:{value:new dr(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Be},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new tn},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new So},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Ai,vertexTransform:Ci,fragmentDefs:Mi,fragmentColorTransform:Fi,customRewriter({vertexShader:c,fragmentShader:u}){let t=/\buniform\s+vec3\s+diffuse\b/;return t.test(u)&&(u=u.replace(t,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),t.test(c)||(c=c.replace(Xr,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:c,fragmentShader:u}}});return n.transparent=!0,n.forceSinglePass=!0,Object.defineProperties(n,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),n}const zn=new Ir({color:16777215,side:zr,transparent:!0}),Pr=8421504,Lr=new yo,Qt=new be,Dn=new be,Mt=[],Li=new be,An="+x+y";function Or(h){return Array.isArray(h)?h[0]:h}let Qr=()=>{const h=new Ge(new On(1,1),zn);return Qr=()=>h,h},$r=()=>{const h=new Ge(new On(1,1,32,1),zn);return $r=()=>h,h};const Oi={type:"syncstart"},Ri={type:"synccomplete"},eo=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Bi=eo.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Nn extends Ge{constructor(){const n=new Di;super(n,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Pr,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=An,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(n){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(n):(this._isSyncing=!0,this.dispatchEvent(Oi),_i({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},c=>{this._isSyncing=!1,this._textRenderInfo=c,this.geometry.updateGlyphs(c.glyphBounds,c.glyphAtlasIndices,c.blockBounds,c.chunkedBounds,c.glyphColors);const u=this._queuedSyncs;u&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{u.forEach(t=>t&&t())})),this.dispatchEvent(Ri),n&&n()})))}onBeforeRender(n,c,u,t,e,o){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(n){return Pi(n)}get material(){let n=this._derivedMaterial;const c=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=zn.clone());if((!n||!n.isDerivedFrom(c))&&(n=this._derivedMaterial=this.createDerivedMaterial(c),c.addEventListener("dispose",function u(){c.removeEventListener("dispose",u),n.dispose()})),this.hasOutline()){let u=n._outlineMtl;return u||(u=n._outlineMtl=Object.create(n,{id:{value:n.id+.1}}),u.isTextOutlineMaterial=!0,u.depthWrite=!1,u.map=null,n.addEventListener("dispose",function t(){n.removeEventListener("dispose",t),u.dispose()})),[u,n]}else return n}set material(n){n&&n.isTroikaTextMaterial?(this._derivedMaterial=n,this._baseMaterial=n.baseMaterial):this._baseMaterial=n}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(n){this.geometry.detail=n}get curveRadius(){return this.geometry.curveRadius}set curveRadius(n){this.geometry.curveRadius=n}get customDepthMaterial(){return Or(this.material).getDepthMaterial()}set customDepthMaterial(n){}get customDistanceMaterial(){return Or(this.material).getDistanceMaterial()}set customDistanceMaterial(n){}_prepareForRender(n){const c=n.isTextOutlineMaterial,u=n.uniforms,t=this.textRenderInfo;if(t){const{sdfTexture:i,blockBounds:r}=t;u.uTroikaSDFTexture.value=i,u.uTroikaSDFTextureSize.value.set(i.image.width,i.image.height),u.uTroikaSDFGlyphSize.value=t.sdfGlyphSize,u.uTroikaSDFExponent.value=t.sdfExponent,u.uTroikaTotalBounds.value.fromArray(r),u.uTroikaUseGlyphColors.value=!c&&!!t.glyphColors;let a=0,s=0,l=0,f,d,p,m=0,g=0;if(c){let{outlineWidth:w,outlineOffsetX:T,outlineOffsetY:b,outlineBlur:S,outlineOpacity:M}=this;a=this._parsePercent(w)||0,s=Math.max(0,this._parsePercent(S)||0),f=M,m=this._parsePercent(T)||0,g=this._parsePercent(b)||0}else l=Math.max(0,this._parsePercent(this.strokeWidth)||0),l&&(p=this.strokeColor,u.uTroikaStrokeColor.value.set(p??Pr),d=this.strokeOpacity,d==null&&(d=1)),f=this.fillOpacity;u.uTroikaEdgeOffset.value=a,u.uTroikaPositionOffset.value.set(m,g),u.uTroikaBlurRadius.value=s,u.uTroikaStrokeWidth.value=l,u.uTroikaStrokeOpacity.value=d,u.uTroikaFillOpacity.value=f??1,u.uTroikaCurveRadius.value=this.curveRadius||0;let A=this.clipRect;if(A&&Array.isArray(A)&&A.length===4)u.uTroikaClipRect.value.fromArray(A);else{const w=(this.fontSize||.1)*100;u.uTroikaClipRect.value.set(r[0]-w,r[1]-w,r[2]+w,r[3]+w)}this.geometry.applyClipRect(u.uTroikaClipRect.value)}u.uTroikaSDFDebug.value=!!this.debugSDF,n.polygonOffset=!!this.depthOffset,n.polygonOffsetFactor=n.polygonOffsetUnits=this.depthOffset||0;const e=c?this.outlineColor||0:this.color;if(e==null)delete n.color;else{const i=n.hasOwnProperty("color")?n.color:n.color=new tn;(e!==i._input||typeof e=="object")&&i.set(i._input=e)}let o=this.orientation||An;if(o!==n._orientation){let i=u.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let r=o!==An&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(r){let[,a,s,l,f]=r;Qt.set(0,0,0)[s]=a==="-"?1:-1,Dn.set(0,0,0)[f]=l==="-"?-1:1,Lr.lookAt(Li,Qt.cross(Dn),Dn),i.setFromMatrix4(Lr)}else i.identity();n._orientation=o}}_parsePercent(n){if(typeof n=="string"){let c=n.match(/^(-?[\d.]+)%$/),u=c?parseFloat(c[1]):NaN;n=(isNaN(u)?0:u/100)*this.fontSize}return n}localPositionToTextCoords(n,c=new Be){c.copy(n);const u=this.curveRadius;return u&&(c.x=Math.atan2(n.x,Math.abs(u)-Math.abs(n.z))*Math.abs(u)),c}worldPositionToTextCoords(n,c=new Be){return Qt.copy(n),this.localPositionToTextCoords(this.worldToLocal(Qt),c)}raycast(n,c){const{textRenderInfo:u,curveRadius:t}=this;if(u){const e=u.blockBounds,o=t?$r():Qr(),i=o.geometry,{position:r,uv:a}=i.attributes;for(let s=0;s<a.count;s++){let l=e[0]+a.getX(s)*(e[2]-e[0]);const f=e[1]+a.getY(s)*(e[3]-e[1]);let d=0;t&&(d=t-Math.cos(l/t)*t,l=Math.sin(l/t)*t),r.setXYZ(s,l,f,d)}i.boundingSphere=this.geometry.boundingSphere,i.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,Mt.length=0,o.raycast(n,Mt);for(let s=0;s<Mt.length;s++)Mt[s].object=this,c.push(Mt[s])}}copy(n){const c=this.geometry;return super.copy(n),this.geometry=c,Bi.forEach(u=>{this[u]=n[u]}),this}clone(){return new this.constructor().copy(this)}}eo.forEach(h=>{const n="_private_"+h;Object.defineProperty(Nn.prototype,h,{get(){return this[n]},set(c){c!==this[n]&&(this[n]=c,this._needsSync=!0)}})});new Pt;new tn;function Gi(h,n,c,u,t=!1,e=!1){const o=new et,i=[],r=[],a=[];for(let s=0;s<h;s++){const l=s/h*Math.PI*2,f=n*Math.cos(l),d=n*Math.sin(l);r.push(new be(f,c,d)),a.push(new be(f,u,d))}if(t)for(let s=1;s<h-1;s++)i.push(r[0].x,r[0].y,r[0].z,r[s+1].x,r[s+1].y,r[s+1].z,r[s].x,r[s].y,r[s].z);if(e)for(let s=1;s<h-1;s++)i.push(a[0].x,a[0].y,a[0].z,a[s].x,a[s].y,a[s].z,a[s+1].x,a[s+1].y,a[s+1].z);for(let s=0;s<h;s++){const l=r[s],f=r[(s+1)%h],d=a[(s+1)%h],p=a[s];i.push(l.x,l.y,l.z,f.x,f.y,f.z,p.x,p.y,p.z),i.push(f.x,f.y,f.z,d.x,d.y,d.z,p.x,p.y,p.z)}return o.setAttribute("position",new Rn(i,3)),o.computeVertexNormals(),o}function Ii(h,n,c,u,t=!1){const e=new et,o=[],i=new be(0,u,0),r=[];for(let a=0;a<h;a++){const s=a/h*Math.PI*2,l=n*Math.cos(s),f=n*Math.sin(s);r.push(new be(l,c,f))}if(t)for(let a=1;a<h-1;a++)o.push(r[0].x,r[0].y,r[0].z,r[a+1].x,r[a+1].y,r[a+1].z,r[a].x,r[a].y,r[a].z);for(let a=0;a<h;a++){const s=r[a],l=r[(a+1)%h];o.push(s.x,s.y,s.z,l.x,l.y,l.z,i.x,i.y,i.z)}return e.setAttribute("position",new Rn(o,3)),e.computeVertexNormals(),e}function zi(h,n,c,u,t,e=!1,o=!1){const i=new et,r=[],a=[],s=[];for(let l=0;l<h;l++){const f=l/h*Math.PI*2;a.push(new be(n*Math.cos(f),u,n*Math.sin(f))),s.push(new be(c*Math.cos(f),t,c*Math.sin(f)))}if(e)for(let l=1;l<h-1;l++)r.push(a[0].x,a[0].y,a[0].z,a[l+1].x,a[l+1].y,a[l+1].z,a[l].x,a[l].y,a[l].z);if(o)for(let l=1;l<h-1;l++)r.push(s[0].x,s[0].y,s[0].z,s[l].x,s[l].y,s[l].z,s[l+1].x,s[l+1].y,s[l+1].z);for(let l=0;l<h;l++){const f=a[l],d=a[(l+1)%h],p=s[(l+1)%h],m=s[l];r.push(f.x,f.y,f.z,d.x,d.y,d.z,m.x,m.y,m.z),r.push(d.x,d.y,d.z,p.x,p.y,p.z,m.x,m.y,m.z)}return i.setAttribute("position",new Rn(r,3)),i.computeVertexNormals(),i}function Rr(h,n=!1){const c=new Ne(h);let u;n?u=new bt({color:0,dashSize:.05,gapSize:.025,depthTest:!1,transparent:!0,opacity:.5}):u=new Ke({color:0,depthTest:!0,transparent:!0,opacity:1});const t=new Ye(c,u);return n&&t.computeLineDistances&&t.computeLineDistances(),t}(()=>{const h=new Bn(1,1,1),n=[new Ue({color:"red"}),new Ue({color:"red"}),new Ue({color:"green"}),new Ue({color:"green"}),new Ue({color:"blue"}),new Ue({color:"blue"})];return new Ge(h,n)})();(()=>{const h=new Bn(1,1,1),n=[new Ue({color:"red"}),new Ue({color:"red"}),new Ue({color:"green"}),new Ue({color:"green"}),new Ue({color:"blue"}),new Ue({color:"blue"})],c=new Ge(h,n),u=new Ne(h),t=new Ye(u,new Ke({color:0})),e=new Ze;return e.add(c),e.add(t),e})();function Ni(h,n=1,c){const u=so(6).map(i=>(c?.colors??[16777215])[i%(c?.colors?.length??1)]),t=new Bn(n,n,n),e=[new Ue({color:u[0]}),new Ue({color:u[1]}),new Ue({color:u[2]}),new Ue({color:u[3]}),new Ue({color:u[4]}),new Ue({color:u[5]})],o=new Ge(t,e);if(o.position.set(...h),c?.edges){const i=new Ne(t),r=new Ye(i,new Ke({color:c.edgesColor??0,opacity:c.edgesOpacity??1,transparent:(c.edgesOpacity??1)<1}));r.position.copy(o.position);const a=new Ze;return a.add(o),a.add(r),a}else return o}function ji(h){const n="images/earth_day_4096.jpg",c="images/earth_normal_2048.jpg",u=new Gn(h.radius??1,h.segmentsWidth??64,h.segmentsHeight??32),t=new jr,e=new Eo({color:16777215,metalness:.2,roughness:.8,bumpScale:.1,normalScale:new Be(1,1),emissive:2236962}),o=new Ge(u,e);return h.position&&o.position.set(...h.position),h.greenwichAlignment&&(o.rotation.y=Gr.degToRad(h.greenwichAlignment)),t.load(n,i=>{i.colorSpace=Wr,e.map=i,e.needsUpdate=!0,h.onTextureLoaded?.()}),t.load(c,i=>{e.normalMap=i,e.needsUpdate=!0,h.onTextureLoaded?.()}),o}function Ln(h){const n=h.spherePosition??[0,0,0],c=(h.sphereRadius??1)+(h.altitude??0),u=h.latitude*Math.PI/180,t=h.longitude*Math.PI/180,[e,o,i]=Br(h.latitude,h.longitude,c,n),r=new Gn(h.pointRadius??.03,16,16),a=new Ue({color:h.pointColor??16711680}),s=new Ge(r,a);s.position.set(e,o,i);const l=new Ze;if(l.add(s),h.label){const[f,d,p]=Br(h.latitude-3,h.longitude,c,n),m=new Nn,g=new be(f,d,p).normalize(),A=h.labelOffset??.05,w=g.clone().multiplyScalar(c+A);m.position.copy(w),m.text=h.label,m.fontSize=h.labelSize??.5,m.color=h.labelColor??"#ffffff",m.anchorX="center",m.anchorY="middle",m.font=h.font??"fonts/Arial Rounded Bold.ttf";const T=new To(0,t,0,"YXZ");T.x=-u,m.setRotationFromEuler(T),m.sync(),l.add(m)}return l}function Wi(h){const n=new Ze;return h.points.forEach(c=>{n.add(Ln({spherePosition:h.spherePosition,sphereRadius:h.sphereRadius,...c}))}),n}function Br(h,n,c,u){const t=h*Math.PI/180,e=n*Math.PI/180;return[u[0]+c*Math.cos(t)*Math.sin(e),u[1]+c*Math.sin(t),u[2]+c*Math.cos(t)*Math.cos(e)]}function Vi(h={}){const{position:n=[0,0,0],radius:c=1,parallels:u=4,meridians:t=8,segments:e=32,parallelColor:o=13421772,meridianColor:i=13421568,showParallels:r=!0,showMeridians:a=!0,showEquator:s=!0,equatorColor:l=16776960,equatorThickness:f=.02,showGreenwich:d=!1,greenwichColor:p=65535,greenwichThickness:m=.02}=h,g=new Ze;if(g.position.set(...n),r)for(let A=1;A<=u;A++){const w=Math.PI*A/(u+1),b=new pr(0,0,c*Math.sin(w),c*Math.sin(w),0,2*Math.PI,!1,0).getPoints(e),S=new et().setFromPoints(b.map(E=>new be(E.x,c*Math.cos(w),E.y))),M=new Ke({color:o}),x=new mr(S,M);g.add(x)}if(a)for(let A=0;A<t;A++){const w=2*Math.PI*A/t,T=[];for(let x=0;x<=e;x++){const E=Math.PI*x/e,R=c*Math.sin(E)*Math.sin(w),P=c*Math.cos(E),Y=c*Math.sin(E)*Math.cos(w);T.push(new be(R,P,Y))}const b=new et().setFromPoints(T),S=new Ke({color:i}),M=new gr(b,S);g.add(M)}if(s){const w=new pr(0,0,c,c,0,2*Math.PI,!1,0).getPoints(e),T=new et().setFromPoints(w.map(M=>new be(M.x,0,M.y))),b=new Ke({color:l,linewidth:f?Math.max(1,f*10):2}),S=new mr(T,b);g.add(S)}if(d){const A=[];for(let S=0;S<=e;S++){const M=Math.PI*S/e,x=0,E=c*Math.cos(M),R=c*Math.sin(M);A.push(new be(x,E,R))}const w=new et().setFromPoints(A),T=new Ke({color:p,linewidth:m?Math.max(1,m*10):2}),b=new gr(w,T);g.add(b)}return g}function Hi(h){const n=new Gn(h.radius??200,64,32),c=new jr,u=new Ir({side:zr}),t=new Ge(n,u);return c.load(h.image,e=>{e.colorSpace=Wr,u.map=e,u.needsUpdate=!0}),t}function Qi(h,n){const c=[];function u(g){g instanceof et&&!(g instanceof Ne)?c.push(g):g.geometry instanceof et&&!(g.geometry instanceof Ne)?c.push(g.geometry):(g instanceof Ze||g instanceof Nr)&&g.children.forEach(A=>u(A))}if(h.forEach(g=>u(g)),c.length===0)throw new Error("Aucune BufferGeometry trouve pour la fusion");const t=jo(c,!0);if(!t)throw new Error("La fusion des gomtries a chou (vrifiez les entres)");t.computeVertexNormals();const e=t.getAttribute("position"),o=new be(0,0,0);for(let g=0;g<e.count;g++)o.x+=e.getX(g),o.y+=e.getY(g),o.z+=e.getZ(g);const i=o.multiplyScalar(1/e.count);for(let g=0;g<e.count;g+=3){const A=e.getX(g),w=e.getY(g),T=e.getZ(g),b=e.getX(g+1),S=e.getY(g+1),M=e.getZ(g+1),x=e.getX(g+2),E=e.getY(g+2),R=e.getZ(g+2),P=new be(b-A,S-w,M-T),Y=new be(x-A,E-w,R-T),y=new be().crossVectors(P,Y).normalize(),F=new be((A+b+x)/3,(w+S+E)/3,(T+M+R)/3),k=i.clone().sub(F).normalize();y.dot(k)>0&&(e.setXYZ(g+1,x,E,R),e.setXYZ(g+2,b,S,M))}const r=new Ze,a=new Ge(t,new Ue({color:16777215,transparent:!0,opacity:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));r.add(a);const s=new Ne(t),l=new bt({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),f=new Ye(s,l);f.computeLineDistances(),r.add(f);const d=new Ne(t),p=new Ke({color:0,linewidth:2,transparent:!1,depthTest:!0}),m=new Ye(d,p);return r.add(m),r}function $i(h,n,c,u,t=!1,e=!1,o=.5){const i=new Ze,r=Gi(h,n,c,u,t,e),a=new Ge(r,new Ue({color:16777215,transparent:!0,opacity:o,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));i.add(a);const s=new Ne(r),l=new bt({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),f=new Ye(s,l);f.computeLineDistances(),i.add(f);const d=new Ne(r),p=new Ke({color:0,linewidth:2,transparent:!1,depthTest:!0}),m=new Ye(d,p);return i.add(m),i}function ea(h,n,c,u,t=!1,e=.5){const o=new Ze,i=Ii(h,n,c,u,t),r=new Ge(i,new Ue({color:16777215,transparent:!0,opacity:e,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));o.add(r);const a=new Ne(i),s=new bt({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),l=new Ye(a,s);l.computeLineDistances(),o.add(l);const f=new Ne(i),d=new Ke({color:0,linewidth:2,transparent:!1,depthTest:!0}),p=new Ye(f,d);return o.add(p),o}function ta(h,n,c,u,t,e=!1,o=!1,i=.5){const r=new Ze,a=zi(h,n,c,u,t,e,o),s=new Ge(a,new Ue({color:16777215,transparent:!0,opacity:i,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));r.add(s);const l=new Ne(a),f=new bt({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),d=new Ye(l,f);d.computeLineDistances(),r.add(d);const p=new Ne(a),m=new Ke({color:0,linewidth:2,transparent:!1,depthTest:!0}),g=new Ye(p,m);return r.add(g),r}class Yi extends HTMLElement{background=15658734;width=500;height=300;renderer=null;scene=null;camera=null;controls=null;_objects=[];_imgElement;_contentDescription;_animationFrameId=null;_fullscreenBtn;_cameraPosition=new be(8,8,8);_cameraTarget=new be(0,0,0);_imgClickHandler;set objects(n){this._objects=n,this.scene&&this.setObjects(n)}get objects(){return this._objects}connectedCallback(){if(this.style.display="inline-block",this.width=parseInt(this.getAttribute("width")||"")||500,this.height=parseInt(this.getAttribute("height")||"")||300,this.style.width=`${this.width}px`,this.style.height=`${this.height}px`,this.style.position="relative",!this.camera){const u=new be(8,8,8),t=new be(0,0,0);this._cameraPosition=u.clone(),this._cameraTarget=t.clone(),this.camera=new Zt(35,this.width/this.height,.1,1e3),this.camera.position.copy(this._cameraPosition),this.camera.lookAt(this._cameraTarget)}const n=this.getAttribute("content");if(n)try{const u=JSON.parse(decodeURIComponent(n));this._contentDescription=u;const t=u.autoCenterZoomMargin??1.2;if(Array.isArray(u.cameraPosition)){const i=u.cameraPosition;this._cameraPosition.set(i[0],i[1],i[2]),this.camera&&this.camera.position.set(i[0],i[1],i[2])}if(Array.isArray(u.cameraTarget)){const i=u.cameraTarget;this._cameraTarget.set(i[0],i[1],i[2]),this.camera&&this.camera.lookAt(i[0],i[1],i[2]),this.controls&&(this.controls.target.set(i[0],i[1],i[2]),this.controls.update())}const e=u.objects.map(i=>{if(i.type==="geoPoint")return Ln(i);if(i.type==="geoPoints")return Wi(i);if(i.type==="cube")return Ni(i.pos,i.size,{edges:i.edges,edgesColor:i.edgesColor,edgesOpacity:i.edgesOpacity,colors:i.colors??Xi});if(i.type==="bufferGeometry"){if(i.geometry.type==="BufferGeometry"){const a=new vr().parse(i.geometry),s=new Ze,l=new Ge(a,new Ue({color:16777215,transparent:!0,opacity:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));s.add(l);const f=new Ne(a),d=new bt({color:8947848,dashSize:.08,gapSize:.04,linewidth:1,transparent:!0,opacity:.7,depthTest:!0}),p=new Ye(f,d);p.computeLineDistances(),s.add(p);const m=new Ne(a),g=new Ke({color:0,linewidth:2,transparent:!1,depthTest:!0}),A=new Ye(m,g);return s.add(A),s}else if(Array.isArray(i.geometry.geometries)){const r=new vr,a=i.geometry.geometries.filter(m=>m.type==="BufferGeometry").map(m=>r.parse(m));let s;a.length===1?s=a[0]:s=(void 0).mergeGeometries(a,!0);const l=new Ze,f=new Ge(s,new Ue({color:2236962,transparent:!0,opacity:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}));this.applyPolygonOffset(f),f.renderOrder=0,l.add(f);const d=Rr(s,!0);d.renderOrder=1;const p=Rr(s,!1);return p.renderOrder=2,l.add(d),l.add(p),l}}if(i.type==="realisticEarthSphere")return ji({...i,onTextureLoaded:()=>{this.renderStaticImage()}});if(i.type==="customWireSphere")return Vi(i);if(i.type==="geoPoint")return Ln(i);if(i.type==="ambientLight")return new Uo(i.color??16777215,i.intensity??1);if(i.type==="directionalLight"){const r=new ko(i.color??16777215,i.intensity??1);return i.position&&r.position.set(...i.position),r}if(i.type==="skySphere"){const r=Hi({...i,onTextureLoaded:()=>{}});return r.isSkySphere=!0,r}if(i.type==="group")return new Do().parse(i.object);if(i.type==="canvas3dButton"){const r=document.createElement("button");r.id=i.id,r.textContent=i.text,Ki(r),r.type="button",r.style.cursor="pointer",i.position&&Object.assign(r.style,i.position),i.style&&Object.assign(r.style,i.style),r.style.zIndex="20",r.style.pointerEvents="auto";const a=()=>{this.dispatchEvent(new CustomEvent(i.onClick,{bubbles:!0,composed:!0}))};r.addEventListener("click",a);let s=this.querySelector(".canvas-threejs-overlay");return s||(s=document.createElement("div"),s.className="canvas-threejs-overlay",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none",s.style.zIndex="10",this.appendChild(s)),s.appendChild(r),null}return null}).filter(Boolean);this._objects=e,this.setObjects(e),Array.isArray(this._contentDescription?.cameraPosition)||Array.isArray(this._contentDescription?.cameraTarget)||this.autoCenterZoom(e,t);const o=this.querySelector(".canvas-threejs-overlay");o&&(o.style.display="none"),u.backgroundColor&&(this.background=u.backgroundColor,this.setBackground(u.backgroundColor))}catch(u){console.error("Erreur de parsing content:",u)}this._imgElement||(this._imgElement=document.createElement("img"),this._imgElement.style.position="absolute",this._imgElement.style.top="0",this._imgElement.style.left="0",this._imgElement.style.objectFit="contain",this._imgElement.style.zIndex="1",this._imgElement.style.pointerEvents="auto",this._imgElement.style.cursor="zoom-in",this._imgElement.style.width=this.width+"px",this._imgElement.style.height=this.height+"px",this._imgClickHandler=()=>this.enterFullscreen(),this._imgElement.addEventListener("click",this._imgClickHandler),this.appendChild(this._imgElement)),this._fullscreenBtn||(this._fullscreenBtn=document.createElement("button"),this._fullscreenBtn.innerHTML='<i class="bx bx-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors"></i>',this._fullscreenBtn.title="Plein cran",this._fullscreenBtn.style.position="absolute",this._fullscreenBtn.style.top="5px",this._fullscreenBtn.style.right="5px",this._fullscreenBtn.style.zIndex="10",this._fullscreenBtn.style.pointerEvents="auto",this._fullscreenBtn.style.background="#fff",this._fullscreenBtn.style.border="1px solid #888",this._fullscreenBtn.style.borderRadius="6px",this._fullscreenBtn.style.width="48px",this._fullscreenBtn.style.height="48px",this._fullscreenBtn.style.display="flex",this._fullscreenBtn.style.alignItems="center",this._fullscreenBtn.style.justifyContent="center",this._fullscreenBtn.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",this._fullscreenBtn.style.cursor="pointer",this._fullscreenBtn.style.color="#222",this._fullscreenBtn.style.opacity="1",this._fullscreenBtn.onclick=()=>this.enterFullscreen(),this.appendChild(this._fullscreenBtn));const c=Zi(this._objects);if(c.length>0){let u=0;c.forEach(t=>{t.addEventListener("synccomplete",()=>{u++,u===c.length&&this.renderStaticImage()},{once:!0})})}else this.renderStaticImage()}disconnectedCallback(){this._imgElement&&this._imgClickHandler&&(this._imgElement.removeEventListener("click",this._imgClickHandler),this._imgClickHandler=void 0),this.removeDynamicButtonListeners(),this.destroyRenderer()}renderStaticImage(){const n=this.width,c=this.height,u=document.createElement("canvas");u.width=n,u.height=c,u.style.width=n+"px",u.style.height=c+"px";const t=new Tn({canvas:u,antialias:!0,alpha:!0,preserveDrawingBuffer:!0});this.renderer&&this.background&&this.setBackground(this.background);const e=new En,o=new Zt(35,n/c,.1,1e3);o.position.copy(this._cameraPosition),o.lookAt(this._cameraTarget),this._objects.forEach(r=>e.add(r)),t.setSize(n,c,!1),t.render(e,o);const i=u.toDataURL("image/png");t.dispose(),typeof t.forceContextLoss=="function"&&t.forceContextLoss(),this._imgElement?(this._imgElement.style.width=n+"px",this._imgElement.style.height=c+"px",this._imgElement.width=n,this._imgElement.height=c,this._imgElement.src=i):console.error("Il n'y a pas de this._imgElement alors qu'on est dans renderStaticImage")}enterFullscreen(){if(this._imgElement&&this._fullscreenBtn&&(this._imgElement.style.display="none",this._fullscreenBtn.style.display="none"),window.innerWidth<800||/Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent)){const r=window.innerWidth,a=window.innerHeight,s=document.createElement("canvas");s.width=r,s.height=a,s.style.width="100vw",s.style.height="100vh",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.zIndex="5000",document.body.appendChild(s),s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen();const l=document.createElement("button");l.type="button",l.style.position="fixed",l.style.top="20px",l.style.right="30px",l.style.zIndex="6000",l.style.background="#fff",l.style.border="1px solid #888",l.style.borderRadius="6px",l.style.width="48px",l.style.height="48px",l.style.fontSize="1.8em",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",l.style.cursor="pointer",l.innerHTML='<i class="bx bx-exit-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors"></i>',l.title="Quitter le plein cran",document.body.appendChild(l),this.renderer=new Tn({canvas:s,antialias:!0,alpha:!1}),this.renderer&&this.background&&this.setBackground(this.background),this.scene=new En,this.camera=new Zt(35,r/a,.1,1e3),this.camera.position.copy(this._cameraPosition),this.camera.lookAt(this._cameraTarget),this.controls=new _r(this.camera,s),this.controls.target.copy(this._cameraTarget),this.controls.update(),this._objects.forEach(d=>this.scene.add(d)),this.renderer.setSize(r,a,!1),this.startAnimationLoop();const f=()=>{document.body.contains(l)&&document.body.removeChild(l),this.stopAnimationLoop(),this.renderer&&(this.renderer.dispose(),typeof this.renderer.forceContextLoss=="function"&&this.renderer.forceContextLoss()),document.body.contains(s)&&document.body.removeChild(s),this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.renderStaticImage(),this._fullscreenBtn&&(this._fullscreenBtn.style.display=""),this._imgElement&&(this._imgElement.style.display=""),document.fullscreenElement&&document.exitFullscreen?.()};l.onclick=f,document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||f()},{once:!0});return}const c=document.createElement("button");c.type="button",c.style.position="fixed",c.style.top="20px",c.style.right="30px",c.style.zIndex="2000",c.style.background="#fff",c.style.border="1px solid #888",c.style.borderRadius="6px",c.style.width="48px",c.style.height="48px",c.style.fontSize="1.8em",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",c.style.cursor="pointer",c.innerHTML='<i class="bx bx-exit-fullscreen text-lg text-gray-700 hover:text-blue-500 transition-colors"></i>',c.title="Quitter le plein cran",c.style.zIndex="6000",c.onclick=()=>{i()},document.body.appendChild(c);const u=window.innerWidth,t=window.innerHeight,e=document.createElement("canvas");e.width=u,e.height=t,e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.zIndex="5000",document.body.appendChild(e);const o=this.querySelector(".canvas-threejs-overlay");o&&(o.style.position="fixed",o.style.display="block",o.style.top="0",o.style.left="0",o.style.width="100vw",o.style.height="100vh",o.style.zIndex="6000",o.style.pointerEvents="none",o.querySelectorAll("button").forEach(r=>{r.style.zIndex="6010",r.style.pointerEvents="auto"})),this.renderer=new Tn({canvas:e,antialias:!0,alpha:!1}),this.renderer&&this.background&&this.setBackground(this.background),this.scene=new En,this.camera=new Zt(35,u/t,.1,1e3),this.camera.position.copy(this._cameraPosition),this.camera.lookAt(this._cameraTarget),this.controls=new _r(this.camera,e),this.controls.target.copy(this._cameraTarget),this.controls.update(),this._objects.forEach(r=>this.scene.add(r)),this.renderer.setSize(u,t,!1),this.startAnimationLoop();const i=()=>{document.body.contains(c)&&document.body.removeChild(c),o&&(o.style.position="absolute",o.style.display="none",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.zIndex="10",o.style.pointerEvents="none",o.querySelectorAll("button").forEach(r=>{r.style.zIndex="20",r.style.pointerEvents="auto"})),this.stopAnimationLoop(),this.renderer&&(this.renderer.dispose(),typeof this.renderer.forceContextLoss=="function"&&this.renderer.forceContextLoss()),document.body.removeChild(e),this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.renderStaticImage(),this._fullscreenBtn&&(this._fullscreenBtn.style.display=""),this._imgElement&&(this._imgElement.style.display="")}}setObjects(n){this.scene&&(this.scene.clear(),n.forEach(c=>this.scene.add(c)),this.renderer?.render(this.scene,this.camera))}startAnimationLoop(){if(this._animationFrameId)return;const n=()=>{this.renderer?.render(this.scene,this.camera),this.camera&&(this._cameraPosition.copy(this.camera.position),this.controls&&this._cameraTarget.copy(this.controls.target)),this._animationFrameId=requestAnimationFrame(n)};n()}stopAnimationLoop(){this._animationFrameId&&(cancelAnimationFrame(this._animationFrameId),this._animationFrameId=null)}applyPolygonOffset(n){const c=Array.isArray(n.material)?n.material:[n.material];for(const u of c)u.polygonOffset=!0,u.polygonOffsetFactor=1,u.polygonOffsetUnits=1}autoCenterZoom(n,c=1.2){const u=n.filter(s=>!s.isSkySphere).filter(s=>s.type!=="DirectionalLight"&&s.type!=="AmbientLight"),t=new Pt;u.forEach(s=>{if(s instanceof Nr){const l=new Pt().setFromObject(s);if(t.union(l),s instanceof Ye&&s.userData.sourceGeometry){const f=new Ge(s.userData.sourceGeometry),d=new Pt().setFromObject(f);t.union(d)}}});const e=t.getCenter(new be),o=t.getSize(new be),i=o.x,r=o.y,a=o.z;if(c>0&&this.camera){const s=this.camera.fov*Math.PI/180,l=this.width/this.height,f=2*Math.atan(Math.tan(s/2)*l),d=r/(2*Math.tan(s/2)),p=i/(2*Math.tan(f/2)),m=c*Math.max(d,p,a),g=new be(e.x+m,e.y+m,e.z+m);this._cameraPosition.copy(g),this.camera.position.copy(g)}this._cameraTarget.copy(e),this.controls?(this.controls.target.copy(e),this.controls.update()):this.camera&&this.camera.lookAt(e)}destroyRenderer(){this.stopAnimationLoop(),this.renderer&&(this.renderer.dispose(),typeof this.renderer.forceContextLoss=="function"&&this.renderer.forceContextLoss()),this.renderer=null,this.scene=null,this.camera=null,this.controls=null}setBackground(n){this.renderer&&this.renderer.setClearColor(n)}removeDynamicButtonListeners(){const n=this.querySelector(".canvas-threejs-overlay");n&&(n.querySelectorAll("button").forEach(u=>{const t=u.cloneNode(!0);n.replaceChild(t,u)}),this.removeChild(n))}}customElements.define("canvas-3d",Yi);const Xi=[16711680,10946825,16753500,14320679,16776960,13290010];function na({id:h,content:n,width:c=200,height:u=200}){const t=encodeURIComponent(JSON.stringify(n));return`<canvas-3d id="${h}" content='${t}' width="${c}" height="${u}"></canvas-3d>`}function Ki(h){h.className="inline-flex px-6 py-2.5 ml-6 bg-coopmaths-action dark:bg-coopmathsdark-action text-coopmaths-canvas dark:text-coopmathsdark-canvas font-medium text-xs leading-tight uppercase rounded shadow-md transform hover:bg-coopmaths-action-lightest dark:hover:bg-coopmathsdark-action-lightest hover:shadow-lg focus:bg-coopmaths-action-lightest dark:focus:bg-coopmathsdark-action-lightest focus:shadow-lg focus:outline-none focus:ring-0 active:bg-coopmaths-action-lightest dark:active:bg-coopmathsdark-action-lightest active:shadow-lg transition duration-150 ease-in-out",h.setAttribute("type","button")}function Zi(h){const n=[];return h.forEach(c=>{c.traverse(u=>{u instanceof Nn&&n.push(u)})}),n}export{ea as a,Qi as b,ta as c,$i as d,na as e,Br as s};
