import{y}from"./embellissements-BYV7mIDn.js";import"./comparisonFunctions-B45ZZ3C7.js";function E(s,n=!0){if(typeof s!="string")throw TypeError("argument invalide");const e=document.getElementById(s);if(!e&&n)throw Error(`L’élément html ${s} n’existe pas`);return e}function D(s){s.target instanceof HTMLDivElement&&s.dataTransfer?.setData("text/plain",s.target.id)}function h(s){s.preventDefault();const n=s.target;if(n.classList.contains("trashDND")){const e=n.firstChild;e&&e instanceof HTMLElement&&e.classList.add("hovered")}}function x(s){s.preventDefault()}function f(s){s.preventDefault();const n=s.target,e=s.dataTransfer?.getData("text/plain");if(e){const i=document.getElementById(e);if(i&&n){if((!n.id||!n.id.includes("rectangle"))&&i.id.includes("clone")){i.parentElement?.removeChild(i);return}const r=/Ex(\d+)Q(\d+)I(\d+)/,u=i.id.match(r);let l="";if(u){const a=u[1],o=u[2];l=`Ex${a}Q${o}`}if(i.classList.contains("duplicable")&&n.classList.contains("rectangleDND")&&n.id.includes(l)){const a=i.cloneNode(!0);a.id=`${i.id}-clone-${Date.now()}`,g(a),n.appendChild(a)}else if(n.classList.contains("rectangleDND")&&n.id.includes(l))g(i,i.parentElement),n.appendChild(i);else if(n.parentElement?.classList.contains("rectangleDND")&&n.parentElement?.id.includes(l)){const a=i.cloneNode(!0);a.id=`${i.id}-clone-${Date.now()}`,g(a),n.after(a)}n.classList.remove("hovered")}}}function L(s){let n=s.target;for(;n&&n.tagName!=="DIV";)n=n.parentElement;if(n?.classList.contains("etiquette")&&n?.classList.contains("dragOk")){const e=n.cloneNode(!0);e.style.display="none",n.before(e)}}function p(s){s.preventDefault();const n=s.changedTouches[0];let e=n.target;for(;e&&e.tagName!=="DIV";)e=e.parentElement;if(e&&e.classList.contains("etiquette")&&e.classList.contains("dragOk")){if(e.parentElement){const a=e.parentElement.offsetTop,o=e.parentElement.offsetLeft,c=e.parentElement.getBoundingClientRect();if(c){const t=n.clientX,d=n.clientY;e.previousElementSibling.style.display="block",e.style.position="absolute",e.style.left=`${t-c.left+o-e.clientWidth/2}px`,e.style.top=`${d-c.top+a-e.clientHeight/2}px`}}const i=/Ex(\d+)Q(\d+)I(\d+)/,r=e.id.match(i);let u="";if(r){const a=r[1],o=r[2];u=`Ex${a}Q${o}`}const l=document.querySelectorAll(`div.rectangleDND[id^="rectangle${u}"`);for(const a of l){const o=a.getBoundingClientRect();n.clientX>o.left&&n.clientX<o.right&&n.clientY>o.top&&n.clientY<o.bottom?a.classList.add("hovered"):a.classList.remove("hovered")}}}function m(s){const n=s.changedTouches[0];let e=n.target;if(e&&e.tagName==="BUTTON"&&e.classList.contains("delete-btn")){e.click();return}for(;e&&e.tagName!=="DIV";)e=e.parentElement;if(e&&e.classList.contains("etiquette")&&e.classList.contains("dragOk")){const i=n.clientX,r=n.clientY,u=/Ex(\d+)Q(\d+)I(\d+)/,l=e.id.match(u);let a="";if(l){const t=l[1],d=l[2];a=`Ex${t}Q${d}`}const o=document.querySelectorAll(`div.rectangleDND[id^="rectangle${a}"`);let c=null;for(const t of o){const d=t.getBoundingClientRect();if(i>d.left&&i<d.right&&r>d.top&&r<d.bottom){c=t;break}}if(c?.children?.length)for(let t=0;t<c?.children?.length;t++){const d=c.children[t].getBoundingClientRect();if(i>d.left&&i<d.right&&r>d.top&&r<d.bottom){c=c.children[t];break}}if(c?.classList.contains("rectangleDND")||c?.parentElement?.classList.contains("rectangleDND")){if(e.classList.contains("duplicable")&&c.classList.contains("rectangleDND")){const t=e.cloneNode(!0);t.id=`${e.id}-clone-${Date.now()}`,g(t),t.style.position="relative",t.style.top="0px",t.classList.remove("dragOk"),t.style.left="0px",t.style.zIndex="1",c.appendChild(t)}else if(c.classList.contains("rectangleDND"))g(e,e.parentElement),e.previousElementSibling?.remove(),c.appendChild(e);else{const t=e.cloneNode(!0);t.id=`${e.id}-clone-${Date.now()}`,g(t),t.style.position="relative",t.style.top="0px",t.classList.remove("dragOk"),t.style.left="0px",t.style.zIndex="1",c.after(t)}c.classList.remove("hovered")}e.style.position="relative",e.style.top="0px",e.style.left="0px",e.classList.contains("duplicable")&&e.previousElementSibling?.remove()}}function $(s){s.target instanceof HTMLElement&&s.target.classList.contains("rectangleDND")&&s.target.classList.add("hovered")}function q(s){const n=s.target;n instanceof HTMLElement&&(n.classList.contains("rectangleDND")||n.classList.contains("trashDND"))&&n.classList.remove("hovered")}function g(s,n=null){const e=document.createElement("button");e.textContent="x",e.classList.add("delete-btn"),e.addEventListener("click",()=>{s.classList.contains("duplicable")?s.remove():(n?.appendChild(s),s.removeChild(e))}),s.appendChild(e)}class Q{exercice;question;consigne;etiquettes;enonceATrous;listeners;constructor({exercice:n,question:e,consigne:i,etiquettes:r,enonceATrous:u}){this.exercice=n,this.question=e,this.consigne=i,this.etiquettes=r,this.enonceATrous=u,this.listeners=[]}ajouteDragAndDrop({melange:n=!1,duplicable:e=!1}){const i=this.exercice.numeroExercice;{let r="";const u='<hr width="100%" height="0px" />';r+=`<div class="questionDND" id="divDragAndDropEx${i}Q${this.question}">
	`,r+=`<div class="consigneDND">${this.consigne}</div>
	`,r+=`<div  class="etiquettes" id="etiquettesEx${i}Q${this.question}">
	`;for(const o of this.etiquettes){const c=n?y(o.slice()):o.slice();for(const t of c)r+=`<div class="etiquette${this.exercice.interactif?" dragOk":" noDrag"}${e?" duplicable":""}${this.exercice.interactif?" bg-gray-200":""}" draggable="${this.exercice.interactif?"true":"false"}" id="etiquetteEx${i}Q${this.question}I${t.id}">${t.contenu}</div>
	`;r+=u}r=r.substring(0,r.length-u.length),r+="</div>",r+=`<div class="rectangles" id="rectanglesEx${i}Q${this.question}" >
	`;let l=this.enonceATrous,a="";for(;l;){const o=/^(.*?)%\{([^}]+)}(.*?)$/.exec(l);if(o){const[,c,t,d]=o,v=t;if(v==null)throw Error(`Définition de ${v} manquante`);a+=`<span>${c}</span>`,this.exercice.interactif?a+=`<div class="rectangleDND" id="rectangleEx${i}Q${this.question}R${v.substring(9)}"></div>`:a+='<hr style="height: 30px; width: 60px; border: 1px dashed #555;">',l=d??""}else a+=l,l=""}if(r+=a,r+=`<span id="resultatCheckEx${i}Q${this.question}"></span></div>`,this.exercice.interactif)r+=`<div class="ml-2 py-2 italic text-coopmaths-warn-darkest dark:text-coopmathsdark-warn-darkest" id="feedbackEx${i}Q${this.question}"></div>`,document.addEventListener("exercicesAffiches",()=>{const o=E(`etiquettesEx${i}Q${this.question}`,!1);if(o){o.addEventListener("drop",f),o.addEventListener("dragover",h),o.addEventListener("touchmove",p,{capture:!0}),o.addEventListener("touchend",m),this.listeners.push([o,"drop",f],[o,"dragover",h],[o,"touchmove",p],[o,"touchend",m]);for(const t of o.querySelectorAll(".etiquette"))t.addEventListener("dragstart",D),t.addEventListener("dragend",x),t.addEventListener("touchstart",L,{capture:!1}),this.listeners.push([t,"dragstart",D],[t,"touchstart",L],[t,"dragend",x])}const c=E(`rectanglesEx${i}Q${this.question}`,!1);if(c)for(const t of c.querySelectorAll(".rectangleDND"))t.addEventListener("dragover",h),t.addEventListener("drop",f),t.addEventListener("touchmove",p),t.addEventListener("touchend",m),t.addEventListener("dragenter",$),t.addEventListener("dragleave",q),this.listeners.push([t,"dragover",h],[t,"drop",f],[t,"touchmove",p],[t,"touchend",m],[t,"dragenter",$],[t,"dragleave",q])});else{const o=E(`etiquettesEx${i}Q${this.question}`,!1);if(o)for(const c of o.querySelectorAll(".etiquette"))c.classList.add("noDrag")}return r}}}export{Q as D};
