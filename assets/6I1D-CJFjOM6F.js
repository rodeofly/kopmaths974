import{c as commonjsGlobal,a as getDefaultExportFromCjs}from"./index-BUDQz6-w.js";import{e as blockly_compressedExports,W as Workspace,s as serialization,c as svgResize,u as utils,X as Xml,d as setLocale,E as En,M as Msg,B as Blocks,f as defineBlocksWithJsonArray,i as inject,C as ContextMenuRegistry}from"./en-CH6AM4SJ.js";import{d as ajouteFeedback}from"./questionMathLive-DdRvWqlN.js";import{r as runAStar}from"./findPath-D-bvJShA.js";import{r as randint,l as listeQuestionsToContenu}from"./embellissements-BYV7mIDn.js";import{E as Exercice}from"./Exercice-DtXhjCyI.js";import"./tableauMathlive-xx-nDjq0.js";import"./canStore-DaSrd7sp.js";import"./generalStore-C3E9FHtR.js";import"decimal.js";import"seedrandom";import"mathjs";import"katex";import"earcut";import"roughjs";import"./comparisonFunctions-B45ZZ3C7.js";import"./compute-engine.min.umd-BwAhpA7x.js";import"./Hms-u2AUyU1C.js";import"./ListeDeroulanteElement-CXmzV-cr.js";import"./sizeTools-DfTC1Dgv.js";import"./time-DMC-jnVL.js";import"./exerciseMethods-CtbYPwln.js";import"crypto-js";import"./gestionInteractif-DujZpSu8.js";import"./AjouteTableauMathlive-Bz24QHd3.js";var blocks_compressed={exports:{}};(function(a,d){(function(_,s){a.exports=s(blockly_compressedExports)})(commonjsGlobal,function(_){var s=_.__namespace__,m=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),g={customContextMenu:function(t){if(this.isInFlyout)(this.type==="variables_get_dynamic"||this.type==="variables_get_reporter_dynamic")&&(l={text:s.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:I(this)},u=this.getField("VAR").getText(),u={text:s.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",u),enabled:!0,callback:h(this)},t.unshift(l),t.unshift(u));else{if(this.type==="variables_get_dynamic")var r="variables_set_dynamic",l=s.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else r="variables_get_dynamic",l=s.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var u=this.getField("VAR");r={type:r,fields:{VAR:u.saveState(!0)}},t.push({enabled:this.workspace.remainingCapacity()>0,text:l.replace("%1",u.getText()),callback:s.callbackFactory$$module$build$src$core$contextmenu(this,r)})}},onchange:function(t){t=this.getFieldValue("VAR"),t=s.getVariable$$module$build$src$core$variables(this.workspace,t),this.type==="variables_get_dynamic"?this.outputConnection.setCheck(t.getType()):this.getInput("VALUE").connection.setCheck(t.getType())}},I=function(t){return function(){const r=t.workspace,l=t.getField("VAR").getVariable();s.renameVariable$$module$build$src$core$variables(r,l)}},h=function(t){return function(){const r=t.getField("VAR").getVariable();r&&s.deleteVariable$$module$build$src$core$variables(r.getWorkspace(),r,t)}};s.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",g),s.defineBlocks$$module$build$src$core$common(m);var L={blocks:m},M=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),b={customContextMenu:function(t){if(this.isInFlyout)(this.type==="variables_get"||this.type==="variables_get_reporter")&&(l={text:s.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:O(this)},u=this.getField("VAR").getText(),u={text:s.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",u),enabled:!0,callback:v(this)},t.unshift(l),t.unshift(u));else{if(this.type==="variables_get")var r="variables_set",l=s.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else r="variables_get",l=s.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var u=this.getField("VAR");r={type:r,fields:{VAR:u.saveState(!0)}},t.push({enabled:this.workspace.remainingCapacity()>0,text:l.replace("%1",u.getText()),callback:s.callbackFactory$$module$build$src$core$contextmenu(this,r)})}}},O=function(t){return function(){const r=t.workspace,l=t.getField("VAR").getVariable();s.renameVariable$$module$build$src$core$variables(r,l)}},v=function(t){return function(){const r=t.getField("VAR").getVariable();r&&s.deleteVariable$$module$build$src$core$variables(r.getWorkspace(),r,t)}};s.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",b),s.defineBlocks$$module$build$src$core$common(M);var x={blocks:M},A=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),R={init:function(){this.WHERE_OPTIONS_1=[[s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT);const t=r=>{const l=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+r]});return l.setValidator(function(u){const T=this.getValue();u=u==="FROM_START"||u==="FROM_END",u!==(T==="FROM_START"||T==="FROM_END")&&this.getSourceBlock().updateAt_(r,u)}),l};this.appendDummyInput("WHERE1_INPUT").appendField(t(1),"WHERE1"),this.appendDummyInput("AT1"),this.appendDummyInput("WHERE2_INPUT").appendField(t(2),"WHERE2"),this.appendDummyInput("AT2"),s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");var r=this.getInput("AT1")instanceof s.ValueInput$$module$build$src$core$inputs$value_input;return t.setAttribute("at1",`${r}`),r=this.getInput("AT2")instanceof s.ValueInput$$module$build$src$core$inputs$value_input,t.setAttribute("at2",`${r}`),t},domToMutation:function(t){const r=t.getAttribute("at1")==="true";t=t.getAttribute("at2")==="true",this.updateAt_(1,r),this.updateAt_(2,t)},updateAt_:function(t,r){this.removeInput("AT"+t),this.removeInput("ORDINAL"+t,!0),r?(this.appendValueInput("AT"+t).setCheck("Number"),s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+t).appendField(s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+t),t===2&&s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(s.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL)),t===1&&(this.moveInputBefore("AT1","WHERE2_INPUT"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","WHERE2_INPUT"))}};A.text_getSubstring=R,A.text_changeCase={init:function(){const t=[[s.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[s.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[s.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(s.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(s.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},A.text_trim={init:function(){const t=[[s.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[s.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[s.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(s.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(s.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},A.text_print={init:function(){this.jsonInit({message0:s.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:s.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:s.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var f={updateType_:function(t){this.outputConnection.setCheck(t==="NUMBER"?"Number":"String")},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("type",this.getFieldValue("TYPE")),t},domToMutation:function(t){this.updateType_(t.getAttribute("type"))}};A.text_prompt_ext=Object.assign({},f,{init:function(){var t=[[s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(s.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),t.setValidator(r=>{this.updateType_(r)}),this.appendValueInput("TEXT").appendField(t,"TYPE"),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}}),A.text_prompt=Object.assign({},f,{init:function(){this.mixin(k);var t=[[s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(s.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),t.setValidator(r=>{this.updateType_(r)}),this.appendDummyInput().appendField(t,"TYPE").appendField(this.newQuote_(!0)).appendField(s.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:s.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}}),A.text_count={init:function(){this.jsonInit({message0:s.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:s.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:s.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},A.text_replace={init:function(){this.jsonInit({message0:s.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:s.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:s.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},A.text_reverse={init:function(){this.jsonInit({message0:s.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:s.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:s.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var k={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(t){for(let r=0,l;l=this.inputList[r];r++)for(let u=0,T;T=l.fieldRow[u];u++)if(t===T.name){l.insertFieldAt(u,this.newQuote_(!0)),l.insertFieldAt(u+2,this.newQuote_(!1));return}console.warn('field named "'+t+'" not found in '+this.toDevString())},newQuote_:function(t){return t=this.RTL?!t:t,s.fromJson$$module$build$src$core$field_registry({type:"field_image",src:t?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:t?"“":"”"})}},G=function(){this.mixin(k),this.quoteField_("TEXT")},W={itemCount_:0,mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("items",`${this.itemCount_}`),t},domToMutation:function(t){this.itemCount_=parseInt(t.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(t){this.itemCount_=t.itemCount,this.updateShape_()},decompose:function(t){const r=t.newBlock("text_create_join_container");r.initSvg();let l=r.getInput("STACK").connection;for(let u=0;u<this.itemCount_;u++){const T=t.newBlock("text_create_join_item");T.initSvg(),l.connect(T.previousConnection),l=T.nextConnection}return r},compose:function(t){var r=t.getInputTargetBlock("STACK");for(t=[];r;)r.isInsertionMarker()||t.push(r.valueConnection_),r=r.getNextBlock();for(r=0;r<this.itemCount_;r++){const l=this.getInput("ADD"+r).connection.targetConnection;l&&!t.includes(l)&&l.disconnect()}for(this.itemCount_=t.length,this.updateShape_(),r=0;r<this.itemCount_;r++){let l;(l=t[r])==null||l.reconnect(this,"ADD"+r)}},saveConnections:function(t){t=t.getInputTargetBlock("STACK");let r=0;for(;t;){if(t.isInsertionMarker()){t=t.getNextBlock();continue}const l=this.getInput("ADD"+r);t.valueConnection_=l&&l.connection.targetConnection,t=t.getNextBlock(),r++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var t=0;t<this.itemCount_;t++)if(!this.getInput("ADD"+t)){const r=this.appendValueInput("ADD"+t).setAlign(s.Align$$module$build$src$core$inputs$align.RIGHT);t===0&&r.appendField(s.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(t=this.itemCount_;this.getInput("ADD"+t);t++)this.removeInput("ADD"+t)}},q=function(){this.mixin(k),this.itemCount_=2,this.updateShape_(),this.setMutator(new s.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))};s.register$$module$build$src$core$extensions("text_append_tooltip",s.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var K=function(){this.setTooltip(()=>s.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))},X={isAt_:!1,mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("at",`${this.isAt_}`),t},domToMutation:function(t){t=t.getAttribute("at")!=="false",this.updateAt_(t)},updateAt_:function(t){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),t&&(this.appendValueInput("AT").setCheck("Number"),s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),s.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(s.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=t}},H=function(){this.getField("WHERE").setValidator(function(t){t=t==="FROM_START"||t==="FROM_END";const r=this.getSourceBlock();t!==r.isAt_&&r.updateAt_(t)}),this.updateAt_(!0),this.setTooltip(()=>{var t=this.getFieldValue("WHERE");let r=s.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return(t==="FROM_START"||t==="FROM_END")&&(t=t==="FROM_START"?s.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:s.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(r+="  "+t.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),r})};s.register$$module$build$src$core$extensions("text_indexOf_tooltip",K),s.register$$module$build$src$core$extensions("text_quotes",G),s.registerMixin$$module$build$src$core$extensions("quote_image_mixin",k),s.registerMutator$$module$build$src$core$extensions("text_join_mutator",W,q),s.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",X,H),s.defineBlocks$$module$build$src$core$common(A);var B={blocks:A},S={},U={setStatements_:function(t){this.hasStatements_!==t&&(t?(this.appendStatementInput("STACK").appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=t)},updateParams_:function(){let t="";this.arguments_.length&&(t=s.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),s.disable$$module$build$src$core$events$utils();try{this.setFieldValue(t,"PARAMS")}finally{s.enable$$module$build$src$core$events$utils()}},mutationToDom:function(t){const r=s.createElement$$module$build$src$core$utils$xml("mutation");t&&r.setAttribute("name",this.getFieldValue("NAME"));for(let l=0;l<this.argumentVarModels_.length;l++){const u=s.createElement$$module$build$src$core$utils$xml("arg"),T=this.argumentVarModels_[l];u.setAttribute("name",T.getName()),u.setAttribute("varid",T.getId()),t&&this.paramIds_&&u.setAttribute("paramId",this.paramIds_[l]),r.appendChild(u)}return this.hasStatements_||r.setAttribute("statements","false"),r},domToMutation:function(t){this.arguments_=[],this.argumentVarModels_=[];for(let l=0,u;u=t.childNodes[l];l++)if(u.nodeName.toLowerCase()==="arg"){var r=u;const T=r.getAttribute("name");r=r.getAttribute("varid")||r.getAttribute("varId"),this.arguments_.push(T),r=s.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,r,T,""),r!==null?this.argumentVarModels_.push(r):console.log(`Failed to create a variable named "${T}", ignoring.`)}this.updateParams_(),s.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(t.getAttribute("statements")!=="false")},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const t=Object.create(null);if(this.argumentVarModels_.length){t.params=[];for(let r=0;r<this.argumentVarModels_.length;r++)t.params.push({name:this.argumentVarModels_[r].getName(),id:this.argumentVarModels_[r].getId()})}return this.hasStatements_||(t.hasStatements=!1),t},loadExtraState:function(t){if(this.arguments_=[],this.argumentVarModels_=[],t.params)for(let l=0;l<t.params.length;l++){var r=t.params[l];r=s.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,r.id,r.name,""),this.arguments_.push(r.getName()),this.argumentVarModels_.push(r)}this.updateParams_(),s.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(t.hasStatements!==!1)},decompose:function(t){const r=s.createElement$$module$build$src$core$utils$xml("block");r.setAttribute("type","procedures_mutatorcontainer");var l=s.createElement$$module$build$src$core$utils$xml("statement");l.setAttribute("name","STACK"),r.appendChild(l);for(let T=0;T<this.arguments_.length;T++){const N=s.createElement$$module$build$src$core$utils$xml("block");N.setAttribute("type","procedures_mutatorarg");var u=s.createElement$$module$build$src$core$utils$xml("field");u.setAttribute("name","NAME");const Y=s.createTextNode$$module$build$src$core$utils$xml(this.arguments_[T]);u.appendChild(Y),N.appendChild(u),u=s.createElement$$module$build$src$core$utils$xml("next"),N.appendChild(u),l.appendChild(N),l=u}return t=s.domToBlock$$module$build$src$core$xml(r,t),this.type==="procedures_defreturn"?t.setFieldValue(this.hasStatements_,"STATEMENTS"):t.removeInput("STATEMENT_INPUT"),s.mutateCallers$$module$build$src$core$procedures(this),t},compose:function(t){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let r=t.getInputTargetBlock("STACK");for(;r&&!r.isInsertionMarker();){var l=r.getFieldValue("NAME");this.arguments_.push(l),l=this.workspace.getVariable(l,""),this.argumentVarModels_.push(l),this.paramIds_.push(r.id),r=r.nextConnection&&r.nextConnection.targetBlock()}if(this.updateParams_(),s.mutateCallers$$module$build$src$core$procedures(this),t=t.getFieldValue("STATEMENTS"),t!==null&&(t=t==="TRUE",this.hasStatements_!==t))if(t){this.setStatements_(!0);var u;(u=this.statementConnection_)==null||u.reconnect(this,"STACK"),this.statementConnection_=null}else u=this.getInput("STACK").connection,(this.statementConnection_=u.targetConnection)&&(u=u.targetBlock(),u.unplug(),u.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(t,r){var l=this.workspace.getVariableById(t);if(l.getType()===""){l=l.getName(),r=this.workspace.getVariableById(r);var u=!1;for(let T=0;T<this.argumentVarModels_.length;T++)this.argumentVarModels_[T].getId()===t&&(this.arguments_[T]=r.getName(),this.argumentVarModels_[T]=r,u=!0);u&&(this.displayRenamedVar_(l,r.getName()),s.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(t){const r=t.getName();let l=!1,u;for(let T=0;T<this.argumentVarModels_.length;T++)this.argumentVarModels_[T].getId()===t.getId()&&(u=this.arguments_[T],this.arguments_[T]=r,l=!0);l&&(this.displayRenamedVar_(u,r),s.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(t,r){this.updateParams_();var l=this.getIcon(s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(l&&l.bubbleIsVisible()){l=l.getWorkspace().getAllBlocks(!1);for(let u=0,T;T=l[u];u++)T.type==="procedures_mutatorarg"&&s.Names$$module$build$src$core$names.equals(t,T.getFieldValue("NAME"))&&T.setFieldValue(r,"NAME")}},customContextMenu:function(t){if(!this.isInFlyout){var r=this.getFieldValue("NAME"),l={type:this.callType_,extraState:{name:r,params:this.arguments_}};if(t.push({enabled:!0,text:s.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",r),callback:s.callbackFactory$$module$build$src$core$contextmenu(this,l)}),!this.isCollapsed())for(r=0;r<this.argumentVarModels_.length;r++){l=this.argumentVarModels_[r];const u={type:"variables_get",fields:{VAR:{name:l.getName(),id:l.getId(),type:l.getType()}}};t.push({enabled:!0,text:s.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",l.getName()),callback:s.callbackFactory$$module$build$src$core$contextmenu(this,u)})}}}};S.procedures_defnoreturn=Object.assign({},U,{init:function(){var t=s.findLegalName$$module$build$src$core$procedures("",this);t=s.fromJson$$module$build$src$core$field_registry({type:"field_input",text:t}),t.setValidator(s.rename$$module$build$src$core$procedures),t.setSpellcheck(!1),this.appendDummyInput().appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(t,"NAME").appendField("","PARAMS"),this.setMutator(new s.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),S.procedures_defreturn=Object.assign({},U,{init:function(){var t=s.findLegalName$$module$build$src$core$procedures("",this);t=s.fromJson$$module$build$src$core$field_registry({type:"field_input",text:t}),t.setValidator(s.rename$$module$build$src$core$procedures),t.setSpellcheck(!1),this.appendDummyInput().appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(t,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(s.Align$$module$build$src$core$inputs$align.RIGHT).appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new s.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var J={init:function(){this.appendDummyInput().appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(s.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(s.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};S.procedures_mutatorcontainer=J;var $e=class extends s.FieldTextInput$$module$build$src$core$field_textinput{constructor(){super(...arguments),this.editingInteractively=!1}showEditor_(t){super.showEditor_(t),this.editingInteractively=!0,this.editingVariable=void 0}onFinishEditing_(t){super.onFinishEditing_(t),this.editingInteractively=!1}},_e={init:function(){const t=new $e(s.DEFAULT_ARG$$module$build$src$core$procedures,this.validator_);this.appendDummyInput().appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(t,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(s.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1},validator_:function(t){var r=this.getSourceBlock();const l=r.workspace.getRootWorkspace();if(t=t.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""),!t)return null;const u=(r.workspace.targetWorkspace||r.workspace).getAllBlocks(!1),T=t.toLowerCase();for(let N=0;N<u.length;N++){if(u[N].id===this.getSourceBlock().id)continue;const Y=u[N].getFieldValue("NAME");if(Y&&Y.toLowerCase()===T)return null}return r.isInFlyout||((r=l.getVariable(t,""))&&r.getName()!==t&&l.renameVariableById(r.getId(),t),r||(this.editingInteractively?this.editingVariable?l.renameVariableById(this.editingVariable.getId(),t):this.editingVariable=l.createVariable(t,""):l.createVariable(t,""))),t}};S.procedures_mutatorarg=_e;var j="DISABLED_PROCEDURE_DEFINITION",te={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(t,r){s.Names$$module$build$src$core$names.equals(t,this.getProcedureCall())&&(this.setFieldValue(r,"NAME"),this.setTooltip((this.outputConnection?s.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:s.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",r)))},setProcedureParameters_:function(t,r){var l=s.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((l=(l=l&&l.getIcon(s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&l.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),t.join(`
`)===this.arguments_.join(`
`))this.quarkIds_=r;else{if(r.length!==t.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let T=0;T<this.arguments_.length;T++){var u=this.getInput("ARG"+T);u&&(u=u.connection.targetConnection,this.quarkConnections_[this.quarkIds_[T]]=u,l&&u&&!r.includes(this.quarkIds_[T])&&(u.disconnect(),u.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(t),this.argumentVarModels_=[],t=0;t<this.arguments_.length;t++)l=s.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[t],""),this.argumentVarModels_.push(l);if(this.updateShape_(),this.quarkIds_=r){for(r=0;r<this.arguments_.length;r++)if(t=this.quarkIds_[r],t in this.quarkConnections_){let T;(T=this.quarkConnections_[t])!=null&&T.reconnect(this,"ARG"+r)||delete this.quarkConnections_[t]}}}},updateShape_:function(){for(var t=0;t<this.arguments_.length;t++){var r=this.getField("ARGNAME"+t);if(r){s.disable$$module$build$src$core$events$utils();try{r.setValue(this.arguments_[t])}finally{s.enable$$module$build$src$core$events$utils()}}else r=s.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[t]}),this.appendValueInput("ARG"+t).setAlign(s.Align$$module$build$src$core$inputs$align.RIGHT).appendField(r,"ARGNAME"+t)}for(t=this.arguments_.length;this.getInput("ARG"+t);t++)this.removeInput("ARG"+t);(t=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||t.appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"):this.getField("WITH")&&t.removeField("WITH"))},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");t.setAttribute("name",this.getProcedureCall());for(let r=0;r<this.arguments_.length;r++){const l=s.createElement$$module$build$src$core$utils$xml("arg");l.setAttribute("name",this.arguments_[r]),t.appendChild(l)}return t},domToMutation:function(t){var r=t.getAttribute("name");this.renameProcedure(this.getProcedureCall(),r),r=[];const l=[];for(let u=0,T;T=t.childNodes[u];u++)T.nodeName.toLowerCase()==="arg"&&(r.push(T.getAttribute("name")),l.push(T.getAttribute("paramId")));this.setProcedureParameters_(r,l)},saveExtraState:function(){const t=Object.create(null);return t.name=this.getProcedureCall(),this.arguments_.length&&(t.params=this.arguments_),t},loadExtraState:function(t){if(this.renameProcedure(this.getProcedureCall(),t.name),t=t.params){const r=[];r.length=t.length,r.fill(null),this.setProcedureParameters_(t,r)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(t){if(this.workspace&&!this.workspace.isFlyout&&t.recordUndo)if(t.type===s.BLOCK_CREATE$$module$build$src$core$events$events&&t.ids.includes(this.id)){var r=this.getProcedureCall(),l=s.getDefinition$$module$build$src$core$procedures(r,this.workspace);if(!l||l.type===this.defType_&&JSON.stringify(l.getVars())===JSON.stringify(this.arguments_)||(l=null),l)l.isEnabled()||(this.setDisabledReason(!0,j),this.setWarningText(s.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",r)));else{s.setGroup$$module$build$src$core$events$utils(t.group),t=s.createElement$$module$build$src$core$utils$xml("xml"),r=s.createElement$$module$build$src$core$utils$xml("block"),r.setAttribute("type",this.defType_),l=this.getRelativeToSurfaceXY();var u=l.y+s.config$$module$build$src$core$config.snapRadius*2;r.setAttribute("x",`${l.x+s.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),r.setAttribute("y",`${u}`),l=this.mutationToDom(),r.appendChild(l),l=s.createElement$$module$build$src$core$utils$xml("field"),l.setAttribute("name","NAME"),u=this.getProcedureCall();const T=s.findLegalName$$module$build$src$core$procedures(u,this);u!==T&&this.renameProcedure(u,T),l.appendChild(s.createTextNode$$module$build$src$core$utils$xml(u)),r.appendChild(l),t.appendChild(r),s.domToWorkspace$$module$build$src$core$xml(t,this.workspace),s.setGroup$$module$build$src$core$events$utils(!1)}}else t.type===s.BLOCK_DELETE$$module$build$src$core$events$events?(r=this.getProcedureCall(),s.getDefinition$$module$build$src$core$procedures(r,this.workspace)||(s.setGroup$$module$build$src$core$events$utils(t.group),this.dispose(!0),s.setGroup$$module$build$src$core$events$utils(!1))):t.type===s.BLOCK_CHANGE$$module$build$src$core$events$events&&t.element==="disabled"&&(r=this.getProcedureCall(),(u=s.getDefinition$$module$build$src$core$procedures(r,this.workspace))&&u.id===t.blockId&&((l=s.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),s.setGroup$$module$build$src$core$events$utils(t.group),t=u.isEnabled(),this.setDisabledReason(!t,j),this.setWarningText(t?null:s.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",r)),s.setGroup$$module$build$src$core$events$utils(l)))},customContextMenu:function(t){if(this.workspace.isMovable()){var r=this.getProcedureCall(),l=this.workspace;t.push({enabled:!0,text:s.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const u=s.getDefinition$$module$build$src$core$procedures(r,l);u&&(l.centerOnBlock(u.id),s.getFocusManager$$module$build$src$core$focus_manager().focusNode(u))}})}}};S.procedures_callnoreturn=Object.assign({},te,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(s.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defnoreturn"}),S.procedures_callreturn=Object.assign({},te,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(s.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defreturn"});var de="UNPARENTED_IFRETURN",Te={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(s.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(s.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(s.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("value",String(Number(this.hasReturnValue_))),t},domToMutation:function(t){this.hasReturnValue_=t.getAttribute("value")==="1",this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(t){if(!(this.workspace.isDragging&&this.workspace.isDragging()||t.type!==s.BLOCK_MOVE$$module$build$src$core$events$events&&t.type!==s.BLOCK_CREATE$$module$build$src$core$events$events)){t=!1;var r=this;do{if(this.FUNCTION_TYPES.includes(r.type)){t=!0;break}r=r.getSurroundParent()}while(r);if(t?(r.type==="procedures_defnoreturn"&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):r.type!=="procedures_defreturn"||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(s.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),!this.isInFlyout)try{s.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!t,de)}finally{s.setRecordUndo$$module$build$src$core$events$utils(!0)}}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};S.procedures_ifreturn=Te,s.defineBlocks$$module$build$src$core$common(S);var me={blocks:S},Q=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["π","PI"],["e","E"],["φ","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt(½)","SQRT1_2"],["∞","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),pe={ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"};s.register$$module$build$src$core$extensions("math_op_tooltip",s.buildTooltipForDropdown$$module$build$src$core$extensions("OP",pe));var Ee={mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation"),r=this.getFieldValue("PROPERTY")==="DIVISIBLE_BY";return t.setAttribute("divisor_input",String(r)),t},domToMutation:function(t){t=t.getAttribute("divisor_input")==="true",this.updateShape_(t)},updateShape_:function(t){const r=this.getInput("DIVISOR");t?r||this.appendValueInput("DIVISOR").setCheck("Number"):r&&this.removeInput("DIVISOR")}},ge=function(){this.getField("PROPERTY").setValidator(function(t){t=t==="DIVISIBLE_BY",this.getSourceBlock().updateShape_(t)})};s.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",Ee,ge),s.register$$module$build$src$core$extensions("math_change_tooltip",s.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var Ie={updateType_:function(t){t==="MODE"?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("op",this.getFieldValue("OP")),t},domToMutation:function(t){if(t=t.getAttribute("op"),t===null)throw new TypeError("xmlElement had no op attribute");this.updateType_(t)}},se=function(){this.getField("OP").setValidator(function(t){this.updateType_(t)}.bind(this))};s.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",Ie,se),s.defineBlocks$$module$build$src$core$common(Q);var he={blocks:Q},z=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),Oe={WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"};s.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",s.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",Oe));var Ae={BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"};s.register$$module$build$src$core$extensions("controls_flow_tooltip",s.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",Ae));var Se={customContextMenu:function(t){if(!this.isInFlyout){var r=this.getField("VAR"),l=r.getVariable().getName();this.isCollapsed()||l===null||(r={type:"variables_get",fields:{VAR:r.saveState(!0)}},t.push({enabled:!0,text:s.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",l),callback:s.callbackFactory$$module$build$src$core$contextmenu(this,r)}))}}};s.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",Se),s.register$$module$build$src$core$extensions("controls_for_tooltip",s.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),s.register$$module$build$src$core$extensions("controls_forEach_tooltip",s.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var oe=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),Ne="CONTROL_FLOW_NOT_IN_LOOP",Re={getSurroundLoop:function(){let t=this;do{if(oe.has(t.type))return t;t=t.getSurroundParent()}while(t);return null},onchange:function(t){const r=this.workspace;if(r.isDragging&&!r.isDragging()&&(t.type===s.BLOCK_MOVE$$module$build$src$core$events$events||t.type===s.BLOCK_CREATE$$module$build$src$core$events$events)&&(t=!!this.getSurroundLoop(),this.setWarningText(t?null:s.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout))try{s.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!t,Ne)}finally{s.setRecordUndo$$module$build$src$core$events$utils(!0)}}};s.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",Re),s.defineBlocks$$module$build$src$core$common(z);var Le={blocks:z,loopTypes:oe},Z=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["≠","NEQ"],["‏<","LT"],["‏≤","LTE"],["‏>","GT"],["‏≥","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),fe={EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"};s.register$$module$build$src$core$extensions("logic_op_tooltip",s.buildTooltipForDropdown$$module$build$src$core$extensions("OP",fe));var be={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const t=s.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&t.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&t.setAttribute("else","1"),t},domToMutation:function(t){this.elseifCount_=parseInt(t.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(t.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const t=Object.create(null);return this.elseifCount_&&(t.elseIfCount=this.elseifCount_),this.elseCount_&&(t.hasElse=!0),t},loadExtraState:function(t){this.elseifCount_=t.elseIfCount||0,this.elseCount_=t.hasElse?1:0,this.updateShape_()},decompose:function(t){const r=t.newBlock("controls_if_if");r.initSvg();let l=r.nextConnection;for(let u=1;u<=this.elseifCount_;u++){const T=t.newBlock("controls_if_elseif");T.initSvg(),l.connect(T.previousConnection),l=T.nextConnection}return this.elseCount_&&(t=t.newBlock("controls_if_else"),t.initSvg(),l.connect(t.previousConnection)),r},compose:function(t){t=t.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const r=[null],l=[null];let u=null;for(;t;){if(!t.isInsertionMarker())switch(t.type){case"controls_if_elseif":this.elseifCount_++,r.push(t.valueConnection_),l.push(t.statementConnection_);break;case"controls_if_else":this.elseCount_++,u=t.statementConnection_;break;default:throw TypeError("Unknown block type: "+t.type)}t=t.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(r,l,u)},saveConnections:function(t){t=t.nextConnection.targetBlock();let r=1;for(;t;){if(!t.isInsertionMarker())switch(t.type){case"controls_if_elseif":var l=this.getInput("IF"+r);const u=this.getInput("DO"+r);t.valueConnection_=l&&l.connection.targetConnection,t.statementConnection_=u&&u.connection.targetConnection,r++;break;case"controls_if_else":l=this.getInput("ELSE"),t.statementConnection_=l&&l.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+t.type)}t=t.getNextBlock()}},rebuildShape_:function(){const t=[null],r=[null];let l=null;this.getInput("ELSE")&&(l=this.getInput("ELSE").connection.targetConnection);for(let u=1;this.getInput("IF"+u);u++){const T=this.getInput("IF"+u),N=this.getInput("DO"+u);t.push(T.connection.targetConnection),r.push(N.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(t,r,l)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var t=1;this.getInput("IF"+t);t++)this.removeInput("IF"+t),this.removeInput("DO"+t);for(t=1;t<=this.elseifCount_;t++)this.appendValueInput("IF"+t).setCheck("Boolean").appendField(s.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+t).appendField(s.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(s.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(t,r,l){for(let u=1;u<=this.elseifCount_;u++){let T;(T=t[u])==null||T.reconnect(this,"IF"+u);let N;(N=r[u])==null||N.reconnect(this,"DO"+u)}l?.reconnect(this,"ELSE")}};s.registerMutator$$module$build$src$core$extensions("controls_if_mutator",be,null,["controls_if_elseif","controls_if_else"]);var Me=function(){this.setTooltip(function(){if(this.elseifCount_||this.elseCount_){if(!this.elseifCount_&&this.elseCount_)return s.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2;if(this.elseifCount_&&!this.elseCount_)return s.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3;if(this.elseifCount_&&this.elseCount_)return s.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4}else return s.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1;return""}.bind(this))};s.register$$module$build$src$core$extensions("controls_if_tooltip",Me);var Ce={onchange:function(t){this.prevBlocks_||(this.prevBlocks_=[null,null]);var r=this.getInputTargetBlock("A");const l=this.getInputTargetBlock("B");r&&l&&!this.workspace.connectionChecker.doTypeChecks(r.outputConnection,l.outputConnection)&&(s.setGroup$$module$build$src$core$events$utils(t.group),t=this.prevBlocks_[0],t!==r&&(r.unplug(),!t||t.isDisposed()||t.isShadow()||this.getInput("A").connection.connect(t.outputConnection)),r=this.prevBlocks_[1],r!==l&&(l.unplug(),!r||r.isDisposed()||r.isShadow()||this.getInput("B").connection.connect(r.outputConnection)),this.bumpNeighbours(),s.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}},re=function(){this.mixin(Ce)};s.register$$module$build$src$core$extensions("logic_compare",re);var ve={prevParentConnection_:null,onchange:function(t){const r=this.getInputTargetBlock("THEN"),l=this.getInputTargetBlock("ELSE"),u=this.outputConnection.targetConnection;if((r||l)&&u)for(let T=0;T<2;T++){const N=T===1?r:l;N&&!N.workspace.connectionChecker.doTypeChecks(N.outputConnection,u)&&(s.setGroup$$module$build$src$core$events$utils(t.group),u===this.prevParentConnection_?(this.unplug(),u.getSourceBlock().bumpNeighbours()):(N.unplug(),N.bumpNeighbours()),s.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=u}};s.registerMixin$$module$build$src$core$extensions("logic_ternary",ve),s.defineBlocks$$module$build$src$core$common(Z);var ye={blocks:Z},D=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),ne={init:function(){this.setHelpUrl(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new s.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("items",String(this.itemCount_)),t},domToMutation:function(t){if(t=t.getAttribute("items"),!t)throw new TypeError("element did not have items");this.itemCount_=parseInt(t,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(t){this.itemCount_=t.itemCount,this.updateShape_()},decompose:function(t){const r=t.newBlock("lists_create_with_container");r.initSvg();let l=r.getInput("STACK").connection;for(let u=0;u<this.itemCount_;u++){const T=t.newBlock("lists_create_with_item");if(T.initSvg(),!T.previousConnection)throw Error("itemBlock has no previousConnection");l.connect(T.previousConnection),l=T.nextConnection}return r},compose:function(t){var r=t.getInputTargetBlock("STACK");for(t=[];r;)r.isInsertionMarker()||t.push(r.valueConnection_),r=r.getNextBlock();for(r=0;r<this.itemCount_;r++){const l=this.getInput("ADD"+r).connection.targetConnection;l&&!t.includes(l)&&l.disconnect()}for(this.itemCount_=t.length,this.updateShape_(),r=0;r<this.itemCount_;r++){let l;(l=t[r])==null||l.reconnect(this,"ADD"+r)}},saveConnections:function(t){t=t.getInputTargetBlock("STACK");let r=0;for(;t;){if(t.isInsertionMarker()){t=t.getNextBlock();continue}const l=this.getInput("ADD"+r);let u;t.valueConnection_=(u=l)==null?void 0:u.connection.targetConnection,t=t.getNextBlock(),r++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(s.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var t=0;t<this.itemCount_;t++)if(!this.getInput("ADD"+t)){const r=this.appendValueInput("ADD"+t).setAlign(s.Align$$module$build$src$core$inputs$align.RIGHT);t===0&&r.appendField(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(t=this.itemCount_;this.getInput("ADD"+t);t++)this.removeInput("ADD"+t)}};D.lists_create_with=ne;var ie={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};D.lists_create_with_container=ie;var i={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(s.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};D.lists_create_with_item=i;var le={init:function(){var t=[[s.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[s.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(s.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(s.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),!t)throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(t,"END"),this.setInputsInline(!0),this.setTooltip(()=>s.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))}};D.lists_indexOf=le;var ue={init:function(){var t=[[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),t.setValidator(function(r){r=r==="REMOVE",this.getSourceBlock().updateStatement_(r)}),this.appendValueInput("VALUE").setCheck("Array").appendField(s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(t,"MODE").appendField("","SPACE"),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS}),t.setValidator(function(r){const l=this.getValue();r=r==="FROM_START"||r==="FROM_END",r!==(l==="FROM_START"||l==="FROM_END")&&this.getSourceBlock().updateAt_(r)}),this.appendDummyInput().appendField(t,"WHERE"),this.appendDummyInput("AT"),s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip(()=>{const r=this.getFieldValue("MODE"),l=this.getFieldValue("WHERE");let u="";switch(r+" "+l){case"GET FROM_START":case"GET FROM_END":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":u=s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return(l==="FROM_START"||l==="FROM_END")&&(u+="  "+(l==="FROM_START"?s.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:s.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),u})},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");t.setAttribute("statement",String(!this.outputConnection));const r=this.getInput("AT")instanceof s.ValueInput$$module$build$src$core$inputs$value_input;return t.setAttribute("at",String(r)),t},domToMutation:function(t){const r=t.getAttribute("statement")==="true";this.updateStatement_(r),t=t.getAttribute("at")!=="false",this.updateAt_(t)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(t){t.isStatement?this.updateStatement_(!0):typeof t=="string"&&this.domToMutation(s.textToDom$$module$build$src$core$utils$xml(t))},updateStatement_:function(t){t!==!this.outputConnection&&(this.unplug(!0,!0),t?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(t){this.removeInput("AT"),this.removeInput("ORDINAL",!0),t?(this.appendValueInput("AT").setCheck("Number"),s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"),s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};D.lists_getIndex=ue;var y={init:function(){var t=[[s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[s.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:t}),this.appendDummyInput().appendField(t,"MODE").appendField("","SPACE"),t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS}),t.setValidator(function(r){const l=this.getValue();r=r==="FROM_START"||r==="FROM_END",r!==(l==="FROM_START"||l==="FROM_END")&&this.getSourceBlock().updateAt_(r)}),this.appendDummyInput().appendField(t,"WHERE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip(()=>{const r=this.getFieldValue("MODE"),l=this.getFieldValue("WHERE");let u="";switch(r+" "+l){case"SET FROM_START":case"SET FROM_END":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":u=s.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return(l==="FROM_START"||l==="FROM_END")&&(u+="  "+s.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),u})},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation"),r=this.getInput("AT")instanceof s.ValueInput$$module$build$src$core$inputs$value_input;return t.setAttribute("at",String(r)),t},domToMutation:function(t){t=t.getAttribute("at")!=="false",this.updateAt_(t)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(t){this.removeInput("AT"),this.removeInput("ORDINAL",!0),t?(this.appendValueInput("AT").setCheck("Number"),s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO")}};D.lists_setIndex=y;var F={init:function(){this.WHERE_OPTIONS_1=[[s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST);const t=r=>{const l=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+r]});return l.setValidator(function(u){const T=this.getValue();u=u==="FROM_START"||u==="FROM_END",u!==(T==="FROM_START"||T==="FROM_END")&&this.getSourceBlock().updateAt_(r,u)}),l};this.appendDummyInput("WHERE1_INPUT").appendField(t(1),"WHERE1"),this.appendDummyInput("AT1"),this.appendDummyInput("WHERE2_INPUT").appendField(t(2),"WHERE2"),this.appendDummyInput("AT2"),s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");var r=this.getInput("AT1")instanceof s.ValueInput$$module$build$src$core$inputs$value_input;return t.setAttribute("at1",String(r)),r=this.getInput("AT2")instanceof s.ValueInput$$module$build$src$core$inputs$value_input,t.setAttribute("at2",String(r)),t},domToMutation:function(t){const r=t.getAttribute("at1")==="true";t=t.getAttribute("at2")==="true",this.updateAt_(1,r),this.updateAt_(2,t)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(t,r){this.removeInput("AT"+t),this.removeInput("ORDINAL"+t,!0),r?(this.appendValueInput("AT"+t).setCheck("Number"),s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+t).appendField(s.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+t),t===1&&(this.moveInputBefore("AT1","WHERE2_INPUT"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","WHERE2_INPUT")),s.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};D.lists_getSublist=F,D.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},D.lists_split={init:function(){const t=s.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[s.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[s.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!t)throw Error("field_dropdown not found");t.setValidator(r=>{this.updateType_(r)}),this.setHelpUrl(s.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(t,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(s.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip(()=>{const r=this.getFieldValue("MODE");if(r==="SPLIT")return s.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if(r==="JOIN")return s.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+r)})},updateType_:function(t){if(this.getFieldValue("MODE")!==t){const r=this.getInput("INPUT").connection;r.setShadowDom(null);const l=r.targetBlock();l&&(r.disconnect(),l.isShadow()?l.dispose(!1):this.bumpNeighbours())}t==="SPLIT"?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const t=s.createElement$$module$build$src$core$utils$xml("mutation");return t.setAttribute("mode",this.getFieldValue("MODE")),t},domToMutation:function(t){this.updateType_(t.getAttribute("mode"))},saveExtraState:function(){return{mode:this.getFieldValue("MODE")}},loadExtraState:function(t){this.updateType_(t.mode)}},s.defineBlocks$$module$build$src$core$common(D);var V={blocks:D},C=Object.assign({},D,Z,z,Q,S,A,M,m),w={blocks:C,lists:V,logic:ye,loops:Le,math:he,procedures:me,texts:B,variables:x,variablesDynamic:L};return w.__namespace__=s,w})})(blocks_compressed);var blocks_compressedExports=blocks_compressed.exports;const libraryBlocks=getDefaultExportFromCjs(blocks_compressedExports),{blocks,lists,logic,loops,math,procedures,texts,variables,variablesDynamic}=libraryBlocks;var javascript_compressed={exports:{}};(function(a,d){(function(_,s){a.exports=s(blockly_compressedExports)})(commonjsGlobal,function(_){var s=_.__namespace__,m=function(e,o){return["[]",i.ATOMIC]},g=function(e,o){const n=Array(e.itemCount_);for(let c=0;c<e.itemCount_;c++)n[c]=o.valueToCode(e,"ADD"+c,i.NONE)||"null";return["["+n.join(", ")+"]",i.ATOMIC]},I=function(e,o){const n=o.provideFunction_("listsRepeat",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(value, n) {
  var array = [];
  for (var i = 0; i < n; i++) {
    array[i] = value;
  }
  return array;
}
`),c=o.valueToCode(e,"ITEM",i.NONE)||"null";return e=o.valueToCode(e,"NUM",i.NONE)||"0",[n+"("+c+", "+e+")",i.FUNCTION_CALL]},h=function(e,o){return[(o.valueToCode(e,"VALUE",i.MEMBER)||"[]")+".length",i.MEMBER]},L=function(e,o){return["!"+(o.valueToCode(e,"VALUE",i.MEMBER)||"[]")+".length",i.LOGICAL_NOT]},M=function(e,o){const n=e.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",c=o.valueToCode(e,"FIND",i.NONE)||"''";return o=(o.valueToCode(e,"VALUE",i.MEMBER)||"[]")+"."+n+"("+c+")",e.workspace.options.oneBasedIndex?[o+" + 1",i.ADDITION]:[o,i.FUNCTION_CALL]},b=function(e,o){const n=e.getFieldValue("MODE")||"GET",c=e.getFieldValue("WHERE")||"FROM_START";var $=o.valueToCode(e,"VALUE",c==="RANDOM"?i.NONE:i.MEMBER)||"[]";switch(c){case"FIRST":if(n==="GET")return[$+"[0]",i.MEMBER];if(n==="GET_REMOVE")return[$+".shift()",i.MEMBER];if(n==="REMOVE")return $+`.shift();
`;break;case"LAST":if(n==="GET")return[$+".slice(-1)[0]",i.MEMBER];if(n==="GET_REMOVE")return[$+".pop()",i.MEMBER];if(n==="REMOVE")return $+`.pop();
`;break;case"FROM_START":if(e=o.getAdjusted(e,"AT"),n==="GET")return[$+"["+e+"]",i.MEMBER];if(n==="GET_REMOVE")return[$+".splice("+e+", 1)[0]",i.FUNCTION_CALL];if(n==="REMOVE")return $+".splice("+e+`, 1);
`;break;case"FROM_END":if(e=o.getAdjusted(e,"AT",1,!0),n==="GET")return[$+".slice("+e+")[0]",i.FUNCTION_CALL];if(n==="GET_REMOVE")return[$+".splice("+e+", 1)[0]",i.FUNCTION_CALL];if(n==="REMOVE")return $+".splice("+e+", 1);";break;case"RANDOM":if($=o.provideFunction_("listsGetRandomItem",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {
  var x = Math.floor(Math.random() * list.length);
  if (remove) {
    return list.splice(x, 1)[0];
  } else {
    return list[x];
  }
}
`)+"("+$+", "+(n!=="GET")+")",n==="GET"||n==="GET_REMOVE")return[$,i.FUNCTION_CALL];if(n==="REMOVE")return $+`;
`}throw Error("Unhandled combination (lists_getIndex).")},O=function(e,o){function n(){if(c.match(/^\w+$/))return"";const P=o.nameDB_.getDistinctName("tmpList",s.NameType$$module$build$src$core$names.VARIABLE),ce="var "+P+" = "+c+`;
`;return c=P,ce}let c=o.valueToCode(e,"LIST",i.MEMBER)||"[]";const $=e.getFieldValue("MODE")||"GET";var p=e.getFieldValue("WHERE")||"FROM_START";const E=o.valueToCode(e,"TO",i.ASSIGNMENT)||"null";switch(p){case"FIRST":if($==="SET")return c+"[0] = "+E+`;
`;if($==="INSERT")return c+".unshift("+E+`);
`;break;case"LAST":if($==="SET")return n()+(c+"["+c+".length - 1] = "+E+`;
`);if($==="INSERT")return c+".push("+E+`);
`;break;case"FROM_START":if(e=o.getAdjusted(e,"AT"),$==="SET")return c+"["+e+"] = "+E+`;
`;if($==="INSERT")return c+".splice("+e+", 0, "+E+`);
`;break;case"FROM_END":if(e=o.getAdjusted(e,"AT",1,!1,i.SUBTRACTION),p=n(),$==="SET")return p+(c+"["+c+".length - "+e+"] = "+E+`;
`);if($==="INSERT")return p+(c+".splice("+c+".length - "+e+", 0, "+E+`);
`);break;case"RANDOM":if(e=n(),p=o.nameDB_.getDistinctName("tmpX",s.NameType$$module$build$src$core$names.VARIABLE),e+="var "+p+" = Math.floor(Math.random() * "+c+`.length);
`,$==="SET")return e+(c+"["+p+"] = "+E+`;
`);if($==="INSERT")return e+(c+".splice("+p+", 0, "+E+`);
`)}throw Error("Unhandled combination (lists_setIndex).")},v=function(e,o){var n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},c=o.valueToCode(e,"LIST",i.MEMBER)||"[]";const $=e.getFieldValue("WHERE1"),p=e.getFieldValue("WHERE2");if($==="FIRST"&&p==="LAST")c+=".slice(0)";else if(c.match(/^\w+$/)||$!=="FROM_END"&&p==="FROM_START"){switch($){case"FROM_START":n=o.getAdjusted(e,"AT1");break;case"FROM_END":n=o.getAdjusted(e,"AT1",1,!1,i.SUBTRACTION),n=c+".length - "+n;break;case"FIRST":n="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(p){case"FROM_START":o=o.getAdjusted(e,"AT2",1);break;case"FROM_END":o=o.getAdjusted(e,"AT2",0,!1,i.SUBTRACTION),o=c+".length - "+o;break;case"LAST":o=c+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}c=c+".slice("+n+", "+o+")"}else{const E=o.getAdjusted(e,"AT1");e=o.getAdjusted(e,"AT2"),c=o.provideFunction_("subsequence"+n[$]+n[p],`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(sequence${$==="FROM_END"||$==="FROM_START"?", at1":""}${p==="FROM_END"||p==="FROM_START"?", at2":""}) {
  var start = ${ue("sequence",$,"at1")};
  var end = ${ue("sequence",p,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+c+($==="FROM_END"||$==="FROM_START"?", "+E:"")+(p==="FROM_END"||p==="FROM_START"?", "+e:"")+")"}return[c,i.FUNCTION_CALL]},x=function(e,o){const n=o.valueToCode(e,"LIST",i.FUNCTION_CALL)||"[]",c=e.getFieldValue("DIRECTION")==="1"?1:-1;return e=e.getFieldValue("TYPE"),o=o.provideFunction_("listsGetSortCompare",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {
  var compareFuncs = {
    'NUMERIC': function(a, b) {
        return Number(a) - Number(b); },
    'TEXT': function(a, b) {
        return String(a) > String(b) ? 1 : -1; },
    'IGNORE_CASE': function(a, b) {
        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },
  };
  var compare = compareFuncs[type];
  return function(a, b) { return compare(a, b) * direction; };
}
      `),[n+".slice().sort("+o+'("'+e+'", '+c+"))",i.FUNCTION_CALL]},A=function(e,o){let n=o.valueToCode(e,"INPUT",i.MEMBER);if(o=o.valueToCode(e,"DELIM",i.NONE)||"''",e=e.getFieldValue("MODE"),e==="SPLIT")n||(n="''"),e="split";else if(e==="JOIN")n||(n="[]"),e="join";else throw Error("Unknown mode: "+e);return[n+"."+e+"("+o+")",i.FUNCTION_CALL]},R=function(e,o){return[(o.valueToCode(e,"LIST",i.FUNCTION_CALL)||"[]")+".slice().reverse()",i.FUNCTION_CALL]},f=function(e,o){var n=0;let c="";o.STATEMENT_PREFIX&&(c+=o.injectId(o.STATEMENT_PREFIX,e));do{const $=o.valueToCode(e,"IF"+n,i.NONE)||"false";let p=o.statementToCode(e,"DO"+n);o.STATEMENT_SUFFIX&&(p=o.prefixLines(o.injectId(o.STATEMENT_SUFFIX,e),o.INDENT)+p),c+=(n>0?" else ":"")+"if ("+$+`) {
`+p+"}",n++}while(e.getInput("IF"+n));return(e.getInput("ELSE")||o.STATEMENT_SUFFIX)&&(n=e.getInput("ELSE")?o.statementToCode(e,"ELSE"):"",o.STATEMENT_SUFFIX&&(n=o.prefixLines(o.injectId(o.STATEMENT_SUFFIX,e),o.INDENT)+n),c+=` else {
`+n+"}"),c+`
`},k=function(e,o){const n={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],c=n==="=="||n==="!="?i.EQUALITY:i.RELATIONAL,$=o.valueToCode(e,"A",c)||"0";return e=o.valueToCode(e,"B",c)||"0",[$+" "+n+" "+e,c]},G=function(e,o){const n=e.getFieldValue("OP")==="AND"?"&&":"||",c=n==="&&"?i.LOGICAL_AND:i.LOGICAL_OR;let $=o.valueToCode(e,"A",c);return e=o.valueToCode(e,"B",c),$||e?(o=n==="&&"?"true":"false",$||($=o),e||(e=o)):e=$="false",[$+" "+n+" "+e,c]},W=function(e,o){const n=i.LOGICAL_NOT;return["!"+(o.valueToCode(e,"BOOL",n)||"true"),n]},q=function(e,o){return[e.getFieldValue("BOOL")==="TRUE"?"true":"false",i.ATOMIC]},K=function(e,o){return["null",i.ATOMIC]},X=function(e,o){const n=o.valueToCode(e,"IF",i.CONDITIONAL)||"false",c=o.valueToCode(e,"THEN",i.CONDITIONAL)||"null";return e=o.valueToCode(e,"ELSE",i.CONDITIONAL)||"null",[n+" ? "+c+" : "+e,i.CONDITIONAL]},H=function(e,o){let n;n=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):o.valueToCode(e,"TIMES",i.ASSIGNMENT)||"0";let c=o.statementToCode(e,"DO");c=o.addLoopTrap(c,e),e="";const $=o.nameDB_.getDistinctName("count",s.NameType$$module$build$src$core$names.VARIABLE);let p=n;return n.match(/^\w+$/)||s.isNumber$$module$build$src$core$utils$string(n)||(p=o.nameDB_.getDistinctName("repeat_end",s.NameType$$module$build$src$core$names.VARIABLE),e+="var "+p+" = "+n+`;
`),e+("for (var "+$+" = 0; "+$+" < "+p+"; "+$+`++) {
`+c+`}
`)},B=function(e,o){const n=e.getFieldValue("MODE")==="UNTIL";let c=o.valueToCode(e,"BOOL",n?i.LOGICAL_NOT:i.NONE)||"false",$=o.statementToCode(e,"DO");return $=o.addLoopTrap($,e),n&&(c="!"+c),"while ("+c+`) {
`+$+`}
`},S=function(e,o){var n=o.getVariableName(e.getFieldValue("VAR")),c=o.valueToCode(e,"FROM",i.ASSIGNMENT)||"0",$=o.valueToCode(e,"TO",i.ASSIGNMENT)||"0";const p=o.valueToCode(e,"BY",i.ASSIGNMENT)||"1";let E=o.statementToCode(e,"DO");if(E=o.addLoopTrap(E,e),s.isNumber$$module$build$src$core$utils$string(c)&&s.isNumber$$module$build$src$core$utils$string($)&&s.isNumber$$module$build$src$core$utils$string(p))o=Number(c)<=Number($),e="for ("+n+" = "+c+"; "+n+(o?" <= ":" >= ")+$+"; "+n,n=Math.abs(Number(p)),e=n===1?e+(o?"++":"--"):e+((o?" += ":" -= ")+n),e+=`) {
`+E+`}
`;else{e="";let P=c;c.match(/^\w+$/)||s.isNumber$$module$build$src$core$utils$string(c)||(P=o.nameDB_.getDistinctName(n+"_start",s.NameType$$module$build$src$core$names.VARIABLE),e+="var "+P+" = "+c+`;
`),c=$,$.match(/^\w+$/)||s.isNumber$$module$build$src$core$utils$string($)||(c=o.nameDB_.getDistinctName(n+"_end",s.NameType$$module$build$src$core$names.VARIABLE),e+="var "+c+" = "+$+`;
`),$=o.nameDB_.getDistinctName(n+"_inc",s.NameType$$module$build$src$core$names.VARIABLE),e+="var "+$+" = ",e=s.isNumber$$module$build$src$core$utils$string(p)?e+(Math.abs(Number(p))+`;
`):e+("Math.abs("+p+`);
`),e+="if ("+P+" > "+c+`) {
`,e+=o.INDENT+$+" = -"+$+`;
`,e=e+`}
for (`+(n+" = "+P+"; "+$+" >= 0 ? "+n+" <= "+c+" : "+n+" >= "+c+"; "+n+" += "+$+`) {
`+E+`}
`)}return e},U=function(e,o){const n=o.getVariableName(e.getFieldValue("VAR"));var c=o.valueToCode(e,"LIST",i.ASSIGNMENT)||"[]";let $=o.statementToCode(e,"DO");$=o.addLoopTrap($,e),e="";let p=c;return c.match(/^\w+$/)||(p=o.nameDB_.getDistinctName(n+"_list",s.NameType$$module$build$src$core$names.VARIABLE),e+="var "+p+" = "+c+`;
`),c=o.nameDB_.getDistinctName(n+"_index",s.NameType$$module$build$src$core$names.VARIABLE),$=o.INDENT+n+" = "+p+"["+c+`];
`+$,e+("for (var "+c+" in "+p+`) {
`+$+`}
`)},J=function(e,o){let n="";if(o.STATEMENT_PREFIX&&(n+=o.injectId(o.STATEMENT_PREFIX,e)),o.STATEMENT_SUFFIX&&(n+=o.injectId(o.STATEMENT_SUFFIX,e)),o.STATEMENT_PREFIX){const c=e.getSurroundLoop();c&&!c.suppressPrefixSuffix&&(n+=o.injectId(o.STATEMENT_PREFIX,c))}switch(e.getFieldValue("FLOW")){case"BREAK":return n+`break;
`;case"CONTINUE":return n+`continue;
`}throw Error("Unknown flow statement.")},$e=function(e,o){return e=Number(e.getFieldValue("NUM")),[String(e),e>=0?i.ATOMIC:i.UNARY_NEGATION]},_e=function(e,o){var n={ADD:[" + ",i.ADDITION],MINUS:[" - ",i.SUBTRACTION],MULTIPLY:[" * ",i.MULTIPLICATION],DIVIDE:[" / ",i.DIVISION],POWER:[null,i.NONE]}[e.getFieldValue("OP")];const c=n[0];n=n[1];const $=o.valueToCode(e,"A",n)||"0";return e=o.valueToCode(e,"B",n)||"0",c?[$+c+e,n]:["Math.pow("+$+", "+e+")",i.FUNCTION_CALL]},j=function(e,o){const n=e.getFieldValue("OP");let c;if(n==="NEG")return e=o.valueToCode(e,"NUM",i.UNARY_NEGATION)||"0",e[0]==="-"&&(e=" "+e),["-"+e,i.UNARY_NEGATION];switch(e=n==="SIN"||n==="COS"||n==="TAN"?o.valueToCode(e,"NUM",i.DIVISION)||"0":o.valueToCode(e,"NUM",i.NONE)||"0",n){case"ABS":c="Math.abs("+e+")";break;case"ROOT":c="Math.sqrt("+e+")";break;case"LN":c="Math.log("+e+")";break;case"EXP":c="Math.exp("+e+")";break;case"POW10":c="Math.pow(10,"+e+")";break;case"ROUND":c="Math.round("+e+")";break;case"ROUNDUP":c="Math.ceil("+e+")";break;case"ROUNDDOWN":c="Math.floor("+e+")";break;case"SIN":c="Math.sin("+e+" / 180 * Math.PI)";break;case"COS":c="Math.cos("+e+" / 180 * Math.PI)";break;case"TAN":c="Math.tan("+e+" / 180 * Math.PI)"}if(c)return[c,i.FUNCTION_CALL];switch(n){case"LOG10":c="Math.log("+e+") / Math.log(10)";break;case"ASIN":c="Math.asin("+e+") / Math.PI * 180";break;case"ACOS":c="Math.acos("+e+") / Math.PI * 180";break;case"ATAN":c="Math.atan("+e+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+n)}return[c,i.DIVISION]},te=function(e,o){return{PI:["Math.PI",i.MEMBER],E:["Math.E",i.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",i.DIVISION],SQRT2:["Math.SQRT2",i.MEMBER],SQRT1_2:["Math.SQRT1_2",i.MEMBER],INFINITY:["Infinity",i.ATOMIC]}[e.getFieldValue("CONSTANT")]},de=function(e,o){var n={EVEN:[" % 2 === 0",i.MODULUS,i.EQUALITY],ODD:[" % 2 === 1",i.MODULUS,i.EQUALITY],WHOLE:[" % 1 === 0",i.MODULUS,i.EQUALITY],POSITIVE:[" > 0",i.RELATIONAL,i.RELATIONAL],NEGATIVE:[" < 0",i.RELATIONAL,i.RELATIONAL],DIVISIBLE_BY:[null,i.MODULUS,i.EQUALITY],PRIME:[null,i.NONE,i.FUNCTION_CALL]};const c=e.getFieldValue("PROPERTY"),[$,p,E]=n[c];return n=o.valueToCode(e,"NUMBER_TO_CHECK",p)||"0",c==="PRIME"?e=o.provideFunction_("mathIsPrime",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(n) {
  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods
  if (n == 2 || n == 3) {
    return true;
  }
  // False if n is NaN, negative, is 1, or not whole.
  // And false if n is divisible by 2 or 3.
  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {
    return false;
  }
  // Check all the numbers of form 6k +/- 1, up to sqrt(n).
  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {
    if (n % (x - 1) === 0 || n % (x + 1) === 0) {
      return false;
    }
  }
  return true;
}
`)+"("+n+")":c==="DIVISIBLE_BY"?(e=o.valueToCode(e,"DIVISOR",i.MODULUS)||"0",e=n+" % "+e+" === 0"):e=n+$,[e,E]},Te=function(e,o){const n=o.valueToCode(e,"DELTA",i.ADDITION)||"0";return e=o.getVariableName(e.getFieldValue("VAR")),e+" = (typeof "+e+" === 'number' ? "+e+" : 0) + "+n+`;
`},me=function(e,o){var n=e.getFieldValue("OP");switch(n){case"SUM":e=o.valueToCode(e,"LIST",i.MEMBER)||"[]",e+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":e=o.valueToCode(e,"LIST",i.NONE)||"[]",e="Math.min.apply(null, "+e+")";break;case"MAX":e=o.valueToCode(e,"LIST",i.NONE)||"[]",e="Math.max.apply(null, "+e+")";break;case"AVERAGE":n=o.provideFunction_("mathMean",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;
}
`),e=o.valueToCode(e,"LIST",i.NONE)||"[]",e=n+"("+e+")";break;case"MEDIAN":n=o.provideFunction_("mathMedian",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  var localList = myList.filter(function (x) {return typeof x === 'number';});
  if (!localList.length) return null;
  localList.sort(function(a, b) {return b - a;});
  if (localList.length % 2 === 0) {
    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;
  } else {
    return localList[(localList.length - 1) / 2];
  }
}
`),e=o.valueToCode(e,"LIST",i.NONE)||"[]",e=n+"("+e+")";break;case"MODE":n=o.provideFunction_("mathModes",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(values) {
  var modes = [];
  var counts = [];
  var maxCount = 0;
  for (var i = 0; i < values.length; i++) {
    var value = values[i];
    var found = false;
    var thisCount;
    for (var j = 0; j < counts.length; j++) {
      if (counts[j][0] === value) {
        thisCount = ++counts[j][1];
        found = true;
        break;
      }
    }
    if (!found) {
      counts.push([value, 1]);
      thisCount = 1;
    }
    maxCount = Math.max(thisCount, maxCount);
  }
  for (var j = 0; j < counts.length; j++) {
    if (counts[j][1] === maxCount) {
      modes.push(counts[j][0]);
    }
  }
  return modes;
}
`),e=o.valueToCode(e,"LIST",i.NONE)||"[]",e=n+"("+e+")";break;case"STD_DEV":n=o.provideFunction_("mathStandardDeviation",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(numbers) {
  var n = numbers.length;
  if (!n) return null;
  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;
  var variance = 0;
  for (var j = 0; j < n; j++) {
    variance += Math.pow(numbers[j] - mean, 2);
  }
  variance /= n;
  return Math.sqrt(variance);
}
`),e=o.valueToCode(e,"LIST",i.NONE)||"[]",e=n+"("+e+")";break;case"RANDOM":n=o.provideFunction_("mathRandomList",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(list) {
  var x = Math.floor(Math.random() * list.length);
  return list[x];
}
`),e=o.valueToCode(e,"LIST",i.NONE)||"[]",e=n+"("+e+")";break;default:throw Error("Unknown operator: "+n)}return[e,i.FUNCTION_CALL]},Q=function(e,o){const n=o.valueToCode(e,"DIVIDEND",i.MODULUS)||"0";return e=o.valueToCode(e,"DIVISOR",i.MODULUS)||"0",[n+" % "+e,i.MODULUS]},pe=function(e,o){const n=o.valueToCode(e,"VALUE",i.NONE)||"0",c=o.valueToCode(e,"LOW",i.NONE)||"0";return e=o.valueToCode(e,"HIGH",i.NONE)||"Infinity",["Math.min(Math.max("+n+", "+c+"), "+e+")",i.FUNCTION_CALL]},Ee=function(e,o){const n=o.valueToCode(e,"FROM",i.NONE)||"0";return e=o.valueToCode(e,"TO",i.NONE)||"0",[o.provideFunction_("mathRandomInt",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(a, b) {
  if (a > b) {
    // Swap a and b to ensure a is smaller.
    var c = a;
    a = b;
    b = c;
  }
  return Math.floor(Math.random() * (b - a + 1) + a);
}
`)+"("+n+", "+e+")",i.FUNCTION_CALL]},ge=function(e,o){return["Math.random()",i.FUNCTION_CALL]},Ie=function(e,o){const n=o.valueToCode(e,"X",i.NONE)||"0";return["Math.atan2("+(o.valueToCode(e,"Y",i.NONE)||"0")+", "+n+") / Math.PI * 180",i.DIVISION]},se=function(e,o){const n=o.getProcedureName(e.getFieldValue("NAME"));var c="";o.STATEMENT_PREFIX&&(c+=o.injectId(o.STATEMENT_PREFIX,e)),o.STATEMENT_SUFFIX&&(c+=o.injectId(o.STATEMENT_SUFFIX,e)),c&&(c=o.prefixLines(c,o.INDENT));let $="";o.INFINITE_LOOP_TRAP&&($=o.prefixLines(o.injectId(o.INFINITE_LOOP_TRAP,e),o.INDENT));let p="";e.getInput("STACK")&&(p=o.statementToCode(e,"STACK"));let E="";e.getInput("RETURN")&&(E=o.valueToCode(e,"RETURN",i.NONE)||"");let P="";p&&E&&(P=c),E&&(E=o.INDENT+"return "+E+`;
`);const ce=[],ke=e.getVars();for(let ae=0;ae<ke.length;ae++)ce[ae]=o.getVariableName(ke[ae]);return c="function "+n+"("+ce.join(", ")+`) {
`+c+$+p+P+E+"}",c=o.scrub_(e,c),o.definitions_["%"+n]=c,null},he=function(e,o){const n=o.getProcedureName(e.getFieldValue("NAME")),c=[],$=e.getVars();for(let p=0;p<$.length;p++)c[p]=o.valueToCode(e,"ARG"+p,i.NONE)||"null";return[n+"("+c.join(", ")+")",i.FUNCTION_CALL]},z=function(e,o){return o.forBlock.procedures_callreturn(e,o)[0]+`;
`},Oe=function(e,o){let n="if ("+(o.valueToCode(e,"CONDITION",i.NONE)||"false")+`) {
`;return o.STATEMENT_SUFFIX&&(n+=o.prefixLines(o.injectId(o.STATEMENT_SUFFIX,e),o.INDENT)),e.hasReturnValue_?(e=o.valueToCode(e,"VALUE",i.NONE)||"null",n+=o.INDENT+"return "+e+`;
`):n+=o.INDENT+`return;
`,n+`}
`},Ae=function(e,o){return[o.quote_(e.getFieldValue("TEXT")),i.ATOMIC]},Se=function(e,o){switch(e.itemCount_){case 0:return["''",i.ATOMIC];case 1:return e=o.valueToCode(e,"ADD0",i.NONE)||"''",r(e);case 2:var n=o.valueToCode(e,"ADD0",i.NONE)||"''";return e=o.valueToCode(e,"ADD1",i.NONE)||"''",[r(n)[0]+" + "+r(e)[0],i.ADDITION];default:n=Array(e.itemCount_);for(let c=0;c<e.itemCount_;c++)n[c]=o.valueToCode(e,"ADD"+c,i.NONE)||"''";return["["+n.join(",")+"].join('')",i.FUNCTION_CALL]}},oe=function(e,o){const n=o.getVariableName(e.getFieldValue("VAR"));return e=o.valueToCode(e,"TEXT",i.NONE)||"''",n+" += "+r(e)[0]+`;
`},Ne=function(e,o){return[(o.valueToCode(e,"VALUE",i.MEMBER)||"''")+".length",i.MEMBER]},Re=function(e,o){return["!"+(o.valueToCode(e,"VALUE",i.MEMBER)||"''")+".length",i.LOGICAL_NOT]},Le=function(e,o){const n=e.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",c=o.valueToCode(e,"FIND",i.NONE)||"''";return o=(o.valueToCode(e,"VALUE",i.MEMBER)||"''")+"."+n+"("+c+")",e.workspace.options.oneBasedIndex?[o+" + 1",i.ADDITION]:[o,i.FUNCTION_CALL]},Z=function(e,o){const n=e.getFieldValue("WHERE")||"FROM_START",c=o.valueToCode(e,"VALUE",n==="RANDOM"?i.NONE:i.MEMBER)||"''";switch(n){case"FIRST":return[c+".charAt(0)",i.FUNCTION_CALL];case"LAST":return[c+".slice(-1)",i.FUNCTION_CALL];case"FROM_START":return e=o.getAdjusted(e,"AT"),[c+".charAt("+e+")",i.FUNCTION_CALL];case"FROM_END":return e=o.getAdjusted(e,"AT",1,!0),[c+".slice("+e+").charAt(0)",i.FUNCTION_CALL];case"RANDOM":return[o.provideFunction_("textRandomLetter",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(text) {
  var x = Math.floor(Math.random() * text.length);
  return text[x];
}
`)+"("+c+")",i.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},fe=function(e,o){var n={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const c=e.getFieldValue("WHERE1"),$=e.getFieldValue("WHERE2");var p=c!=="FROM_END"&&c!=="LAST"&&$!=="FROM_END"&&$!=="LAST",E=o.valueToCode(e,"STRING",p?i.MEMBER:i.NONE)||"''";if(c==="FIRST"&&$==="LAST")return[E,i.NONE];if(E.match(/^'?\w+'?$/)||p){switch(c){case"FROM_START":n=o.getAdjusted(e,"AT1");break;case"FROM_END":n=o.getAdjusted(e,"AT1",1,!1,i.SUBTRACTION),n=E+".length - "+n;break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch($){case"FROM_START":o=o.getAdjusted(e,"AT2",1);break;case"FROM_END":o=o.getAdjusted(e,"AT2",0,!1,i.SUBTRACTION),o=E+".length - "+o;break;case"LAST":o=E+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}E=E+".slice("+n+", "+o+")"}else p=o.getAdjusted(e,"AT1"),e=o.getAdjusted(e,"AT2"),E=o.provideFunction_("subsequence"+n[c]+n[$],`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(sequence${c==="FROM_END"||c==="FROM_START"?", at1":""}${$==="FROM_END"||$==="FROM_START"?", at2":""}) {
  var start = ${l("sequence",c,"at1")};
  var end = ${l("sequence",$,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+E+(c==="FROM_END"||c==="FROM_START"?", "+p:"")+($==="FROM_END"||$==="FROM_START"?", "+e:"")+")";return[E,i.FUNCTION_CALL]},be=function(e,o){const n={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=o.valueToCode(e,"TEXT",n?i.MEMBER:i.NONE)||"''",[n?e+n:o.provideFunction_("textToTitleCase",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(str) {
  return str.replace(/\\S+/g,
      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});
}
`)+"("+e+")",i.FUNCTION_CALL]},Me=function(e,o){const n={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(o.valueToCode(e,"TEXT",i.MEMBER)||"''")+n,i.FUNCTION_CALL]},Ce=function(e,o){return"window.alert("+(o.valueToCode(e,"TEXT",i.NONE)||"''")+`);
`},re=function(e,o){return o="window.prompt("+(e.getField("TEXT")?o.quote_(e.getFieldValue("TEXT")):o.valueToCode(e,"TEXT",i.NONE)||"''")+")",e.getFieldValue("TYPE")==="NUMBER"&&(o="Number("+o+")"),[o,i.FUNCTION_CALL]},ve=function(e,o){const n=o.valueToCode(e,"TEXT",i.NONE)||"''";return e=o.valueToCode(e,"SUB",i.NONE)||"''",[o.provideFunction_("textCount",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {
  if (needle.length === 0) {
    return haystack.length + 1;
  } else {
    return haystack.split(needle).length - 1;
  }
}
`)+"("+n+", "+e+")",i.FUNCTION_CALL]},ye=function(e,o){const n=o.valueToCode(e,"TEXT",i.NONE)||"''",c=o.valueToCode(e,"FROM",i.NONE)||"''";return e=o.valueToCode(e,"TO",i.NONE)||"''",[o.provideFunction_("textReplace",`
function ${o.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {
  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')
                 .replace(/\\x08/g, '\\\\x08');
  return haystack.replace(new RegExp(needle, 'g'), replacement);
}
`)+"("+n+", "+c+", "+e+")",i.FUNCTION_CALL]},D=function(e,o){return[(o.valueToCode(e,"TEXT",i.MEMBER)||"''")+".split('').reverse().join('')",i.FUNCTION_CALL]},ne=function(e,o){return[o.getVariableName(e.getFieldValue("VAR")),i.ATOMIC]},ie=function(e,o){const n=o.valueToCode(e,"VALUE",i.ASSIGNMENT)||"0";return o.getVariableName(e.getFieldValue("VAR"))+" = "+n+`;
`},i;(function(e){e[e.ATOMIC=0]="ATOMIC",e[e.NEW=1.1]="NEW",e[e.MEMBER=1.2]="MEMBER",e[e.FUNCTION_CALL=2]="FUNCTION_CALL",e[e.INCREMENT=3]="INCREMENT",e[e.DECREMENT=3]="DECREMENT",e[e.BITWISE_NOT=4.1]="BITWISE_NOT",e[e.UNARY_PLUS=4.2]="UNARY_PLUS",e[e.UNARY_NEGATION=4.3]="UNARY_NEGATION",e[e.LOGICAL_NOT=4.4]="LOGICAL_NOT",e[e.TYPEOF=4.5]="TYPEOF",e[e.VOID=4.6]="VOID",e[e.DELETE=4.7]="DELETE",e[e.AWAIT=4.8]="AWAIT",e[e.EXPONENTIATION=5]="EXPONENTIATION",e[e.MULTIPLICATION=5.1]="MULTIPLICATION",e[e.DIVISION=5.2]="DIVISION",e[e.MODULUS=5.3]="MODULUS",e[e.SUBTRACTION=6.1]="SUBTRACTION",e[e.ADDITION=6.2]="ADDITION",e[e.BITWISE_SHIFT=7]="BITWISE_SHIFT",e[e.RELATIONAL=8]="RELATIONAL",e[e.IN=8]="IN",e[e.INSTANCEOF=8]="INSTANCEOF",e[e.EQUALITY=9]="EQUALITY",e[e.BITWISE_AND=10]="BITWISE_AND",e[e.BITWISE_XOR=11]="BITWISE_XOR",e[e.BITWISE_OR=12]="BITWISE_OR",e[e.LOGICAL_AND=13]="LOGICAL_AND",e[e.LOGICAL_OR=14]="LOGICAL_OR",e[e.CONDITIONAL=15]="CONDITIONAL",e[e.ASSIGNMENT=16]="ASSIGNMENT",e[e.YIELD=17]="YIELD",e[e.COMMA=18]="COMMA",e[e.NONE=99]="NONE"})(i||(i={}));var le=class extends s.CodeGenerator$$module$build$src$core$generator{constructor(e="JavaScript"){super(e),this.ORDER_OVERRIDES=[[i.FUNCTION_CALL,i.MEMBER],[i.FUNCTION_CALL,i.FUNCTION_CALL],[i.MEMBER,i.MEMBER],[i.MEMBER,i.FUNCTION_CALL],[i.LOGICAL_NOT,i.LOGICAL_NOT],[i.MULTIPLICATION,i.MULTIPLICATION],[i.ADDITION,i.ADDITION],[i.LOGICAL_AND,i.LOGICAL_AND],[i.LOGICAL_OR,i.LOGICAL_OR]],this.isInitialized=!1;for(const o in i)e=i[o],typeof e!="string"&&(this["ORDER_"+o]=e);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(e){super.init(e),this.nameDB_?this.nameDB_.reset():this.nameDB_=new s.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(e.getVariableMap()),this.nameDB_.populateVariables(e),this.nameDB_.populateProcedures(e);const o=[];var n=s.allDeveloperVariables$$module$build$src$core$variables(e);for(let c=0;c<n.length;c++)o.push(this.nameDB_.getName(n[c],s.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(e=s.allUsedVarModels$$module$build$src$core$variables(e),n=0;n<e.length;n++)o.push(this.nameDB_.getName(e[n].getId(),s.NameType$$module$build$src$core$names.VARIABLE));o.length&&(this.definitions_.variables="var "+o.join(", ")+";"),this.isInitialized=!0}finish(e){const o=Object.values(this.definitions_);return super.finish(e),this.isInitialized=!1,this.nameDB_.reset(),o.join(`

`)+`


`+e}scrubNakedValue(e){return e+`;
`}quote_(e){return e=e.replace(/\\/g,"\\\\").replace(/\n/g,`\\
`).replace(/'/g,"\\'"),"'"+e+"'"}multiline_quote_(e){return e.split(/\n/g).map(this.quote_).join(` + '\\n' +
`)}scrub_(e,o,n=!1){let c="";if(!e.outputConnection||!e.outputConnection.targetConnection){var $=e.getCommentText();$&&($=s.wrap$$module$build$src$core$utils$string($,this.COMMENT_WRAP-3),c+=this.prefixLines($+`
`,"// "));for(let p=0;p<e.inputList.length;p++)e.inputList[p].type===s.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&($=e.inputList[p].connection.targetBlock())&&($=this.allNestedComments($))&&(c+=this.prefixLines($,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),n=n?"":this.blockToCode(e),c+o+n}getAdjusted(e,o,n=0,c=!1,$=i.NONE){e.workspace.options.oneBasedIndex&&n--;const p=e.workspace.options.oneBasedIndex?"1":"0";let E=$;return n>0?E=i.ADDITION:n<0?E=i.SUBTRACTION:c&&(E=i.UNARY_NEGATION),e=this.valueToCode(e,o,E)||p,n===0&&!c?e:s.isNumber$$module$build$src$core$utils$string(e)?(e=String(Number(e)+n),c&&(e=String(-Number(e))),e):(n>0?e=`${e} + ${n}`:n<0&&(e=`${e} - ${-n}`),c&&(e=n?`-(${e})`:`-${e}`),Math.floor($)>=Math.floor(E)&&(e=`(${e})`),e)}},ue=function(e,o,n){return o==="FIRST"?"0":o==="FROM_END"?e+".length - 1 - "+n:o==="LAST"?e+".length - 1":n},y={};y.lists_create_empty=m,y.lists_create_with=g,y.lists_getIndex=b,y.lists_getSublist=v,y.lists_indexOf=M,y.lists_isEmpty=L,y.lists_length=h,y.lists_repeat=I,y.lists_reverse=R,y.lists_setIndex=O,y.lists_sort=x,y.lists_split=A;var F={};F.controls_if=f,F.controls_ifelse=f,F.logic_boolean=q,F.logic_compare=k,F.logic_negate=W,F.logic_null=K,F.logic_operation=G,F.logic_ternary=X;var V={};V.controls_flow_statements=J,V.controls_for=S,V.controls_forEach=U,V.controls_repeat=H,V.controls_repeat_ext=H,V.controls_whileUntil=B;var C={};C.math_arithmetic=_e,C.math_atan2=Ie,C.math_change=Te,C.math_constant=te,C.math_constrain=pe,C.math_modulo=Q,C.math_number=$e,C.math_number_property=de,C.math_on_list=me,C.math_random_float=ge,C.math_random_int=Ee,C.math_round=j,C.math_single=j,C.math_trig=j;var w={};w.procedures_callnoreturn=z,w.procedures_callreturn=he,w.procedures_defnoreturn=se,w.procedures_defreturn=se,w.procedures_ifreturn=Oe;var t=/^\s*'([^']|\\')*'\s*$/,r=function(e){return t.test(e)?[e,i.ATOMIC]:["String("+e+")",i.FUNCTION_CALL]},l=function(e,o,n){return o==="FIRST"?"0":o==="FROM_END"?e+".length - 1 - "+n:o==="LAST"?e+".length - 1":n},u={};u.text=Ae,u.text_append=oe,u.text_changeCase=be,u.text_charAt=Z,u.text_count=ve,u.text_getSubstring=fe,u.text_indexOf=Le,u.text_isEmpty=Re,u.text_join=Se,u.text_length=Ne,u.text_print=Ce,u.text_prompt=re,u.text_prompt_ext=re,u.text_replace=ye,u.text_reverse=D,u.text_trim=Me;var T={};T.variables_get=ne,T.variables_set=ie;var N={};N.variables_get_dynamic=ne,N.variables_set_dynamic=ie;var Y=new le,De=Object.assign({},y,F,V,C,w,u,T,N);for(const e in De)Y.forBlock[e]=De[e];var ee={};return ee.JavascriptGenerator=le,ee.Order=i,ee.javascriptGenerator=Y,ee.__namespace__=s,ee})})(javascript_compressed);var javascript_compressedExports=javascript_compressed.exports;const javascript=getDefaultExportFromCjs(javascript_compressedExports),{JavascriptGenerator,Order,javascriptGenerator}=javascript,titre="Programmer le déplacement d'un bus",dateDePublication="15/07/2025",interactifReady=!0,interactifType="custom",uuid="f320c",refs={"fr-fr":["6I1D"],"fr-2016":["6I15"],"fr-ch":[]};class ExerciceLabyrintheChemin extends Exercice{destroyers=[];constructor(){super(),this.nbQuestions=2,this.besoinFormulaireNumerique=["Nombre de lignes du labyrinthe (entre 2 et 8 ou bien 1 si vous laissez le hasard décider)",8],this.besoinFormulaire2Numerique=["Nombre de colonnes du labyrinthe (entre 2 et 8 ou bien 1 si vous laissez le hasard décider)",8],this.sup=5,this.sup2=4}destroy(){this.destroyers.forEach(a=>a()),this.destroyers.length=0}nouvelleVersion(){this.destroyers.forEach(a=>a()),this.destroyers.length=0;for(let a=0,d=0,_,s;a<this.nbQuestions&&d<50;d++){const m=this.sup===1?randint(2,5):Math.min(Math.max(2,this.sup),5),g=this.sup===1?randint(3,5):Math.min(Math.max(3,this.sup2),5),I=randint(0,g-1),h=randint(0,g-1,[I]),L=this.generatePath(g,m,0,I,m-1,h),M=L.villeParCoord[I][0]||"Ville de départ",b=L.villeParCoord[h][m-1]||"Ville d'arrivée";_=`Retrouver les instructions pour représenter le parcours d'un bus entre ${M} et ${b}.<br>`,_+=this.generateGrapheSVG(`${this.numeroExercice}_${a}`,g,m,0,I,m-1,h,L),s="Le bus part du lieu : "+L.villeParCoord[I][0]+" et arrive au lieu : "+L.villeParCoord[h][m-1]+".<br>",s+="Le bus suit le chemin suivant :<br>",s+=L.path.map(O=>`${L.villeParCoord[O[0]][O[1]]}`).join(" → ")+"<br>",s+="Voici une solution possible des instructions pour le trajet du bus :<br>",createSolutionStr(L.edges).forEach((O,v)=>{const x=O.split("-"),A=x.length>1?x[1].trim():O.trim();s+=`${v+1} - ${A}<br>`}),this.interactif&&(_+=`<div class="ml-2 py-2" id="resultatCheckEx${this.numeroExercice}Q${a}"></div>`,_+=ajouteFeedback(this,a)),this.questionJamaisPosee(a,_)&&(this.listeQuestions[a]=_,this.listeCorrections[a]=s,a++),listeQuestionsToContenu(this)}}generatePath(a,d,_,s,m,g){const I=[s,_],h=[g,m],L=["le stade","la boulangerie","la patisserie","l'école","la poste","la mairie","le fleuriste","le garagiste","la gare","la piscine","la pharmacie","l'hôpital","la banque","la librairie","le cinéma","le musée","les pompiers","le marché","le restaurant","l'hôtel","la laverie","le parking","la caserne","la station-service","le Bar"],M=(()=>{const R=new Set;return()=>{let f;do f=L[randint(0,L.length-1)];while(R.has(f));return R.add(f),f}})();function b(R,f){let[k,G]=R;const[W,q]=f,K=[[k,G]],X=W-k,H=q-G,B=[];for(let S=0;S<Math.abs(X);S++)B.push([Math.sign(X),0]);for(let S=0;S<Math.abs(H);S++)B.push([0,Math.sign(H)]);for(let S=B.length-1;S>0;S--){const U=randint(0,S),J=B[S];B[S]=B[U],B[U]=J}for(const[S,U]of B)k+=S,G+=U,K.push([k,G]);return K}let O;const v=runAStar(d,a,_,s,m,g);v?(v.sort((R,f)=>f.length-R.length),O=v[randint(0,v.length-1)].map(R=>[R.x,R.y])):O=b(I,h);const x=[];for(let R=0;R<O.length-1;R++){const f=O[R],k=O[R+1];x.push({from:f,to:k})}const A=[];for(let R=0;R<a;R++){A[R]=[];for(let f=0;f<d;f++)A[R][f]=M()}return{path:O,edges:x,villeParCoord:A}}generateGrapheTikz(a,d,_,s,m,g,I,h){const L=function(){const b=[];for(let O=0;O<_;O++)for(let v=0;v<d;v++)b.push(removeFirstWord(h.villeParCoord[v][O]));return b},M=h.path.map(b=>`${b[0]}/${b[1]}`).join(", ");return`
    \\begingroup
\\begin{tikzpicture}[
    >=Stealth, 
    every node/.style={
        draw, ellipse, minimum height=10mm, text width=14mm, align=center, font=\\sffamily\\footnotesize
    }
]

  % Définir variables locales pour les dimensions
  \\pgfmathsetmacro{\\rows}{${_}}
  \\pgfmathsetmacro{\\cols}{${d}}

  % Liste des villes (au moins rows × cols)
  \\def\\citylist{{${L().map(b=>`"${b}"`).join(", ")}}}

  % Chemin donné par une suite de coordonnées (x,y)
  \\def\\pathcoords{${M}}

  % Extraction du premier et dernier élément
  \\def\\firstcoord{}
  \\def\\lastcoord{}
  \\foreach \\x/\\y [count=\\i] in \\pathcoords {
    \\edef\\coord{\\x/\\y}
    \\ifnum\\i=1
      \\xdef\\firstcoord{\\coord}
    \\fi
    \\xdef\\lastcoord{\\coord}
  }
  
  % Placement des nœuds
  \\foreach \\j in {0,...,\\numexpr\\rows-1} {
    \\foreach \\i in {0,...,\\numexpr\\cols-1} {
      \\pgfmathtruncatemacro{\\index}{\\j * \\cols + \\i}
      \\pgfmathsetmacro{\\x}{\\i * 3} % horizontal spacing
      \\pgfmathsetmacro{\\y}{(\\rows - 1 - \\j) * 2} % vertical spacing
      \\edef\\coord{\\i/\\j}
      \\ifx\\coord\\firstcoord
        \\node[fill=gray!20] (C\\i\\j) at (\\x,\\y) {\\pgfmathparse{\\citylist[\\index]}\\pgfmathresult};
      \\else\\ifx\\coord\\lastcoord
        \\node[fill=gray!20] (C\\i\\j) at (\\x,\\y) {\\pgfmathparse{\\citylist[\\index]}\\pgfmathresult};
      \\else
        \\node (C\\i\\j) at (\\x,\\y) {\\pgfmathparse{\\citylist[\\index]}\\pgfmathresult};
      \\fi\\fi
    }
  }

  % Arêtes par défaut (grises)
  \\foreach \\j in {0,...,\\numexpr\\rows-1} {
    \\foreach \\i in {0,...,\\numexpr\\cols-2} {
      \\draw[->,gray] (C\\i\\j) -- (C\\the\\numexpr\\i+1\\relax\\j);
    }
  }

  \\foreach \\j in {0,...,\\numexpr\\rows-2} {
    \\foreach \\i in {0,...,\\numexpr\\cols-1} {
      \\draw[->,gray] (C\\i\\j) -- (C\\i\\the\\numexpr\\j+1\\relax);
    }
  }

  % Chemin rouge
   \\foreach \\xA/\\yA [count=\\i] in \\pathcoords {
    \\ifnum\\i>1
      \\pgfmathsetmacro{\\xprev}{\\xA}
      \\pgfmathsetmacro{\\yprev}{\\yA}
      \\draw[->, red] (C\\prevx\\prevy) -- (C\\xA\\yA);
    \\fi
    \\xdef\\prevx{\\xA}
    \\xdef\\prevy{\\yA}
  }

  % Macros d'extraction
  \\def\\getx#1/#2\\relax{#1} % Prend la partie avant le /
  \\def\\gety#1/#2\\relax{#2} % Prend la partie après le /

  % Extraction effective
  \\edef\\fx{\\expandafter\\getx\\firstcoord\\relax}
  \\edef\\fy{\\expandafter\\gety\\firstcoord\\relax}

  % Convertir en coordonnées TikZ
  \\pgfmathsetmacro\\xstart{\\fx * 3}
  \\pgfmathsetmacro\\ystart{(\\rows - 1 - \\fy) * 2}

  % Robot : une flèche en triangle
  \\begin{scope}[shift={(\\xstart,\\ystart)}, rotate=0, scale=1,opacity=0.3]
    \\filldraw[fill=gray, draw=black]
      (-0.8,-0.3) -- (0.2,-0.3) -- (0.2,-0.5) -- (1,0) -- (0.2,0.5) -- (0.2,0.3) -- (-0.8,0.3) -- cycle;
  \\end{scope}

\\end{tikzpicture}
\\endgroup\\\\
   
Les instructions à utiliser sont les suivantes :

\\setscratch{scale=0.8,line width=1pt}
\\begin{scratch}
\\blockmove{Avancer}
\\end{scratch}
ou 
\\begin{scratch}
\\blockmove{Tourner à gauche}
\\end{scratch}
ou 
\\begin{scratch}
\\blockmove{Tourner à droite}
\\end{scratch}.
 `}generateGrapheSVG(id,cols,rows,rowsStart,colsStart,rowsEnd,colsEnd,parcours){const svgWidth=cols*100,svgHeight=rows*100,start=[colsStart,rowsStart],orientation={angle:0},end=[colsEnd,rowsEnd],pos={x:start[0],y:start[1]},edges=parcours.edges,path=parcours.path,villeParCoord=parcours.villeParCoord;function resizeBlockly(a){if(a instanceof CustomEvent&&a.detail.uuid!==uuid)return;const d=retrieveWorkspace(`blocklyDiv${id}`);if(d){const _=document.getElementById(`blocklyDiv${id}`);_&&_.offsetParent!==null&&svgResize(d)}}function destroyerListener(){document.removeEventListener("questionDisplay",resizeBlockly)}this.destroyers.push(destroyerListener);function drawArrow(a,d,_,s,m){const h=s-d,L=m-_,M=Math.atan2(L,h),b=d+40*Math.cos(M),O=_+20*Math.sin(M),v=s-40*Math.cos(M),x=m-20*Math.sin(M),A=document.createElementNS("http://www.w3.org/2000/svg","line");A.setAttribute("x1",String(b)),A.setAttribute("y1",String(O)),A.setAttribute("x2",String(v)),A.setAttribute("y2",String(x)),A.setAttribute("stroke","red"),A.setAttribute("stroke-width","2"),A.setAttribute("marker-end",`url(#arrowhead${id})`),a.appendChild(A)}const svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("width",`${svgWidth}`),svg.setAttribute("height",`${svgHeight}`),svg.setAttribute("viewBox",`0 0 ${svgWidth} ${svgHeight}`),svg.style.border="1px solid black";const positions={};for(let a=0;a<cols;a++)for(let d=0;d<rows;d++){const _=a*100+50,s=d*100+50;positions[`${a},${d}`]=[_,s]}for(let a=0;a<cols;a++)for(let d=0;d<rows;d++){const[_,s]=positions[`${a},${d}`],m=[[1,0],[0,1]];for(const[g,I]of m){const h=a+g,L=d+I;if(h<cols&&L<rows){const[M,b]=positions[`${h},${L}`],O=document.createElementNS("http://www.w3.org/2000/svg","line");O.setAttribute("x1",`${_}`),O.setAttribute("y1",`${s}`),O.setAttribute("x2",`${M}`),O.setAttribute("y2",`${b}`),O.setAttribute("stroke","black"),O.setAttribute("stroke-width","1"),svg.appendChild(O)}}}for(let a=0;a<cols;a++)for(let d=0;d<rows;d++){const[_,s]=positions[`${a},${d}`],m=document.createElementNS("http://www.w3.org/2000/svg","ellipse");m.setAttribute("cx",`${_}`),m.setAttribute("cy",`${s}`),m.setAttribute("rx","40"),m.setAttribute("ry","20"),a===start[0]&&d===start[1]?m.setAttribute("fill","green"):a===end[0]&&d===end[1]?m.setAttribute("fill","blue"):m.setAttribute("fill","#ccc"),svg.appendChild(m);const g=villeParCoord[a][d]||"Ville inconnue",I=document.createElementNS("http://www.w3.org/2000/svg","text");I.setAttribute("x",`${_}`),I.setAttribute("y",`${s+5}`),I.setAttribute("text-anchor","middle"),I.setAttribute("font-size","12"),I.textContent=removeFirstWord(g),svg.appendChild(I)}const robot=document.createElementNS("http://www.w3.org/2000/svg","path");robot.setAttribute("d","M -8,-2 L 4,-2 L 4,-6 L 12,0 L 4,6 L 4,2 L -8,2 Z"),robot.setAttribute("fill","grey"),robot.setAttribute("stroke","red"),robot.setAttribute("id","robot");const[px,py]=positions[`${start[0]},${start[1]}`],scale=1.2;robot.setAttribute("transform",`translate(${px}, ${py}) rotate(${orientation.angle}) scale(${scale})`),svg.appendChild(robot);function moveDir(a,d){const _=[pos.x+a,pos.y+d];if(edges.find(m=>m.from[0]===pos.x&&m.from[1]===pos.y&&m.to[0]===_[0]&&m.to[1]===_[1])){pos.x+=a,pos.y+=d;const[m,g]=positions[`${pos.x},${pos.y}`];return document.getElementById(id)?.querySelector("#robot")?.setAttribute("transform",`translate(${m}, ${g}) rotate(${orientation.angle}) scale(${scale})`),!0}return!1}function avancer(){orientation.angle===0?moveDir(1,0):orientation.angle===90?moveDir(0,1):orientation.angle===180?moveDir(-1,0):orientation.angle===270&&moveDir(0,-1)}function tourner(a){a===1?orientation.angle=(orientation.angle+90)%360:(orientation.angle=(orientation.angle-90)%360,orientation.angle<0&&(orientation.angle+=360)),rotate(orientation.angle)}function rotate(a){const d=document.getElementById(id);if(d){const _=d.querySelector("#robot"),m=(_.getAttribute("transform")||"").replace(/rotate\(\d+\)/,`rotate(${a})`);_.setAttribute("transform",m)}}let workspace;function createBlockLy(){setLocale(En),Msg.CONTROLS_REPEAT_TITLE="répéter %1 fois",Msg.CONTROLS_REPEAT_INPUT_DO="faire",Blocks.start||defineBlocksWithJsonArray([{type:"start",message0:"Démarrer",nextStatement:null,colour:20,hat:"true"},{type:"move_forward",message0:"avancer",previousStatement:null,nextStatement:null,colour:160},{type:"turn_left",message0:"tourner à gauche",previousStatement:null,nextStatement:null,colour:210},{type:"turn_right",message0:"tourner à droite",previousStatement:null,nextStatement:null,colour:210}]),javascriptGenerator.forBlock.start=function(g){return javascriptGenerator.statementToCode(g,"")},javascriptGenerator.forBlock.move_forward=function(g,I){return`avancer();
`},javascriptGenerator.forBlock.turn_left=function(g,I){return`tourner(-1);
`},javascriptGenerator.forBlock.turn_right=function(g,I){return`tourner(1);
`};const a=`
      <xml xmlns="https://developers.google.com/blockly/xml">
      <block type="start" deletable="false" movable="false" x="10" y="5"></block>
      </xml>`,d=document.getElementById("toolbox");if(!d)throw new Error("Toolbox element with id 'toolbox' not found.");const _=retrieveWorkspace(`blocklyDiv${id}`);_&&_.dispose(),workspace=inject(`blocklyDiv${id}`,{media:"/kopmaths974/blockly/media/",toolbox:d,sounds:!1,zoom:{controls:!0,wheel:!0,startScale:.8,maxScale:2.5,minScale:.3,scaleSpeed:1.2,pinch:!1}});const m=document.querySelector(`#blocklyDiv${id} .blocklyZoomReset`);m&&(m.style.display="none"),workspace.idkey=`blocklyDiv${id}`,Xml.domToWorkspace(utils.xml.textToDom(a),workspace),ContextMenuRegistry.registry.reset(),document.addEventListener("questionDisplay",resizeBlockly)}function ajouterBlocALaSuite(a){const d=retrieveWorkspace(`blocklyDiv${id}`);if(!d)return;const _=d.getTopBlocks(!0);if(_.length===0){console.warn("Aucun bloc de départ trouvé.");return}let s=_[0];for(;s.getNextBlock();){const g=s.getNextBlock();if(!g)break;s=g}const m=serialization.blocks.append({type:a},d);s.nextConnection&&m.previousConnection&&s.nextConnection.connect(m.previousConnection)}function resetRobot(){const a=document.getElementById(id);if(a){const[s,m]=positions[`${start[0]},${start[1]}`];pos.x=start[0],pos.y=start[1],orientation.angle=0,a?.querySelector("#robot")?.setAttribute("transform",`translate(${s}, ${m}) rotate(${orientation.angle}) scale(${scale})`)}const d=document.getElementById(id)?.querySelector("#message-correct");d&&(d.style.display="none");const _=document.getElementById(id)?.querySelector("#message-faux");_&&(_.style.display="none")}function resetWorkspace(){const a=retrieveWorkspace(`blocklyDiv${id}`);if(a){a.clear();const _=utils.xml.textToDom('<xml><block type="start" deletable="false" movable="false" x="20" y="20"></block></xml>');Xml.domToWorkspace(_,a)}}function runCode(){const workspace=retrieveWorkspace(`blocklyDiv${id}`);if(!workspace)return;javascriptGenerator.init(workspace);const blocks=workspace.getTopBlocks(!0),startBlock=blocks.find(a=>a.type==="start");if(!startBlock){alert('Ajoutez un bloc "Démarrer"');return}let code=javascriptGenerator.blockToCode(startBlock);Array.isArray(code)&&(code=code[0]);try{eval(code)}catch(a){console.error(a)}const btn=document.getElementById(id)?.querySelector("#message-encours");if(btn&&(btn.style.display="none"),checkIfSolution()){const a=document.getElementById(id)?.querySelector("#message-correct");a&&(a.style.display="block")}else{const a=document.getElementById(id)?.querySelector("#message-faux");a&&(a.style.display="block")}}async function runCodeWithDelay(){const workspace=retrieveWorkspace(`blocklyDiv${id}`);if(!workspace)return;javascriptGenerator.init(workspace);const blocks=workspace.getTopBlocks(!0),startBlock=blocks.find(a=>a.type==="start");if(!startBlock){alert('Ajoutez un bloc "Démarrer"');return}let code=javascriptGenerator.blockToCode(startBlock);Array.isArray(code)&&(code=code[0]);const btnCorrect=document.getElementById(id)?.querySelector("#message-correct");btnCorrect&&(btnCorrect.style.display="none");const btnFaux=document.getElementById(id)?.querySelector("#message-faux");btnFaux&&(btnFaux.style.display="none");const btnEncours=document.getElementById(id)?.querySelector("#message-encours");btnEncours&&(btnEncours.style.display="block");try{const delayMs=1e3,lines=code.split(`
`).filter(a=>a.trim()!==""),delayedCode=lines.map(a=>`  ${a}
  await sleep(1000);`).join(`
`),asyncWrapper=`(async () => {
          const sleep = (ms) => new Promise(r => setTimeout(r, ms));
        ${delayedCode}
        })()`;await eval(asyncWrapper)}catch(a){console.error(a)}btnEncours&&(btnEncours.style.display="none"),checkIfSolution()?btnCorrect&&(btnCorrect.style.display="block"):btnFaux&&(btnFaux.style.display="block")}function checkIfSolution(){const a=edges.at(-1);if(!a)return!1;const{to:d}=a,_=pos.y-d[1],s=pos.x-d[0];return _===0&&s===0}function createSolution(){resetRobot(),resetWorkspace();for(const a of edges){const d=a.from,_=a.to,s=_[0]-d[0],m=_[1]-d[1];s===1&&m===0?orientation.angle===0?ajouterBlocALaSuite("move_forward"):orientation.angle===270?(ajouterBlocALaSuite("turn_right"),ajouterBlocALaSuite("move_forward"),orientation.angle=0):orientation.angle===180?(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=0):orientation.angle===90&&(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=0):s===-1&&m===0?orientation.angle===180?ajouterBlocALaSuite("move_forward"):orientation.angle===0?(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=180):orientation.angle===90?(ajouterBlocALaSuite("turn_right"),ajouterBlocALaSuite("move_forward"),orientation.angle=180):orientation.angle===270&&(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=180):s===0&&m===1?orientation.angle===90?ajouterBlocALaSuite("move_forward"):orientation.angle===0?(ajouterBlocALaSuite("turn_right"),ajouterBlocALaSuite("move_forward"),orientation.angle=90):orientation.angle===180?(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=90):orientation.angle===270&&(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward")):s===0&&m===-1&&(orientation.angle===270?ajouterBlocALaSuite("move_forward"):orientation.angle===0?(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=270):orientation.angle===90?(ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("turn_left"),ajouterBlocALaSuite("move_forward"),orientation.angle=270):orientation.angle===180&&(ajouterBlocALaSuite("turn_right"),ajouterBlocALaSuite("move_forward"),orientation.angle=270))}orientation.angle=0}const listener=function(){const a=document.getElementById(id);a&&!a._eventsBound&&(a.querySelector("#btn-av")?.addEventListener("click",()=>avancer()),a.querySelector("#btn-left")?.addEventListener("click",()=>tourner(-1)),a.querySelector("#btn-right")?.addEventListener("click",()=>tourner(1)),a.querySelector("#resetRobot")?.addEventListener("click",resetRobot),a.querySelector("#resetWorkspace")?.addEventListener("click",resetWorkspace),a.querySelector("#showSolution")?.addEventListener("click",createSolution),a.querySelector("#runCode")?.addEventListener("click",runCode),a.querySelector("#runCodeWithDelay")?.addEventListener("click",runCodeWithDelay),createBlockLy(),a._eventsBound=!0),document.removeEventListener("exercicesAffiches",listener)};document.addEventListener("exercicesAffiches",listener);for(let a=0;a<path.length-1;a++){const[d,_]=positions[`${path[a][0]},${path[a][1]}`],[s,m]=positions[`${path[a+1][0]},${path[a+1][1]}`];drawArrow(svg,d,_,s,m)}const defs=document.createElementNS("http://www.w3.org/2000/svg","defs");defs.innerHTML=`
     <marker id="arrowhead${id}" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth" viewBox="0 0 6 6">
  <path d="M 0 0 L 6 3 L 0 6 L 2 3 Z" fill="red" />
</marker>
    `,svg.insertBefore(defs,svg.firstChild),svg.setAttribute("class","mathalea2d"),svg.setAttribute("viewBox",`0 0 ${svgWidth} ${svgHeight}`),svg.setAttribute("style","display: inline-block");const serializer=new XMLSerializer,svgString=serializer.serializeToString(svg);return`<div id=${id}>
    <div class="svgContainer" style="display: inline-block"> 
    ${svgString}<br>
    
  <!-- <button id="btn-av">⇒</button>
  <button id="btn-left" class="px-6 py-2.5 ml-6">↪</button>
  <button id="btn-right" class="px-6 py-2.5 ml-6">↩</button>
  <button id="generate" class="px-6 py-2.5 ml-6">🔁 Recommencer</button> -->
  </div>
  <xml id="toolbox" style="display: none">
  <category name="Déplacement">
    <block type="move_forward"></block>
    <block type="turn_left"></block>
    <block type="turn_right"></block>
  </category>
  <category name="Contrôle">
  <block type="start"></block>
    <block type="controls_repeat_ext">
      <value name="TIMES"><shadow type="math_number"><field name="NUM">2</field></shadow></value>
    </block>
  </category>
  </xml>

  <div>
  <button id="runCode" class="px-6 py-2.5" style="display:none">▶️ Exécuter</button>
  <button id="runCodeWithDelay" class="px-6 py-2.5" ${this.interactif?'style="display:none"':""}>▶️ Exécuter (pas à pas) </button>
  <button id="resetWorkspace" class="px-6 py-2.5" ${this.interactif?'style="display:none"':""}>♻️ Reinit programme</button>
  <button id="resetRobot" class="px-6 py-2.5" ${this.interactif?'style="display:none"':""}>🔁 Reinit bus</button>
  <button id="showSolution" class="px-6 py-2.5" style="display:none">💡 Show solution</button>
  <div id="message-correct" style="display: none; margin: 10px 10px 10px 10px; font-weight: bold; color: green; font-size: 1.2em;">
  🎉 Bravo, le bus est bien arrivé !
  </div>
  <div id="message-faux" style="display: none; margin: 10px 10px 10px 10px; font-weight: bold; color: red; font-size: 1.2em;">
   ❌ Attention, le bus n'est pas arrivé à sa destination finale!
  </div>
  <style>
  @keyframes blink {
    50% { opacity: 0; }
  }
  </style>
  <div id="message-encours" style="animation: blink 1s step-start infinite;display: none; margin: 10px 10px 10px 10px; font-weight: bold; font-size: 1.2em;">
  En cours d'exécution...
  </div>
  <div id="blocklyDiv${id}" style="height:300px;width:100%"></div>
  </div>
  </div>
`}correctionInteractive=a=>{if(a===void 0)return"";this.answers===void 0&&(this.answers={});let d="KO";const _=`${this.numeroExercice}_${a}`,s=retrieveWorkspace(`blocklyDiv${_}`);if(s){const h=exportBlocklyJSONUltraLight(s);this.answers[`blocklyDiv${_}`]=h}const m=document.querySelector(`#resultatCheckEx${this.numeroExercice}Q${a}`),g=document.querySelector(`#feedbackEx${this.numeroExercice}Q${a}`);m&&(m.innerHTML="");const I=document.getElementById(_);return I&&(I.querySelector("#runCode")?.click(),I.querySelector("#message-correct")?.style.display!=="none"?(d="OK",m&&(m.innerHTML="😎")):(m&&(m.innerHTML="☹️"),g&&(g.innerHTML="Le bus n'est pas arrivé à destination",g.style.display="block"))),d}}function retrieveWorkspace(a){const d=Workspace.getAll();for(let _=0;_<d.length;_++){const s=d[_];if(s.idkey===a)return s}return null}function exportBlocklyJSONUltraLight(a){const d=serialization.workspaces.save(a),_=new Set(["id","x","y","collapsed","deletable","movable","editable","enabled","inline","inputsInline","data","extraState","isShadow","disabled"]);function s(g){if(Array.isArray(g))return g.map(s);if(g&&typeof g=="object"){const I={};for(const h in g)_.has(h)||(I[h]=s(g[h]));return I}return g}const m=s(d);return JSON.stringify(m,null,2)}function removeFirstWord(a){const d=a.replace(/^(les|la|le|l’|l')\s*/i,"").trim();return d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()}function createSolutionStr(a){const d={angle:0},_=[];for(const s of a){const m=s.from,g=s.to,I=g[0]-m[0],h=g[1]-m[1];I===1&&h===0?d.angle===0?_.push("move_forward-Avancer"):d.angle===270?(_.push("turn_right-Tourner à droite"),_.push("move_forward-Avancer"),d.angle=0):d.angle===180?(_.push("turn_left-Tourner à gauche"),_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=0):d.angle===90&&(_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=0):I===-1&&h===0?d.angle===180?_.push("move_forward-Avancer"):d.angle===0?(_.push("turn_left-Tourner à gauche"),_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=180):d.angle===90?(_.push("turn_right-Tourner à droite"),_.push("move_forward-Avancer"),d.angle=180):d.angle===270&&(_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=180):I===0&&h===1?d.angle===90?_.push("move_forward-Avancer"):d.angle===0?(_.push("turn_right-Tourner à droite"),_.push("move_forward-Avancer"),d.angle=90):d.angle===180?(_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=90):d.angle===270&&(_.push("turn_left-Tourner à gauche"),_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer")):I===0&&h===-1&&(d.angle===270?_.push("move_forward-Avancer"):d.angle===0?(_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=270):d.angle===90?(_.push("turn_left-Tourner à gauche"),_.push("turn_left-Tourner à gauche"),_.push("move_forward-Avancer"),d.angle=270):d.angle===180&&(_.push("turn_right-Tourner à droite"),_.push("move_forward-Avancer"),d.angle=270))}return d.angle=0,_}export{dateDePublication,ExerciceLabyrintheChemin as default,interactifReady,interactifType,refs,titre,uuid};
