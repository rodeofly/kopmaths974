import{t as _t,P as C,S as M,s as V,u as re,E as Ue,i as dt,v as it,A as kt,F as Dt}from"./exerciseMethods-CtbYPwln.js";import{dG as Mt,dK as jt,dL as qt}from"./embellissements-BYV7mIDn.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var v=function(){return v=Object.assign||function(t){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},v.apply(this,arguments)};function Ke(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i}function P(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function N(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),n,o=[],s;try{for(;(t===void 0||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(a){s={error:a}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(s)throw s.error}}return o}function q(e,t,i){if(arguments.length===2)for(var r=0,n=t.length,o;r<n;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var j;(function(e){e.Start="xstate.start",e.Stop="xstate.stop",e.Raise="xstate.raise",e.Send="xstate.send",e.Cancel="xstate.cancel",e.NullEvent="",e.Assign="xstate.assign",e.After="xstate.after",e.DoneState="done.state",e.DoneInvoke="done.invoke",e.Log="xstate.log",e.Init="xstate.init",e.Invoke="xstate.invoke",e.ErrorExecution="error.execution",e.ErrorCommunication="error.communication",e.ErrorPlatform="error.platform",e.ErrorCustom="xstate.error",e.Update="xstate.update",e.Pure="xstate.pure",e.Choose="xstate.choose"})(j||(j={}));var ue;(function(e){e.Parent="#_parent",e.Internal="#_internal"})(ue||(ue={}));var Ge=j.Start,Je=j.Stop,Se=j.Raise,je=j.Send,ht=j.Cancel,Ut=j.NullEvent,gt=j.Assign;j.After;j.DoneState;var pt=j.Log,Bt=j.Init,ze=j.Invoke;j.ErrorExecution;var rt=j.ErrorPlatform,xt=j.ErrorCustom,vt=j.Update,Gt=j.Choose,zt=j.Pure,mt=".",nt={},$e="xstate.guard",$t="",Le;function Ze(e,t,i){i===void 0&&(i=mt);var r=ye(e,i),n=ye(t,i);return _(n)?_(r)?n===r:!1:_(r)?r in n:Object.keys(r).every(function(o){return o in n?Ze(r[o],n[o]):!1})}function yt(e){try{return _(e)||typeof e=="number"?"".concat(e):e.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Ve(e,t){try{return ce(e)?e:e.toString().split(t)}catch{throw new Error("'".concat(e,"' is not a valid state path."))}}function Vt(e){return typeof e=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e}function ye(e,t){if(Vt(e))return e.value;if(ce(e))return _e(e);if(typeof e!="string")return e;var i=Ve(e,t);return _e(i)}function _e(e){if(e.length===1)return e[0];for(var t={},i=t,r=0;r<e.length-1;r++)r===e.length-2?i[e[r]]=e[r+1]:(i[e[r]]={},i=i[e[r]]);return t}function ge(e,t){for(var i={},r=Object.keys(e),n=0;n<r.length;n++){var o=r[n];i[o]=t(e[o],o,e,n)}return i}function ot(e,t,i){var r,n,o={};try{for(var s=P(Object.keys(e)),a=s.next();!a.done;a=s.next()){var l=a.value,u=e[l];i(u)&&(o[l]=t(u,l,e))}}catch(c){r={error:c}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}var Yt=function(e){return function(t){var i,r,n=t;try{for(var o=P(e),s=o.next();!s.done;s=o.next()){var a=s.value;n=n[a]}}catch(l){i={error:l}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return n}};function Ht(e,t){return function(i){var r,n,o=i;try{for(var s=P(e),a=s.next();!a.done;a=s.next()){var l=a.value;o=o[t][l]}}catch(u){r={error:u}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}}function Ie(e){if(!e)return[[]];if(_(e))return[[e]];var t=U(Object.keys(e).map(function(i){var r=e[i];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[i]]:Ie(e[i]).map(function(n){return[i].concat(n)})}));return t}function U(e){var t;return(t=[]).concat.apply(t,q([],N(e),!1))}function Et(e){return ce(e)?e:[e]}function X(e){return e===void 0?[]:Et(e)}function ke(e,t,i){var r,n;if(F(e))return e(t,i.data);var o={};try{for(var s=P(Object.keys(e)),a=s.next();!a.done;a=s.next()){var l=a.value,u=e[l];F(u)?o[l]=u(t,i.data):o[l]=u}}catch(c){r={error:c}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function Wt(e){return/^(done|error)\./.test(e)}function st(e){return!!(e instanceof Promise||e!==null&&(F(e)||typeof e=="object")&&F(e.then))}function Xt(e){return e!==null&&typeof e=="object"&&"transition"in e&&typeof e.transition=="function"}function Kt(e,t){var i,r,n=N([[],[]],2),o=n[0],s=n[1];try{for(var a=P(e),l=a.next();!l.done;l=a.next()){var u=l.value;t(u)?o.push(u):s.push(u)}}catch(c){i={error:c}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return[o,s]}function wt(e,t){return ge(e.states,function(i,r){if(i){var n=(_(t)?void 0:t[r])||(i?i.current:void 0);if(n)return{current:n,states:wt(i,n)}}})}function Jt(e,t){return{current:t,states:wt(e,t)}}function at(e,t,i,r){var n=e&&i.reduce(function(o,s){var a,l,u=s.assignment,c={state:r,action:s,_event:t},d={};if(F(u))d=u(o,t.data,c);else try{for(var f=P(Object.keys(u)),h=f.next();!h.done;h=f.next()){var m=h.value,p=u[m];d[m]=F(p)?p(o,t.data,c):p}}catch(S){a={error:S}}finally{try{h&&!h.done&&(l=f.return)&&l.call(f)}finally{if(a)throw a.error}}return Object.assign({},o,d)},e);return n}var Zt=function(){};function ce(e){return Array.isArray(e)}function F(e){return typeof e=="function"}function _(e){return typeof e=="string"}function St(e,t){if(e)return _(e)?{type:$e,name:e,predicate:t?t[e]:void 0}:F(e)?{type:$e,name:e.name,predicate:e}:e}function Qt(e){try{return"subscribe"in e&&F(e.subscribe)}catch{return!1}}var Z=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Le={},Le[Z]=function(){return this},Le[Symbol.observable]=function(){return this};function fe(e){return!!e&&"__xstatenode"in e}function ei(e){return!!e&&typeof e.send=="function"}function qe(e,t){return _(e)||typeof e=="number"?v({type:e},t):e}function z(e,t){if(!_(e)&&"$$type"in e&&e.$$type==="scxml")return e;var i=qe(e);return v({name:i.type,data:i,$$type:"scxml",type:"external"},t)}function ne(e,t){var i=Et(t).map(function(r){return typeof r>"u"||typeof r=="string"||fe(r)?{target:r,event:e}:v(v({},r),{event:e})});return i}function ti(e){if(!(e===void 0||e===$t))return X(e)}function bt(e,t,i,r,n){var o=e.options.guards,s={state:n,cond:t,_event:r};if(t.type===$e)return(o?.[t.name]||t.predicate)(i,r.data,s);var a=o?.[t.type];if(!a)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return a(i,r.data,s)}function Lt(e){return typeof e=="string"?{type:e}:e}function Ne(e,t,i){var r=function(){},n=typeof e=="object",o=n?e:null;return{next:((n?e.next:e)||r).bind(o),error:((n?e.error:t)||r).bind(o),complete:((n?e.complete:i)||r).bind(o)}}function Ce(e,t){return"".concat(e,":invocation[").concat(t,"]")}function Ye(e){return(e.type===Se||e.type===je&&e.to===ue.Internal)&&typeof e.delay!="number"}var le=z({type:Bt});function He(e,t){return t&&t[e]||void 0}function Ee(e,t){var i;if(_(e)||typeof e=="number"){var r=He(e,t);F(r)?i={type:e,exec:r}:r?i=r:i={type:e,exec:void 0}}else if(F(e))i={type:e.name||e.toString(),exec:e};else{var r=He(e.type,t);if(F(r))i=v(v({},e),{exec:r});else if(r){var n=r.type||e.type;i=v(v(v({},r),e),{type:n})}else i=e}return i}var Q=function(e,t){if(!e)return[];var i=ce(e)?e:[e];return i.map(function(r){return Ee(r,t)})};function Qe(e){var t=Ee(e);return v(v({id:_(e)?e:t.id},t),{type:t.type})}function ii(e,t){return{type:Se,event:typeof e=="function"?e:qe(e),delay:t?t.delay:void 0,id:t?.id}}function ri(e,t,i,r){var n={_event:i},o=z(F(e.event)?e.event(t,i.data,n):e.event),s;if(_(e.delay)){var a=r&&r[e.delay];s=F(a)?a(t,i.data,n):a}else s=F(e.delay)?e.delay(t,i.data,n):e.delay;return v(v({},e),{type:Se,_event:o,delay:s})}function ni(e,t){return{to:t?t.to:void 0,type:je,event:F(e)?e:qe(e),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:F(e)?e.name:yt(e)}}function oi(e,t,i,r){var n={_event:i},o=z(F(e.event)?e.event(t,i.data,n):e.event),s;if(_(e.delay)){var a=r&&r[e.delay];s=F(a)?a(t,i.data,n):a}else s=F(e.delay)?e.delay(t,i.data,n):e.delay;var l=F(e.to)?e.to(t,i.data,n):e.to;return v(v({},e),{to:l,_event:o,event:o.data,delay:s})}var si=function(e,t,i){return v(v({},e),{value:_(e.expr)?e.expr:e.expr(t,i.data,{_event:i})})},ai=function(e){return{type:ht,sendId:e}};function li(e){var t=Qe(e);return{type:j.Start,activity:t,exec:void 0}}function ui(e){var t=F(e)?e:Qe(e);return{type:j.Stop,activity:t,exec:void 0}}function fi(e,t,i){var r=F(e.activity)?e.activity(t,i.data):e.activity,n=typeof r=="string"?{id:r}:r,o={type:j.Stop,activity:n};return o}function ci(e,t){var i=t?"#".concat(t):"";return"".concat(j.After,"(").concat(e,")").concat(i)}function Oe(e,t){var i="".concat(j.DoneState,".").concat(e),r={type:i,data:t};return r.toString=function(){return i},r}function Fe(e,t){var i="".concat(j.DoneInvoke,".").concat(e),r={type:i,data:t};return r.toString=function(){return i},r}function pe(e,t){var i="".concat(j.ErrorPlatform,".").concat(e),r={type:i,data:t};return r.toString=function(){return i},r}var di=function(e){var t,i,r=[];try{for(var n=P(e),o=n.next();!o.done;o=n.next())for(var s=o.value,a=0;a<s.actions.length;){if(s.actions[a].type===gt){r.push(s.actions[a]),s.actions.splice(a,1);continue}a++}}catch(l){t={error:l}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return r};function De(e,t,i,r,n,o,s){s===void 0&&(s=!1);var a=s?[]:di(n),l=a.length?at(i,r,a,t):i,u=s?[i]:void 0,c=[];function d(m,p){var S;switch(p.type){case Se:{var g=ri(p,l,r,e.options.delays);return o&&typeof g.delay=="number"&&o(g,l,r),g}case je:var y=oi(p,l,r,e.options.delays);return o&&y.to!==ue.Internal&&(m==="entry"?c.push(y):o(y,l,r)),y;case pt:{var E=si(p,l,r);return o?.(E,l,r),E}case Gt:{var b=p,O=(S=b.conds.find(function(be){var K=St(be.cond,e.options.guards);return!K||bt(e,K,l,r,o?void 0:t)}))===null||S===void 0?void 0:S.actions;if(!O)return[];var k=N(De(e,t,l,r,[{type:m,actions:Q(X(O),e.options.actions)}],o,s),2),I=k[0],A=k[1];return l=A,u?.push(l),I}case zt:{var O=p.get(l,r.data);if(!O)return[];var L=N(De(e,t,l,r,[{type:m,actions:Q(X(O),e.options.actions)}],o,s),2),D=L[0],T=L[1];return l=T,u?.push(l),D}case Je:{var E=fi(p,l,r);return o?.(E,i,r),E}case gt:{l=at(l,r,[p],o?void 0:t),u?.push(l);break}default:var R=Ee(p,e.options.actions),$=R.exec;if(o)o(R,l,r);else if($&&u){var Y=u.length-1,de=v(v({},R),{exec:function(be){for(var K=[],ee=1;ee<arguments.length;ee++)K[ee-1]=arguments[ee];$.apply(void 0,q([u[Y]],N(K),!1))}});R=de}return R}}function f(m){var p,S,g=[];try{for(var y=P(m.actions),E=y.next();!E.done;E=y.next()){var b=E.value,O=d(m.type,b);O&&(g=g.concat(O))}}catch(k){p={error:k}}finally{try{E&&!E.done&&(S=y.return)&&S.call(y)}finally{if(p)throw p.error}}return c.forEach(function(k){o(k,l,r)}),c.length=0,g}var h=U(n.map(f));return[h,l]}var ae=function(e,t){var i=t(e);return i};function Ct(e){var t;return t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}},t[Z]=function(){return this},t}function hi(e,t,i,r){var n,o=Lt(e.src),s=(n=t?.options.services)===null||n===void 0?void 0:n[o.type],a=e.data?ke(e.data,i,r):void 0,l=s?Ot(s,e.id,a):Ct(e.id);return l.meta=e,l}function Ot(e,t,i){var r=Ct(t);if(r.deferred=!0,fe(e)){var n=r.state=ae(void 0,function(){return(i?e.withContext(i):e).initialState});r.getSnapshot=function(){return n}}return r}function gi(e){try{return typeof e.send=="function"}catch{return!1}}function pi(e){return gi(e)&&"id"in e}function vi(e){var t;return v((t={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},t[Z]=function(){return this},t),e)}var Me=function(e){return e.type==="atomic"||e.type==="final"};function Tt(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function we(e){return Tt(e).filter(function(t){return t.type!=="history"})}function Pt(e){var t=[e];return Me(e)?t:t.concat(U(we(e).map(Pt)))}function ve(e,t){var i,r,n,o,s,a,l,u,c=new Set(e),d=We(c),f=new Set(t);try{for(var h=P(f),m=h.next();!m.done;m=h.next())for(var p=m.value,S=p.parent;S&&!f.has(S);)f.add(S),S=S.parent}catch(L){i={error:L}}finally{try{m&&!m.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}var g=We(f);try{for(var y=P(f),E=y.next();!E.done;E=y.next()){var p=E.value;if(p.type==="compound"&&(!g.get(p)||!g.get(p).length))d.get(p)?d.get(p).forEach(function(D){return f.add(D)}):p.initialStateNodes.forEach(function(D){return f.add(D)});else if(p.type==="parallel")try{for(var b=(s=void 0,P(we(p))),O=b.next();!O.done;O=b.next()){var k=O.value;f.has(k)||(f.add(k),d.get(k)?d.get(k).forEach(function(D){return f.add(D)}):k.initialStateNodes.forEach(function(D){return f.add(D)}))}}catch(D){s={error:D}}finally{try{O&&!O.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}}}catch(L){n={error:L}}finally{try{E&&!E.done&&(o=y.return)&&o.call(y)}finally{if(n)throw n.error}}try{for(var I=P(f),A=I.next();!A.done;A=I.next())for(var p=A.value,S=p.parent;S&&!f.has(S);)f.add(S),S=S.parent}catch(L){l={error:L}}finally{try{A&&!A.done&&(u=I.return)&&u.call(I)}finally{if(l)throw l.error}}return f}function It(e,t){var i=t.get(e);if(!i)return{};if(e.type==="compound"){var r=i[0];if(r){if(Me(r))return r.key}else return{}}var n={};return i.forEach(function(o){n[o.key]=It(o,t)}),n}function We(e){var t,i,r=new Map;try{for(var n=P(e),o=n.next();!o.done;o=n.next()){var s=o.value;r.has(s)||r.set(s,[]),s.parent&&(r.has(s.parent)||r.set(s.parent,[]),r.get(s.parent).push(s))}}catch(a){t={error:a}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return r}function mi(e,t){var i=ve([e],t);return It(e,We(i))}function me(e,t){return Array.isArray(e)?e.some(function(i){return i===t}):e instanceof Set?e.has(t):!1}function yi(e){return q([],N(new Set(U(q([],N(e.map(function(t){return t.ownEvents})),!1)))),!1)}function Ae(e,t){return t.type==="compound"?we(t).some(function(i){return i.type==="final"&&me(e,i)}):t.type==="parallel"?we(t).every(function(i){return Ae(e,i)}):!1}function Ei(e){return e===void 0&&(e=[]),e.reduce(function(t,i){return i.meta!==void 0&&(t[i.id]=i.meta),t},{})}function lt(e){return new Set(U(e.map(function(t){return t.tags})))}function Nt(e,t){if(e===t)return!0;if(e===void 0||t===void 0)return!1;if(_(e)||_(t))return e===t;var i=Object.keys(e),r=Object.keys(t);return i.length===r.length&&i.every(function(n){return Nt(e[n],t[n])})}function wi(e){return typeof e!="object"||e===null?!1:"value"in e&&"_event"in e}function Si(e,t){var i=e.exec,r=v(v({},e),{exec:i!==void 0?function(){return i(t.context,t.event,{action:e,state:t,_event:t._event})}:void 0});return r}var J=function(){function e(t){var i=this,r;this.actions=[],this.activities=nt,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||nt,this.meta=Ei(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(r=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&r!==void 0?r:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return yi(i.configuration)}})}return e.from=function(t,i){if(t instanceof e)return t.context!==i?new e({value:t.value,context:i,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,events:[],configuration:[],transitions:[],children:{}}):t;var r=le;return new e({value:t,context:i,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,i){if(t instanceof e){if(!t.actions.length)return t;var r=le;return new e({value:t.value,context:i,_event:r,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,i)},e.prototype.toStrings=function(t,i){var r=this;if(t===void 0&&(t=this.value),i===void 0&&(i="."),_(t))return[t];var n=Object.keys(t);return n.concat.apply(n,q([],N(n.map(function(o){return r.toStrings(t[o],i).map(function(s){return o+i+s})})),!1))},e.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var i=t.tags;t.machine;var r=Ke(t,["configuration","transitions","tags","machine"]);return v(v({},r),{tags:Array.from(i)})},e.prototype.matches=function(t){return Ze(t,this.value)},e.prototype.hasTag=function(t){return this.tags.has(t)},e.prototype.can=function(t){var i;Zt(!!this.machine);var r=(i=this.machine)===null||i===void 0?void 0:i.getTransitionData(this,t);return!!r?.transitions.length&&r.transitions.some(function(n){return n.target!==void 0||n.actions.length})},e}(),bi={deferEvents:!1},ut=function(){function e(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=v(v({},bi),t)}return e.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},e.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},e.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(i){throw this.clear(),i}finally{this.processingEvent=!1}},e}(),Be=new Map,Li=0,he={bookId:function(){return"x:".concat(Li++)},register:function(e,t){return Be.set(e,t),e},get:function(e){return Be.get(e)},free:function(e){Be.delete(e)}};function et(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Ci(){var e=et();if(e&&"__xstate__"in e)return e.__xstate__}function Oi(e){if(et()){var t=Ci();t&&t.register(e)}}function Ti(e,t){t===void 0&&(t={});var i=e.initialState,r=new Set,n=[],o=!1,s=function(){if(!o){for(o=!0;n.length>0;){var u=n.shift();i=e.transition(i,u,l),r.forEach(function(c){return c.next(i)})}o=!1}},a=vi({id:t.id,send:function(u){n.push(u),s()},getSnapshot:function(){return i},subscribe:function(u,c,d){var f=Ne(u,c,d);return r.add(f),f.next(i),{unsubscribe:function(){r.delete(f)}}}}),l={parent:t.parent,self:a,id:t.id||"anonymous",observers:r};return i=e.start?e.start(l):i,a}var Pi={sync:!1,autoForward:!1},G;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})(G||(G={}));var Ii=function(){function e(t,i){i===void 0&&(i=e.defaultOptions);var r=this;this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=G.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(c,d){if(ce(c))return r.batch(c),r.state;var f=z(qe(c,d));if(r.status===G.Stopped)return r.state;if(r.status!==G.Running&&!r.options.deferEvents)throw new Error('Event "'.concat(f.name,'" was sent to uninitialized service "').concat(r.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(f.data)));return r.scheduler.schedule(function(){r.forward(f);var h=r._nextState(f);r.update(h,f)}),r._state},this.sendTo=function(c,d,f){var h=r.parent&&(d===ue.Parent||r.parent.id===d),m=h?r.parent:_(d)?d===ue.Internal?r:r.children.get(d)||he.get(d):ei(d)?d:void 0;if(!m){if(!h)throw new Error("Unable to send event to child '".concat(d,"' from service '").concat(r.id,"'."));return}if("machine"in m){if(r.status!==G.Stopped||r.parent!==m||r.state.done){var p=v(v({},c),{name:c.name===xt?"".concat(pe(r.id)):c.name,origin:r.sessionId});!f&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([m,p]):m.send(p)}}else!f&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([m,c.data]):m.send(c.data)},this._exec=function(c,d,f,h){h===void 0&&(h=r.machine.options.actions);var m=c.exec||He(c.type,h),p=F(m)?m:m?m.exec:c.exec;if(p)try{return p(d,f.data,r.machine.config.predictableActionArguments?{action:c,_event:f}:{action:c,state:r.state,_event:f})}catch(Y){throw r.parent&&r.parent.send({type:"xstate.error",data:Y}),Y}switch(c.type){case Se:{var S=c;r.defer(S);break}case je:var g=c;if(typeof g.delay=="number"){r.defer(g);return}else g.to?r.sendTo(g._event,g.to,f===le):r.send(g._event);break;case ht:r.cancel(c.sendId);break;case Ge:{if(r.status!==G.Running)return;var y=c.activity;if(!r.machine.config.predictableActionArguments&&!r.state.activities[y.id||y.type])break;if(y.type===j.Invoke){var E=Lt(y.src),b=r.machine.options.services?r.machine.options.services[E.type]:void 0,O=y.id,k=y.data,I="autoForward"in y?y.autoForward:!!y.forward;if(!b)return;var A=k?ke(k,d,f):void 0;if(typeof b=="string")return;var L=F(b)?b(d,f.data,{data:A,src:E,meta:y.meta}):b;if(!L)return;var D=void 0;fe(L)&&(L=A?L.withContext(A):L,D={autoForward:I}),r.spawn(L,O,D)}else r.spawnActivity(y);break}case Je:{r.stopChild(c.activity.id);break}case pt:var T=c,R=T.label,$=T.value;R?r.logger(R,$):r.logger($);break}};var n=v(v({},e.defaultOptions),i),o=n.clock,s=n.logger,a=n.parent,l=n.id,u=l!==void 0?l:t.id;this.id=u,this.logger=s,this.clock=o,this.parent=a,this.options=n,this.scheduler=new ut({deferEvents:this.options.deferEvents}),this.sessionId=he.bookId()}return Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:ae(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.execute=function(t,i){var r,n;try{for(var o=P(t.actions),s=o.next();!s.done;s=o.next()){var a=s.value;this.exec(a,t,i)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},e.prototype.update=function(t,i){var r,n,o,s,a,l,u,c,d=this;if(t._sessionid=this.sessionId,this._state=t,(!this.machine.config.predictableActionArguments||i===le)&&this.options.execute)this.execute(this.state);else for(var f=void 0;f=this._outgoingQueue.shift();)f[0].send(f[1]);if(this.children.forEach(function(L){d.state.children[L.id]=L}),this.devTools&&this.devTools.send(i.data,t),t.event)try{for(var h=P(this.eventListeners),m=h.next();!m.done;m=h.next()){var p=m.value;p(t.event)}}catch(L){r={error:L}}finally{try{m&&!m.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}try{for(var S=P(this.listeners),g=S.next();!g.done;g=S.next()){var p=g.value;p(t,t.event)}}catch(L){o={error:L}}finally{try{g&&!g.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}try{for(var y=P(this.contextListeners),E=y.next();!E.done;E=y.next()){var b=E.value;b(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(L){a={error:L}}finally{try{E&&!E.done&&(l=y.return)&&l.call(y)}finally{if(a)throw a.error}}if(this.state.done){var O=t.configuration.find(function(L){return L.type==="final"&&L.parent===d.machine}),k=O&&O.doneData?ke(O.doneData,t.context,i):void 0;this._doneEvent=Fe(this.id,k);try{for(var I=P(this.doneListeners),A=I.next();!A.done;A=I.next()){var p=A.value;p(this._doneEvent)}}catch(L){u={error:L}}finally{try{A&&!A.done&&(c=I.return)&&c.call(I)}finally{if(u)throw u.error}}this._stop(),this._stopChildren(),he.free(this.sessionId)}},e.prototype.onTransition=function(t){return this.listeners.add(t),this.status===G.Running&&t(this.state,this.state.event),this},e.prototype.subscribe=function(t,i,r){var n=this,o=Ne(t,i,r);this.listeners.add(o.next),this.status!==G.NotStarted&&o.next(this.state);var s=function(){n.doneListeners.delete(s),n.stopListeners.delete(s),o.complete()};return this.status===G.Stopped?o.complete():(this.onDone(s),this.onStop(s)),{unsubscribe:function(){n.listeners.delete(o.next),n.doneListeners.delete(s),n.stopListeners.delete(s)}}},e.prototype.onEvent=function(t){return this.eventListeners.add(t),this},e.prototype.onSend=function(t){return this.sendListeners.add(t),this},e.prototype.onChange=function(t){return this.contextListeners.add(t),this},e.prototype.onStop=function(t){return this.stopListeners.add(t),this},e.prototype.onDone=function(t){return this.status===G.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},e.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},e.prototype.start=function(t){var i=this;if(this.status===G.Running)return this;this.machine._init(),he.register(this.sessionId,this),this.initialized=!0,this.status=G.Running;var r=t===void 0?this.initialState:ae(this,function(){return wi(t)?i.machine.resolveState(t):i.machine.resolveState(J.from(t,i.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){i.update(r,le)}),this},e.prototype._stopChildren=function(){this.children.forEach(function(t){F(t.stop)&&t.stop()}),this.children.clear()},e.prototype._stop=function(){var t,i,r,n,o,s,a,l,u,c;try{for(var d=P(this.listeners),f=d.next();!f.done;f=d.next()){var h=f.value;this.listeners.delete(h)}}catch(I){t={error:I}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(t)throw t.error}}try{for(var m=P(this.stopListeners),p=m.next();!p.done;p=m.next()){var h=p.value;h(),this.stopListeners.delete(h)}}catch(I){r={error:I}}finally{try{p&&!p.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}try{for(var S=P(this.contextListeners),g=S.next();!g.done;g=S.next()){var h=g.value;this.contextListeners.delete(h)}}catch(I){o={error:I}}finally{try{g&&!g.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}try{for(var y=P(this.doneListeners),E=y.next();!E.done;E=y.next()){var h=E.value;this.doneListeners.delete(h)}}catch(I){a={error:I}}finally{try{E&&!E.done&&(l=y.return)&&l.call(y)}finally{if(a)throw a.error}}if(!this.initialized)return this;this.initialized=!1,this.status=G.Stopped,this._initialState=void 0;try{for(var b=P(Object.keys(this.delayedEventsMap)),O=b.next();!O.done;O=b.next()){var k=O.value;this.clock.clearTimeout(this.delayedEventsMap[k])}}catch(I){u={error:I}}finally{try{O&&!O.done&&(c=b.return)&&c.call(b)}finally{if(u)throw u.error}}this.scheduler.clear(),this.scheduler=new ut({deferEvents:this.options.deferEvents})},e.prototype.stop=function(){var t=this,i=this.scheduler;return this._stop(),i.schedule(function(){var r;if(!(!((r=t._state)===null||r===void 0)&&r.done)){var n=z({type:"xstate.stop"}),o=ae(t,function(){var s=U(q([],N(t.state.configuration),!1).sort(function(d,f){return f.order-d.order}).map(function(d){return Q(d.onExit,t.machine.options.actions)})),a=N(De(t.machine,t.state,t.state.context,n,[{type:"exit",actions:s}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),l=a[0],u=a[1],c=new J({value:t.state.value,context:u,_event:n,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:l.filter(function(d){return!Ye(d)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return c.changed=!0,c});t.update(o,n),t._stopChildren(),he.free(t.sessionId)}}),this},e.prototype.batch=function(t){var i=this;if(!(this.status===G.NotStarted&&this.options.deferEvents)){if(this.status!==G.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}if(t.length){var r=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var n,o,s=i.state,a=!1,l=[],u=function(h){var m=z(h);i.forward(m),s=ae(i,function(){return i.machine.transition(s,m,void 0,r||void 0)}),l.push.apply(l,q([],N(i.machine.config.predictableActionArguments?s.actions:s.actions.map(function(p){return Si(p,s)})),!1)),a=a||!!s.changed};try{for(var c=P(t),d=c.next();!d.done;d=c.next()){var f=d.value;u(f)}}catch(h){n={error:h}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}s.changed=a,s.actions=l,i.update(s,z(t[t.length-1]))})}},e.prototype.sender=function(t){return this.send.bind(this,t)},e.prototype._nextState=function(t,i){var r=this;i===void 0&&(i=!!this.machine.config.predictableActionArguments&&this._exec);var n=z(t);if(n.name.indexOf(rt)===0&&!this.state.nextEvents.some(function(s){return s.indexOf(rt)===0}))throw n.data.data;var o=ae(this,function(){return r.machine.transition(r.state,n,void 0,i||void 0)});return o},e.prototype.nextState=function(t){return this._nextState(t,!1)},e.prototype.forward=function(t){var i,r;try{for(var n=P(this.forwardTo),o=n.next();!o.done;o=n.next()){var s=o.value,a=this.children.get(s);if(!a)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(s,"'."));a.send(t)}}catch(l){i={error:l}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.defer=function(t){var i=this,r=this.clock.setTimeout(function(){"to"in t&&t.to?i.sendTo(t._event,t.to,!0):i.send(t._event)},t.delay);t.id&&(this.delayedEventsMap[t.id]=r)},e.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},e.prototype.exec=function(t,i,r){r===void 0&&(r=this.machine.options.actions),this._exec(t,i.context,i._event,r)},e.prototype.removeChild=function(t){var i;this.children.delete(t),this.forwardTo.delete(t),(i=this.state)===null||i===void 0||delete i.children[t]},e.prototype.stopChild=function(t){var i=this.children.get(t);i&&(this.removeChild(t),F(i.stop)&&i.stop())},e.prototype.spawn=function(t,i,r){if(this.status!==G.Running)return Ot(t,i);if(st(t))return this.spawnPromise(Promise.resolve(t),i);if(F(t))return this.spawnCallback(t,i);if(pi(t))return this.spawnActor(t,i);if(Qt(t))return this.spawnObservable(t,i);if(fe(t))return this.spawnMachine(t,v(v({},r),{id:i}));if(Xt(t))return this.spawnBehavior(t,i);throw new Error('Unable to spawn entity "'.concat(i,'" of type "').concat(typeof t,'".'))},e.prototype.spawnMachine=function(t,i){var r=this;i===void 0&&(i={});var n=new e(t,v(v({},this.options),{parent:this,id:i.id||t.id})),o=v(v({},Pi),i);o.sync&&n.onTransition(function(a){r.send(vt,{state:a,id:n.id})});var s=n;return this.children.set(n.id,s),o.autoForward&&this.forwardTo.add(n.id),n.onDone(function(a){r.removeChild(n.id),r.send(z(a,{origin:n.id}))}).start(),s},e.prototype.spawnBehavior=function(t,i){var r=Ti(t,{id:i,parent:this});return this.children.set(i,r),r},e.prototype.spawnPromise=function(t,i){var r,n=this,o=!1,s;t.then(function(l){o||(s=l,n.removeChild(i),n.send(z(Fe(i,l),{origin:i})))},function(l){if(!o){n.removeChild(i);var u=pe(i,l);try{n.send(z(u,{origin:i}))}catch{n.devTools&&n.devTools.send(u,n.state),n.machine.strict&&n.stop()}}});var a=(r={id:i,send:function(){},subscribe:function(l,u,c){var d=Ne(l,u,c),f=!1;return t.then(function(h){f||(d.next(h),!f&&d.complete())},function(h){f||d.error(h)}),{unsubscribe:function(){return f=!0}}},stop:function(){o=!0},toJSON:function(){return{id:i}},getSnapshot:function(){return s}},r[Z]=function(){return this},r);return this.children.set(i,a),a},e.prototype.spawnCallback=function(t,i){var r,n=this,o=!1,s=new Set,a=new Set,l,u=function(f){l=f,a.forEach(function(h){return h(f)}),!o&&n.send(z(f,{origin:i}))},c;try{c=t(u,function(f){s.add(f)})}catch(f){this.send(pe(i,f))}if(st(c))return this.spawnPromise(c,i);var d=(r={id:i,send:function(f){return s.forEach(function(h){return h(f)})},subscribe:function(f){var h=Ne(f);return a.add(h.next),{unsubscribe:function(){a.delete(h.next)}}},stop:function(){o=!0,F(c)&&c()},toJSON:function(){return{id:i}},getSnapshot:function(){return l}},r[Z]=function(){return this},r);return this.children.set(i,d),d},e.prototype.spawnObservable=function(t,i){var r,n=this,o,s=t.subscribe(function(l){o=l,n.send(z(l,{origin:i}))},function(l){n.removeChild(i),n.send(z(pe(i,l),{origin:i}))},function(){n.removeChild(i),n.send(z(Fe(i),{origin:i}))}),a=(r={id:i,send:function(){},subscribe:function(l,u,c){return t.subscribe(l,u,c)},stop:function(){return s.unsubscribe()},getSnapshot:function(){return o},toJSON:function(){return{id:i}}},r[Z]=function(){return this},r);return this.children.set(i,a),a},e.prototype.spawnActor=function(t,i){return this.children.set(i,t),t},e.prototype.spawnActivity=function(t){var i=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(i){var r=i(this.state.context,t);this.spawnEffect(t.id,r)}},e.prototype.spawnEffect=function(t,i){var r;this.children.set(t,(r={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:i||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}},r[Z]=function(){return this},r))},e.prototype.attachDev=function(){var t=et();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var i=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(v(v({name:this.id,autoPause:!0,stateSanitizer:function(r){return{value:r.value,context:r.context,actions:r.actions}}},i),{features:v({jump:!1,skip:!1},i?i.features:void 0)}),this.machine),this.devTools.init(this.state)}Oi(this)}},e.prototype.toJSON=function(){return{id:this.id}},e.prototype[Z]=function(){return this},e.prototype.getSnapshot=function(){return this.status===G.NotStarted?this.initialState:this._state},e.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,i){return setTimeout(t,i)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},e.interpret=Ft,e}();function Ft(e,t){var i=new Ii(e,t);return i}function Ni(e){if(typeof e=="string"){var t={type:e};return t.toString=function(){return e},t}return e}function Te(e){return v(v({type:ze},e),{toJSON:function(){e.onDone,e.onError;var t=Ke(e,["onDone","onError"]);return v(v({},t),{type:ze,src:Ni(e.src)})}})}var Pe="",Xe="#",xe="*",oe={},se=function(e){return e[0]===Xe},Fi=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Ai=function(){function e(t,i,r,n){r===void 0&&(r="context"in t?t.context:void 0);var o=this,s;this.config=t,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Fi(),i),this.parent=n?.parent,this.key=this.config.key||n?.key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:mt),this.id=this.config.id||q([this.machine.key],N(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(s=this.config.schema)!==null&&s!==void 0?s:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?ge(this.config.states,function(u,c){var d,f=new e(u,{},void 0,{parent:o,key:c});return Object.assign(o.idMap,v((d={},d[f.id]=f,d),f.idMap)),f}):oe;var a=0;function l(u){var c,d;u.order=a++;try{for(var f=P(Tt(u)),h=f.next();!h.done;h=f.next()){var m=h.value;l(m)}}catch(p){c={error:p}}finally{try{h&&!h.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}}l(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(u){var c=u.event;return c===Pe}):Pe in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=X(this.config.entry||this.config.onEntry).map(function(u){return Ee(u)}),this.onExit=X(this.config.exit||this.config.onExit).map(function(u){return Ee(u)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=X(this.config.invoke).map(function(u,c){var d,f;if(fe(u)){var h=Ce(o.id,c);return o.machine.options.services=v((d={},d[h]=u,d),o.machine.options.services),Te({src:h,id:h})}else if(_(u.src)){var h=u.id||Ce(o.id,c);return Te(v(v({},u),{id:h,src:u.src}))}else if(fe(u.src)||F(u.src)){var h=u.id||Ce(o.id,c);return o.machine.options.services=v((f={},f[h]=u.src,f),o.machine.options.services),Te(v(v({id:h},u),{src:h}))}else{var m=u.src;return Te(v(v({id:Ce(o.id,c)},u),{src:m}))}}),this.activities=X(this.config.activities).concat(this.invoke).map(function(u){return Qe(u)}),this.transition=this.transition.bind(this),this.tags=X(this.config.tags)}return e.prototype._init=function(){this.__cache.transitions||Pt(this).forEach(function(t){return t.on})},e.prototype.withConfig=function(t,i){var r=this.options,n=r.actions,o=r.activities,s=r.guards,a=r.services,l=r.delays;return new e(this.config,{actions:v(v({},n),t.actions),activities:v(v({},o),t.activities),guards:v(v({},s),t.guards),services:v(v({},a),t.services),delays:v(v({},l),t.delays)},i??this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return F(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ge(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(i,r){return i[r.eventType]=i[r.eventType]||[],i[r.eventType].push(r),i},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var i=t===Pe,r=this.transitions.filter(function(n){var o=n.eventType===t;return i?o:o||n.eventType===xe});return this.__cache.candidates[t]=r,r},e.prototype.getDelayedTransitions=function(){var t=this,i=this.config.after;if(!i)return[];var r=function(o,s){var a=F(o)?"".concat(t.id,":delay[").concat(s,"]"):o,l=ci(a,t.id);return t.onEntry.push(ni(l,{delay:o})),t.onExit.push(ai(l)),l},n=ce(i)?i.map(function(o,s){var a=r(o.delay,s);return v(v({},o),{event:a})}):U(Object.keys(i).map(function(o,s){var a=i[o],l=_(a)?{target:a}:a,u=isNaN(+o)?o:+o,c=r(u,s);return X(l).map(function(d){return v(v({},d),{event:c,delay:u})})}));return n.map(function(o){var s=o.delay;return v(v({},t.formatTransition(o)),{delay:s})})},e.prototype.getStateNodes=function(t){var i,r=this;if(!t)return[];var n=t instanceof J?t.value:ye(t,this.delimiter);if(_(n)){var o=this.getStateNode(n).initial;return o!==void 0?this.getStateNodes((i={},i[n]=o,i)):[this,this.states[n]]}var s=Object.keys(n),a=[this];return a.push.apply(a,q([],N(U(s.map(function(l){return r.getStateNode(l).getStateNodes(n[l])}))),!1)),a},e.prototype.handles=function(t){var i=yt(t);return this.events.includes(i)},e.prototype.resolveState=function(t){var i=t instanceof J?t:J.create(t),r=Array.from(ve([],this.getStateNodes(i.value)));return new J(v(v({},i),{value:this.resolve(i.value),configuration:r,done:Ae(r,this),tags:lt(r),machine:this.machine}))},e.prototype.transitionLeafNode=function(t,i,r){var n=this.getStateNode(t),o=n.next(i,r);return!o||!o.transitions.length?this.next(i,r):o},e.prototype.transitionCompoundNode=function(t,i,r){var n=Object.keys(t),o=this.getStateNode(n[0]),s=o._transition(t[n[0]],i,r);return!s||!s.transitions.length?this.next(i,r):s},e.prototype.transitionParallelNode=function(t,i,r){var n,o,s={};try{for(var a=P(Object.keys(t)),l=a.next();!l.done;l=a.next()){var u=l.value,c=t[u];if(c){var d=this.getStateNode(u),f=d._transition(c,i,r);f&&(s[u]=f)}}}catch(g){n={error:g}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}var h=Object.keys(s).map(function(g){return s[g]}),m=U(h.map(function(g){return g.transitions})),p=h.some(function(g){return g.transitions.length>0});if(!p)return this.next(i,r);var S=U(Object.keys(s).map(function(g){return s[g].configuration}));return{transitions:m,exitSet:U(h.map(function(g){return g.exitSet})),configuration:S,source:i,actions:U(Object.keys(s).map(function(g){return s[g].actions}))}},e.prototype._transition=function(t,i,r){return _(t)?this.transitionLeafNode(t,i,r):Object.keys(t).length===1?this.transitionCompoundNode(t,i,r):this.transitionParallelNode(t,i,r)},e.prototype.getTransitionData=function(t,i){return this._transition(t.value,t,z(i))},e.prototype.next=function(t,i){var r,n,o=this,s=i.name,a=[],l=[],u;try{for(var c=P(this.getCandidates(s)),d=c.next();!d.done;d=c.next()){var f=d.value,h=f.cond,m=f.in,p=t.context,S=m?_(m)&&se(m)?t.matches(ye(this.getStateNodeById(m).path,this.delimiter)):Ze(ye(m,this.delimiter),Yt(this.path.slice(0,-2))(t.value)):!0,g=!1;try{g=!h||bt(this.machine,h,p,i,t)}catch(b){throw new Error("Unable to evaluate guard '".concat(h.name||h.type,"' in transition for event '").concat(s,"' in state node '").concat(this.id,`':
`).concat(b.message))}if(g&&S){f.target!==void 0&&(l=f.target),a.push.apply(a,q([],N(f.actions),!1)),u=f;break}}}catch(b){r={error:b}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}if(u){if(!l.length)return{transitions:[u],exitSet:[],configuration:t.value?[this]:[],source:t,actions:a};var y=U(l.map(function(b){return o.getRelativeStateNodes(b,t.historyValue)})),E=!!u.internal;return{transitions:[u],exitSet:E?[]:U(l.map(function(b){return o.getPotentiallyReenteringNodes(b)})),configuration:y,source:t,actions:a}}},e.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var i=[],r=this,n=t;r&&r!==n;)i.push(r),r=r.parent;return r!==n?[]:(i.push(n),i)},e.prototype.getActions=function(t,i,r,n,o,s,a){var l,u,c,d,f=this,h=s?ve([],this.getStateNodes(s.value)):[],m=new Set;try{for(var p=P(Array.from(t).sort(function(T,R){return T.order-R.order})),S=p.next();!S.done;S=p.next()){var g=S.value;(!me(h,g)||me(r.exitSet,g)||g.parent&&m.has(g.parent))&&m.add(g)}}catch(T){l={error:T}}finally{try{S&&!S.done&&(u=p.return)&&u.call(p)}finally{if(l)throw l.error}}try{for(var y=P(h),E=y.next();!E.done;E=y.next()){var g=E.value;(!me(t,g)||me(r.exitSet,g.parent))&&r.exitSet.push(g)}}catch(T){c={error:T}}finally{try{E&&!E.done&&(d=y.return)&&d.call(y)}finally{if(c)throw c.error}}r.exitSet.sort(function(T,R){return R.order-T.order});var b=Array.from(m).sort(function(T,R){return T.order-R.order}),O=new Set(r.exitSet),k=U(b.map(function(T){var R=[];if(T.type!=="final")return R;var $=T.parent;if(!$.parent)return R;R.push(Oe(T.id,T.doneData),Oe($.id,T.doneData?ke(T.doneData,n,o):void 0));var Y=$.parent;return Y.type==="parallel"&&we(Y).every(function(de){return Ae(r.configuration,de)})&&R.push(Oe(Y.id)),R})),I=b.map(function(T){var R=T.onEntry,$=T.activities.map(function(Y){return li(Y)});return{type:"entry",actions:Q(a?q(q([],N(R),!1),N($),!1):q(q([],N($),!1),N(R),!1),f.machine.options.actions)}}).concat({type:"state_done",actions:k.map(function(T){return ii(T)})}),A=Array.from(O).map(function(T){return{type:"exit",actions:Q(q(q([],N(T.onExit),!1),N(T.activities.map(function(R){return ui(R)})),!1),f.machine.options.actions)}}),L=A.concat({type:"transition",actions:Q(r.actions,this.machine.options.actions)}).concat(I);if(i){var D=Q(U(q([],N(t),!1).sort(function(T,R){return R.order-T.order}).map(function(T){return T.onExit})),this.machine.options.actions).filter(function(T){return!Ye(T)});return L.concat({type:"stop",actions:D})}return L},e.prototype.transition=function(t,i,r,n){t===void 0&&(t=this.initialState);var o=z(i),s;if(t instanceof J)s=r===void 0?t:this.resolveState(J.from(t,r));else{var a=_(t)?this.resolve(_e(this.getResolvedPath(t))):this.resolve(t),l=r??this.machine.context;s=this.resolveState(J.from(a,l))}if(this.strict&&!this.events.includes(o.name)&&!Wt(o.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(o.name,"'"));var u=this._transition(s.value,s,o)||{transitions:[],configuration:[],exitSet:[],source:s,actions:[]},c=ve([],this.getStateNodes(s.value)),d=u.configuration.length?ve(c,u.configuration):c;return u.configuration=q([],N(d),!1),this.resolveTransition(u,s,s.context,n,o)},e.prototype.resolveRaisedTransition=function(t,i,r,n){var o,s=t.actions;return t=this.transition(t,i,void 0,n),t._event=r,t.event=r.data,(o=t.actions).unshift.apply(o,q([],N(s),!1)),t},e.prototype.resolveTransition=function(t,i,r,n,o){var s,a,l,u,c=this;o===void 0&&(o=le);var d=t.configuration,f=!i||t.transitions.length>0,h=f?t.configuration:i?i.configuration:[],m=Ae(h,this),p=f?mi(this.machine,d):void 0,S=i?i.historyValue?i.historyValue:t.source?this.machine.historyValue(i.value):void 0:void 0,g=this.getActions(new Set(h),m,t,r,o,i,n),y=i?v({},i.activities):{};try{for(var E=P(g),b=E.next();!b.done;b=E.next()){var O=b.value;try{for(var k=(l=void 0,P(O.actions)),I=k.next();!I.done;I=k.next()){var A=I.value;A.type===Ge?y[A.activity.id||A.activity.type]=A:A.type===Je&&(y[A.activity.id||A.activity.type]=!1)}}catch(W){l={error:W}}finally{try{I&&!I.done&&(u=k.return)&&u.call(k)}finally{if(l)throw l.error}}}}catch(W){s={error:W}}finally{try{b&&!b.done&&(a=E.return)&&a.call(E)}finally{if(s)throw s.error}}var L=N(De(this,i,r,o,g,n,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),D=L[0],T=L[1],R=N(Kt(D,Ye),2),$=R[0],Y=R[1],de=D.filter(function(W){var ie;return W.type===Ge&&((ie=W.activity)===null||ie===void 0?void 0:ie.type)===ze}),be=de.reduce(function(W,ie){return W[ie.activity.id]=hi(ie.activity,c.machine,T,o),W},i?v({},i.children):{}),K=new J({value:p||i.value,context:T,_event:o,_sessionid:i?i._sessionid:null,historyValue:p?S?Jt(S,p):void 0:i?i.historyValue:void 0,history:!p||t.source?i:void 0,actions:p?Y:[],activities:p?y:i?i.activities:{},events:[],configuration:h,transitions:t.transitions,children:be,done:m,tags:lt(h),machine:this}),ee=r!==T;K.changed=o.name===vt||ee;var te=K.history;te&&delete te.history;var tt=!m&&(this._transient||d.some(function(W){return W._transient}));if(!f&&(!tt||o.name===Pe))return K;var H=K;if(!m)for(tt&&(H=this.resolveRaisedTransition(H,{type:Ut},o,n));$.length;){var At=$.shift();H=this.resolveRaisedTransition(H,At._event,o,n)}var Rt=H.changed||(te?!!H.actions.length||ee||typeof te.value!=typeof H.value||!Nt(H.value,te.value):void 0);return H.changed=Rt,H.history=te,H},e.prototype.getStateNode=function(t){if(se(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var i=this.states[t];if(!i)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return i},e.prototype.getStateNodeById=function(t){var i=se(t)?t.slice(Xe.length):t;if(i===this.id)return this;var r=this.machine.idMap[i];if(!r)throw new Error("Child state node '#".concat(i,"' does not exist on machine '").concat(this.id,"'"));return r},e.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&se(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var i=Ve(t,this.delimiter).slice(),r=this;i.length;){var n=i.shift();if(!n.length)break;r=r.getStateNode(n)}return r},e.prototype.resolve=function(t){var i,r=this;if(!t)return this.initialStateValue||oe;switch(this.type){case"parallel":return ge(this.initialStateValue,function(o,s){return o?r.getStateNode(s).resolve(t[s]||o):oe});case"compound":if(_(t)){var n=this.getStateNode(t);return n.type==="parallel"||n.type==="compound"?(i={},i[t]=n.initialStateValue,i):t}return Object.keys(t).length?ge(t,function(o,s){return o?r.getStateNode(s).resolve(o):oe}):this.initialStateValue||{};default:return t||oe}},e.prototype.getResolvedPath=function(t){if(se(t)){var i=this.machine.idMap[t.slice(Xe.length)];if(!i)throw new Error("Unable to find state node '".concat(t,"'"));return i.path}return Ve(t,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var i;if(this.type==="parallel")i=ot(this.states,function(r){return r.initialStateValue||oe},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));i=Me(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else i={};return this.__cache.initialStateValue=i,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(t,i){this._init();var r=this.getStateNodes(t);return this.resolveTransition({configuration:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,i??this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;if(this.type==="history"){var i=this.config;_(i.target)?t=se(i.target)?_e(this.machine.getStateNodeById(i.target).path.slice(this.path.length-1)):i.target:t=i.target}return t},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(t,i,r){return r===void 0&&(r=!0),r?t.type==="history"?t.resolveHistory(i):t.initialStateNodes:[t]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var t=this;if(Me(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var i=Ie(this.initialStateValue);return U(i.map(function(r){return t.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var i=N(t),r=i[0],n=i.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var o=this.getStateNode(r);if(o.type==="history")return o.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(n)},e.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:ot(this.states,function(i,r){if(!t)return i.historyValue();var n=_(t)?void 0:t[r];return i.historyValue(n||i.initialStateValue)},function(i){return!i.history})}},e.prototype.resolveHistory=function(t){var i=this;if(this.type!=="history")return[this];var r=this.parent;if(!t){var n=this.target;return n?U(Ie(n).map(function(s){return r.getFromRelativePath(s)})):r.initialStateNodes}var o=Ht(r.path,"states")(t).current;return _(o)?[r.getStateNode(o)]:U(Ie(o).map(function(s){return i.history==="deep"?r.getFromRelativePath(s):[r.states[s[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var t=this,i=U(Object.keys(this.states).map(function(r){return t.states[r].stateIds}));return[this.id].concat(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){var t,i,r,n;if(this.__cache.events)return this.__cache.events;var o=this.states,s=new Set(this.ownEvents);if(o)try{for(var a=P(Object.keys(o)),l=a.next();!l.done;l=a.next()){var u=l.value,c=o[u];if(c.states)try{for(var d=(r=void 0,P(c.events)),f=d.next();!f.done;f=d.next()){var h=f.value;s.add("".concat(h))}}catch(m){r={error:m}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}}catch(m){t={error:m}}finally{try{l&&!l.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(s)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(i){return!(!i.target&&!i.actions.length&&i.internal)}).map(function(i){return i.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(t){var i=this;if(t!==void 0)return t.map(function(r){if(!_(r))return r;var n=r[0]===i.delimiter;if(n&&!i.parent)return i.getStateNodeByPath(r.slice(1));var o=n?i.key+r:r;if(i.parent)try{var s=i.parent.getStateNodeByPath(o);return s}catch(a){throw new Error("Invalid transition definition for state node '".concat(i.id,`':
`).concat(a.message))}else return i.getStateNodeByPath(o)})},e.prototype.formatTransition=function(t){var i=this,r=ti(t.target),n="internal"in t?t.internal:r?r.some(function(l){return _(l)&&l[0]===i.delimiter}):!0,o=this.machine.options.guards,s=this.resolveTarget(r),a=v(v({},t),{actions:Q(X(t.actions)),cond:St(t.cond,o),target:s,source:this,internal:n,eventType:t.event,toJSON:function(){return v(v({},a),{target:a.target?a.target.map(function(l){return"#".concat(l.id)}):void 0,source:"#".concat(i.id)})}});return a},e.prototype.formatTransitions=function(){var t,i,r=this,n;if(!this.config.on)n=[];else if(Array.isArray(this.config.on))n=this.config.on;else{var o=this.config.on,s=xe,a=o[s],l=a===void 0?[]:a,u=Ke(o,[typeof s=="symbol"?s:s+""]);n=U(Object.keys(u).map(function(y){var E=ne(y,u[y]);return E}).concat(ne(xe,l)))}var c=this.config.always?ne("",this.config.always):[],d=this.config.onDone?ne(String(Oe(this.id)),this.config.onDone):[],f=U(this.invoke.map(function(y){var E=[];return y.onDone&&E.push.apply(E,q([],N(ne(String(Fe(y.id)),y.onDone)),!1)),y.onError&&E.push.apply(E,q([],N(ne(String(pe(y.id)),y.onError)),!1)),E})),h=this.after,m=U(q(q(q(q([],N(d),!1),N(f),!1),N(n),!1),N(c),!1).map(function(y){return X(y).map(function(E){return r.formatTransition(E)})}));try{for(var p=P(h),S=p.next();!S.done;S=p.next()){var g=S.value;m.push(g)}}catch(y){t={error:y}}finally{try{S&&!S.done&&(i=p.return)&&i.call(p)}finally{if(t)throw t.error}}return m},e}();function Ri(e,t){return new Ai(e,t)}function ft(e){let t=document.querySelector("dialog");t?.remove(),t=document.createElement("dialog"),t.style.border="1px solid black",t.style.backgroundColor="white",t.style.padding="20px";const i=document.createElement("label");i.innerHTML="Rayon : ";const r=document.createElement("input");r.type="text",r.style.marginLeft="10px";const n=document.createElement("button");return n.innerHTML="Valider",n.style.marginLeft="10px",t.appendChild(i),t.appendChild(r),t.appendChild(n),document.body.appendChild(t),t.addEventListener("close",()=>{e.ui!=null&&(r.value.match(/[a-zA-Z]/)?e.ui.send("RADIUS",{radius:r.value}):e.ui.send("RADIUS",{radius:String(Number(r.value.replace(",",".")))}))}),n.addEventListener("click",()=>{t.close()}),r.addEventListener("keydown",o=>{o.key==="Enter"||o.key==="Escape"?(o.preventDefault(),t.close()):o.key==="."&&(o.preventDefault(),r.value+=",")}),t}function _i(e){const t=document.createElement("dialog");t.style.border="1px solid black",t.style.backgroundColor="white",t.style.padding="20px";const i=document.createElement("label");i.innerHTML="Coefficient de l'homothétie : ";const r=document.createElement("input");r.type="number",r.min="-10",r.max="10",r.value="2",r.style.marginLeft="10px";const n=document.createElement("button");return n.innerHTML="Valider",n.style.marginLeft="10px",t.appendChild(i),t.appendChild(r),t.appendChild(n),document.body.appendChild(t),t.addEventListener("close",()=>{e.ui!=null&&e.ui.send("DILATE_COEF",{coefficient:Number(r.value)})}),n.addEventListener("click",()=>{t.close()}),r.addEventListener("keyup",o=>{(o.key==="Enter"||o.key==="Escape")&&(o.preventDefault(),t.close())}),t}function ki(e){const t=document.createElement("dialog");t.style.border="1px solid black",t.style.backgroundColor="white",t.style.padding="20px";const i=document.createElement("label");i.innerHTML="Nom du point";const r=document.createElement("input");r.type="text",r.name="search",r.style.marginLeft="10px",r.setAttribute("autocomplete","off"),r.setAttribute("spellcheck","false"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","none");const n=document.createElement("button");return n.innerHTML="Valider",n.style.marginLeft="10px",t.appendChild(i),t.appendChild(r),t.appendChild(n),document.body.appendChild(t),t.addEventListener("close",()=>{e.ui!=null&&e.ui.send("TEXT_FROM_DIALOG",{text:r.value})}),n.addEventListener("click",()=>{t.close()}),r.addEventListener("keyup",o=>{(o.key==="Enter"||o.key==="Escape")&&(o.preventDefault(),t.close())}),t}function Di(e){const t=document.createElement("dialog");t.style.border="1px solid black",t.style.backgroundColor="white",t.style.padding="20px";const i=document.createElement("label");i.innerHTML="Angle (en degrés) : ";const r=document.createElement("input");r.type="number",r.style.marginLeft="10px",r.value="90";const n=document.createElement("select");n.style.marginLeft="10px",n.innerHTML='<option value="-1">Sens horaire</option><option value="1">Sens anti-horaire</option>';const o=document.createElement("button");return o.innerHTML="Valider",o.style.marginLeft="10px",t.appendChild(i),t.appendChild(r),t.appendChild(n),t.appendChild(o),document.body.appendChild(t),t.addEventListener("close",()=>{const s=Number(r.value)*Number.parseInt(n.value);e.ui!=null&&e.ui.send("ANGLE",{angle:s})}),o.addEventListener("click",()=>{t.close()}),r.addEventListener("keyup",s=>{(s.key==="Enter"||s.key==="Escape")&&(s.preventDefault(),t.close())}),t}function Mi(e){const t=document.createElement("dialog");return t.id="dialog",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="50%",t.style.height="90%",t.style.border="none",t.style.background="white",t.style.zIndex="100",t.appendChild(e.htmlDescription),_t(t,{delimiters:[{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"}],errorColor:"#CC0000",preProcess:i=>i.replaceAll(" ","\\,"),strict:"warn",throwOnError:!0,trust:!1}),t.addEventListener("click",()=>{t.close()}),document.body.appendChild(t),t.showModal(),t}function ji(e){const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.border="1px solid black",t.style.backgroundColor="rgba(0, 0, 0, 0.1)",t.style.pointerEvents="none",t.style.zIndex="1000";const i=document.createElement("button");i.style.position="absolute",i.style.border="1px solid black",i.style.pointerEvents="auto",i.style.zIndex="1001",i.innerHTML="SVG";const r=document.createElement("button");r.style.position="absolute",r.style.border="1px solid black",r.style.pointerEvents="auto",r.style.zIndex="1001",r.innerHTML="LaTeX",r.style.top="50px",r.style.right="10%",r.style.cursor="pointer",i.style.cursor="pointer",r.style.backgroundColor="white",i.style.backgroundColor="white",r.style.boxShadow="0px 0px 5px 0px rgba(0,0,0,0.75)",i.style.boxShadow="0px 0px 5px 0px rgba(0,0,0,0.75)";const n=e.divFigure,o=n.getBoundingClientRect(),s=o.left,a=o.top;n.appendChild(t),t.appendChild(i),t.appendChild(r),i.style.top="100px",i.style.right="10%",i.style.cursor="pointer",t.style.width=`${e.divFigure.clientWidth-100}px`,t.style.height=`${e.divFigure.clientHeight-200}px`;let l=!1,u=!1,c=!1,d=!1,f=!1,h=!1,m=!1,p=!1,S=!1;return window.addEventListener("mousemove",g=>{const y=t.getBoundingClientRect(),E=g.clientX,b=g.clientY;n.style.cursor="default",Math.abs(E-y.left)<10?(u=!0,n.style.cursor="ew-resize"):Math.abs(E-y.right)<10?(c=!0,n.style.cursor="ew-resize"):(u=!1,c=!1),Math.abs(b-y.top)<10?(d=!0,n.style.cursor="n-resize"):Math.abs(b-y.bottom)<10?(f=!0,n.style.cursor="s-resize"):(d=!1,f=!1),u&&d?(h=!0,n.style.cursor="nw-resize"):c&&d?(m=!0,n.style.cursor="ne-resize"):u&&f?(p=!0,n.style.cursor="sw-resize"):c&&f?(S=!0,n.style.cursor="se-resize"):(h=!1,m=!1,p=!1,S=!1),l=u||c||d||f||h||m||p||S}),window.addEventListener("pointerdown",()=>{if(l){const g=t.getBoundingClientRect(),y=g.width,E=g.height,b=g.left,O=g.top,k=A=>{const L=A.clientX-b,D=A.clientY-O;u?(t.style.left=`${b+L-s}px`,t.style.width=`${y-L}px`):c&&(t.style.width=`${L}px`),d?(t.style.top=`${O+D-a}px`,t.style.height=`${E-D}px`):f&&(t.style.height=`${D}px`),h?(t.style.left=`${b+L-s}px`,t.style.width=`${y-L}px`,t.style.top=`${O+D}px`,t.style.height=`${E-D}px`):m?(t.style.width=`${L}px`,t.style.top=`${O+D}px`,t.style.height=`${E-D}px`):p?(t.style.left=`${b+L-s}px`,t.style.width=`${y-L}px`,t.style.height=`${D}px`):S&&(t.style.width=`${L}px`,t.style.height=`${D}px`)},I=()=>{window.removeEventListener("pointermove",k),window.removeEventListener("pointerup",I)};window.addEventListener("pointermove",k),window.addEventListener("pointerup",I)}}),i.addEventListener("click",()=>{const g=t.getBoundingClientRect(),y=g.left-s,E=g.top-a,b=g.width,O=g.height;e.ui?.send("SELECTION_AREA_TO_SVG",{height:O,width:b,xMin:y,yMax:E})}),r.addEventListener("click",()=>{const g=t.getBoundingClientRect(),y=g.left-s,E=g.top-a,b=g.width,O=g.height;e.ui?.send("SELECTION_AREA_TO_LATEX",{height:O,width:b,xMin:y,yMax:E})}),t}const qi=Ri({context:{figure:{},temp:{elements:[],htmlElement:[],values:[]}},entry:["highlightButton","eraseTempElements","eraseUserMessage"],id:"apiGeomUI",initial:"INIT",on:{BISECTOR_BY_POINTS:"BISECTOR_BY_POINTS",CIRCLE_CENTER_POINT:"CIRCLE_CENTER_POINT",CIRCLE_RADIUS:"CIRCLE_RADIUS",COLOR:"COLOR",DESCRIPTION:"DESCRIPTION",DILATE:"DILATE",DISC_CENTER_POINT:"DISC_CENTER_POINT",DISC_RADIUS:"DISC_RADIUS",DOWNLOAD_LATEX_SVG:"DOWNLOAD_LATEX_SVG",DRAG:"DRAG",FILL:"FILL",GRID:"GRID",HIDE:"HIDE",INFORMATIONS:"INFORMATIONS",LATEX:"LATEX",LINE:"LINE",LINE_PARALLEL:"LINE_PARALLEL",LINE_PERPENDICULAR:"LINE_PERPENDICULAR",MARK_BETWEEN_POINTS:"MARK_BETWEEN_POINTS",MIDDLE:"MIDDLE",MOVE_LABEL:"MOVE_LABEL",NAME_POINT:"NAME_POINT",OPEN:"OPEN",PAUSE:"PAUSE",PERPENDICULAR_BISECTOR:"PERPENDICULAR_BISECTOR",PLAY:"PLAY",PLAY_SKIP_BACK:"PLAY_SKIP_BACK",PLAY_SKIP_FORWARD:"PLAY_SKIP_FORWARD",POINT:"POINT",POINT_INTERSECTION:"POINT_INTERSECTION",POINT_ON:"POINT_ON",POLYGON:"POLYGON",RAY:"RAY",REDO:"REDO",REFLECTION:"REFLECTION",REFLECTION_OVER_LINE:"REFLECTION_OVER_LINE",REMOVE:"REMOVE",RESTART:"RESTART",ROTATE:"ROTATE",SAVE:"SAVE",SEGMENT:"SEGMENT",SET_OPTIONS:"SET_OPTIONS",SHAKE:"SHAKE",TRANSLATION:"TRANSLATION",UNDO:"UNDO",VECTOR:"VECTOR",ZOOM_IN:"ZOOM_IN",ZOOM_OUT:"ZOOM_OUT"},predictableActionArguments:!0,states:{BISECTOR_BY_POINTS:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur un premier point (autre que le sommet de l'angle).",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0,target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{w("Cliquer sur le sommet de l'angle.",e.figure)},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element},cond:(e,t)=>t.element!==void 0,target:"waitingForThirdElement"}}},waitingForThirdElement:{entry:e=>{w("Cliquer sur un troisième point.",e.figure)},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[2]=t.element;const[i,r,n]=e.figure.selectedElements;e.figure.create("BisectorByPoints",{origin:r,pointOnSide1:i,pointOnSide2:n}),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"waitingForFirstElement"}}}}},CIRCLE_CENTER_POINT:{initial:"waitingForCenter",states:{waitingForCenter:{entry:e=>{w("Cliquer sur le centre du cercle.",e.figure),e.figure.filter=t=>t instanceof C,e.figure.currentState="POINT_INTERSECTION"},exit:e=>{e.figure.currentState=""},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,e.figure.tempCreate("CircleCenterPoint",{center:e.figure.selectedElements[0],point:e.figure.pointer})),e.figure.filter=r=>r instanceof C},cond:(e,t)=>B(t),target:"waitingForPoint"}}},waitingForPoint:{entry:e=>{w("Cliquer sur un point du cercle.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);if(i!==void 0){e.figure.selectedElements[1]=i;const[r,n]=e.figure.selectedElements;e.figure.create("CircleCenterPoint",{center:r,point:n}),e.figure.saveState()}},cond:(e,t)=>B(t),target:"waitingForCenter"}}}}},CIRCLE_RADIUS:{initial:"waitingForCenter",states:{waitingForCenter:{entry:e=>{w("Cliquer sur le centre du cercle.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,ft(e.figure).showModal()),e.figure.filter=r=>r instanceof C},cond:(e,t)=>B(t),target:"waitingForRadius"}}},waitingForRadius:{on:{RADIUS:{actions:(e,t)=>{const i=t.radius,r=e.figure.selectedElements[0],n=ct(t.radius,e.figure);if(n!==void 0){const o=e.figure.create("Distance",{point1:n[0],point2:n[1]});e.figure.create("CircleCenterDynamicRadius",{center:r,radius:o}),e.figure.saveState()}else i>0&&(e.figure.create("Circle",{center:r,radius:i}),e.figure.saveState())},target:"waitingForCenter"}}}}},COLOR:{entry:(e,t)=>{e.figure.options.color=t.text}},DESCRIPTION:{entry:e=>{Mi(e.figure)}},DILATE:{entry:e=>{e.figure.filter=t=>t instanceof C},exit:e=>{e.figure.selectedElements=[];for(const t of e.figure.tmpElements)t.remove()},initial:"waitingForCenter",states:{waitingForCenter:{entry:e=>{w("Cliquer sur le centre de l'homothétie.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,_i(e.figure).showModal())},cond:(e,t)=>B(t),target:"waitingForCoefficient"}}},waitingForCoefficient:{on:{DILATE_COEF:{actions:(e,t)=>{e.temp.values[0]=t.coefficient},target:"waitingForElement"}}},waitingForElement:{entry:e=>{e.figure.filter=r=>r instanceof C||r instanceof M||r instanceof V||r instanceof re;const t=e.figure.selectedElements[0],i=e.temp.values[0];e.figure.tmpElements.push(e.figure.pointer.dilate(t,i,{color:e.figure.options.tmpColor,isChild:!0})),w("Cliquer sur l'élément à transformer.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=e.figure.selectedElements[0],r=t.element,n=e.temp.values[0];r.dilate(i,n),e.figure.saveState(),e.figure.selectedElements[0]=i},cond:(e,t)=>t.element!==void 0,target:"waitingForElement"}}}}},DISC_CENTER_POINT:{initial:"waitingForCenter",states:{waitingForCenter:{entry:e=>{w("Cliquer sur le centre du disque.",e.figure),e.figure.filter=t=>t instanceof C||t instanceof M,e.figure.currentState="POINT_INTERSECTION"},exit:e=>{e.figure.currentState=""},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,e.figure.tempCreate("CircleCenterPoint",{center:e.figure.selectedElements[0],point:e.figure.pointer})),e.figure.filter=r=>r instanceof C},cond:(e,t)=>B(t),target:"waitingForPoint"}}},waitingForPoint:{entry:e=>{w("Cliquer sur un point du disque.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);if(i!==void 0){e.figure.selectedElements[1]=i;const[r,n]=e.figure.selectedElements;e.figure.create("CircleCenterPoint",{center:r,point:n,fillColor:e.figure.options.color,fillOpacity:e.figure.options.discFillOpacity}),e.figure.saveState()}},cond:(e,t)=>B(t),target:"waitingForCenter"}}}}},DISC_RADIUS:{initial:"waitingForCenter",states:{waitingForCenter:{entry:e=>{w("Cliquer sur le centre du disque.",e.figure),e.figure.filter=t=>t instanceof C||t instanceof M},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,ft(e.figure).showModal()),e.figure.filter=r=>r instanceof C},cond:(e,t)=>B(t),target:"waitingForRadius"}}},waitingForRadius:{on:{RADIUS:{actions:(e,t)=>{const i=t.radius,r=e.figure.selectedElements[0],n=ct(t.radius,e.figure);if(n!==void 0){const o=e.figure.create("Distance",{point1:n[0],point2:n[1]});e.figure.create("CircleCenterDynamicRadius",{center:r,radius:o,fillColor:e.figure.options.color,fillOpacity:e.figure.options.discFillOpacity}),e.figure.saveState()}else i>0&&(e.figure.create("Circle",{center:r,radius:i,fillColor:e.figure.options.color,fillOpacity:e.figure.options.discFillOpacity}),e.figure.saveState())},target:"waitingForCenter"}}}}},DOWNLOAD_LATEX_SVG:{entry:e=>{e.temp.htmlElement[0]=ji(e.figure)},on:{SELECTION_AREA_TO_LATEX:{actions:(e,t)=>{const i=e.figure.xMin+e.figure.sxTox(t.xMin),r=i+e.figure.sxTox(t.width),n=e.figure.yMax+e.figure.syToy(t.yMax),o=n+e.figure.syToy(t.height);e.temp.htmlElement[0].remove();const s=e.figure.latex({xMax:r,xMin:i,yMax:n,yMin:o}),a=new Blob([s],{type:"text/plain"}),l=window.URL.createObjectURL(a),u=document.createElement("a");u.style.display="none",u.href=l,u.download="figure.tex",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(l),document.body.removeChild(u),e.figure.buttons.get("DRAG")?.click()},target:"DRAG"},SELECTION_AREA_TO_SVG:{actions:(e,t)=>{const i=e.figure.xToSx(e.figure.xMin+e.figure.sxTox(t.xMin)),r=e.figure.yToSy(e.figure.yMax+e.figure.syToy(t.yMax));e.temp.htmlElement[0].remove();const n=e.figure.svg.cloneNode(!0);n.setAttribute("width",t.width.toString()),n.setAttribute("height",t.height.toString()),n.setAttribute("viewBox",`${i} ${r} ${t.width} ${t.height}`);const o=new Blob([n.outerHTML],{type:"image/svg+xml"}),s=window.URL.createObjectURL(o),a=document.createElement("a");a.style.display="none",a.href=s,a.download="figure.svg",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(s),document.body.removeChild(a),e.figure.buttons.get("DRAG")?.click()},target:"DRAG"}}},DRAG:{entry:e=>{e.figure.elements.size>1?w("Cliquer sur un point pour le déplacer.",e.figure):w("",e.figure),e.figure.filter=t=>t instanceof C&&t.isFree},exit:e=>{e.figure.divFigure.style.cursor="default",e.figure.inDrag=void 0},on:{clickLocation:{actions:(e,t)=>{e.figure.inDrag=t.element,e.figure.divFigure.style.cursor="move"},cond:(e,t)=>t.element!==void 0,target:"DRAG"}}},FILL:{entry:e=>{e.figure.filter=t=>t instanceof re||t instanceof V||t instanceof kt,e.figure.currentState="FILL"},exit:e=>{e.figure.currentState="";for(const t of e.figure.tmpElements)t.isSelected=!1},on:{clickLocation:{actions:(e,t)=>{const i=t.element;i!==void 0&&(i.fillColor===e.figure.options.color?i.fillColor="none":i.fillColor=e.figure.options.color,e.figure.saveState())}}}},GRID:{entry:e=>{e.figure.grid===void 0?e.figure.grid=e.figure.create("Grid",{color:"black"}):e.figure.grid.isVisible?(e.figure.grid.isVisible=!1,e.figure.snapGrid=!1):(e.figure.grid.isVisible=!0,e.figure.snapGrid=!0),e.figure.saveState()}},HIDE:{entry:e=>{e.figure.currentState="HIDE",w("Cliquer sur l'élément à masquer ou à démasquer.",e.figure),e.figure.filter=t=>t.isVisible;for(const t of e.figure.elements)t instanceof Ue&&t.isHidden&&t.tempShow()},exit:e=>{e.figure.currentState="";for(const t of e.figure.elements)t instanceof Ue&&t.isHidden&&t.hide()},on:{clickLocation:{actions:(e,t)=>{t.element.isHidden===!0?(t.element.show(),t.element.isHidden=!1):(t.element.tempShow(),t.element.isHidden=!0),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"HIDE"}}},INFORMATIONS:{entry:e=>{w("Cliquer sur l'élément",e.figure),e.figure.filter=t=>t.isVisible},on:{clickLocation:{actions:(e,t)=>{console.info(t.element)},cond:(e,t)=>t.element!==void 0,target:"INFORMATIONS"}}},INIT:{entry:e=>{e.figure.userMessage=""}},LATEX:{entry:e=>{const t=e.figure.latex,i=new Blob([t()],{type:"text/plain"}),r=window.URL.createObjectURL(i),n=document.createElement("a");n.style.display="none",n.href=r,n.download="figure.tex",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n),e.figure.buttons.get("DRAG")?.click()}},LINE:{entry:e=>{e.figure.filter=t=>t instanceof C},initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur un premier point de la droite.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,e.figure.tempCreate("Line",{point1:e.figure.selectedElements[0],point2:e.figure.pointer}))},cond:(e,t)=>B(t),target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{w("Cliquer sur un deuxième point de la droite.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);if(i!==void 0){e.figure.selectedElements[1]=i;const[r,n]=e.figure.selectedElements;e.figure.create("Line",{point1:r,point2:n}),e.figure.saveState()}},cond:(e,t)=>B(t),target:"waitingForFirstElement"}}}}},LINE_PARALLEL:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur un point ou une droite.",e.figure),e.figure.filter=t=>t instanceof M||t instanceof C},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0,target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{e.figure.selectedElements[0]instanceof C?(w("Cliquer sur une droite.",e.figure),e.figure.filter=t=>t instanceof M):(w("Cliquer sur un point.",e.figure),e.figure.filter=t=>t instanceof C)},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element;let i,r;e.figure.selectedElements[0]instanceof C?[i,r]=e.figure.selectedElements:[r,i]=e.figure.selectedElements,e.figure.create("LineParallel",{line:r,point:i}),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"waitingForFirstElement"}}}}},LINE_PERPENDICULAR:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur un point ou une droite.",e.figure),e.figure.filter=t=>t instanceof M||t instanceof C},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0,target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{e.figure.selectedElements[0]instanceof C?(w("Cliquer sur une droite.",e.figure),e.figure.filter=t=>t instanceof M):(w("Cliquer sur un point.",e.figure),e.figure.filter=t=>t instanceof C)},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element;let i,r;e.figure.selectedElements[0]instanceof C?[i,r]=e.figure.selectedElements:[r,i]=e.figure.selectedElements,e.figure.create("LinePerpendicular",{line:r,point:i}),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"waitingForFirstElement"}}}}},MARK_BETWEEN_POINTS:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur la première extrémité du segment ou sur un segment.",e.figure),e.figure?.divMarkPalette!==void 0&&(e.figure.divMarkPalette.style.display="flex"),e.figure.filter=t=>t instanceof C||t instanceof M},on:{clickLocation:[{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0&&t.element instanceof C,target:"waitingForSecondElement"},{actions:(e,t)=>{const i=t.element,r=i.point1,n=i.point2;e.figure.create("MarkBetweenPoints",{point1:r,point2:n}),e.figure.saveState()},cond:(e,t)=>t.element!==void 0&&t.element instanceof M,target:"waitingForFirstElement"}]},exit:e=>{e.figure?.divMarkPalette!==void 0&&(e.figure.divMarkPalette.style.display="none")}},waitingForSecondElement:{entry:e=>{e.figure?.divMarkPalette!==void 0&&(e.figure.divMarkPalette.style.display="flex"),w("Cliquer sur la deuxième extrémité du segment.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element;const[i,r]=e.figure.selectedElements;e.figure.create("MarkBetweenPoints",{point1:i,point2:r}),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"waitingForFirstElement"}}}}},MIDDLE:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur la première extrémité du segment ou sur un segment.",e.figure),e.figure.filter=t=>t instanceof C||t instanceof M},on:{clickLocation:[{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0&&t.element instanceof C,target:"waitingForSecondElement"},{actions:(e,t)=>{const i=t.element,r=i.point1,n=i.point2;e.figure.create("Middle",{point1:r,point2:n})},cond:(e,t)=>t.element!==void 0&&t.element instanceof M,target:"waitingForFirstElement"}]}},waitingForSecondElement:{entry:e=>{w("Cliquer sur la deuxième extrémité du segment.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element;const[i,r]=e.figure.selectedElements;e.figure.create("Middle",{point1:i,point2:r}),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"waitingForFirstElement"}}}}},MOVE_LABEL:{entry:e=>{w("Cliquer sur le point pour déplacer son nom.",e.figure),e.figure.filter=t=>t instanceof C},initial:"waitingForPoint",states:{waitingForPoint:{on:{clickLocation:{actions:(e,t)=>{const i=t.element;e.figure.inDrag=i.elementTextLabel},target:"waitingForPoint"}}}}},NAME_POINT:{initial:"waitingForPoint",states:{waitingForName:{entry:e=>{ki(e.figure).showModal()},on:{TEXT_FROM_DIALOG:{actions:(e,t)=>{const i=e.temp.elements[0];i.label=t.text,e.figure.saveState()},target:"waitingForPoint"}}},waitingForPoint:{entry:e=>{e.figure.filter=t=>t instanceof C,w("Cliquer sur un point à renommer.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t,!1);i!==void 0&&(e.temp.elements[0]=i)},cond:(e,t)=>B(t),target:"waitingForName"}}}}},OPEN:{entry:e=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=i=>{const r=i.target.files?.[0];if(r===void 0)return;const n=new FileReader;n.readAsText(r,"UTF-8"),n.onload=o=>{const s=o?.target?.result??"";typeof s=="string"&&s!==""&&e.figure.loadJson(JSON.parse(s),!0)}},t.click()}},PAUSE:{entry:e=>{w("",e.figure),e.intervalId!==void 0&&clearInterval(e.intervalId)}},PERPENDICULAR_BISECTOR:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur la première extrémité du segment.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[0]=t.element,e.figure.tempCreate("PerpendicularBisectorByPoints",{point1:e.figure.selectedElements[0],point2:e.figure.pointer})},cond:(e,t)=>t.element!==void 0,target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{w("Cliquer sur la deuxième extrémité du segment.",e.figure)},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element;const[i,r]=e.figure.selectedElements;e.figure.create("PerpendicularBisectorByPoints",{point1:i,point2:r}),e.figure.saveState()},target:"waitingForFirstElement"}}}}},PLAY:{entry:e=>{w("",e.figure),clearInterval(e.intervalId),e.figure.redo(),e.intervalId=setInterval(()=>{if(e.figure.stackRedo.length===0){e.figure.buttons.get("PAUSE")?.click(),clearInterval(e.intervalId);return}e.figure.redo()},e.figure.options.animationStepInterval)}},PLAY_SKIP_BACK:{entry:e=>{w("",e.figure),e.figure.undo()}},PLAY_SKIP_FORWARD:{entry:e=>{w("",e.figure),e.figure.redo()}},POINT:{entry:e=>{w("Cliquer pour créer un point.",e.figure),e.figure.filter=t=>t instanceof C,e.figure.currentState="POINT"},initial:"waitingForLocation",states:{waitingForLocation:{on:{clickLocation:{actions:(e,t)=>{if(e.figure.hoverPoints.size>0){const i=[...e.figure.hoverPoints][0];e.figure.inDrag=i,e.figure.divFigure.style.cursor="move"}else{const{x:i,y:r}=t,n=e.figure.options.limitNumberOfElement?.get("Point")??Number.POSITIVE_INFINITY,o=n===void 0||!Number.isFinite(n),s=[...e.figure.elements.values()].filter(l=>l instanceof C).length>n;if(!(!e.figure.options.gridWithTwoPointsOnSamePosition&&[...e.figure.elements.values()].filter(l=>l instanceof C&&l.isSelectable&&l.isVisible&&l.x===Math.round(i/e.figure.dx)*e.figure.dx&&l.y===Math.round(r/e.figure.dy)*e.figure.dy).length>0)&&(o||!s)){const l=Re(e.figure);e.figure.create("Point",{x:i,y:r,label:l})}}e.figure.saveState()},target:"waitingForLocation"}}}},exit:e=>{e.figure.currentState=""}},POINT_INTERSECTION:{entry:e=>{e.figure.filter=t=>t instanceof M||t instanceof V,e.figure.currentState="POINT_INTERSECTION"},exit:e=>{e.figure.selectedElements=[];for(const t of e.figure.tmpElements)t.remove();e.figure.currentState=""},initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur une droite, une demi-droite, un segment ou un cercle.",e.figure)},exit:e=>{e.figure.selectedElements[0]?.isSelected&&(e.figure.selectedElements[0].isSelected=!1)},on:{clickLocation:[{actions:(e,t)=>{e.figure.selectedElements[0]=t.element,t.element.isSelected=!0},cond:(e,t)=>t.element!==void 0,target:"waitingForSecondElement"},{actions:(e,t)=>{e.figure.selectedElements[0]=t.possibleElements[0],e.figure.selectedElements[1]=t.possibleElements[1];const[i,r]=e.figure.selectedElements,n=Re(e.figure);i instanceof M?(r instanceof M&&e.figure.create("PointIntersectionLL",{line1:i,line2:r,label:n}),r instanceof V&&e.figure.create("PointsIntersectionLC",{circle:r,line:i}),e.figure.saveState()):i instanceof V&&(r instanceof M&&e.figure.create("PointsIntersectionLC",{circle:i,line:r}),r instanceof V&&e.figure.create("PointsIntersectionCC",{circle1:i,circle2:r}),e.figure.saveState())},cond:(e,t)=>t.possibleElements.length===2,target:"waitingForFirstElement"}]}},waitingForSecondElement:{exit:e=>{for(const t of e.figure.selectedElements)t.isSelected=!1;for(const t of e.figure.tmpElements)t.isSelected=!1},on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[1]=t.element;const[i,r]=e.figure.selectedElements;i instanceof M?(r instanceof M&&e.figure.create("PointIntersectionLL",{line1:i,line2:r}),r instanceof V&&e.figure.create("PointsIntersectionLC",{circle:r,line:i}),e.figure.saveState()):i instanceof V&&(r instanceof M&&e.figure.create("PointsIntersectionLC",{circle:i,line:r}),r instanceof V&&e.figure.create("PointsIntersectionCC",{circle1:i,circle2:r}),e.figure.saveState())},cond:(e,t)=>t.element!==void 0,target:"waitingForFirstElement"}}}}},POINT_ON:{entry:e=>{e.figure.filter=t=>t instanceof M||t instanceof V||t instanceof it,w("Cliquer sur un segment, un cercle ou une courbe.",e.figure)},on:{clickLocation:{actions:(e,t)=>{if(e.figure.selectedElements[0]=t.element,t.element instanceof M){const[i,r]=[t.element.point1,t.element.point2],n=((t.x-i.x)*(r.x-i.x)+(t.y-i.y)*(r.y-i.y))/dt(i,r)**2,o=Re(e.figure);e.figure.create("PointOnLine",{k:n,line:t.element,label:o}),e.figure.saveState()}else if(t.element instanceof V){const i=Math.atan2(t.y-t.element.center.y,t.x-t.element.center.x);e.figure.create("PointOnCircle",{angleWithHorizontal:i,circle:t.element}),e.figure.saveState()}else if(t.element instanceof it){const i=t.x;e.figure.create("PointOnGraph",{x:i,graph:t.element}),e.figure.saveState()}},target:"POINT_ON"}}},POLYGON:{id:"polygon",initial:"init",on:{STOPPOLYGON:"#polygon.STOPPOLYGON"},states:{init:{always:"waitingElement",entry:e=>{w("Cliquer sur un sommet du polygone.",e.figure),e.figure.filter=t=>t instanceof C}},STOPPOLYGON:{always:{target:"#polygon.waitingElement"},entry:e=>{const t=e.figure.create("Polygon",{points:e.figure.selectedElements,fillColor:e.figure.options.fillColor});for(const i of t.points)i.color=e.figure.options.colorPointPolygon;w("Cliquer sur un sommet pour créer un autre polygone.",e.figure),e.figure.saveState()}},waitingElement:{exit:e=>{for(const t of e.figure.tmpElements)t.remove()},on:{clickLocation:[{actions:(e,t)=>{e.figure.selectedElements.length>0?w("Cliquer sur un nouveau sommet ou sur le premier sommet pour terminer.",e.figure):w("Cliquer sur un sommet du polygone.",e.figure);const i=x(e,t);if(i!==void 0){i.shape=e.figure.options.tmpShape,i.color=e.figure.options.tmpColor,e.figure.selectedElements.push(i);const r=[...e.figure.selectedElements,e.figure.pointer];e.figure.tempCreate("Polygon",{isBuiltWithSegments:!1,isChild:!0,color:e.figure.options.tmpColor,fillColor:e.figure.options.tmpFillColor,points:r})}},cond:(e,t)=>{if(e.figure.selectedElements.length<2)return B(t);const i=t.element,r=e.figure.selectedElements[0],n=i?.id===r?.id;return B(t)&&!n},target:"waitingElement"},{cond:(e,t)=>{if(e.figure.selectedElements.length>1){const i=t.element,r=e.figure.selectedElements[0];return i?.id===r?.id}return!1},target:"STOPPOLYGON"}]}}}},RAY:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur l'origine de la demi-droite.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,e.figure.tempCreate("Ray",{point1:e.figure.selectedElements[0],point2:e.figure.pointer}))},cond:(e,t)=>B(t),target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{w("Cliquer un point de la demi-droite.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);if(i!==void 0){e.figure.selectedElements[1]=i;const[r,n]=e.figure.selectedElements;e.figure.create("Ray",{point1:r,point2:n}),e.figure.saveState()}},cond:(e,t)=>B(t),target:"waitingForFirstElement"}}}}},REDO:{entry:e=>{e.figure.redo(),e.figure.buttons.get("DRAG")?.click()}},REFLECTION:{entry:e=>{w("Cliquer sur le centre de la symétrie.",e.figure),e.figure.filter=t=>t instanceof C},exit:e=>{e.figure.selectedElements=[];for(const t of e.figure.tmpElements)t.remove()},initial:"waitingForCenter",states:{waitingForCenter:{on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0,target:"waitingForElement"}}},waitingForElement:{entry:e=>{w("Cliquer sur l'élément à transformer.",e.figure),e.figure.filter=i=>i instanceof C||i instanceof M||i instanceof V||i instanceof re;const t=e.figure.selectedElements[0];t!==void 0&&(e.figure.selectedElements[0]=t,e.figure.tmpElements.push(e.figure.pointer.reflect(t,{color:e.figure.options.tmpColor,isChild:!0,isSelectable:!1})))},on:{clickLocation:{actions:(e,t)=>{const i=t.element,r=e.figure.selectedElements[0];i!==void 0&&(i.reflect(r),e.figure.saveState(),e.figure.selectedElements[0]=r)},target:"waitingForElement"}}}}},REFLECTION_OVER_LINE:{entry:e=>{w("Cliquer sur l'axe de la symétrie.",e.figure),e.figure.filter=t=>t instanceof M},exit:e=>{e.figure.selectedElements=[];for(const t of e.figure.tmpElements)t.remove()},initial:"waitingForAxis",states:{waitingForAxis:{on:{clickLocation:{actions:(e,t)=>{e.figure.selectedElements[0]=t.element},cond:(e,t)=>t.element!==void 0,target:"waitingForOrigin"}}},waitingForOrigin:{entry:e=>{w("Cliquer sur l'élément à transformer.",e.figure),e.figure.filter=i=>i instanceof C||i instanceof M||i instanceof V||i instanceof re;const t=e.figure.selectedElements[0];t!==void 0&&(e.figure.selectedElements[0]=t,e.figure.tmpElements.push(e.figure.pointer.reflectOverLine(t,{color:e.figure.options.tmpColor,isChild:!0,isSelectable:!1})))},on:{clickLocation:{actions:(e,t)=>{const i=t.element,r=e.figure.selectedElements[0];i!==void 0&&(i.reflectOverLine(r),e.figure.saveState(),e.figure.selectedElements[0]=r)},cond:(e,t)=>t.element!==void 0,target:"waitingForOrigin"}}}}},REMOVE:{entry:e=>{w("Cliquer sur l'élément à supprimer.",e.figure),e.figure.filter=t=>t.isVisible},on:{clickLocation:{actions:(e,t)=>{t.element.remove(),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"REMOVE"}}},RESTART:{entry:e=>{w("",e.figure),e.figure.restart()}},ROTATE:{entry:e=>{e.figure.filter=t=>t instanceof C||t instanceof M},exit:e=>{e.figure.selectedElements=[];for(const t of e.figure.tmpElements)t.remove()},initial:"waitingForCenter",states:{waitingForAngle:{on:{ANGLE:{actions:(e,t)=>{const i=t.angle;e.temp.values[0]=i},target:"waitingForOrigin"}}},waitingForCenter:{entry:e=>{w("Cliquer sur le centre de rotation.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,Di(e.figure).showModal())},cond:(e,t)=>B(t),target:"waitingForAngle"}}},waitingForOrigin:{entry:e=>{const t=e.figure.selectedElements[0],i=e.temp.values[0];e.figure.tmpElements.push(e.figure.pointer.rotate(t,i,{color:e.figure.options.tmpColor,isChild:!0,isSelectable:!1})),w("Cliquer sur l'élément à transformer.",e.figure),e.figure.filter=r=>r instanceof C||r instanceof M||r instanceof V||r instanceof re},on:{clickLocation:{actions:(e,t)=>{const i=e.figure.selectedElements[0],r=t.element,n=e.temp.values[0];r.rotate(i,n),e.figure.saveState(),e.figure.selectedElements[0]=i},cond:(e,t)=>t.element!==void 0,target:"waitingForOrigin"}}}}},SAVE:{entry:e=>{const t=e.figure.getJsonWithHistory(),i=new Blob([t],{type:"text/plain"}),r=window.URL.createObjectURL(i),n=document.createElement("a");n.style.display="none",n.href=r,n.download="figure.json",document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n),e.figure.buttons.get("DRAG")?.click()}},SEGMENT:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur la première extrémité du segment.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,e.figure.tempCreate("Segment",{point1:e.figure.selectedElements[0],point2:e.figure.pointer}))},cond:(e,t)=>B(t),target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{w("Cliquer sur la deuxième extrémité du segment.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);if(i!==void 0){e.figure.selectedElements[1]=i;const[r,n]=e.figure.selectedElements;e.figure.create("Segment",{point1:r,point2:n}),e.figure.saveState()}},cond:(e,t)=>B(t),target:"waitingForFirstElement"}}}}},SET_OPTIONS:{entry:e=>{e.figure.filter=t=>t instanceof Ue,e.figure.currentState="SET_OPTIONS"},on:{clickLocation:{actions:(e,t)=>{const i=t.element;i!==void 0&&(i.color=e.figure.options.color,i.thickness=e.figure.options.thickness,"isDashed"in i&&(i.isDashed=e.figure.options.isDashed),e.figure.options.fillColorAndBorderColorAreSame&&"fillColor"in i&&i.fillColor!=="none"&&(i.fillColor=e.figure.options.color))}}}},SHAKE:{always:"DRAG",entry:async e=>{await e.figure.shake(),e.figure.saveState()}},TRANSLATION:{exit:e=>{for(const t of e.figure.tmpElements)t.isSelectable=!1},initial:"waitingForFistPoint",states:{waitingForFistPoint:{entry:e=>{e.figure.filter=t=>t instanceof C,w("Cliquer sur le premier point qui définit de la translation.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=t.element;e.temp.elements[0]=i,i.isSelected=!0},cond:(e,t)=>t.element!==void 0,target:"waitingForSecondPoint"}}},waitingForOrigin:{entry:e=>{w("Cliquer sur l'objet à transformer.",e.figure),e.figure.filter=t=>t instanceof C||t instanceof M||t instanceof V||t instanceof re},on:{clickLocation:{actions:(e,t)=>{const[i,r]=e.temp.elements;t.element.translate(i,r),e.figure.saveState()},cond:(e,t)=>t.element!==void 0,target:"waitingForOrigin"}}},waitingForSecondPoint:{entry:e=>{w("Cliquer sur le deuxième point qui définit de la translation.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=t.element;e.temp.elements[1]=i,i.isSelected=!0},cond:(e,t)=>t.element!==void 0,target:"waitingForOrigin"}}}}},UNDO:{entry:e=>{e.figure.undo(),e.figure.buttons.get("DRAG")?.click()}},VECTOR:{initial:"waitingForFirstElement",states:{waitingForFirstElement:{entry:e=>{w("Cliquer sur l'origine de la représentation du vecteur.",e.figure),e.figure.filter=t=>t instanceof C},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);i!==void 0&&(e.figure.selectedElements[0]=i,e.figure.tempCreate("Segment",{point1:e.figure.selectedElements[0],point2:e.figure.pointer,shape:"->"}))},cond:(e,t)=>B(t),target:"waitingForSecondElement"}}},waitingForSecondElement:{entry:e=>{w("Cliquer sur l'extrémité de la représentation du vecteur.",e.figure)},on:{clickLocation:{actions:(e,t)=>{const i=x(e,t);if(i!==void 0){e.figure.selectedElements[1]=i;const[r,n]=e.figure.selectedElements;e.figure.create("VectorByPoints",{point1:r,point2:n}),r.color="",n.color="",e.figure.saveState()}},cond:(e,t)=>B(t),target:"waitingForFirstElement"}}}}},ZOOM_IN:{initial:"zoom_in",states:{zoom_in:{entry:e=>{e.figure.zoomLevel*=qt,e.figure.zoom(e.figure.zoomLevel)}}}},ZOOM_OUT:{initial:"zoom_out",states:{zoom_out:{entry:e=>{e.figure.zoomLevel*=jt,e.figure.zoom(e.figure.zoomLevel)}}}}}},{actions:{eraseTempElements:e=>{for(const t of e.figure.tmpElements)t.remove()},highlightButton:(e,t)=>{const i=e.figure.buttons.get(t.type);i!==void 0&&(i.style.backgroundColor=Mt),e.figure.buttons.forEach((r,n)=>{n!==t.type&&(r.style.backgroundColor="white")})},eraseUserMessage:e=>{w("",e.figure)}}});function x(e,t,i){if(t.element instanceof C)return t.element;const[r,n]=[t.x,t.y];if(t.possibleElements!==void 0&&t.possibleElements.length===2&&t.possibleElements[0]instanceof M&&t.possibleElements[1]instanceof M)return e.figure.create("PointIntersectionLL",{line1:t.possibleElements[0],line2:t.possibleElements[1]});if(t.element instanceof M){const[s,a]=[t.element.point1,t.element.point2],l=((r-s.x)*(a.x-s.x)+(n-s.y)*(a.y-s.y))/dt(s,a)**2;return e.figure.create("PointOnLine",{k:l,line:t.element})}if(t.waitingWithModal===!0)return;const o=Re(e.figure);return i?e.figure.create("Point",{x:r,y:n,label:o}):e.figure.create("Point",{x:r,y:n})}function B(e){return e.waitingWithModal===!1}function w(e,t){if(!t.options.automaticUserMessage)return;const i=t.divUserMessage;i!=null&&(i.innerHTML=t.isDynamic?e:"")}function ct(e,t){if(e===void 0||typeof e!="string")return;const[i,r]=e.split(""),n=[...t.elements.values()].filter(a=>a.type!=="pointer"&&a.type?.includes("Point")),o=n.filter(a=>a.label===i),s=n.filter(a=>a.label===r);if(!(o.length!==1||s.length!==1))return[o[0],s[0]]}function Re(e){let t;if(e.options.labelAutomaticBeginsWith!==void 0){let i=e.options.labelAutomaticBeginsWith.charCodeAt(0);const r=90;t=e.options.labelAutomaticBeginsWith;const n=t.endsWith("'");for(n&&(t=t.slice(0,-1));[...e.elements.values()].some(o=>"label"in o?o.label===t+(n?"'":""):!1);)i++,i>r&&(i=65),t=String.fromCharCode(i);t+=n?"'":""}return t}class xi extends Dt{constructor({border:t=!1,dx:i=1,dy:r=1,height:n=400,isDynamic:o=!0,pixelsPerUnit:s=30,scale:a=1,snapGrid:l=!1,width:u=400,xMin:c=-10,xScale:d=1,yMin:f=-6,yScale:h=1}={}){super({border:t,dx:i,dy:r,height:n,isDynamic:o,pixelsPerUnit:s,scale:a,snapGrid:l,width:u,xMin:c,xScale:d,yMin:f,yScale:h});const m=qi.withContext({figure:this,temp:{elements:[],htmlElement:[],values:[]}});this.ui=Ft(m).start()}}export{xi as S};
