import{_ as Be,a as ui}from"./index-BUDQz6-w.js";const l="http://www.w3.org/2000/svg",hi={alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",pi:"π",rho:"ρ",sigma:"σ",tau:"τ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",Gamma:"Γ",Delta:"Δ",Xi:"Ξ",Pi:"Π",Sigma:"Σ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω"},di={alpha2:"α",plus:"+",moins:"-",fois:"×",divise:"÷",petitf:"f",petitebarre:"–",grandebarre:"—",prime:"'",seconde:'"',puceronde:"•",grandC:"ℂ",euler:"ℂ",petitg:"ℊ",petith:"ℏ",Ironde:"ℑ",Lronde:"ℒ",lronde:"ℓ",grandN:"ℕ",Pronde:"℘",grandQ:"ℚ",Rronde:"ℜ",grandR:"ℝ",grandZ:"ℤ",Eronde:"ℰ",Fronde:"ℱ",Nronde:"ℵ",flecheG:"←",flecheH:"↑",flecheD:"→",flecheB:"↓",flecheDG:"↔",flecheGD:"↔",flecheHB:"↕",flecheBH:"↕",croissant:"↗",decroissant:"↘",alaligneadroite:"↳",alaligneagauche:"↵",doubleflecheG:"⇐",doubleflecheD:"⇒",doubleflecheDG:"⇔",doubleflecheGD:"⇔",flecheGbarre:"⇤",flecheDbarre:"⇥",flecheGcreuse:"⇦",flecheHcreuse:"⇧",flecheDcreuse:"⇨",flecheBcreuse:"⇩",qqsoit:"∀",pourtout:"∀",quelquesoit:"∀",complement:"∁",differentielpartiel:"∂",ilexiste:"∃",ilnexistepas:"∄",vide:"∅",nabla:"∇",appartienta:"∈",nappartientpasa:"∉",contient:"∋",petitcontient:"∍",grandproduit:"∏",grandcoproduit:"∐",grandesomme:"∑",petitebarrefine:"−",moinsouplus:"∓",antislash:"\\",asterisque:"∗",racine:"√",proportionnela:"∝",infini:"∞",angle:"∡",anglespherique:"∢",nedivisepas:"∤",parallelea:"//",nestpasparallelea:"∦",etlogique:"∧",oulogique:"∨",inter:"∩",intersection:"∩",union:"∪",integrale:"∫",doubleintegrale:"∬",tripleintegrale:"∭",integralecurviligne:"∮",integralesurfacique:"∯",integralevolumique:"∰",egaleasymptotiquea:"≃",environdroit:"≃",environegala:"≅",environ:"≈",egalpardefinition:"≝",differentde:"≠",identiquea:"≡",inferieura:"≤",superieura:"≥",inclusdans:"⊂",nestpasinclusdans:"⊄",necontientpas:"⊅",sommedirecte:"⊕",differencedirecte:"⊖",produittensoriel:"⊗",divisiondirecte:"⊘",produitdirect:"⊙",top:"⊤",perpendiculairea:"⊥",antecedentde:"⊶",imagede:"⊷",angledroitarc:"⊾",point:"⋅",pv:";"},H=Math.PI/180,pi=180/Math.PI,Wt=Math.cos(30*H),Ut=.5;function wt(e,t,i,s,n,r){this.bold=e,this.italic=t,this.underline=i,this.couleur=s,this.fontface=n,this.taille=r}const De={};Object.entries(di).forEach(([e,t])=>{De[e.toLowerCase()]=t});const vt=e=>Math.abs(e)<1e-9,fi=e=>Math.abs(e)<1e-7;function It(e){const t=Math.floor((e+180)/360);let i=e-360*t;return i===-180&&(i=180),i}function gi(e){let t,i;return window.DOMParser?(t=new DOMParser,i=t.parseFromString(e,"text/xml")):window.ActiveXObject?(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(e)):console.error(Error("Votre navigateur ne peut pas analyser du XML, impossible d’utiliser instrumenpoche")),i}const Mt=e=>["compas","compasLeve","crayon","equerre","rapporteur","regle","requerre"].includes(e);function D(e){let t,i,s,n=!1;if(e.indexOf("<font")===0)i="</font>",n=!0;else{if(s=e.indexOf(">"),s===-1)return e.length;t=e.substring(0,s+1),i=t.substring(0,1)+"/"+t.substring(1)}const r=e.indexOf(i);if(r===-1){if(n){const o=e.indexOf("<font",5);if(o!==-1)return o}return-1}else return r+i.length}function Ge(e){const t=e.trim(),i={},s=t.indexOf(","),n=t.indexOf(")");return i.erreur=s===-1||n===-1,i.erreur?(i.texte="",i):(i.operande=t.substring(3,s),i.exposant=t.substring(s+1,n),i.texte=t.substring(n+1),i)}function V(e,t){let i,s,n=1;for(i=t+1;i<e.length&&(s=e.charAt(i),s==="("?n++:s===")"&&n--,n!==0);)i++;return n===0?i:-1}function bi(e,t){const i=Math.pow(10,t);return Math.round(e/i)*i}function ie(e,t,i,s,n){const r=(s-n)/(t-i),o=s-r*t;return r*e+o}function mi(e){let t="";const i=["objet","mouvement","vitesse","tempo","abscisse","ordonnee","id","couleur","pointille","echelle","angle","cible","texte","ecrire","rotation","translation","epaisseur","opacite","masquer","montrer","crayon","equerre","regle","compas","reglequerre","sens","hauteur","largeur","haut","gauche","Xmin","Ymin","Xmax","yMax","Xgrad","Ygrad","image","police","taille","ordonnee_bas_droite","abscisse_bas_droite","ordonnee_haut_gauche","abscisse_haut_gauche"];return e.split(/<action/gi).forEach((s,n)=>{i.forEach(r=>{const o=new RegExp(" "+r+'[^\\w ]*= *"[\\w]*"',"i"),c=s.search(o);c!==-1&&s.substring(c+1).search(o)!==-1&&(s=s.replace(o,""))}),t+=n===0?s:"<action"+s}),t}function Xe(e){return e=e.replace(/<B>/g,"<b>"),e=e.replace(/<\/B>/g,"</b>"),e=e.replace(/<I>/g,"<i>"),e=e.replace(/<\/I>/g,"</i>"),e=e.replace(/<U>/g,"<u>"),e=e.replace(/<\/U>/g,"</u>"),e=e.replace(/£lt£i£gt£/gi,"<i>"),e=e.replace(/£i£/gi,"<i>"),e=e.replace(/£lt£\/i£gt£/gi,"</i>"),e=e.replace(/£\/i£/gi,"</i>"),e=e.replace(/£lt£b£gt£/gi,"<b>"),e=e.replace(/£b£/gi,"<b>"),e=e.replace(/£lt£\/b£gt£/gi,"</b>"),e=e.replace(/£\/b£/gi,"</b>"),e=e.replace(/£lt£u£gt£/gi,"<u>"),e=e.replace(/£u£/gi,"<u>"),e=e.replace(/£lt£\/u£gt£/gi,"</u>"),e=e.replace(/£\/u£/gi,"</u>"),e=e.replace(/£lt£br£gt£/gi,"<br>"),e=e.replace(/£lt£br\/£gt£/gi,"<br>"),e=e.replace(/£br£/gi,"<br>"),e=e.replace(/£br\/£/gi,"<br>"),e=e.replace(/£lt£font/gi,"<font"),e=e.replace(/£lt£\/font£gt£/gi,"</font>"),e=e.replace(/£lt£bold£gt£/gi,"<b>"),e=e.replace(/£lt£\/bold£gt£/gi,"</b>"),e=e.replace(/£lt£/gi,"<"),e=e.replace(/£gt£/gi,">"),e=e.replace(/£inferieurstrict£/gi,"<"),e=e.replace(/£superieurstrict£/gi,">"),e=e.replace(/£guillemet£/gi,'"'),e}function Ze(e){if(!e.includes("£"))return e;const t=e.split("£").map((i,s)=>{if(s%2){const n=i.toLowerCase();return De[n]||`£${i}£`}return i}).join("");return(e.length-e.replace(/£/g,"").length)%2?(console.warn(`Il y a un nombre impair de £ dans cette chaîne : ${e}`),t.substr(0,t.length-1)):t}function He(e,t){let i,s,n;for(n=1,i=t+1;i<e.length&&(s=e.charAt(i),s==="{"?n++:s==="}"&&n--,n!==0);)i++;return n===0?i:-1}function Je(e){return e.indexOf("\\frac")!==-1||e.indexOf("\\sqrt")!==-1||e.indexOf("}^{")!==-1||e.indexOf("}_{")!==-1||e.indexOf("\\widehat{")!==-1||e.indexOf("\\left[")!==-1||e.indexOf("\\left(")!==-1||e.indexOf("\\left|")!==-1||e.indexOf("\\left\\|")!==-1||e.indexOf("\\overrightarrow{")!==-1||e.indexOf("\\text{")!==-1}function K(e){const t={noir:"black",rouge:"red",vert:"green",bleu:"blue",blanc:"white",gris:"grey",darkorange:"maroon"};if(e==="0")return"black";if(t[e])return t[e];const i=s=>s.length<7?"#"+"0".repeat(6-s.length)+s:s.substr(-6);return/^#/.test(e)?e.length===7?e:e.length===4?`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`:(console.error(Error(`couleur ${e} invalide, on va tronquer ou compléter avec des 0`)),i(e.substring(1))):/^0x/.test(e)?i(e.substring(2)):/^[0-9]/.test(e)?i(parseFloat(e).toString(16)):e}function yi(e,t){const i=e.norme(),s=t.norme();return vt(i)||vt(s)?!0:vt((e.x*t.y-e.y*t.x)/i/s)}const Fe=(e,t)=>yi(e,t)&&e.x*t.x+e.y*t.y>=0;function st(e,t,i){let s,n,r=0,o=t;for(;o<e.length;){if(s=e.charAt(o),s==="("){if(n=V(e,o),n===-1)return-1;o=n}else if(s===","&&r++,r===i)return o;o++}return-1}function te(e,t,i){let s;return t*e<0?s=-Math.floor(-e/i)*i:Math.ceil(Math.log(Math.abs(e))/Math.LN10)!==Math.ceil(Math.log(Math.abs(t))/Math.LN10)?(e<0?s=-Math.pow(10,Math.floor(Math.log(Math.abs(e))/Math.LN10)):s=Math.pow(10,Math.ceil(Math.log(Math.abs(e))/Math.LN10)),s=s-Math.floor((s-e)/i)*i):(s=bi(e,Math.floor(Math.log(i)/Math.LN10)),s<e&&(s+=i)),s}function Z(e,t,i,s,n){if(e==="")return;let r,o,c,a,h,p,f,d,g;const b=e.search(/<b>|<i>|<u>|<font/),u=document.createElementNS(l,"tspan");if(u.setAttribute("pointer-events","none"),b===-1||b>0){r="",t.couleur&&(r+="fill:"+t.couleur+";"),t.bold&&(r+="font-weight:bold;"),t.italic&&(r+="font-style:italic;"),t.underline&&(r+="text-decoration:underline;"),t.fontface!==""?r+="font-family:"+t.fontface+";":r+='font-family: "Times New Roman", Times, serif;',r+="font-size:"+t.taille+"px;",u.setAttribute("style",r),s&&(u.setAttribute("x",0),s=!1),u.setAttribute("y",n);const w=b===-1?e:e.substring(0,b);u.appendChild(document.createTextNode(w)),i.appendChild(u),b>0&&Z(e.substring(b),t,i,s,n)}else e.indexOf("<b>")===0?(g=new wt(!0,t.italic,t.underline,t.couleur,t.fontface),o=D(e),Z(o===-1?e.substring(3):e.substring(3,o-4),g,i,s,n)):e.indexOf("<i>")===0?(g=new wt(t.bold,!0,t.underline,t.couleur,t.fontface),o=D(e),Z(o===-1?e.substring(3):e.substring(3,o-4),g,i,s,n)):e.indexOf("<u>")===0?(g=new wt(t.bold,t.italic,!0,t.couleur,t.fontface),o=D(e),Z(o===-1?e.substring(3):e.substring(3,o-4),g,i,s,n)):e.indexOf("<font")===0&&(o=D(e),o===-1&&(o=e.length),c=e.indexOf('face="'),c!==-1?(a=e.indexOf('"',c+6),a!==-1?h=e.substring(c+6,a):h=""):h="",p="",c=e.indexOf('couleur="'),c!==-1?(a=e.indexOf('"',c+9),a!==-1&&(p=K(e.substring(c+9,a)))):(c=e.indexOf('color="'),c!==-1&&(a=e.indexOf('"',c+7),a!==-1&&(p=K(e.substring(c+7,a))))),c=e.indexOf('size="'),c!==-1&&(a=e.indexOf('"',c+6),a!==-1?f=e.substring(c+6,a):f=t.taille),g=new wt(t.bold,t.italic,t.underline,p,h,f),d=e.indexOf(">"),/<\/font>/i.test(e)?Z(e.substring(d+1,o-7),g,i,s,n):Z(e.substring(d+1),g,i,s,n))}function Ye(e){if(["a","c","d","f","g","n","p","r","s","u","v"].some(r=>e.includes(`£${r}(`)))return!0;let t,i,s,n=e;for(;(t=n.search(/£e\(|£i\(/g))!==-1;){if(i=V(n,t+3),i===-1&&(i=n.length),s=n.substring(t,i),s.search(/£e\(|£i\(£lt£font/g)!==-1)return!0;if(i===n.length)return!1;n=s.substring(i+1)}for(n=e;(t=n.search(/£lt£font/g))!==-1;){if(i=D(n.substring(t)),i===-1?i=n.length:i+=t,s=n.substring(t,i),s.search(/£e\(|£i\(/g)!==-1)return!0;if(i===n.length)return!1;n=s.substring(i+1)}return!1}function m(e,t){let i,s,n,r,o,c,a,h,p,f,d,g,b;const u=e;if(u==="")return"";for(;(i=u.indexOf("<font"))!==-1;)return h=null,a=u.substring(i),s=D(a),r=a.indexOf('couleur="'),r!==-1?(o=a.indexOf('"',r+9),o!==-1&&(h=K(a.substring(r+9,o)))):(r=a.indexOf('color="'),r!==-1&&(o=a.indexOf('"',r+7),o!==-1&&(h=K(a.substring(r+7,o))))),h!=null?(c=i+a.indexOf(">")+1,s===-1?m(u.substring(0,i)+"\\textcolor{"+h+"}{"+u.substring(c)+"}",t):(s+=i,m(u.substring(0,i)+"\\textcolor{"+h+"}{"+u.substring(c,s-7)+"}"+u.substring(s),t))):(c=i+a.indexOf(">")+1,s===-1?m(u.substring(0,i)+u.substring(c),t):(s+=i,m(u.substring(0,i)+u.substring(c,s-7)+u.substring(s),t)));for(;(i=u.indexOf("£u("))!==-1;)return s=V(u,i+2),s===-1?u:m(u.substring(0,i),t)+"\\unicode{x"+u.substring(i+3,s)+"}"+m(u.substring(s+1),t);for(;(i=u.indexOf("£f("))!==-1;)return n=st(u,i+3,1),s=V(u,i+2),n===-1||s===-1||n>s?u:m(m(u.substring(0,i),t)+"\\displaystyle{\\frac{"+m(u.substring(i+3,n),!1)+"}{"+m(u.substring(n+1,s),!1)+"}}"+m(u.substring(s+1),t),t);for(;(i=u.indexOf("£r("))!==-1;)return s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\sqrt{"+m(u.substring(i+3,s),!1)+"}"+m(u.substring(s+1),t),t);for(;(i=u.indexOf("£a("))!==-1;)return s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\widehat{"+m(u.substring(i+3,s),!0)+"}"+m(u.substring(s+1),t),t);for(;(i=u.indexOf("£g("))!==-1;)return f=st(u,i+3,1),d=st(u,i+3,2),g=st(u,i+3,3),s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\int_{"+m(u.substring(d+1,g),!1)+"}^{"+m(u.substring(g+1,s),!1)+"}"+m(u.substring(i+3,f),!1)+" d"+m(u.substring(f+1,d),!1)+m(u.substring(s+1),t),t);for(;(i=u.indexOf("£c("))!==-1;)return s=V(u,i+2),s===-1?u:m(u.substring(0,i),t)+"\\left["+m(u.substring(i+3,s),t)+"\\right]"+m(u.substring(s+1),t);for(;(i=u.indexOf("£p("))!==-1;)return s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\left("+m(u.substring(i+3,s),t)+"\\right)"+m(u.substring(s+1),t));for(;(i=u.indexOf("£d("))!==-1;)return s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\left|"+m(u.substring(i+3,s),!1)+"\\right|"+m(u.substring(s+1),t),t);for(;(i=u.indexOf("£n("))!==-1;)return s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\left\\|"+m(u.substring(i+3,s),!1)+"\\right\\|"+m(u.substring(s+1),t));for(;(i=u.indexOf("£i("))!==-1;)return n=st(u,i+3,1),s=V(u,i+2),n===-1||s===-1||n>s?u:m(m(u.substring(0,i),t)+"{"+m(u.substring(i+3,n),!1)+"}_{"+m(u.substring(n+1,s),!1)+"}"+m(u.substring(s+1),t),t);for(;(i=u.indexOf("£e("))!==-1;)return n=st(u,i+3,1),s=V(u,i+2),n===-1||s===-1||n>s?u:m(m(u.substring(0,i),t)+"{"+m(u.substring(i+3,n),!1)+"}^{"+m(u.substring(n+1,s),!1)+"}"+m(u.substring(s+1),t));for(;(i=u.indexOf("£v("))!==-1;)return s=V(u,i+2),s===-1?u:m(m(u.substring(0,i),t)+"\\overrightarrow{"+m(u.substring(i+3,s),!1)+"}"+m(u.substring(s+1),t),t);for(;(i=u.indexOf("<u>"))!==-1;)return s=D(u.substring(i)),s===-1?u:(s+=i,m(u.substring(0,i),t)+"\\underline{"+m(u.substring(i+3,s-4),!0)+"}"+m(u.substring(s),t));for(;(i=u.indexOf("<i>"))!==-1;)return s=D(u.substring(i)),s===-1?m(u.substring(0,i),t)+"\\textit{"+m(u.substring(i+3),!1)+"}":(s+=i,m(u.substring(0,i),t)+"\\textit{"+m(u.substring(i+3,s-4),!1)+"}"+m(u.substring(s),t));for(;(i=u.indexOf("<b>"))!==-1;)return s=D(u.substring(i)),s===-1?m(u.substring(0,i),t)+"\\textbf{"+m(u.substring(i+3),!1)+"}":(s+=i,m(u.substring(0,i),t)+"\\textbf{"+m(u.substring(i+3,s-4),!1)+"}"+m(u.substring(s),t));if(t){if(b=u.charAt(0),b===")"||b===","||b==="}")return b+m(u.substring(1),t);if(Je(u))return u;if(i=u.indexOf("\\textcolor{"),i!==-1){for(p="",a=u;(i=a.indexOf("\\textcolor{"))!==-1;)r=a.indexOf("}{"),s=He(a,r+1),s===-1?i===0?(r+2!==a.length?p+=a.substring(0,r+2)+"\\text{"+a.substring(r+2)+"}":p+=a,a=""):(r+2!==a.length?p+="\\text{"+a.substring(0,i)+"}"+a.substring(i,r+2)+"\\text{"+a.substring(r+2)+"}":p+="\\text{"+a.substring(0,i)+"}"+a.substring(i,r+2),a=""):i===0?(p+=a.substring(0,s+1),s<a.length-1?a=a.substring(s+1):a=""):(p+="\\text{"+a.substring(0,i)+"}"+a.substring(i,r+2)+"\\text{"+a.substring(r+2,s+1)+"}",s<a.length-1?a=a.substring(s+1):a="");return a===""?p:p+"\\text{"+a+"}"}else{let w=0,y=0;for(;u.charAt(y)===" ";)w++,y++;return"~".repeat(w)+"\\text{"+u.substring(y)+"}"}}else return u}function v(e,t){let i,s,n,r,o,c,a,h,p,f,d=e;if(d==="")return"";for(;(i=d.indexOf("<font"))!==-1;)return h=null,a=d.substring(i),s=D(a),r=a.indexOf('couleur="'),r!==-1?(o=a.indexOf('"',r+9),o!==-1&&(h=K(a.substring(r+9,o)))):(r=a.indexOf('color="'),r!==-1&&(o=a.indexOf('"',r+7),o!==-1&&(h=K(a.substring(r+7,o))))),h!==null?(c=i+a.indexOf(">")+1,s===-1?v(d.substring(0,i)+"\\textcolor{"+h+"}{"+d.substring(c)+"}",t):(s+=i,v(d.substring(0,i)+"\\textcolor{"+h+"}{"+d.substring(c,s-7)+"}"+d.substring(s),t))):(c=i+a.indexOf(">")+1,s===-1?v(d.substring(0,i)+d.substring(c),t):(s+=i,v(d.substring(0,i)+d.substring(c,s-7)+d.substring(s),t)));for(;(i=d.indexOf("£u("))!==-1;)return s=V(d,i+2),s===-1?d:v(d.substring(0,i),t)+"\\unicode{x"+d.substring(i+3,s)+"}"+v(d.substring(s+1),t);for(;(i=d.indexOf("£r("))!==-1;)return s=V(d,i+2),s===-1?d:v(v(d.substring(0,i),t)+"\\sqrt{"+v(d.substring(i+3,s),!1)+"}"+v(d.substring(s+1),t),t);for(;(i=d.indexOf("£d("))!==-1;)return s=V(d,i+2),s===-1?d:v(v(d.substring(0,i),t)+"\\left|"+v(d.substring(i+3,s),!1)+"\\right|"+v(d.substring(s+1),t),t);for(;(i=d.indexOf("£n("))!==-1;)return s=V(d,i+2),s===-1?d:v(v(d.substring(0,i),t)+"\\left\\|"+v(d.substring(i+3,s),!1)+"\\right\\|"+v(d.substring(s+1),t));for(;(i=d.indexOf("£i("))!==-1;)return n=st(d,i+3,1),s=V(d,i+2),n===-1||s===-1||n>s?d:v(v(d.substring(0,i),t)+"{"+v(d.substring(i+3,n),!0)+"}_{"+v(d.substring(n+1,s),!1)+"}"+v(d.substring(s+1),t),t);for(;(i=d.indexOf("£e("))!==-1;)return n=st(d,i+3,1),s=V(d,i+2),n===-1||s===-1||n>s?d:v(v(d.substring(0,i),t)+"{"+v(d.substring(i+3,n),!0)+"}^{"+v(d.substring(n+1,s),!1)+"}"+v(d.substring(s+1),t));for(;(i=d.indexOf("£v("))!==-1;)return s=V(d,i+2),s===-1?d:v(v(d.substring(0,i),t)+"\\overrightarrow{"+v(d.substring(i+3,s),!1)+"}"+v(d.substring(s+1),t),t);for(;(i=d.indexOf("<u>"))!==-1;)return s=D(d.substring(i)),s===-1?d:(s+=i,v(d.substring(0,i),t)+"\\underline{"+v(d.substring(i+3,s-4),!0)+"}"+v(d.substring(s),t));for(;(i=d.indexOf("<i>"))!==-1;)return s=D(d.substring(i)),s===-1?v(d.substring(0,i),t)+"\\textit{"+v(d.substring(i+3),!1)+"}":(s+=i,v(d.substring(0,i),t)+"\\textit{"+v(d.substring(i+3,s-4),!1)+"}"+v(d.substring(s),t));for(;(i=d.indexOf("<b>"))!==-1;)return s=D(d.substring(i)),s===-1?v(d.substring(0,i),t)+"\\textbf{"+v(d.substring(i+3),!1)+"}":(s+=i,v(d.substring(0,i),t)+"\\textbf{"+v(d.substring(i+3,s-4),!1)+"}"+v(d.substring(s),t));if(t){if(Je(d))return d;if(i=d.indexOf("\\textcolor{"),i!==-1){for(p="",a=d;(i=a.indexOf("\\textcolor{"))!==-1;)r=a.indexOf("}{"),s=He(a,r+1),s===-1?i===0?(r+2!==a.length?p+=a.substring(0,r+2)+"\\text{"+a.substring(r+2)+"}":p+=a,a=""):(r+2!==a.length?p+="\\text{"+a.substring(0,i)+"}"+a.substring(i,r+2)+"\\text{"+a.substring(r+2)+"}":p+="\\text{"+a.substring(0,i)+"}"+a.substring(i,r+2),a=""):i===0?(p+=a.substring(0,s+1),s<a.length-1?a=a.substring(s+1):a=""):(p+="\\text{"+a.substring(0,i)+"}"+a.substring(i,r+2)+"\\text{"+a.substring(r+2,s+1)+"}",s<a.length-1?a=a.substring(s+1):a="");return a===""?p:p+"\\text{"+a+"}"}else{if(f=d.charAt(0),f===")"||f===","||f==="}")return d;{let g="";for(;d.indexOf(" ")===0;)g+="~",d=d.substring(1);return g+"\\text{"+d+"}"}}}else return d}function dt(e,t={}){if(!e||typeof e!="object")throw Error("objet invalide");const i=t.defaut||20,s=t.min||5,n=t.max||199;if(typeof i!="number"||typeof s!="number"||typeof n!="number")throw Error("options invalides");const r=Number(e.taille);return isNaN(r)?(console.error(Error(`taille invalide (${e.taille}) => ${i}`)),i):r<s?(console.error(Error(`taille trop petite (${e.taille} < ${s}) => ${i}`)),i):r>n?(console.error(Error(`taille trop grande (${e.taille} > ${n}) => ${i}`)),i):r}function P(e,t,i,s){arguments.length>2?(this.x=i-e,this.y=s-t):(this.x=e,this.y=t)}P.prototype.presqueNul=function(){return vt(this.x)&&vt(this.y)};P.prototype.norme=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};P.prototype.vecteurColineaire=function(e){const t=this.norme();return new P(this.x/t*e,this.y/t*e)};P.prototype.tourne=function(e){const t=Math.cos(e*H),i=Math.sin(e*H);return new P(t*this.x-i*this.y,t*this.y+i*this.x)};P.prototype.angle=function(){let e;return this.x===0&&this.y===0?0:(this.x===0?this.y>0?e=3*Math.PI/2:e=Math.PI/2:(this.x>=0?e=Math.atan(-this.y/this.x):e=Math.PI-Math.atan(this.y/this.x),e<0&&(e=e+2*Math.PI)),e*pi)};function C(e){this.doc=e,this.x=200,this.y=400,this.angle=0,this.zoomfactor=1,this.visible=!1}C.prototype.montre=function(e){this.visible=e,this.g.setAttribute("visibility",e?"visible":"hidden")};C.prototype.updateg=function(){this.initialisePosition(),this.doc.svg.removeChild(this.g),this.doc.svg.appendChild(this.g)};C.prototype.translate=function(e,t){this.setPosition(e,t,this.angle,this.zoomfactor)};C.prototype.angleInit=function(){return 0};C.prototype.setPosition=function(e,t,i,s){let n;this.x=e,this.y=t,this.angle=i,arguments.length>=4?(n=s,this.zoomfactor=n):n=this.zoomfactor,this.g.setAttribute("transform","scale("+n+") translate("+String(e/n)+","+String(t/n)+") rotate("+i+")")};C.prototype.initialisePosition=function(){this.setPosition(200,400,this.angleInit(),1)};C.prototype.lanceAnimationTranslation=function(e,t,i){this.xfin=e,this.yfin=t,this.pix=Math.abs(i/2);const s=new P(this.x,this.y,e,t);if(this.dist=s.norme(),this.dist===0){this.doc.actionSuivante();return}this.vect=s.vecteurColineaire(this.pix);const n=this;this.timer=setInterval(function(){n.actionPourTranslation()},25)};C.prototype.actionPourTranslation=function(){const e=this.x+this.vect.x,t=this.y+this.vect.y,s=new P(e,t,this.xfin,this.yfin).norme();s>this.dist||!this.doc.animationEnCours?(this.setPosition(this.xfin,this.yfin,this.angle),this===this.doc.compas&&this.doc.compasLeve!=null&&this.doc.compasLeve.visible&&this.doc.compasLeve.setPosition(this.xfin,this.yfin,this.angle),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=s,this.setPosition(e,t,this.angle),this===this.doc.compas&&this.doc.compasLeve!=null&&this.doc.compasLeve.visible&&this.doc.compasLeve.setPosition(e,t,this.angle))};C.prototype.lanceAnimationRotation=function(e,t){const i=It(this.angle);let s=It(e);Math.abs(s-i)>180&&(s>i?s=s-360:s=s+360),this.anglefin=s,this.angle=i,this.pasdeg=t/3,this.pasdeg*=s>=i?1:-1,this.distang=Math.abs(s-this.angle);const n=this;this.timer=setInterval(function(){n.actionPourRotation()},25)};C.prototype.actionPourRotation=function(){const e=parseFloat(this.angle)+parseFloat(this.pasdeg),t=Math.abs(e-this.anglefin);t>this.distang||!this.doc.animationEnCours?(this.setPosition(this.x,this.y,this.anglefin),clearInterval(this.timer),this.doc.actionSuivante()):(this.distang=t,this.setPosition(this.x,this.y,e))};C.prototype.lanceAnimationZoom=function(e,t){this.zoomfin=e,this.vitesse=parseInt(t),this.pas=this.vitesse*.05*(this.zoomfin-this.zoomfactor),this.senspos=this.pas>=0;const i=this;this.timer=setInterval(function(){i.actionPourZoom()},100)};C.prototype.actionPourZoom=function(){const e=this.zoomfactor+this.pas;this.doc.animationEnCours&&(this.senspos&&e<this.zoomfin||!this.senspos&&e>this.zoomfin)?this.setPosition(this.x,this.y,this.angle,e):(this.zoomfactor=this.zoomfin,this.positionne(),clearInterval(this.timer),this.doc.actionSuivante())};C.prototype.positionne=function(){this.setPosition(this.x,this.y,this.angle,this.zoomfactor)};function U(e){C.call(this,e),this.ecart=0,this.bretourne=!1,this.leve=!1,this.lon=185,this.longpointe=18;const t=this.lon+this.longpointe;this.alp=Math.asin(this.ecart/(2*t))/Math.PI*180,this.decbh=30,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle,1),e.svg.appendChild(this.g)}U.prototype=new C;U.prototype.initialisePosition=function(){C.prototype.initialisePosition.call(this),this.ecart=0,this.positionne()};U.prototype.creeg=function(){let e,t,i,s;const n=this.lon,r=this.longpointe,o=7,c=20,a=6,h=3.5,p=3,f=12,d=35,g=6,b=50,u=3,w=document.createElementNS(l,"g");this.bg=document.createElementNS(l,"g"),e=document.createElementNS(l,"line"),e.setAttribute("x1",0),e.setAttribute("y1",0),e.setAttribute("x2",0),e.setAttribute("y2",-r),e.setAttribute("style","stroke: black; stroke-width:1.5;"),this.bg.appendChild(e),t=document.createElementNS(l,"path"),i="M0 "+String(-r)+"L 0 "+String(-r-n)+" "+String(-o)+" "+String(-r-n)+" "+String(-o)+" "+String(-r)+"Z",t.setAttribute("d",i),t.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bg.appendChild(t),s=document.createElementNS(l,"circle"),s.setAttribute("cx",-o/2),s.setAttribute("cy",-r-c),s.setAttribute("r",a),s.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bg.appendChild(s),s=document.createElementNS(l,"circle"),s.setAttribute("cx",-o/2),s.setAttribute("cy",-r-c),s.setAttribute("r",2),s.setAttribute("style","stroke:black;stroke-width:1; fill: silver; fill-opacity: 1"),this.bg.appendChild(s),w.appendChild(this.bg),this.bd=document.createElementNS(l,"g"),t=document.createElementNS(l,"path"),i="M 0 0 L0 "+String(-r)+" "+h+" "+String(-r-h)+" "+h+" "+String(-h-3)+"Z",t.setAttribute("style","stroke:black;stroke-width:0.75; fill: blck; fill-opacity: 1"),t.setAttribute("d",i),this.bd.appendChild(t),t=document.createElementNS(l,"path"),i="M0 "+String(-r)+"L 0 "+String(-r-n)+" "+o+" "+String(-r-n)+" "+o+" "+String(-r)+"Z",t.setAttribute("d",i),t.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bd.appendChild(t),t=document.createElementNS(l,"path");const y=a/4*3,S=a/2;i="M"+o+" "+String(-r-c+y)+"A "+y+" "+S+" -90 0 0 "+o+" "+String(-r-c-y)+"Z",t.setAttribute("style","stroke:black;stroke-width:1; fill: silver; fill-opacity: 1"),t.setAttribute("d",i),this.bd.appendChild(t);const j="stroke: black; stroke-width:1;";e=document.createElementNS(l,"line"),e.setAttribute("x1",0),e.setAttribute("y1",-100),e.setAttribute("x2",o),e.setAttribute("y2",-100+o),e.setAttribute("style",j),this.bd.appendChild(e),e=document.createElementNS(l,"line"),e.setAttribute("x1",0),e.setAttribute("y1",-50),e.setAttribute("x2",o),e.setAttribute("y2",-50),e.setAttribute("style",j),this.bd.appendChild(e),e=document.createElementNS(l,"line"),e.setAttribute("x1",o/2),e.setAttribute("y1",-50),e.setAttribute("x2",o/2),e.setAttribute("y2",-73),e.setAttribute("style",j),this.bd.appendChild(e);const M=document.createElementNS(l,"rect");M.setAttribute("x",o),M.setAttribute("y",-68),M.setAttribute("width",4),M.setAttribute("height",12),M.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),this.bd.appendChild(M),w.appendChild(this.bd),this.haut=document.createElementNS(l,"g"),t=document.createElementNS(l,"path"),i="M 0 0 L"+p+" 0 "+f+" "+String(-24)+" "+f+" "+String(-d)+"A"+String(b-d)+" "+String(f-g)+" -90 0 1 "+g+" "+String(-b)+"L"+u+" "+String(-70)+" "+String(-u)+" "+String(-70)+"L"+String(-g)+" "+String(-b)+"A"+String(b-d)+" "+String(f-g)+" 90 0 1 "+String(-f)+" "+String(-d)+" L "+String(-f)+" "+String(-24)+" "+String(-p)+" 0Z",t.setAttribute("d",i),t.setAttribute("style","stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1"),this.haut.appendChild(t),e=document.createElementNS(l,"line"),e.setAttribute("x1",g),e.setAttribute("y1",-b),e.setAttribute("x2",-g),e.setAttribute("y2",-b),e.setAttribute("style","stroke: black; stroke-width:1;"),this.haut.appendChild(e);const I=document.createElementNS(l,"text");I.setAttribute("pointer-events","none"),I.appendChild(document.createTextNode("Sésamath")),I.setAttribute("x",0),I.setAttribute("y",0),I.setAttribute("style","font-family: Arial;font-size: 5pt;fill: white"),I.setAttribute("transform","rotate(-90) translate(4,2.5)"),this.haut.appendChild(I),s=document.createElementNS(l,"circle"),s.setAttribute("cx",-o+1),s.setAttribute("cy",-this.decbh),s.setAttribute("r",3),s.setAttribute("style","stroke:black;stroke-width:1; fill: white; fill-opacity: 1"),this.haut.appendChild(s),s=document.createElementNS(l,"circle"),s.setAttribute("cx",o-1),s.setAttribute("cy",-this.decbh),s.setAttribute("r",3),s.setAttribute("style","stroke:black;stroke-width:1; fill: white; fill-opacity: 1"),this.haut.appendChild(s),w.appendChild(this.haut),this.g=w};U.prototype.setPosition=function(e,t,i,s){let n;arguments.length>=4?(n=s,this.zoomfactor=n):n=this.zoomfactor,this.x=e,this.y=t,this.angle=i;const r=this.lon+this.longpointe;let o=this.ecart/(2*r*n);if(o>1&&(o=1),this.alp=Math.asin(o)/Math.PI*180,isNaN(this.alp))console.error(Error("dans compas.setPosition on a alp qui est NaN")),this.doc.debug&&console.debug(`avec x=${e}, y=${t}, angle=${i} et zoom=${n} on a d=${r} et ecart=${this.ecart} asin(${this.ecart}/${2*r*n}/π*180) donne NaN`);else{this.bg.setAttribute("transform",`rotate(${this.alp})`),this.bd.setAttribute("transform",`translate(${this.ecart/n}, 0) rotate(${-this.alp})`);const c=this.alp/180*Math.PI,a=this.ecart/2/n,h=-r*Math.cos(c)+this.decbh;this.haut.setAttribute("transform",`translate(${a},${h})`);const p=this.bretourne?`scale(${n},${-n})`:`scale(${n})`;this.g.setAttribute("transform",`${p} translate(${e/n},${t/n}) rotate(${i})`)}};U.prototype.retourne=function(){this.bretourne=!this.bretourne,this.setPosition(this.x,this.y,this.angle)};U.prototype.positionne=function(){C.prototype.positionne.call(this),this.leve&&this.doc.compasLeve!=null&&C.prototype.positionne.call(this.doc.compasLeve)};U.prototype.translate=function(e,t){C.prototype.translate.call(this,e,t),this.leve&&this.doc.compasLeve!=null&&C.prototype.translate.call(this.doc.compasLeve,e,t)};U.prototype.lanceAnimationEcartement=function(e,t){this.ecartfin=parseFloat(e),this.pasecart=t/4,this.pasecart*=e>=this.ecart?1:-1,this.distecart=Math.abs(e-this.ecart);const i=this;this.timer=setInterval(function(){i.actionPourEcartement()},25)};U.prototype.actionPourEcartement=function(){const e=this.ecart+this.pasecart,t=Math.abs(e-this.ecartfin);t>this.distecart||!this.doc.animationEnCours?(this.ecart=this.ecartfin,this.setPosition(this.x,this.y,this.angle),clearInterval(this.timer),this.doc.actionSuivante()):(this.distecart=t,this.ecart=e,this.setPosition(this.x,this.y,this.angle))};function se(e){C.call(this,e),this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),e.svg.appendChild(this.g)}se.prototype=new C;se.prototype.creeg=function(){let e,t;const o=103.83969465648855,c=16,a=131/223*(223-c),h=document.createElementNS(l,"g");e=document.createElementNS(l,"path"),t="M 0 0 L 131 0 L 0 "+String(-223)+" Z";const p="M 24 "+String(-31)+" L 24 "+String(-31-o)+" L "+String(85)+" "+String(-31)+" Z";t+=p,e.setAttribute("d",t),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: #c6cbe8; fill-opacity: 0.5"),h.appendChild(e),e=document.createElementNS(l,"path"),t="M "+c+" "+String(-c)+" L "+a+" "+String(-c)+" L "+c+" "+-195.76335877862596+" Z",t+=p,e.setAttribute("d",t),e.setAttribute("style","stroke-width:0; fill: #c6cbe8; fill-opacity: 0.5"),h.appendChild(e);const f=document.createElementNS(l,"text");f.setAttribute("pointer-events","none"),f.appendChild(document.createTextNode("Sésamath")),f.setAttribute("x",24),f.setAttribute("y",-c/2-5),f.setAttribute("style","font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon"),h.appendChild(f),this.g=h};function St(e){C.call(this,e),this.graduationExterneVisible=!0,this.graduationInterneVisible=!0,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),e.svg.appendChild(this.g)}St.prototype=new C;St.prototype.creeg=function(){let e,t,i,s,n;const c="13",h=String(156),p=89,f=String(p),d="116",g="7",b=document.createElementNS(l,"g");for(t=document.createElementNS(l,"path"),e="M "+h+" 0 A "+h+" "+h+" 0 0 0 -"+h+" 0 L -"+h+" "+c+" L "+h+" "+c+" L "+h+" 0",e+="M 0 0 L -"+f+" 0 A "+f+" "+f+" 0 0 1 "+f+" 0 Z",t.setAttribute("d",e),t.setAttribute("style","stroke:#999999;stroke-width:1; fill: #c6cbe8; fill-opacity: 0.5"),b.appendChild(t),t=document.createElementNS(l,"path"),e="M "+g+" 0 A "+g+" "+g+" 0 0 0 -"+g+" 0 M 0 0 L 0 -"+g,t.setAttribute("d",e),t.setAttribute("style","stroke: #666666;stroke-width:1; fill: none"),b.appendChild(t),s=0;s<=180;s++)i=document.createElementNS(l,"line"),i.setAttribute("x1",h),i.setAttribute("y1",0),i.setAttribute("x2",s%10===0?136:s%5===0?146:151),i.setAttribute("y2",0),i.setAttribute("transform","rotate(-"+s+")"),i.setAttribute("style","stroke: #333333;stroke-width:0.7;"),b.appendChild(i);for(this.gradext=document.createElementNS(l,"g"),s=0;s<=180;s++)s%10===0&&(n=document.createElementNS(l,"text"),n.setAttribute("pointer-events","none"),n.appendChild(document.createTextNode(s)),n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("style","font-family: arial;font-size: 10px;text-anchor: middle; fill: black"),n.setAttribute("transform"," scale(-1) rotate("+String(-s-90)+") translate(0,"+String(-124)+")"),this.gradext.appendChild(n));b.appendChild(this.gradext);const u=120;for(t=document.createElementNS(l,"path"),e="M "+String(u)+" 0 L "+d+" 0 A "+d+" "+d+" 0 0 0 -"+d+" 0 L "+String(-u)+" 0",t.setAttribute("d",e),t.setAttribute("style","stroke: #666666;stroke-width:1; fill: none"),b.appendChild(t),s=0;s<=18;s++)i=document.createElementNS(l,"line"),i.setAttribute("x1",p),i.setAttribute("y1",0),i.setAttribute("x2",p+10),i.setAttribute("y2",0),i.setAttribute("transform","rotate(-"+String(10*s)+")"),i.setAttribute("style","stroke: #333333;stroke-width:0.7;"),b.appendChild(i);for(this.gradint=document.createElementNS(l,"g"),s=0;s<=18;s++)n=document.createElementNS(l,"text"),n.setAttribute("pointer-events","none"),n.appendChild(document.createTextNode(180-10*s)),n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("style","font-family: arial;font-size: 9px;text-anchor: middle; fill: black"),n.setAttribute("transform","scale(-1) rotate("+String(-10*s-90)+") translate(0,"+String(-p-14)+")"),this.gradint.appendChild(n);b.appendChild(this.gradint);const w=document.createElementNS(l,"circle");w.setAttribute("cx",0),w.setAttribute("cy",0),w.setAttribute("r",2),w.setAttribute("style","stroke: black; stroke-width: 1;fill: none"),b.appendChild(w),n=document.createElementNS(l,"text"),n.setAttribute("pointer-events","none"),n.appendChild(document.createTextNode("Sésamath")),n.setAttribute("x",0),n.setAttribute("y",c-2),n.setAttribute("style","font-family: sans-serif;font-size: 7pt;font-weight:bold;text-anchor: middle; fill: maroon"),b.appendChild(n),this.g=b};St.prototype.montreGraduations=function(e){this.graduationInterneVisible=!0,this.visible&&this.gradint.setAttribute("visibility",e?"visible":"hidden")};St.prototype.montreGraduationsExternes=function(e){this.graduationExterneVisible=!0,this.visible&&this.gradext.setAttribute("visibility",e?"visible":"hidden")};St.prototype.montre=function(e){C.prototype.montre.call(this,e),e?(this.gradint.setAttribute("visibility",this.graduationInterneVisible?"visible":"hidden"),this.gradext.setAttribute("visibility",this.graduationExterneVisible?"visible":"hidden")):(this.gradint.setAttribute("visibility","hidden"),this.gradext.setAttribute("visibility","hidden"))};function Et(e){C.call(this,e),this.x=100,this.y=400,this.angle=0,this.longueur=15,this.graduationVisible=!0,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),e.svg.appendChild(this.g)}Et.prototype=new C;Et.prototype.creeg=function(){let e,t;const s=this.longueur*30+15,r=String(57),o=6,c=String(o),a=document.createElementNS(l,"g"),h=document.createElementNS(l,"rect");h.setAttribute("x",-c-1),h.setAttribute("y",0),h.setAttribute("width",String(s+o+1)),h.setAttribute("height",r),h.setAttribute("rx",c),h.setAttribute("ry",c),h.setAttribute("style","stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5;"),a.appendChild(h);const p=document.createElementNS(l,"line");p.setAttribute("x1",-c),p.setAttribute("y1",27),p.setAttribute("x2",s),p.setAttribute("y2",27),p.setAttribute("style","stroke:#999999;stroke-width:2;"),a.appendChild(p),this.graduations=document.createElementNS(l,"g");for(let f=0;f<=this.longueur*10;f++){e=document.createElementNS(l,"line");const d=3*f;e.setAttribute("x1",d),e.setAttribute("y1",0),e.setAttribute("x2",d),e.setAttribute("y2",f%10===0?12:f%5===0?9:6),f%10===0&&(t=document.createElementNS(l,"text"),t.setAttribute("pointer-events","none"),t.appendChild(document.createTextNode(String(f/10))),t.setAttribute("x",d),t.setAttribute("y",21),t.setAttribute("style","font-family: monospace;font-size: 9pt;text-anchor:middle"),this.graduations.appendChild(t)),e.setAttribute("style","stroke:black;stroke-width:0.7;"),this.graduations.appendChild(e)}t=document.createElementNS(l,"text"),t.setAttribute("pointer-events","none"),t.appendChild(document.createTextNode("Sésamath")),t.setAttribute("x",s/2-o-3),t.setAttribute("y",r-5),t.setAttribute("style","font-family: Arial;font-size: 8pt;font-weight:bold;fill: maroon;text-anchor:middle;"),a.appendChild(t),a.appendChild(this.graduations),this.g=a};Et.prototype.montreGraduations=function(e){this.graduationVisible=e,this.graduations.setAttribute("visibility",this.visible&&e?"visible":"hidden")};Et.prototype.montre=function(e){C.prototype.montre.call(this,e),e?this.graduations.setAttribute("visibility",this.graduationVisible?"visble":"hidden"):this.graduations.setAttribute("visibility","hidden")};Et.prototype.initialisePosition=function(){if(this.longueur!==15){this.longueur=15;const e=this.visible,t=this.g;this.creeg(),this.g.setAttribute("visibility",e?"visible":"hidden"),this.doc.svg.replaceChild(this.g,t)}C.prototype.initialisePosition.call(this)};function Ct(e){C.call(this,e),this.x=200,this.y=400,this.angle=0,this.zoomfactor=1,this.abscisse=0,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),e.svg.appendChild(this.g)}Ct.prototype=new C;Ct.prototype.creeg=function(){let e,t;const p="stroke:#999999;stroke-width:2; fill: #c6cbe8; fill-opacity: 0.5",f=document.createElementNS(l,"g");e=document.createElementNS(l,"path"),t="M 0 0 L "+String(167)+" 0 A 5 5 0 0 1 "+String(172)+" 5 L "+String(172)+" "+String(52)+" A 5 5 90 0 1 "+String(167)+" "+String(57)+" L "+String(-251)+" 57 A 5 5 180 0 1 -256 "+String(52)+" L "+String(-256)+" 5 A 5 5 -90 0 1 "+String(-251)+" 0Z";const d=42,g="M"+String(158)+" "+d+"A 6 6 180 0 0 "+String(146)+" "+String(d)+"A 6 6 180 0 0 "+String(158)+" "+String(d);t+=g,e.setAttribute("d",t),e.setAttribute("style",p),f.appendChild(e),e=document.createElementNS(l,"path"),t="M"+String(172)+" "+String(16)+"L"+String(172)+" "+String(52)+" A 5 5 90 0 1 "+String(167)+" "+String(57)+" L "+String(-251)+" 57 A 5 5 180 0 1 -256 "+String(52)+" L "+String(-256)+" "+String(16)+"Z"+g,e.setAttribute("d",t),e.setAttribute("style",p),f.appendChild(e);const b=document.createElementNS(l,"line");b.setAttribute("x1",0),b.setAttribute("y1",8),b.setAttribute("x2",0),b.setAttribute("y2",0),b.setAttribute("style","stroke: black"),f.appendChild(b);const u={};se.prototype.creeg.call(u),this.gequerre=u.g,this.gequerre.setAttribute("transform","scale(0.7)"),f.appendChild(this.gequerre),this.setAbs(this.abscisse),this.g=f};Ct.prototype.setAbs=function(e){this.abscisse=e,this.gequerre.setAttribute("transform","translate("+e+",0)")};Ct.prototype.lanceAnimationGlissement=function(e,t){this.absfin=e,this.pix=e>=this.abscisse?t/4:-t/4,this.dist=Math.abs(e-this.abscisse);const i=this;this.timer=setInterval(function(){i.actionPourGlissement()},25)};Ct.prototype.actionPourGlissement=function(){const e=this.abscisse+this.pix,t=Math.abs(this.absfin-e);t>this.dist||!this.doc.animationEnCours?(this.setAbs(this.absfin),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=t,this.setAbs(e))};function ne(e){C.call(this,e),this.angle=this.angleInit(),this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(this.x,this.y,this.angle),e.svg.appendChild(this.g)}ne.prototype=new C;ne.prototype.angleInit=function(){return-40};ne.prototype.creeg=function(){let e,t,i,s,n;const p=document.createElementNS(l,"g");e=document.createElementNS(l,"defs"),s=document.createElementNS(l,"linearGradient"),s.setAttribute("id","gradpointe"),n=document.createElementNS(l,"stop"),n.setAttribute("offset","0%"),n.setAttribute("style","stop-color: #f00000;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","50%"),n.setAttribute("style","stop-color: #eeb444;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","100%"),n.setAttribute("style","stop-color: #f00000"),s.appendChild(n),s.setAttribute("x1","0%"),s.setAttribute("y1","0%"),s.setAttribute("x2","0%"),s.setAttribute("y2","100%"),e.appendChild(s),p.appendChild(e),e=document.createElementNS(l,"defs"),s=document.createElementNS(l,"linearGradient"),s.setAttribute("id","gradcorps"),n=document.createElementNS(l,"stop"),n.setAttribute("offset","0%"),n.setAttribute("style","stop-color: #810216;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","25%"),n.setAttribute("style","stop-color: #c64f00;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","50%"),n.setAttribute("style","stop-color: #ab4a36"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","75%"),n.setAttribute("style","stop-color: #c64f00;"),s.appendChild(n),n=document.createElementNS(l,"stop"),n.setAttribute("offset","100%"),n.setAttribute("style","stop-colr: #810216;"),s.appendChild(n),s.setAttribute("x1","0%"),s.setAttribute("y1","0%"),s.setAttribute("x2","0%"),s.setAttribute("y2","100%"),e.appendChild(s),p.appendChild(e),t=document.createElementNS(l,"path");const f=4.5/3,d=f*3/4,g="A"+f+" "+d+" -90 0 0 15 "+String(f)+"A"+f+" "+d+" -90 0 1 15 "+String(-f)+"A"+f+" "+d+" -90 0 0 15 "+String(-4.5);i="M 0 0 L15 "+4.5+g+"Z",t.setAttribute("d",i),t.setAttribute("style","stroke:black; stroke-width:0.5; fill: url(#gradpointe); fill-opacity: 1;"),p.appendChild(t),t=document.createElementNS(l,"path"),i="M 0 0 L 3 "+.9+" 3 "+String(-.9)+"Z",t.setAttribute("d",i),t.setAttribute("style","stroke:black; stroke-width:0.5; fill: black; fill-opacity: 1;"),p.appendChild(t),t=document.createElementNS(l,"path"),i="M 15 "+4.5+g+" L 97 "+String(-4.5)+" L 97 "+String(4.5)+"Z",t.setAttribute("d",i),t.setAttribute("style","stroke:black; stroke-width:0.5; fill: url(#gradcorps); fill-opacity: 1;"),p.appendChild(t);const b=document.createElementNS(l,"circle");b.setAttribute("r",4.5),b.setAttribute("cx",97),b.setAttribute("cy",0),b.setAttribute("style","stroke:blue; stroke-width:0.5; fill: blue; fill-opacity: 1;"),p.appendChild(b),this.g=p};function x(e,t){arguments.length!==0&&(this.doc=e,typeof t=="string"&&(t=Number(t)),this.tempo=typeof t=="number"&&t>0&&Number.isFinite(t)?t*100:null,this.isReady=!1)}x.prototype.setReady=function(){this.isReady=!0};x.prototype.creegElement=function(){};x.prototype.actionVisible=function(){return!0};function jt(e,t){x.call(this,e,t)}jt.prototype=new x;jt.prototype.execute=function(e){const t=this.doc.compas,i=this.doc.compasLeve;t.leve&&(i.montre(!1),t.setPosition(i.x,i.y,i.angle)),!e&&t.visible&&t.montre(!0),t.leve=!1,e||this.doc.actionSuivante(e)};jt.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas.compas,this.indice-1)?this.doc.getCompasStatus(this.indice-1)==="leve":!1};function k(e,t,i){this.doc=e,this.id=t,this.couleur=i,this.zoomfactor=1,this.visible=!1,this.objet="trait"}k.prototype.positionne=function(){};k.prototype.initialisePosition=function(){};k.prototype.translate=function(e,t){this.setPosition(e,t,this.angle,this.zoomfactor)};k.prototype.tourne=function(e){this.setPosition(this.x,this.y,e,this.zoomfactor)};k.prototype.zoom=function(e){this.zoomfactor=e,this.setPosition(this.x,this.y,this.angle,e)};k.prototype.montre=function(e){this.visible=e,this.g&&this.g.setAttribute("visibility",e?"visible":"hidden")};k.prototype.lanceAnimationTranslation=function(e,t,i){this.xfin=e,this.yfin=t,this.pix=Math.abs(i/4);const s=new P(this.x,this.y,e,t);if(this.dist=s.norme(),this.dist===0){this.translate(this.xfin,this.yfin),this.doc.actionSuivante();return}this.vect=s.vecteurColineaire(this.pix);const n=this;this.timer=setInterval(function(){n.actionPourTranslation()},25)};k.prototype.actionPourTranslation=function(){const e=this.x+this.vect.x,t=this.y+this.vect.y,s=new P(e,t,this.xfin,this.yfin).norme();s>this.dist||!this.doc.animationEnCours?(this.translate(this.xfin,this.yfin),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=s,this.translate(e,t))};k.prototype.lanceAnimationRotation=function(e,t){const i=It(this.angle);let s=It(e);Math.abs(s-i)>180&&(s>i?s=s-360:s=s+360),this.anglefin=s,this.angle=i,this.pasdeg=t*2/3,this.pasdeg*=e>=this.angle?1:-1,this.distang=Math.abs(e-this.angle);const n=this;this.timer=setInterval(function(){n.actionPourRotation()},25)};k.prototype.actionPourRotation=function(){const e=parseFloat(this.angle)+parseFloat(this.pasdeg),t=Math.abs(e-this.anglefin);t>this.distang||!this.doc.animationEnCours?(this.tourne(this.anglefin),clearInterval(this.timer),this.doc.actionSuivante()):(this.distang=t,this.tourne(e))};k.prototype.lanceAnimationZoom=function(e,t){this.zoomfin=e,this.vitesse=parseInt(t),this.pas=this.vitesse*.05*(this.zoomfin-this.zoomfactor),this.senspos=this.pas>=0;const i=this;this.timer=setInterval(function(){i.actionPourZoom()},100)};k.prototype.actionPourZoom=function(){const e=this.zoomfactor+this.pas;this.doc.animationEnCours&&(this.senspos&&e<this.zoomfin||!this.senspos&&e>this.zoomfin)?this.zoom(e):(this.zoom(this.zoomfin),clearInterval(this.timer),this.doc.actionSuivante())};k.prototype.updateg=function(){const e=this.g;this.creeg(),this.doc.svg.replaceChild(this.g,e),this.doc.setElement(this.id,this),this.g.setAttribute("visibility","visible")};k.prototype.creationAnimee=function(){return!1};k.prototype.finAction=function(){};function tt(e,t,i,s){k.call(this,e,t,"black"),this.x=parseFloat(i),this.y=parseFloat(s),this.xinit=this.x,this.yinit=this.y,this.taille=20,this.angle=0,this.texte="",this.objet="texte"}tt.prototype=new k;tt.prototype.positionne=function(){this.setPosition(this.x,this.y,this.angle,this.zoomfactor)};tt.prototype.translate=function(e,t){this.x=e,this.y=t,this.positionne()};tt.prototype.updateg=function(e){const t=this.g;if(!t)return console.error("Il faut appeler creeg avant updateg");this.doc.svg.replaceChild(e,t),this.g=e,e.setAttribute("visibility","visible")};tt.prototype.creeg=function(){this.g=document.createElementNS(l,"g")};tt.prototype.setPosition=function(e,t,i,s){this.x=e,this.y=t,this.angle=i,this.zoomfactor=s;const n=dt(this),r=t+n;this.g.setAttribute("transform","scale("+s+") translate("+String(e/s)+","+String(r/s)+") rotate("+i+")")};function $(e,t,i,s,n){x.call(this,e,s),this.id=t;const r=this.doc.getElement(t,i.objet);this.objetRemplace=r===null?null:r,this.objet=i,this.vitesse=arguments.length>=5&&n!=null?Math.abs(parseFloat(n)):8,this.objetRemplace!==null?this.doc.addElement(this.objet):this.doc.pushElement(this.objet)}$.prototype=new x;$.prototype.execute=function(e){this.objet instanceof tt&&(this.objet.x=this.objet.xinit,this.objet.y=this.objet.yinit),this.objetRemplace!==null&&this.objetRemplace.montre(!1),this.objet.creationAnimee()&&!e?this.objet.lanceAnimation(this.vitesse):(this.objet.montre(!0),e?this.objet.finAction():this.doc.actionSuivante())};$.prototype.creegElement=function(){const e=this.doc,t=this.objet;t.creeg(),t.positionne(),t.g.setAttribute("visibility","hidden"),e.svg.appendChild(t.g)};$.prototype.actionVisible=function(){return!(this.objet instanceof tt)};function re(e,t,i,s){x.call(this,e,i),this.ecartement=t,this.ec10=s===null?16:parseFloat(s)}re.prototype=new x;re.prototype.execute=function(e){e?(this.doc.compas.ecart=this.ecartement,this.doc.compas.positionne()):this.doc.compas.lanceAnimationEcartement(this.ecartement,this.ec10)};re.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas,this.indice-1)};function Y(e,t,i,s,n,r,o,c,a,h,p,f,d,g,b,u){x.call(this,e,u),this.txt=this.doc.getElement(t,"texte"),this.id=t,this.couleur=i,this.taille=s==null?"20":s.replace(/O/g,"0"),this.style=r===null?"texte":r,this.couleurFond=o,this.opaciteFond=c==null?"0.6":parseFloat(c)/100,this.couleurCadre=a,h!==null&&a===null&&(this.couleurCadre=i),this.epaisseurCadre=h??(a==null?0:1),this.marge=p==null?0:parseFloat(p),this.margeGauche=f==null?0:parseFloat(f),this.margeDroite=d==null?0:parseFloat(d),this.margeHaut=g==null?0:parseFloat(g),this.margeBas=b==null?0:parseFloat(b),this.texte=n,this.estLatex=this.estAffichageLatex(),this.estLatex||(this.texte=Xe(Ze(this.texte)),this.texte=this.traduitCaracteresGrecs(this.texte),this.texte=this.texte.replace(/\*/g,"×"),Ye(n)&&(this.texte="$"+this.traiteMaths(this.texte)+"$",this.estLatex=!0))}Y.prototype=new x;Y.prototype.execute=function(e){if(this.txt!=null){this.angle=0;const t=this.txt;t.couleur=this.couleur,t.taille=this.taille,t.texte=this.texte,t.couleurFond=this.couleurFond,t.couleurCadre=this.couleurCadre,t.epaisseurCadre=this.epaisseurCadre,t.updateg(this.g),t.positionne()}e||this.doc.actionSuivante(e)};Y.prototype.estAffichageLatex=function(){return this.texte.charAt(0)==="$"&&this.texte.charAt(this.texte.length-1)==="$"};Y.prototype.traduitCaracteresGrecs=function(e){if(!e.includes("£"))return e;const t=e.split("£").map((i,s)=>s%2?hi[i]||`£${i}£`:i).join("");return(e.length-e.replace(/£/g,"").length)%2?(console.warn(`Il y a un nombre impair de £ dans cette chaîne : ${e}`),t.substr(0,t.length-1)):t};Y.prototype.traiteMaths=function(e){let t;const i=e,s=this.style==="texte",n=i.split(/<\/?br *\/?>/gi);if(n.length<=1)return m(e,s);let r="\\begin{array}{l}";for(t=0;t<n.length;t++)t!==0&&(r+="\\\\"),r+=m(n[t],s);return r+="\\end{array}",r};Y.prototype.prepare=function(){let e;if(this.estLatex&&(e=this.texte.replace(/^\$(.*)\$$/,"$1"),e||(console.error(Error("texte latex mais pas enveloppé de $, ignoré"),this.texte),this.estLatex=!1)),this.estLatex){const t=this;Be(async()=>{const{default:i}=await import("./loadMathJax-DlMMnS6S.js");return{default:i}},[]).then(({default:i})=>i()).then(()=>{const i=t.doc.getWidth(),s=t.taille,n=t.prelatex()+e;t.ex=s*.45;const r={em:s,ex:t.ex,containerWidth:i,display:!1};return t.doc.debug&&console.debug("On passe à MathJax la string",n),MathJax.tex2svgPromise(n,r)}).then(i=>{t.html=i,t.creegLatex(),t.setReady()}).catch(i=>{console.error(i),alert("Pb Mathjax, impossible d’afficher le LaTeX correctement")})}else this.creeg(),this.setReady()};Y.prototype.prelatex=function(){return"\\color{"+this.couleur+"}"};Y.prototype.creegLatex=function(){try{const e=this.html.firstChild,t=e.cloneNode(!0),i=document.createElementNS(l,"g");i.appendChild(t);const s=parseFloat(e.getAttribute("width"))*this.ex,n=parseFloat(e.getAttribute("height"))*this.ex,r=t.style["vertical-align"],o=(r&&parseFloat(r)||1)*this.ex;t.setAttribute("width",s+"px"),t.setAttribute("height",n+"px"),t.style["vertical-align"]=`${o}px`,t.setAttribute("x","0");const c=dt(this);if(t.setAttribute("y",String(-c)),i.setAttribute("visibility","hidden"),this.couleurFond!==null||this.couleurCadre!==null){i.setAttribute("visibility","hidden"),this.doc.svg.appendChild(i),this.rectAff={};const a=parseFloat(this.epaisseurCadre),{x:h,y:p,width:f,height:d}=i.getBBox();this.rectAff.height=d+2*a+4+2*this.marge+this.margeHaut+this.margeBas,this.rectAff.width=f+2*a+2+2*this.marge+this.margeGauche+this.margeDroite,this.rectAff.x=h-a-1-this.marge-this.margeGauche,this.rectAff.y=p-a-1-this.marge-this.margeHaut,i.setAttribute("visibility","visible"),this.doc.svg.removeChild(i),this.creeRectangle(i,this.couleurFond==null?"white":this.couleurFond)}this.g=i}catch(e){console.error("Erreur dans ActionEcrireTexte.creegLatex (on remplace par un <g> vide) :",e),this.g=document.createElementNS(l,"g")}};Y.prototype.creeg=function(){let e,t,i,s,n,r,o,c,a,h,p,f,d,g,b,u,w,y,S=0;const j="<",M="£e(",I="£i(",O=document.createElementNS(l,"g"),E=dt(this),F=E+2;let X=0;const z=E*.4;if(this.texte!==""){if(r=document.createElementNS(l,"text"),r.setAttribute("pointer-events","none"),r.setAttribute("x",0),r.setAttribute("y",0),n="text-anchor:left;font-size:"+E+"px;fill:"+this.couleur+";",r.setAttribute("style",n),s=this.texte.replace(/ /g," "),this.texte.indexOf(j)===-1&&this.texte.indexOf(M)===-1&&this.texte.indexOf(I)===-1&&this.texte.indexOf("<br>")===-1)r.appendChild(document.createTextNode(s));else for(b=s.split(/<br>/gi),g=-F,u=0;u<b.length;u++)for(w=!0,i=b[u];i!=="";)if(e=i.indexOf(j),c=i.indexOf(M),a=i.indexOf(I),w&&(g+=F+X),c!==-1&&(g+=z),e===-1&&c===-1&&a===-1){t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.setAttribute("dy",S),w&&(t.setAttribute("x",0),t.setAttribute("y",g),w=!1),S=0,t.appendChild(document.createTextNode(i)),r.appendChild(t);break}else for(;i.indexOf(j)!==-1||i.indexOf(M)!==-1||i.indexOf(I)!==-1;)if(e=i.indexOf(j),c=i.indexOf(M),a=i.indexOf(I),e===-1?c===-1?h=a:h=a===-1?c:Math.min(a,c):c===-1?h=a===-1?e:Math.min(e,a):a===-1?h=Math.min(e,c):h=Math.min(e,a,c),h>0)t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.setAttribute("dy",S),w&&(t.setAttribute("x",0),t.setAttribute("y",g),w=!1),S=0,t.appendChild(document.createTextNode(i.substring(0,h))),r.appendChild(t),i=i.substring(h);else if(e===0){const L=new wt(!1,!1,!1,this.couleur,"",E);o=D(i),Z(o===-1?i:i.substring(0,o),L,r,w,g),w=!1,o!==-1?i=i.substring(o):i="",S=0}else p=h===c,y=Ge(i),t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.setAttribute("dy",S+"px"),w&&(t.setAttribute("x",0),t.setAttribute("y",g),w=!1),y.erreur?t.appendChild(document.createTextNode(i)):(t.appendChild(document.createTextNode(y.operande)),r.appendChild(t),t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.appendChild(document.createTextNode(y.exposant)),S=z,p?S=-S:X=S,t.setAttribute("dy",S+"px"),f=E*.6,d="font-size:"+f+"px;",t.setAttribute("style",d),r.appendChild(t),S=-S),i=y.texte;O.appendChild(r)}if(O.setAttribute("visibility","hidden"),this.couleurFond!=null||this.couleurCadre!=null){O.setAttribute("visibility","hidden"),this.doc.svg.appendChild(O),this.rectAff={};const L=parseFloat(this.epaisseurCadre);this.rectAff.height=O.getBBox().height+2*L+3+2*this.marge+this.margeHaut+this.margeBas,this.rectAff.width=O.getBBox().width+2*L+2+2*this.marge+this.margeGauche+this.margeDroite,this.rectAff.x=O.getBBox().x-L-1-this.marge-this.margeGauche,this.rectAff.y=O.getBBox().y-L-1-this.marge-this.margeHaut,O.setAttribute("visibility","visible"),this.doc.svg.removeChild(O),this.creeRectangle(O,this.couleurFond==null?"white":this.couleurFond)}this.g=O};Y.prototype.contientBalisesItaliqueOuUnderlineOuFontOuBold=function(e){return/<(u|b|i|font[^>]+)>/gi.test(e)};Y.prototype.creeRectangle=function(e,t){const i=document.createElementNS(l,"rect"),s="stroke-width:"+this.epaisseurCadre+"px;stroke:"+this.couleurCadre+";fill:"+t+";fill-opacity:"+this.opaciteFond+";";i.setAttribute("style",s),i.setAttribute("x",this.rectAff.x),i.setAttribute("y",this.rectAff.y),i.setAttribute("width",this.rectAff.width),i.setAttribute("height",this.rectAff.height),i.setAttribute("pointer-events","none"),e.insertBefore(i,e.childNodes[0])};function oe(e,t,i,s){x.call(this,e,i),this.abscisseFin=parseFloat(t),this.pix10=s===null?8:String(Math.abs(s))}oe.prototype=new x;oe.prototype.execute=function(e){e?(this.doc.requerre.setAbs(this.abscisseFin),this.doc.requerre.positionne()):this.doc.requerre.lanceAnimationGlissement(this.abscisseFin,this.pix10)};oe.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.requerre,this.indice-1)};function _t(e,t,i,s,n){C.call(this,e);const r=e.compasLeve==null?null:e.compasLeve.g;this.x=t,this.y=i,this.angle=s,this.ecart=n,this.creeg(),this.g.setAttribute("visibility","hidden"),this.setPosition(t,i,s),r==null?e.svg.appendChild(this.g):e.svg.replaceChild(this.g,r)}_t.prototype=new C;_t.prototype.creeg=function(){let e,t,i;const r=this.ecart,o=document.createElementNS(l,"g");this.ecart>2*8&&(e=document.createElementNS(l,"rect"),e.setAttribute("x",8),e.setAttribute("y",-7/2),e.setAttribute("width",this.ecart-2*8),e.setAttribute("height",7),e.setAttribute("rx",1),e.setAttribute("ry",1),e.setAttribute("style","stroke:black;stroke-width:0.5;fill:silver;fill-opacity:1"),o.appendChild(e)),i=document.createElementNS(l,"path"),i.setAttribute("d","M0 0 L8 1 8 -1Z"),i.setAttribute("style","stroke:black;stroke-width:0.5;fill:black;fill-opacity:1"),o.appendChild(i);const c=r-2*8;t=document.createElementNS(l,"line"),t.setAttribute("x1",8),t.setAttribute("y1",0),t.setAttribute("x2",8+c/8),t.setAttribute("y2",0),t.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(t),i=document.createElementNS(l,"path");const a=String(r-8);i.setAttribute("d","M"+r+" 0 L"+a+" 1.5 "+a+" -1.5Z"),i.setAttribute("style","stroke:black;stroke-width:0.5;fill:black;fill-opacity:1"),o.appendChild(i),t=document.createElementNS(l,"line"),t.setAttribute("x1",a),t.setAttribute("y1",0),t.setAttribute("x2",String(r-8-c/8)),t.setAttribute("y2",0),t.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(t),t=document.createElementNS(l,"line");let h=String(r-8-c/8-2);t.setAttribute("x1",h),t.setAttribute("y1",-7/2),t.setAttribute("x2",h),t.setAttribute("y2",7/2),t.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(t),t=document.createElementNS(l,"line"),h=String(r-8-c/3-2),t.setAttribute("x1",h),t.setAttribute("y1",-7/2),t.setAttribute("x2",h),t.setAttribute("y2",7/2),t.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(t),e=document.createElementNS(l,"rect"),e.setAttribute("x",String(8+c/8-5)),e.setAttribute("y",String(-7)),e.setAttribute("width",8),e.setAttribute("height",3),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(e),e=document.createElementNS(l,"rect"),e.setAttribute("x",String(r-8-c/8-4)),e.setAttribute("y",String(-7)),e.setAttribute("width",8),e.setAttribute("height",3),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(e);const p=12,f=4;i=document.createElementNS(l,"path");const d="M"+String(r/2+p)+" "+String(-f)+" A "+String(p)+" 2 180 0 0 "+String(r/2-p)+" "+String(-f)+"A"+String(f)+" 2 90 0 1 "+String(r/2-p)+" "+String(f)+"A"+String(p)+" 2 0 0 0 "+String(r/2+p)+" "+String(f)+"A"+String(f)+" 2 -90 0 1 "+String(r/2+p)+" "+String(-f);i.setAttribute("d",d),i.setAttribute("style","stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1"),o.appendChild(i),t=document.createElementNS(l,"line"),t.setAttribute("x1",String(r/2+p)),t.setAttribute("y1",-7/2),t.setAttribute("x2",String(r/2-p)),t.setAttribute("y2",7/2),t.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(t),t=document.createElementNS(l,"line"),t.setAttribute("x1",String(r/2-p)),t.setAttribute("y1",-7/2),t.setAttribute("x2",String(r/2+p)),t.setAttribute("y2",7/2),t.setAttribute("style","stroke: black; stroke-width:0.5;"),o.appendChild(t);const g=document.createElementNS(l,"circle");g.setAttribute("cx",String(r/2)),g.setAttribute("cy",0),g.setAttribute("r",5),g.setAttribute("style","stroke:black;stroke-width:0.75; fill: #666666; fill-opacity: 1"),o.appendChild(g),e=document.createElementNS(l,"rect"),e.setAttribute("x",String(8+c/8-5)),e.setAttribute("y",String(-7)),e.setAttribute("width",7),e.setAttribute("height",3),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(e),e=document.createElementNS(l,"rect"),e.setAttribute("x",String(r-8-c/8-4)),e.setAttribute("y",String(-7)),e.setAttribute("width",7),e.setAttribute("height",3),e.setAttribute("style","stroke:black;stroke-width:0.75; fill: silver; fill-opacity: 1"),o.appendChild(e),this.g=o};_t.prototype.setPosition=function(e,t,i){this.x=e,this.y=t,this.angle=i,this.g.setAttribute("transform","translate("+e+","+t+") rotate("+i+")")};function $t(e,t){x.call(this,e,t)}$t.prototype=new x;$t.prototype.execute=function(e){const t=this.doc.compas;t.visible&&(t.montre(!1),t.visible=!0),this.doc.compasLeve=new _t(this.doc,t.x,t.y,t.angle,t.ecart),!e&&t.visible&&this.doc.compasLeve.montre(!0),t.leve=!0,e||this.doc.actionSuivante(e)};$t.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas,this.indice-1)?this.doc.getCompasStatus(this.indice-1)==="couche":!1};function Vt(e,t,i,s){x.call(this,e,s),this.objet=this.doc.getElement(t,i)}Vt.prototype=new x;Vt.prototype.execute=function(e){const t=this.objet;t?.montre(!1),e||this.doc.actionSuivante(e)};Vt.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function Tt(e,t,i){x.call(this,e,i),this.instrument=t}Tt.prototype=new x;Tt.prototype.execute=function(e){const t=this.doc.compas;this.instrument.montre(!1),t.leve&&this.doc.compasLeve.montre(!1),e||this.doc.actionSuivante(e)};Tt.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ae(e,t,i,s){x.call(this,e,s),this.instrument=t,this.longueur=i}ae.prototype=new x;ae.prototype.execute=function(e){if(this.instrument===this.doc.regle){const t=this.instrument.visible;this.instrument.longueur=this.longueur;const i=this.instrument.g;this.instrument.creeg(),this.instrument.g.setAttribute("visibility",t?"visible":"hidden"),this.doc.svg.replaceChild(this.instrument.g,i),this.instrument.translate(this.instrument.x,this.instrument.y)}e||this.doc.actionSuivante(e)};ae.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function qt(e,t,i,s){x.call(this,e,s),this.objet=this.doc.getElement(t,i)}qt.prototype=new x;qt.prototype.execute=function(e){const t=this.objet;t!==null&&t.montre(!0),e||this.doc.actionSuivante(e)};qt.prototype.actionVisible=function(){return!this.doc.getObjectVisibility(this.objet,this.indice-1)};function Ot(e,t,i,s){x.call(this,e,s),this.instrument=t,this.bmontrer=i}Ot.prototype=new x;Ot.prototype.execute=function(e){this.instrument.montreGraduations(this.bmontrer),e||this.doc.actionSuivante(e)};Ot.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function zt(e,t,i,s,n){x.call(this,e,n),this.x=i===null?null:parseFloat(i),this.y=s===null?null:parseFloat(s),this.instrument=t}zt.prototype=new x;zt.prototype.execute=function(e){const t=this.doc.compas;this.x!==null&&this.y!==null&&this.instrument.translate(this.x,this.y),this.instrument===t&&!e?(t.leve?this.doc.compasLeve.montre(!0):t.montre(!0),t.visible=!0):this.instrument.montre(!0),e||this.doc.actionSuivante(e)};zt.prototype.actionVisible=function(){return!this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function Ft(e,t,i){x.call(this,e,i),this.bmontrer=t}Ft.prototype=new x;Ft.prototype.execute=function(e){this.doc.rapporteur.montreGraduationsExternes(this.bmontrer),e||this.doc.actionSuivante(e)};Ft.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.rapporteur,this.indice-1)};function Bt(e,t,i){x.call(this,e,i),this.nomPoint=t}Bt.prototype=new x;Bt.prototype.prepare=function(){if(this.nomPoint.estLatex){const e=this,t=this.doc.getWidth(),i=dt(this.nomPoint)-2,s=this.nomPoint.nom.substring(1);this.ex=i/2;const n={em:i,ex:this.ex,containerWidth:t,display:!1};this.doc.debug&&console.debug("chargement MathJax dans ActionNommerPoint"),Be(async()=>{const{default:r}=await import("./loadMathJax-DlMMnS6S.js");return{default:r}},[]).then(({default:r})=>r()).then(()=>MathJax.tex2svgPromise(s,n)).then(r=>{e.nomPoint.html=r,e.nomPoint.creegLatex(),e.setReady()}).catch(r=>{console.error(r),alert("Pb Mathjax, impossible d’afficher le point en LaTeX")})}else this.nomPoint.creeg(),this.setReady()};Bt.prototype.execute=function(e){if(this.nomPoint.objet==="point"){this.nomPoint.positionne();const t=this.nomPoint.point;t.nom!==null?this.doc.svg.replaceChild(this.nomPoint.g,t.nom.g):this.doc.svg.appendChild(this.nomPoint.g),t.nom=this.nomPoint}this.nomPoint.g.setAttribute("visibility","visible"),e||this.doc.actionSuivante(e)};Bt.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.nomPoint.point,this.indice-1)};function le(e,t){x.call(this,e,t)}le.prototype=new x;le.prototype.execute=function(e){e||(this.doc.activeIconeContinuer(),this.doc.animationEnCours=!1)};le.prototype.actionVisible=function(){return!1};function ce(e,t,i,s,n){x.call(this,e,s),this.instrument=t,this.anglefin=parseFloat(i),this.deg10=n==null?8:Math.abs(parseFloat(n))}ce.prototype=new x;ce.prototype.execute=function(e){e?(this.instrument.angle=this.anglefin,this.instrument.positionne(),e||this.doc.actionSuivante(e)):this.instrument.lanceAnimationRotation(this.anglefin,this.deg10)};ce.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ue(e,t){x.call(this,e,t)}ue.prototype=new x;ue.prototype.execute=function(e){this.doc.compas.retourne(),e||this.doc.actionSuivante(e)};ue.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.doc.compas,this.indice-1)};function he(e,t,i,s,n,r){x.call(this,e,n),this.anglefin=parseFloat(i),this.deg10=r==null?8:Math.abs(parseFloat(r)),this.objet=this.doc.getElement(t,s)}he.prototype=new x;he.prototype.execute=function(e){const t=this.objet;if(t==null){e||this.doc.actionSuivante(e);return}e?(t.angle=this.anglefin,t.positionne()):t.lanceAnimationRotation(this.anglefin,this.deg10,this.tempo)};he.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function de(e,t,i,s,n,r){x.call(this,e,n),this.instrument=t,this.xfin=parseFloat(i),this.yfin=parseFloat(s),this.pix10=r==null?8:parseFloat(r)}de.prototype=new x;de.prototype.execute=function(e){isNaN(this.xfin)||isNaN(this.yfin)?this.doc.actionSuivante(e):e?this.instrument.translate(this.xfin,this.yfin):this.instrument.lanceAnimationTranslation(this.xfin,this.yfin,this.pix10)};de.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function pe(e,t,i,s,n,r,o){x.call(this,e,r),this.xfin=parseFloat(i),this.yfin=parseFloat(s),this.pix10=o==null?8:parseFloat(o),this.type=n,this.objet=this.doc.getElement(t,n)}pe.prototype=new x;pe.prototype.execute=function(e){const t=this.objet;if(t==null){this.doc.actionSuivante(e);return}e?t.translate(this.xfin,this.yfin):t.lanceAnimationTranslation(this.xfin,this.yfin,this.pix10)};pe.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function fe(e,t,i,s,n){x.call(this,e,s),this.instrument=t,this.zoomfin=parseFloat(i)/100,this.vitesse=parseInt(n)}fe.prototype=new x;fe.prototype.execute=function(e){e?(this.instrument.zoomfactor=this.zoomfin,this.instrument.positionne()):this.instrument.lanceAnimationZoom(this.zoomfin,this.vitesse)};fe.prototype.actionVisible=function(){return this.doc.getInstrumentVisibility(this.instrument,this.indice-1)};function ge(e,t,i,s,n,r){x.call(this,e,n),this.objet=this.doc.getElement(t,s),this.zoomfin=parseFloat(i)/100,this.vitesse=r,this.type=s}ge.prototype=new x;ge.prototype.execute=function(e){const t=this.objet;if(t==null){this.doc.actionSuivante(e);return}e?(t.zoomfactor=this.zoomfin,t.positionne()):t.lanceAnimationZoom(this.zoomfin,this.vitesse)};ge.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function be(e,t,i,s,n,r){x.call(this,e,n),this.rayFin=parseFloat(i),this.pix10=r==null?8:parseFloat(r),this.type=s,this.objet=this.doc.getElement(t,s)}be.prototype=new x;be.prototype.execute=function(e){const t=this.objet;if(t==null){this.doc.actionSuivante(e);return}e?t.donneRayon(this.rayFin):t.lanceAnimationModificationRayon(this.rayFin,this.pix10)};be.prototype.actionVisible=function(){return this.doc.getObjectVisibility(this.objet,this.indice-1)};function q(e,t,i,s,n,r){k.call(this,e,t,i),this.epaisseur=s,this.opacite=arguments.length>=5?n:"100",this.styleTrait=arguments.length>=6?r:"continu";const o=parseFloat(this.opacite/100);this.style="stroke:"+i+";stroke-width:"+s+";stroke-opacity:"+o+";stroke-linecap:round;",this.styleTrait==="tiret"&&(this.style+="stroke-dasharray:10 8 10;")}q.prototype=new k;function xe(e,t,i,s,n,r,o,c,a,h,p){this.x=parseFloat(i),this.y=parseFloat(s),this.ray=parseFloat(n),this.ang1=parseFloat(r),this.ang2=parseFloat(o),this.motif=p??"simple",q.call(this,e,t,c,a,1),this.opaciteRemplissage=h==null?.7:parseFloat(h)/100,this.objet="angle"}xe.prototype=new q;xe.prototype.creeg=function(){let e,t,i,s,n,r,o,c,a,h;const f=this.motif,d=this.ray,g=this.ang1,b=this.ang2,u=b-g,w=It(u);fi(Math.abs(u)-180)?e=this.ang1<=this.ang2:e=w>0;const y=new P(this.x,this.y,this.x+Math.cos(g*H),this.y+Math.sin(g*H)).vecteurColineaire(d),S=new P(this.x,this.y,this.x+Math.cos(b*H),this.y+Math.sin(b*H)).vecteurColineaire(d);let j=this.x+y.x,M=this.y+y.y,I=this.x+S.x,O=this.y+S.y;const E=document.createElementNS(l,"g");let F=document.createElementNS(l,"path");const X=f.indexOf("plein")!==-1?this.couleur:"none";X!=="none"?t="M"+this.x+" "+this.y+"L"+j+" "+M+"A"+d+" "+d+" "+this.ang1+" 0 "+(e?"1 ":"0 ")+I+" "+O+" Z":t="M"+j+" "+M+"A"+d+" "+d+" "+this.ang1+" 0 "+(e?"1 ":"0 ")+I+" "+O,F.setAttribute("d",t);const z="stroke:"+this.couleur+";stroke-width:"+this.epaisseur+";",L=z+"fill:"+X+";fill-opacity:"+this.opaciteRemplissage+";";F.setAttribute("style",L),E.appendChild(F);const yt=f.indexOf("O")!==-1,Pt=y.tourne(w/2),Ht=this.x+Pt.x,Jt=this.y+Pt.y;if(yt){const Q=document.createElementNS(l,"circle");Q.setAttribute("r",5),Q.setAttribute("cx",Ht),Q.setAttribute("cy",Jt),Q.setAttribute("style",z+"fill:none;"),E.appendChild(Q)}const Pe=f.indexOf("triple")!==-1?2:f.indexOf("double")!==-1?1:0;for(let Q=1;Q<=Pe;Q++){F=document.createElementNS(l,"path");const Yt=d-Q*5,Ie=y.vecteurColineaire(Yt),Oe=S.vecteurColineaire(Yt);j=this.x+Ie.x,M=this.y+Ie.y,I=this.x+Oe.x,O=this.y+Oe.y,t="M"+j+" "+M+"A"+Yt+" "+Yt+" "+this.ang1+" 0 "+(e?"1 ":"0 ")+I+" "+O,F.setAttribute("d",t),F.setAttribute("style",z+"fill:none;"),E.appendChild(F)}const Me=f.indexOf("///")!==-1?3:f.indexOf("//")!==-1?2:f.indexOf("/")!==-1?1:0;if(Me===0){this.g=E;return}const J=Pe+1,N=Pt.vecteurColineaire(1);switch(Me){case 1:o=this.x+N.x*d,c=this.y+N.y*d,i=document.createElementNS(l,"line"),i.setAttribute("x1",o-N.x*5*J),i.setAttribute("y1",c-N.y*5*J),i.setAttribute("x2",o+N.x*5),i.setAttribute("y2",c+N.y*5),i.setAttribute("style",L),E.appendChild(i);break;case 2:a=w/6,h=6,Math.abs(a)>=Math.abs(h)&&(a=h),s=N.tourne(a),n=this.x+s.x*d,r=this.y+s.y*d,i=document.createElementNS(l,"line"),i.setAttribute("x1",n-N.x*5*J),i.setAttribute("y1",r-N.y*5*J),i.setAttribute("x2",n+N.x*5),i.setAttribute("y2",r+N.y*5),i.setAttribute("style",L),E.appendChild(i),s=N.tourne(-a),n=this.x+s.x*d,r=this.y+s.y*d,i=document.createElementNS(l,"line"),i.setAttribute("x1",n-N.x*5*J),i.setAttribute("y1",r-N.y*5*J),i.setAttribute("x2",n+N.x*5),i.setAttribute("y2",r+N.y*5),i.setAttribute("style",L),E.appendChild(i);break;case 3:o=this.x+N.x*d,c=this.y+N.y*d,i=document.createElementNS(l,"line"),i.setAttribute("x1",o-N.x*5*J),i.setAttribute("y1",c-N.y*5*J),i.setAttribute("x2",o+N.x*5),i.setAttribute("y2",c+N.y*5),i.setAttribute("style",L),E.appendChild(i),a=w/4,h=9,Math.abs(a)>=Math.abs(h)&&(a=h),s=N.tourne(a),n=this.x+s.x*d,r=this.y+s.y*d,i=document.createElementNS(l,"line"),i.setAttribute("x1",n-N.x*5*J),i.setAttribute("y1",r-N.y*5*J),i.setAttribute("x2",n+N.x*5),i.setAttribute("y2",r+N.y*5),i.setAttribute("style",L),E.appendChild(i),s=N.tourne(-a),n=this.x+s.x*d,r=this.y+s.y*d,i=document.createElementNS(l,"line"),i.setAttribute("x1",n-N.x*5*J),i.setAttribute("y1",r-N.y*5*J),i.setAttribute("x2",n+N.x*5),i.setAttribute("y2",r+N.y*5),i.setAttribute("style",L),E.appendChild(i);break}this.g=E};function ee(e,t,i,s,n,r,o,c){this.xsommet=parseFloat(i),this.ysommet=parseFloat(s),this.xinter=parseFloat(n),this.yinter=parseFloat(r),q.call(this,e,t,o,c,100),this.objet="angle_droit"}ee.prototype=new q;ee.prototype.creeg=function(){let e=new P(this.xsommet,this.ysommet,this.xinter,this.yinter);const t=e.norme();e=e.vecteurColineaire(t/Math.sqrt(2)),e=e.tourne(45);const i=e.tourne(-90),s=document.createElementNS(l,"polyline"),n=String(this.xsommet+e.x)+" "+String(this.ysommet+e.y)+" "+this.xsommet+" "+this.ysommet+" "+String(this.xsommet+i.x)+" "+String(this.ysommet+i.y);s.setAttribute("points",n),s.setAttribute("style",this.style+"fill:none;"),this.g=s};function pt(e,t,i,s,n,r,o,c,a,h,p){this.x=parseFloat(i),this.y=parseFloat(s),this.ray=parseFloat(n),this.debut=parseFloat(r),this.fin=parseFloat(o),q.call(this,e,t,c,a,h,p)}pt.prototype=new q;pt.prototype.creeg=function(){const e=this.debut,t=this.fin,i=this.ray,s=e<t?"1":"0",n=Math.abs(t-e),r=document.createElementNS(l,"g");if(n>=359.9){const o=document.createElementNS(l,"circle");o.setAttribute("r",i),o.setAttribute("cx",0),o.setAttribute("cy",0),o.setAttribute("style",this.style+";fill:none;"),r.appendChild(o)}else{const o=document.createElementNS(l,"path"),c=new P(Math.cos(e*H)*i,Math.sin(e*H)*i),a=new P(Math.cos(t*H)*i,Math.sin(t*H)*i),h=c.x,p=c.y,f=a.x,d=a.y,g="M"+h+" "+p+"A"+i+" "+i+" "+e+" "+(n>180?"1":"0")+" "+s+" "+f+" "+d;o.setAttribute("d",g),o.setAttribute("style",this.style+";fill:none"),r.appendChild(o)}r.setAttribute("transform","translate("+this.x+","+this.y+")"),r.setAttribute("visibility","hidden"),this.g=r};pt.prototype.creationAnimee=function(){return!0};pt.prototype.lanceAnimation=function(e){const t=this.doc.compas;this.doc.compasLeve==null&&(this.doc.compasLeve=new _t(this.doc,t.x,t.y,t.angle,t.ecart));const i=this.doc.compasLeve;this.ray=this.doc.compas.ecart,this.angfin=this.fin,this.pasdeg=e/2,this.pasdeg*=this.fin>=this.debut?1:-1,this.distang=Math.abs(this.fin-this.debut),this.fin=this.debut,t.setPosition(this.x,this.y,this.debut),i.setPosition(this.x,this.y,this.debut);const s=this;this.timer=setInterval(function(){s.actionPourAnimation()},25)};pt.prototype.actionPourAnimation=function(){const e=this.doc.compas,t=this.doc.compasLeve;this.fin+=this.pasdeg;const i=Math.abs(this.angfin-this.fin);i>this.distang||!this.doc.animationEnCours?(this.fin=this.angfin,this.updateg(),this.finAction(),clearInterval(this.timer),this.doc.actionSuivante()):(this.distang=i,this.updateg(),e.setPosition(this.x,this.y,this.fin),t!==null&&t.setPosition(this.x,this.y,this.fin))};pt.prototype.finAction=function(){this.doc.compas.setPosition(this.x,this.y,this.fin),this.doc.compasLeve!==null&&this.doc.compasLeve.setPosition(this.x,this.y,this.fin)};function ot(e,t,i,s,n,r,o,c,a,h){q.call(this,e,t,o,c,h,"continu"),this.x=parseFloat(i),this.y=parseFloat(s),this.ray=n===null?10:parseFloat(n),this.ecartAngle=parseFloat(r),this.couleur=o,this.couleurFond=a===null?o:a,this.angle=0,this.objet="gabarit"}ot.prototype=new q;ot.prototype.creationAnimee=function(){return!1};ot.prototype.creeg=function(){const e=this.ecartAngle,t=this.ray,i=e>=0?"1":"0",s=Math.abs(e),n=document.createElementNS(l,"g"),r=document.createElementNS(l,"path"),o=new P(Math.cos(e*H)*t,Math.sin(e*H)*t),c=t,a=0,h=o.x,p=o.y,f="M 0 0 L "+c+" "+a+" A "+t+" "+t+" 0 "+(s>180?"1":"0")+" "+i+" "+h+" "+p+" Z";r.setAttribute("d",f);const d=parseFloat(this.opacite/100),g="stroke:"+this.couleur+";stroke-width:"+this.epaisseur+";fill:"+this.couleurFond+";fill-opacity:"+d+";";r.setAttribute("style",g),n.appendChild(r),n.setAttribute("transform","translate("+this.x+","+this.y+") rotate("+this.angle+")"),n.setAttribute("visibility","hidden"),this.g=n};ot.prototype.donneRayon=function(e){this.ray=e,this.updateg(),this.setPosition(this.x,this.y,this.angle)};ot.prototype.setPosition=function(e,t,i){this.x=e,this.y=t,this.angle=i,this.g.setAttribute("transform","translate("+e+","+t+") rotate("+i+")")};ot.prototype.lanceAnimationModificationRayon=function(e,t){this.rayFin=e,this.rayInit=this.ray;const i=e-this.ray;if(this.dist=Math.abs(i),this.dray=Math.sign(i)*Math.abs(t/4),this.dist===0)return;const s=this;this.timer=setInterval(function(){s.actionPourModificationRayon()},25)};ot.prototype.actionPourModificationRayon=function(){const e=this.ray+this.dray,t=Math.abs(e-this.rayInit);t>this.dist||!this.doc.animationEnCours?(this.donneRayon(this.rayFin),clearInterval(this.timer),this.doc.actionSuivante()):(this.dist=t,this.donneRayon(e))};function ft(e,t,i,s,n,r,o,c,a,h){k.call(this,e,"axeIEP",h),this.pente=t??"horizontal",this.largeur=i,this.haut=s==null?0:parseFloat(s),this.gauche=n==null?0:parseFloat(n),this.distanceBord=parseFloat(r),this.xgrad=o,this.xmin=c,this.xmax=a,this.cadre={},this.cadre.gauche=this.gauche*30,this.cadre.haut=this.haut*30,this.width=30*i,this.cadre.droite=this.gauche+this.width,this.cadre.bas=this.haut+this.width}ft.prototype=new k;ft.prototype.creeg=function(){let e,t,i,s;this.g=document.createElementNS(l,"g");const n="stroke:black;stroke-width:1;";this.pente==="horizontal"&&this.xmax-this.xmin>this.xgrad?(t=Math.floor((this.xmax-this.xmin)/this.xgrad),i=this.distanceBord*30,s=te(this.xmin,this.xmax,this.xgrad),this.tracer_abscisses(s,this.xgrad,t,i),e=document.createElementNS(l,"line"),e.setAttribute("style",n),e.setAttribute("x1",this.cadre.gauche),e.setAttribute("y1",i),e.setAttribute("x2",this.cadre.droite),e.setAttribute("y2",i),this.g.appendChild(e)):this.xmax-this.xmin>this.xgrad&&(t=Math.floor((this.xmax-this.xmin)/this.xgrad),i=Number(this.distanceBord)*30,s=te(this.xmin,this.xmax,this.xgrad),this.tracer_ordonnees(s,this.xgrad,t,i),e=document.createElementNS(l,"line"),e.setAttribute("style",n),e.setAttribute("x1",i),e.setAttribute("y1",this.cadre.bas),e.setAttribute("x2",i),e.setAttribute("y2",this.cadre.haut),this.g.appendChild(e))};ft.prototype.tracer_abscisses=function(e,t,i,s){let n,r,o,c;const h="stroke:black;stroke-width:1.5;";for(n=document.createElementNS(l,"line"),n.setAttribute("style",h),n.setAttribute("x1",this.cadre.gauche),n.setAttribute("y1",s),n.setAttribute("x2",this.cadre.droite),n.setAttribute("y2",s),this.g.appendChild(n),c=0;c<=i;c++){n=document.createElementNS(l,"line"),n.setAttribute("style",h),o=this.mettre_x_en_pixels(e+c*t),n.setAttribute("x1",o),n.setAttribute("y1",String(s-5)),n.setAttribute("x2",o),n.setAttribute("y2",String(s+5)),this.g.appendChild(n),r=document.createElementNS(l,"text"),r.setAttribute("x",o),r.setAttribute("y",s+12+5);const p="text-anchor:left;font-size:12px;fill:"+this.couleur+";";r.setAttribute("style",p),r.appendChild(document.createTextNode(String(e+c*t))),this.g.appendChild(r)}};ft.prototype.tracer_ordonnees=function(e,t,i,s){let n,r,o;const a="stroke:black;stroke-width:1.5;";for(n=document.createElementNS(l,"line"),n.setAttribute("style",a),n.setAttribute("x1",s),n.setAttribute("y1",this.cadre.haut),n.setAttribute("x2",s),n.setAttribute("y2",this.cadre.bas),this.g.appendChild(n),o=0;o<=i;o++){n=document.createElementNS(l,"line"),n.setAttribute("style",a);const h=this.mettre_y_en_pixels(e+o*t);n.setAttribute("x1",String(s-5)),n.setAttribute("y1",h),n.setAttribute("x2",String(s+5)),n.setAttribute("y2",h),this.g.appendChild(n),r=document.createElementNS(l,"text"),r.setAttribute("x",s+10),r.setAttribute("y",h+2);const p="text-anchor:left;font-size:12px;fill:"+this.couleur+";";r.setAttribute("style",p),r.appendChild(document.createTextNode(String(e+o*t))),this.g.appendChild(r)}};ft.prototype.mettre_x_en_pixels=function(e){return ie(e,this.xmin,this.xmax,this.cadre.gauche,this.cadre.droite)};ft.prototype.mettre_y_en_pixels=function(e){return ie(e,this.xmax,this.xmin,this.cadre.haut,this.cadre.bas)};function W(e,t,i,s,n,r,o,c,a,h){this.x1=parseFloat(i),this.y1=parseFloat(s),this.x2=parseFloat(n),this.y2=parseFloat(r),q.call(this,e,t,o,c,a,h)}W.prototype=new q;W.prototype.creeg=function(){const e=document.createElementNS(l,"g"),t=document.createElementNS(l,"line");t.setAttribute("x1",this.x1),t.setAttribute("y1",this.y1),t.setAttribute("x2",this.x2),t.setAttribute("y2",this.y2),t.setAttribute("style",this.style),e.appendChild(t),e.setAttribute("visibility","hidden"),this.g=e};W.prototype.creationAnimee=function(){return!0};W.prototype.lanceAnimation=function(e){this.vitesse=e/4;const t=new P(this.x1,this.y1,this.x2,this.y2);if(this.dist=t.norme(),vt(this.dist)){this.doc.actionSuivante();return}this.vect=t.vecteurColineaire(this.vitesse*1.8),this.xfin=this.x2,this.yfin=this.y2,this.x2=this.x1,this.y2=this.y1;const i=this.doc.crayon;i.setPosition(this.x1,this.y1,i.angle);const s=this;this.timer=setInterval(function(){s.actionPourAnimation(s)},25)};W.prototype.actionPourAnimation=function(){this.x2+=this.vect.x,this.y2+=this.vect.y;const t=new P(this.x1,this.y1,this.x2,this.y2).norme(),i=this.doc.crayon;t>this.dist||!this.doc.animationEnCours?(this.x2=this.xfin,this.y2=this.yfin,this.finAction(),this.updateg(),clearInterval(this.timer),this.doc.actionSuivante()):(i.translate(this.x2,this.y2),this.updateg())};W.prototype.finAction=function(){this.doc.crayon.translate(this.x2,this.y2)};function gt(e,t,i,s,n,r,o,c,a,h){W.call(this,e,t,i,s,n,r,o,c,a,h)}gt.prototype=new W;gt.prototype.creeg=function(){if(this.calcule(),this.horsFenetre)this.g=document.createElementNS(l,"g");else{const e=document.createElementNS(l,"line");e.setAttribute("x1",this.xext1),e.setAttribute("y1",this.yext1),e.setAttribute("x2",this.xext2),e.setAttribute("y2",this.yext2),e.setAttribute("style",this.style),this.g=e}this.g.setAttribute("visibility","hidden")};gt.prototype.calcule=function(){const{x1:e,y1:t,x2:i,y2:s}=this;if(e===i&&t===s){this.horsFenetre=!0;return}this.horsFenetre=!1;const n=this.doc.getWidth(),r=this.doc.getHeight();if(e===i){if(this.xext1=e,this.yext1=0,this.xext2=e,this.yext2=r,e<0||e>n){this.horsFenetre=!0;return}this.xext1=e,this.yext1=0,this.xext2=e,this.yext2=r;return}if(t===s){if(this.xext1=0,this.yext1=t,this.xext2=n,this.yext2=t,t<0||t>r){this.horsFenetre=!0;return}this.xext1=0,this.yext1=t,this.xext2=n,this.yext2=t;return}let o=0;const c=(s-t)/(i-e),a=0,h=this.y1+c*(a-e);h>=0&&h<=r&&(o++,this.xext1=a,this.yext1=h);const p=n,f=c*(p-e)+t;if(f>=0&&f<=r)if(o++,o===1)this.xext1=p,this.yext1=f;else{this.xext2=p,this.yext2=f;return}const d=0,g=(d-t)/c+e;if(g>0&&g<n)if(o++,o===1)this.xext1=g,this.yext1=d;else{this.xext2=g,this.yext2=d;return}const b=r,u=(b-t)/c+e;u>0&&u<=n?(o++,o===2?(this.xext2=u,this.yext2=b):this.horsFenetre=!0):this.horsFenetre=!0,this.horsFenetre&&(this.xext1=0,this.yext1=h,this.xext2=p,this.yext2=f)};function we(e,t,i,s,n,r,o,c,a,h){gt.call(this,e,t,i,s,n,r,o,c,a,h)}we.prototype=new gt;we.prototype.calcule=function(){gt.prototype.calcule.call(this);const e=new P(this.x1,this.y1,this.x2,this.y2);if(this.horsFenetre)return;const t=new P(this.x1,this.y1,this.xext1,this.yext1);if(t.presqueNul()){const i=new P(this.x1,this.y1,this.xext2,this.yext2);Fe(i,e)?(this.xext1=this.x1,this.yext1=this.y1):(this.xext2=this.xext1,this.yext2=this.yext1,this.xext1=this.x1,this.yext1=this.y1)}else Fe(t,e)?(this.xext2=this.xext1,this.yext2=this.yext1,this.xext1=this.x1,this.yext1=this.y1):(this.xext1=this.x1,this.yext1=this.y1)};function bt(e,t,i){this.doc=e,this.id=t,this.url=i,this.x=0,this.y=0,this.angle=0,this.objet="image",this.zoomfactor=1}bt.prototype=new k;bt.prototype.initialisePosition=function(){this.x=0,this.y=0,this.angle=0,this.zoomfactor=1,this.positionne()};bt.prototype.prepareAction=function(){const e=new Image;e.owner=this,this.action=new $(this.doc,this.id,this),this.action.isReady=!1,this.doc.ajouteAction(this.action),e.onload=function(){const t=this.owner;t.width=this.width,t.height=this.height,t.action.isReady=!0},e.src=this.url};bt.prototype.creeg=function(){const e=document.createElementNS(l,"image");e.setAttribute("width",this.width),e.setAttribute("height",this.height),e.setAttributeNS("http://www.w3.org/1999/xlink","href",this.url),e.setAttribute("x",this.x),e.setAttribute("y",this.y),e.setAttribute("visibility","hidden"),this.g=e,this.setPosition(this.x,this.y,this.angle,this.zoomfactor),this.doc.svg.appendChild(e)};bt.prototype.setPosition=function(e,t,i,s){this.x=e,this.y=t,this.angle=i,this.zoomfactor=s,this.g?this.g.setAttribute("transform","scale("+s+") translate("+String(e/s)+","+String(t/s)+") rotate("+i+")"):console.error("Il faut appeler imag.creeg avant imag.setPosition")};bt.prototype.positionne=function(){this.setPosition(this.x,this.y,this.angle,this.zoomfactor)};function nt(e,t,i,s,n,r,o,c,a,h){q.call(this,e,t,o,c,a,h),this.xdeb=i,this.ydeb=s,this.abs=n.split(","),this.ord=r.split(","),this.objet="trait"}nt.prototype=new q;nt.prototype.creeg=function(){let e,t;const i=document.createElementNS(l,"polyline");for(e=this.xdeb+" "+this.ydeb,t=0;t<this.abs.length;t++)e+=" "+this.abs[t]+" "+this.ord[t];i.setAttribute("points",e),i.setAttribute("style",this.style+"fill:none;"),i.setAttribute("visibility","hidden"),this.g=i};nt.prototype.creationAnimee=function(){return!0};nt.prototype.lanceAnimation=function(){this.sauveabs=this.abs,this.sauveord=this.ord,this.abs=[],this.ord=[],this.ind=-1;const e=this;this.timer=setInterval(function(){e.actionPourAnimation()},25)};nt.prototype.actionPourAnimation=function(){this.ind++;const e=this.doc.crayon;if(this.ind>=this.sauveabs.length)this.abs=this.sauveabs,this.ord=this.sauveord,this.updateg(),clearInterval(this.timer),this.finAction(),this.doc.actionSuivante();else{const t=this.sauveabs[this.ind],i=this.sauveord[this.ind];this.abs.push(t),this.ord.push(i),this.updateg(),e.setPosition(parseFloat(t),parseFloat(i),e.angle),this.updateg()}};nt.prototype.finAction=function(){const e=this.abs.length;this.doc.crayon.translate(parseFloat(this.abs[e-1]),parseFloat(this.ord[e-1]))};function Dt(e,t,i,s,n,r,o){this.x=parseFloat(i),this.y=parseFloat(s),this.motif=o,q.call(this,e,t,n,r,100),this.objet="longueur"}Dt.prototype=new q;Dt.prototype.creeg=function(){let e,t,i;switch(this.motif){case"/":e=document.createElementNS(l,"line"),e.setAttribute("x1",5),e.setAttribute("y1",-5),e.setAttribute("x2",-5),e.setAttribute("y2",5),e.setAttribute("style",this.style);break;case"\\":e=document.createElementNS(l,"line"),e.setAttribute("x1",-5),e.setAttribute("y1",-5),e.setAttribute("x2",5),e.setAttribute("y2",5),e.setAttribute("style",this.style);break;case"//":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i+=2)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*2.5+5),t.setAttribute("y1",-5),t.setAttribute("x2",i*2.5-5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t);break;case"///":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i++)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*5+5),t.setAttribute("y1",-5),t.setAttribute("x2",i*5-5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t);break;case"\\\\":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i+=2)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*2.5-5),t.setAttribute("y1",-5),t.setAttribute("x2",i*2.5+5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t);break;case"\\\\\\":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i++)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*5-5),t.setAttribute("y1",-5),t.setAttribute("x2",i*5+5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t);break;case"X":e=document.createElementNS(l,"g"),t=document.createElementNS(l,"line"),t.setAttribute("x1",-5),t.setAttribute("y1",-5),t.setAttribute("x2",5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t),t=document.createElementNS(l,"line"),t.setAttribute("x1",5),t.setAttribute("y1",-5),t.setAttribute("x2",-5),t.setAttribute("y2",5),t.setAttribute("style",this.style),e.appendChild(t);break;case"O":e=document.createElementNS(l,"circle"),e.setAttribute("cx",0),e.setAttribute("cy",0),e.setAttribute("r",5),e.setAttribute("style",this.style+"fill:none;");break;default:e=document.createElementNS(l,"g")}this.g=e};Dt.prototype.positionne=function(){this.g.setAttribute("transform","translate("+this.x+","+this.y+")")};Dt.prototype.translate=function(e,t){this.x=e,this.y=t,this.positionne()};function Lt(e,t,i,s,n,r,o,c,a,h,p){W.call(this,e,t,i,s,n,r,o,c,a,h),this.stylefleche=p}Lt.prototype=new W;Lt.prototype.creeg=function(){if(W.prototype.creeg.call(this),this.stylefleche==="vecteur"){const t=this.x1,i=this.x2,s=this.y1,n=this.y2,o=new P(i,n,t,s).vecteurColineaire(12),c=new P(o.x*Wt-o.y*Ut,o.x*Ut+o.y*Wt),a=new P(o.x*Wt+o.y*Ut,-o.x*Ut+o.y*Wt),h=String(i+c.x)+" "+String(n+c.y)+","+i+" "+n+","+String(i+a.x)+" "+String(n+a.y),p=document.createElementNS(l,"polyline");p.setAttribute("points",h);const f="stroke:"+this.couleur+";stroke-width:"+this.epaisseur+";stroke-opacity:"+this.opacite+";fill:none";p.setAttribute("style",f),this.g.appendChild(p)}};function Gt(e,t,i,s,n,r,o){this.idSeg=i,this.motif=r,this.rayon=o!==null?o:"5",q.call(this,e,t,s,n,100),this.objet="marque"}Gt.prototype=new q;Gt.prototype.creeg=function(){let e,t,i;if(this.doc.getElement(this.idSeg,"trait")instanceof Lt){const n=this.rayon,r=5,o=r/2,c=5;switch(this.motif){case"/":e=document.createElementNS(l,"line"),e.setAttribute("x1",n),e.setAttribute("y1",-n),e.setAttribute("x2",-n),e.setAttribute("y2",n),e.setAttribute("style",this.style);break;case"\\":e=document.createElementNS(l,"line"),e.setAttribute("x1",-n),e.setAttribute("y1",-n),e.setAttribute("x2",n),e.setAttribute("y2",n),e.setAttribute("style",this.style);break;case"//":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i+=2)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*o+n),t.setAttribute("y1",-n),t.setAttribute("x2",i*o-n),t.setAttribute("y2",n),t.setAttribute("style",this.style),e.appendChild(t);break;case"///":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i++)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*r+n),t.setAttribute("y1",-n),t.setAttribute("x2",i*r-n),t.setAttribute("y2",n),t.setAttribute("style",this.style),e.appendChild(t);break;case"\\\\":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i+=2)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*o-n),t.setAttribute("y1",-n),t.setAttribute("x2",i*o+n),t.setAttribute("y2",n),t.setAttribute("style",this.style),e.appendChild(t);break;case"\\\\\\":for(e=document.createElementNS(l,"g"),i=-1;i<=1;i++)t=document.createElementNS(l,"line"),t.setAttribute("x1",i*r-n),t.setAttribute("y1",-n),t.setAttribute("x2",i*r+n),t.setAttribute("y2",n),t.setAttribute("style",this.style),e.appendChild(t);break;case"X":e=document.createElementNS(l,"g"),t=document.createElementNS(l,"line"),t.setAttribute("x1",-n),t.setAttribute("y1",-n),t.setAttribute("x2",n),t.setAttribute("y2",n),t.setAttribute("style",this.style),e.appendChild(t),t=document.createElementNS(l,"line"),t.setAttribute("x1",n),t.setAttribute("y1",-n),t.setAttribute("x2",-n),t.setAttribute("y2",n),t.setAttribute("style",this.style),e.appendChild(t);break;case"O":e=document.createElementNS(l,"circle"),e.setAttribute("cx",0),e.setAttribute("cy",0),e.setAttribute("r",c),e.setAttribute("style",this.style+"fill:none;");break;default:e=document.createElementNS(l,"g")}}else console.warn("Marque de segment non associée à un objet segment"),e=document.createElementNS(l,"g");this.g=e};Gt.prototype.positionne=function(){const e=this.doc.getElement(this.idSeg,"trait"),t=new P(e.x1,e.y1,e.x2,e.y2),i=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,n=-t.angle();this.g.setAttribute("transform","translate("+i+","+s+") rotate("+n+") ")};Gt.prototype.translate=function(e,t){this.x=e,this.y=t,this.positionne()};Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this[t],t,this)});var Ai={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function xi(e){if(typeof e!="string")throw new TypeError("countSlash n’accepte qu’une string en paramètre");return e.replace(/[^/]+/g,"").length}function wi(e,t){return t?e.replace(/[&<>"']/g,function(i){return Ai[i]}):e.replace(/</g,"&lt;")}function vi(e,t){function i(s,n){return Ke(s,"0",n)}if(!t)t=new Date;else if(!(t instanceof Date))throw new TypeError("date is not a Date");if(typeof e!="string")throw new TypeError("format is not a string");return e.replace(/%(.)/g,function(s,n){switch(n){case"d":return i(t.getDate());case"F":return String(t.getFullYear())+"-"+i(t.getMonth()+1)+"-"+i(t.getDate());case"H":return i(t.getHours());case"m":return i(t.getMonth()+1);case"M":return i(t.getMinutes());case"o":return i(t.getMilliseconds(),3);case"O":return i(t.getHours())+":"+i(t.getMinutes())+":"+i(t.getSeconds())+"."+i(t.getMilliseconds(),3);case"s":return i(Math.round(t.getTime()/1e3));case"S":return i(t.getSeconds());case"T":return i(t.getHours())+":"+i(t.getMinutes())+":"+i(t.getSeconds());case"y":return String(t.getFullYear()).substr(2);case"Y":return t.getFullYear();case"%":return"%";default:return"%"+n}})}function Si(){return Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2)}function We(e,t){return typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,t)}function Ei(e){return Array.isArray(e)}function Ci(e){return!!(Array.isArray(e)&&e.length===0)}function Ni(e){return!!(Array.isArray(e)&&e.length)}function ki(e){return typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Pi(e){switch(Object.prototype.toString.call(e)){case"[object Error]":return!0;case"[object Exception]":return!0;case"[object DOMException]":return!0;default:return e instanceof Error}}function Ue(e){return typeof e=="function"}function Mi(e,t){if(!Array.isArray(e))throw new Error("isInArray veut un tableau en 1er argument");return e.indexOf(t)!==-1}function Qe(e,t){switch(typeof e){case"number":return Math.floor(e)===e;case"string":return!!(t&&e&&Math.floor(e)==e);default:return!1}}function Ii(e,t,i){return Qe(e,i)&&(t?e>0:e>=0)}function Oi(e){var t=typeof e;return!!e&&(t==="object"||t==="function")}function Fi(e){return!!e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"}function Li(e){return!!e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object RegExp]"}function Ri(e){return typeof e=="string"}function ve(e){return typeof e>"u"}function ji(e){return typeof e=="string"&&/^https?:\/\/[a-z0-9\-._]+(:[0-9]+)?(\/|$)/.test(e)}function Ke(e,t,i){for(t&&(typeof t!="string"&&(t=String(t)),t.length!==1&&(console.error(new Error("char invalide "+t)),t=void 0)),t||(t=typeof e=="number"?"0":" "),typeof e!="string"&&(e=String(e)),i||(i=2);e.length<i;)e=t+e;return e}function _i(e){var t;if(typeof e=="string")try{t=JSON.parse(e)}catch(i){!ve(console)&&console.error&&console.error(i)}return t}function $i(e,t){return typeof e=="string"?(t||(t=/[,;\s]+/),e.split(t).map(function(i){return i.trim()}).filter(function(i){return i})):[]}function Vi(e,t){var i;try{i=t?JSON.stringify(e,null,t):JSON.stringify(e)}catch{var s,n,r=[];for(s in e)if(We(e,s)&&!ve(e[s])&&!Ue(e[s])){n=e[s],i='"'+s+'":';try{i+=t?JSON.stringify(n,null,t):JSON.stringify(n)}catch(h){i+='"'+h.toString().replace(/\n/g,"\\n")+'"'}r.push(i)}var o=",";if(i="{",t){var c=`
`+" ".repeat(t);o+=c,i+=c}i+=r.join(o),t&&(i+=`
`),i+="}"}return i}function Ti(e){function t(s,n){return s.replace(n[0],n[1])}if(typeof e=="string"){if(/^[\w]*$/.test(e))return e;var i=[[/[áàâäãå]/g,"a"],[/[ÁÀÂÄÃÅ]/g,"A"],["ç","c"],["Ç","C"],[/[éèêë]/g,"e"],[/[ÉÈÊË]/g,"E"],[/[íìîï]/g,"i"],[/[ÍÌÎÏ]/g,"I"],["ñ","n"],["Ñ","N"],[/[óòôöõ]/g,"o"],[/[ÓÒÔÖÕ]/g,"O"],[/[úùûü]/g,"u"],[/[ÚÙÛÜ]/g,"U"],[/[ýÿ]/g,"y"],[/[ÝŸ]/g,"Y"],["æ","ae"],["Æ","AE"],["œ","oe"],["Œ","OE"]];return i.reduce(t,e)}return console.error(new TypeError("not a string"),e),""}function qi(e){switch(typeof e){case"number":return Math.round(e);case"string":return e===""?NaN:Math.round(e);default:return NaN}}var Se={countSlash:xi,escapeForHtml:wi,formatDate:vi,getToken:Si,hasProp:We,isArray:Ei,isArrayEmpty:Ci,isArrayNotEmpty:Ni,isDate:ki,isError:Pi,isFunction:Ue,isInArray:Mi,isInt:Qe,isIntPos:Ii,isObject:Oi,isObjectPlain:Fi,isRegExp:Li,isString:Ri,isUndefined:ve,isUrlAbsolute:ji,pad:Ke,parse:_i,splitAndTrim:$i,stringify:Vi,toAscii:Ti,toInt:qi},it=Se,zi=it.hasProp,Bi=function e(t,i){if(t===null)return"null";var s=typeof t;switch(s){case"undefined":return t;case"number":case"boolean":return String(t);case"string":return'"'+t.replace('"','\\"')+'"';case"symbol":return"[Symbol "+t.toString()+"]";default:i||(i=0);var n=" ".repeat(i);i+=2;var r=n+"  ",o=[],c;if(it.isDate(t))return JSON.stringify(t);if(it.isArray(t))return c=`[
`,t.forEach(function(p,f){c+=r+e(p,i)+(f===t.length-1?`
`:`,
`)}),t.length?c+=n+"]":c+="]",c;if(it.isRegExp(t)||it.isFunction(t))return typeof t.toSource=="function"?t.toSource():t.toString();if(it.isObject(t)){var a=0;for(var h in t)if(zi(t,h)){a++;try{JSON.stringify(t[h]),o.push(h+": "+e(t[h],i))}catch(p){o.push(h+': "'+p.toString().replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"')}}return a?`{
`+r+o.join(`,
`+r)+`
`+n+"}":it.isObjectPlain(t)?n+"{}":n+t.toString()}else return console.error("dump est tombé sur un truc qui ne ressemble à rien de connu",t),it.stringify(t,2)}},Ee={},Di=Bi,ti=Se,Gi=ti.formatDate,Xi=ti.hasProp,R={debug:0,info:1,notice:1,warn:2,warning:2,error:3,alert:4,critical:4},Zi=["[debug]","[info]","[warning]","[error]","[CRITICAL]"],Hi=[console.info||console.log,console.log,console.warn||console.error||console.log,console.error||console.log,console.error||console.log],G=R.info,ei=typeof process<"u"&&Ee,Ce=ei&&Xi(Ee,"NODE_APP_INSTANCE"),Ne=ei&&!Ce,ii="[%O]",ke=Ce,Ji=Ce&&Ee.NODE_APP_INSTANCE||"N/A";function at(e,t){try{var i=Hi[t]||console.log,s="";if(Ne&&(s=Gi(ii)),ke&&(s&&(s+=" "),s+="["+Ji+"]"),s&&(s+=" "),s+=Zi[t],e.length<1&&(e=[Error("fonction de log appelée sans contenu")]),i(s,e[0]),e.length>1)for(var n=1;n<e.length;n++)i(e[n])}catch{}}function T(){G<R.warning&&at(arguments,R.info)}T.debug=function(){G<R.info&&at(arguments,R.debug)};T.info=function(){G<R.warning&&at(arguments,R.info)};T.warn=function(){G<R.error&&at(arguments,R.warning)};T.ifError=function e(){e&&G<R.critical&&at(arguments,R.error)};T.error=function(){G<R.critical&&at(arguments,R.error)};T.critical=function(){at(arguments,R.critical)};T.disable=function(){G=R.error};T.disableDatePrefix=function(){Ne=!1};T.disableProcessPrefix=function(){ke=!1};T.dump=function(e,t,i){typeof i!="object"&&(i={});var s=i.level||R.debug;typeof s=="string"&&(s=R[s]||R.debug);var n=Di(t),r=i.max||1e3;n.length>r&&(n=n.substr(0,r)+"…"),G<=s&&at([e,n],s)};T.enable=function(){G=R.info};T.enableDatePrefix=function(){Ne=!0};T.enableProcessPrefix=function(){typeof process>"u"?console.error("process not available"):ke=!0};T.setDatePrefix=function(t){typeof t=="string"?ii=t:T.error(new Error("Le préfixe de log doit être une string"))};T.setLogLevel=function(t){switch(t){case 0:case"0":case"debug":G=R.debug;break;case 1:case"1":case"info":case"notice":G=R.notice;break;case 2:case"2":case"warn":case"warning":G=R.warning;break;case 3:case"3":case"err":case"error":G=R.error;break;case 4:case"4":case"alert":case"crit":case"critical":G=R.critical;break;default:T.error("niveau d’erreur "+t)}};T.levels={debug:0,info:1,notice:1,warn:2,warning:2,error:3,alert:4,critical:4};var Yi=T,Xt=Yi,si=Se.hasProp;function Wi(e){for(var t=window.document.getElementsByTagName("head")[0],i=t.getElementsByTagName("link"),s=!1,n=0;n<i.length;n++)if(i[n].href===e){s=!0;break}if(s)Xt(e+" était déjà présent, on ne l'ajoute pas");else{var r=window.document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=e,t.appendChild(r)}}function Ui(e,t){var i=window.document.getElementsByTagName("body")[0],s=window.document.createElement("script");s.type="text/javascript",i.appendChild(s),s.addEventListener("load",()=>t(),{once:!0}),s.src=e}function Qi(e,t,i,s){var n=Nt(t,i,s);return e.appendChild(n),n}function Ki(e,t,i,s){var n=Nt(t,i,s),r=e.parentNode;return r?r.insertBefore(n,e.nextSibling):Xt.error(new Error("Navigateur incompatible (pas de parentNode), impossible d'ajouter l'élément")),n}function ts(e,t,i,s){var n=Nt(t,i,s),r=e.parentNode;return r?r.insertBefore(n,e):Xt.error(new Error("Navigateur incompatible (pas de parentNode), impossible d'insérer l'élément")),n}function es(e,t,i,s){var n=Nt(t,i,s);return e.insertBefore(n,e.firstChild),n}function is(e,t,i,s){var n=Nt(t,i,s);return e.parentNode.insertBefore(n,e.parentNode.firstChild),n}function ni(e,t){e.appendChild(window.document.createTextNode(t))}function ss(e){if(e&&e.firstChild)for(;e.firstChild;)e.removeChild(e.firstChild)}function Nt(e,t,i){var s=window.document.createElement(e),n;try{if(t)for(n in t)si(t,n)&&(n==="class"?s.className=t.class:n==="className"?s.className=t.className:n==="style"?ri(s,t.style):s.setAttribute(n,t[n]))}catch(r){Xt("plantage dans getElement "+e+" avec les attributs ",t,r)}return i&&ni(s,i),s}function ns(){var e=window.document.compatMode==="CSS1Compat"?window.document.documentElement:window.document.body;return{width:Math.floor(Math.min(e.clientWidth,window.innerWidth)),height:Math.floor(Math.min(e.clientHeight,window.innerHeight))}}var rs=function(){var e=1e4,t=0,i="sesa"+t;return function(){for(;window.document.getElementById(i)&&t<e;)t++,i="sesa"+t;if(t===e)throw Error("Max de "+e+" id générés atteint");return i}}();function ri(e,t){try{if(e&&e.style){if(typeof t=="string")t=t.split(";"),t.forEach(function(s){if(s=/([\w]+):(.+)/.exec(s),s&&s.length===3){var n=s[1];e.style[n]=s[2]}});else if(typeof t=="object")for(var i in t)si(t,i)&&(e.style[i]=t[i])}}catch(s){Xt.error(s)}}var os={addCss:Wi,addJs:Ui,addElement:Qi,addElementAfter:Ki,addElementBefore:ts,addElementFirstChild:es,addElementFirstSibling:is,addText:ni,empty:ss,getElement:Nt,getSize:ns,getNewId:rs,setStyles:ri};const oi=ui(os),{setStyles:as}=oi;function kt(e,t,i,s,n,r){k.call(this,e,t,r),this.dx=i==null?2:parseFloat(i),this.dy=s==null?4:parseFloat(s),this.nom=Xe(Ze(n)),this.taille=20,this.point=this.doc.getElement(this.id,"point"),this.objet="point",this.nom=this.nom.replace(/\*/g,"×"),Ye(n)?(this.nom="$"+this.traiteMaths(this.nom)+"$",this.estLatex=!0):this.estLatex=!1}kt.prototype=new k;kt.prototype.creeg=function(){let e,t,i,s,n,r,o,c,a,h,p,f,d,g,b,u,w,y,S=0;const j="<",M="£e(",I="£i(",O=document.createElementNS(l,"g"),E=dt(this),F=E+2;let X=0;const z=E*.4;if(this.nom.length!==0){if(r=document.createElementNS(l,"text"),r.setAttribute("pointer-events","none"),r.setAttribute("x",0),r.setAttribute("y",0),n="text-anchor:left;font-size:"+E+"px;fill:"+this.couleur+";",r.setAttribute("style",n),s=this.nom.replace(/ /g," "),this.nom.indexOf(j)===-1&&this.nom.indexOf(M)===-1&&this.nom.indexOf(I)===-1&&this.nom.indexOf("<br>")===-1)r.appendChild(document.createTextNode(s));else for(b=s.split(/<br>/gi),g=-F,u=0;u<b.length;u++)for(w=!0,i=b[u];i.length!==0;)if(e=i.indexOf(j),c=i.indexOf(M),a=i.indexOf(I),w&&(g+=F+X),c!==-1&&(g+=z),e===-1&&c===-1&&a===-1){t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.setAttribute("dy",S),w&&(t.setAttribute("x",0),t.setAttribute("y",g),w=!1),S=0,t.appendChild(document.createTextNode(i)),r.appendChild(t);break}else for(;i.indexOf(j)!==-1||i.indexOf(M)!==-1||i.indexOf(I)!==-1;)if(e=i.indexOf(j),c=i.indexOf(M),a=i.indexOf(I),e===-1?c===-1?h=a:h=a===-1?c:Math.min(a,c):c===-1?h=a===-1?e:Math.min(e,a):a===-1?h=Math.min(e,c):h=Math.min(e,a,c),h>0)t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.setAttribute("dy",S),w&&(t.setAttribute("x",0),t.setAttribute("y",g),w=!1),S=0,t.appendChild(document.createTextNode(i.substring(0,h))),r.appendChild(t),i=i.substring(h);else if(e===0){const L=new wt(!1,!1,!1,this.couleur,"",E);o=D(i),Z(o===-1?i:i.substring(0,o),L,r,w,g),w=!1,o!==-1?i=i.substring(o):i="",S=0}else p=h===c,y=Ge(i),t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.setAttribute("dy",S+"px"),w&&(t.setAttribute("x",0),t.setAttribute("y",g),w=!1),y.erreur?t.appendChild(document.createTextNode(i)):(t.appendChild(document.createTextNode(y.operande)),r.appendChild(t),t=document.createElementNS(l,"tspan"),t.setAttribute("pointer-events","none"),t.appendChild(document.createTextNode(y.exposant)),S=z,p?S=-S:X=S,t.setAttribute("dy",S+"px"),f=E*.6,d="font-size:"+f+"px;",t.setAttribute("style",d),r.appendChild(t),S=-S),i=y.texte;O.appendChild(r),this.g=O}O.setAttribute("visibility","hidden")};kt.prototype.creegLatex=function(){try{const e=document.createElementNS(l,"g"),t=this.html.firstChild,i=t.cloneNode(!0);e.appendChild(i);const s=parseFloat(t.getAttribute("width"))*this.ex,n=parseFloat(t.getAttribute("height"))*this.ex,r=i.style["vertical-align"],o=(r&&parseFloat(r)||1)*this.ex;i.setAttribute("width",s+"px"),i.setAttribute("height",n+"px"),as(i,"vertical-align",o+"px"),i.setAttribute("x","0");const c=dt(this);i.setAttribute("y",String(-c)),i.setAttribute("visibility","hidden"),this.g=e}catch(e){console.error(e,"on remplace par un <g> vide"),this.g=document.createElementNS(l,"g")}};kt.prototype.positionne=function(){this.point===null&&(this.point=this.doc.getElement(this.id,"point"));const e=this.point.x,t=this.point.y,i=dt(this);this.g.setAttribute("transform","translate("+String(e+this.dx)+","+String(t+this.dy+i)+")")};kt.prototype.traiteMaths=function(e){return v(e,!0)};function lt(e,t,i,s,n,r){this.x=parseFloat(i),this.y=parseFloat(s),this.xinit=this.x,this.yinit=this.y,this.xcons=this.x,this.ycons=this.y,q.call(this,e,t,n,r),this.style+="stroke-linecap:round;",this.nom=null,this.objet="point"}lt.prototype=new q;lt.prototype.initialisePosition=function(){this.x=this.xinit,this.y=this.yinit,this.positionne()};lt.prototype.creeg=function(){const t=document.createElementNS(l,"g");let i;i=document.createElementNS(l,"line"),i.setAttribute("x1",-5),i.setAttribute("y1",5),i.setAttribute("x2",5),i.setAttribute("y2",-5),i.setAttribute("style",this.style),t.appendChild(i),i=document.createElementNS(l,"line"),i.setAttribute("x1",-5),i.setAttribute("y1",-5),i.setAttribute("x2",5),i.setAttribute("y2",5),i.setAttribute("style",this.style),t.appendChild(i),this.g=t};lt.prototype.positionne=function(){this.g.setAttribute("transform","translate("+this.x+","+this.y+")")};lt.prototype.translate=function(e,t){this.x=e,this.y=t,this.positionne(),this.nom!==null&&this.nom.positionne()};lt.prototype.updateg=function(){this.setPosition(this.x,this.y)};lt.prototype.montre=function(e){k.prototype.montre.call(this,e),this.nom!==null&&this.nom.g&&this.nom.montre(e)};function rt(e,t,i,s,n,r,o,c){k.call(this,e,t,n),this.abs=i.split(","),this.ord=s.split(","),this.sauveabs=this.abs,this.sauveord=this.ord,this.epaisseur=r,this.opacite=c??"60";const a=parseFloat(this.opacite/100);o==null?this.couleurFond=this.couleur:this.couleurFond=o,this.style="stroke:"+n+";stroke-width:"+r+";fill:"+this.couleurFond+";",this.style+="fill-opacity:"+a+";",this.objet="trait"}rt.prototype=new k;rt.prototype.creeg=function(){let e,t;const i=document.createElementNS(l,"polygon");for(e="",t=0;t<this.abs.length;t++)e+=" "+this.abs[t]+" "+this.ord[t];i.setAttribute("points",e),i.setAttribute("style",this.style),i.setAttribute("visibility","hidden"),this.g=i};rt.prototype.creationAnimee=function(){return!0};rt.prototype.lanceAnimation=function(e){this.pix=parseFloat(e/2),this.abs=[],this.abs[0]=this.sauveabs[0],this.ord=[],this.ord[0]=this.sauveord[0],this.ind=0,this.n=0;const t=this.doc.crayon,i=new P(parseFloat(this.sauveabs[0]),parseFloat(this.sauveord[0]),parseFloat(this.sauveabs[1]),parseFloat(this.sauveord[1]));this.longcote=i.norme(),this.vect=i.vecteurColineaire(this.pix),t.setPosition(parseFloat(this.abs[0]),parseFloat(this.ord[0]),t.angle);const s=this;this.timer=setInterval(function(){s.actionPourAnimation()},25)};rt.prototype.actionPourAnimation=function(){const e=this.doc.crayon;let t=this.ind;const i=parseFloat(this.abs[t]),s=parseFloat(this.ord[t]);if(this.n++,this.doc.animationEnCours)if(this.n*this.pix<=this.longcote){const n=i+this.n*this.vect.x,r=s+this.n*this.vect.y;this.abs[t+1]=String(n),this.ord[t+1]=String(r),e.translate(n,r),this.updateg()}else if(this.ind++,t++,t===this.sauveabs.length-1)clearInterval(this.timer),this.finAction(),this.doc.actionSuivante();else{this.abs[t]=this.sauveabs[t],this.ord[t]=this.sauveord[t],e.translate(parseFloat(this.abs[t]),parseFloat(this.ord[t]));const n=new P(parseFloat(this.sauveabs[t]),parseFloat(this.sauveord[t]),parseFloat(this.sauveabs[t+1]),parseFloat(this.sauveord[t+1]));this.longcote=n.norme(),this.vect=n.vecteurColineaire(this.pix),this.n=0}else clearInterval(this.timer),this.finAction(),this.doc.actionSuivante()};rt.prototype.finAction=function(){this.abs=this.sauveabs,this.ord=this.sauveord;const e=this.abs.length;this.updateg(),this.doc.crayon.translate(parseFloat(this.abs[e-1]),parseFloat(this.ord[e-1]))};function Rt(e,t,i,s,n,r,o){k.call(this,e,"quadrillageIEP",o),this.hauteur=parseFloat(i),this.largeur=parseFloat(s),this.haut=n==null?0:parseFloat(n),this.gauche=r==null?0:parseFloat(r),this.type=t,this.cadre={},this.cadre.gauche=this.gauche*30,this.cadre.haut=this.haut*30,this.cadre.droite=this.cadre.gauche+this.largeur*30,this.cadre.bas=this.cadre.haut+this.hauteur*30,this.objet="quadrillage"}Rt.prototype=new k;Rt.prototype.creeg=function(){const e=this.cadre.gauche,t=this.cadre.droite,i=this.cadre.haut,s=this.cadre.bas,n=this.couleur;this.g=document.createElementNS(l,"g");const r=this.doc.svg.getElementById("quadrillageIEP");switch(r!=null&&this.doc.svg.removeChild(r),this.type){case"seyes":this.tracer_grille(n,24,6,e,i,t,s,!1,1),this.tracer_grille(n,24,24,e,i,t,s,!1,1);break;case"millimetre":this.tracer_grille(n,3,3,e,i,t,s,!1,.6),this.tracer_grille(n,30,30,e,i,t,s,!1,.8),this.tracer_grille(n,150,150,e,i,t,s,!1,1);break;case"10x10":case"10x":this.tracer_grille(n,30,30,e,i,t,s,!1,1);break;case"5x5":case"5x":default:this.tracer_grille(n,15,15,e,i,t,s,!1,1);break}};Rt.prototype.tracer_grille=function(e,t,i,s,n,r,o,c,a){let h,p;const f="stroke:"+e+";stroke-width:0.5;stroke-opacity:"+a+";";c&&(this.style+="stroke-dasharray:2 2;");let d=Math.ceil(Math.abs(r-s)/t);for(p=0;p<d;p++)h=document.createElementNS(l,"line"),h.setAttribute("style",f),h.setAttribute("x1",s+p*t),h.setAttribute("y1",n),h.setAttribute("x2",s+p*t),h.setAttribute("y2",o),h.setAttribute("style",f),this.g.appendChild(h);for(d=Math.ceil(Math.abs(o-n)/i),p=0;p<d;p++)h=document.createElementNS(l,"line"),h.setAttribute("style",f),h.setAttribute("x1",s),h.setAttribute("y1",n+p*i),h.setAttribute("x2",r),h.setAttribute("y2",n+p*i),h.setAttribute("style",f),this.g.appendChild(h)};function mt(e,t,i,s,n,r,o,c,a,h,p,f,d,g,b){k.call(this,e,"repereIEP",f),this.hauteur=t,this.largeur=i,this.haut=s==null?0:parseFloat(s),this.gauche=n==null?0:parseFloat(n),this.xgrad=parseFloat(r),this.ygrad=parseFloat(o),this.xmin=parseFloat(c),this.xmax=parseFloat(a),this.ymin=parseFloat(h),this.ymax=parseFloat(p),this.grille=d??"visible",this.axes=g??"visible",this.etiquettes=b??"visible",this.cadre={},this.cadre.gauche=this.gauche*30,this.cadre.haut=this.haut*30,this.cadre.droite=this.cadre.gauche+this.largeur*30,this.cadre.bas=this.cadre.haut+this.hauteur*30}mt.prototype=new k;mt.prototype.mettre_x_en_pixels=function(e){return ie(e,this.xmin,this.xmax,this.cadre.gauche,this.cadre.droite)};mt.prototype.mettre_y_en_pixels=function(e){return ie(e,this.ymax,this.ymin,this.cadre.haut,this.cadre.bas)};mt.prototype.tracer_abscisses=function(e,t,i,s,n,r){let o,c,a,h;const f="stroke:black;stroke-width:0.5;";for(this.grille==="invisible"&&this.axes!=="invisible"&&(o=document.createElementNS(l,"line"),o.setAttribute("style",f),o.setAttribute("x1",this.cadre.gauche),o.setAttribute("y1",s),o.setAttribute("x2",this.cadre.droite),o.setAttribute("y2",s),this.g.appendChild(o)),h=0;h<=i;h++)if(o=document.createElementNS(l,"line"),o.setAttribute("style",f),a=this.mettre_x_en_pixels(e+h*t),this.grille==="invisible"?this.axes!=="invisible"&&(o.setAttribute("x1",a),o.setAttribute("y1",String(s-5)),o.setAttribute("x2",a),o.setAttribute("y2",String(s+5)),this.g.appendChild(o)):(o.setAttribute("x1",a),o.setAttribute("y1",n),o.setAttribute("x2",a),o.setAttribute("y2",r),this.g.appendChild(o)),this.etiquettes!=="invisible"&&this.axes!=="invisible"){c=document.createElementNS(l,"text"),c.setAttribute("x",a+2),c.setAttribute("y",s+12);const d="text-anchor:left;font-size:12px;fill:"+this.couleur+";";c.setAttribute("style",d),c.appendChild(document.createTextNode(String(e+h*t))),this.g.appendChild(c)}};mt.prototype.tracer_ordonnees=function(e,t,i,s,n,r){let o,c,a,h;const f="stroke:black;stroke-width:0.5;";for(this.grille==="invisible"&&this.axes!=="invisible"&&(o=document.createElementNS(l,"line"),o.setAttribute("style",f),o.setAttribute("x1",s),o.setAttribute("y1",this.cadre.haut),o.setAttribute("x2",s),o.setAttribute("y2",this.cadre.bas),this.g.appendChild(o)),h=0;h<=i;h++)if(o=document.createElementNS(l,"line"),o.setAttribute("style",f),a=this.mettre_y_en_pixels(e+h*t),this.grille==="invisible"?this.axes!=="invisible"&&(o.setAttribute("x1",String(s-5)),o.setAttribute("y1",a),o.setAttribute("x2",String(s+5)),o.setAttribute("y2",a),this.g.appendChild(o)):(o.setAttribute("x1",n),o.setAttribute("y1",a),o.setAttribute("x2",r),o.setAttribute("y2",a),this.g.appendChild(o)),this.etiquettes!=="invisible"&&this.axes!=="invisible"){c=document.createElementNS(l,"text"),c.setAttribute("x",s+2),c.setAttribute("y",a+12);const d="text-anchor:left;font-size:12px;fill:"+this.couleur+";";c.setAttribute("style",d),c.appendChild(document.createTextNode(String(e+h*t))),this.g.appendChild(c)}};mt.prototype.creeg=function(){const e=this.cadre.droite-this.cadre.gauche,t=this.cadre.bas-this.cadre.haut;this.g=document.createElementNS(l,"g");const i=document.createElementNS(l,"defs"),s=document.createElementNS(l,"clipPath");s.setAttribute("id","clipRepere");const n="stroke:"+this.couleur+";stroke-width:1;fill:none;",r=document.createElementNS(l,"rect");if(r.setAttribute("style",n),r.setAttribute("x",this.cadre.gauche),r.setAttribute("y",this.cadre.haut),r.setAttribute("width",e),r.setAttribute("height",t),s.appendChild(r),i.appendChild(s),this.g.appendChild(i),this.g.setAttribute("style","clip-path:url(#clipRepere)"),this.xmax-this.xmin>this.xgrad){const c=Math.floor((this.xmax-this.xmin)/this.xgrad);let a;this.ymax*this.ymin<0?a=this.mettre_y_en_pixels(0):this.ymax<0?a=this.cadre.haut:a=this.cadre.bas;const h=te(this.xmin,this.xmax,this.xgrad);this.tracer_abscisses(h,this.xgrad,c,a,this.cadre.haut,this.cadre.bas)}if(this.ymax-this.ymin>this.ygrad){const c=Math.floor((this.ymax-this.ymin)/this.ygrad);let a;this.xmax*this.xmin<0?a=this.mettre_x_en_pixels(0):this.xmax<0?a=this.cadre.droite:a=this.cadre.gauche;const h=te(this.ymin,this.ymax,this.ygrad);this.tracer_ordonnees(h,this.ygrad,c,a,this.cadre.gauche,this.cadre.droite)}const o=document.createElementNS(l,"rect");o.setAttribute("style",n),o.setAttribute("x",this.cadre.gauche),o.setAttribute("y",this.cadre.haut),o.setAttribute("width",e),o.setAttribute("height",t),this.g.appendChild(o),this.g.setAttribute("visibility","hidden")};const ai=["compas","equerre","rapporteur","regle","requerre","crayon"],ls=["Reset","PrevStep","Pause","Play","Restart","NextStep","GotoEnd","XML","Repeat"],ye=800,Ae=600,cs=e=>new Promise(t=>{setTimeout(()=>t(),e)});function me(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");const o=document.createElementNS(l,"polygon");return o.setAttribute("points","-5,8 8,0 -5,-8"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Le(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");let o=document.createElementNS(l,"rect");return o.setAttribute("x",-6),o.setAttribute("y",-7),o.setAttribute("width",3),o.setAttribute("height",14),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),o=document.createElementNS(l,"rect"),o.setAttribute("x",2),o.setAttribute("y",-7),o.setAttribute("width",3),o.setAttribute("height",14),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Re(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");const o=document.createElementNS(l,"rect");o.setAttribute("x",5),o.setAttribute("y",-6),o.setAttribute("width",3),o.setAttribute("height",12),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o);const c=document.createElementNS(l,"polygon");return c.setAttribute("points","-7,6 2,0 -7,-6"),c.setAttribute("style","stroke:white;fill:white;"),c.setAttribute("transform","translate(16,16)"),s.appendChild(c),s}function je(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");const o=document.createElementNS(l,"rect");o.setAttribute("x",-7),o.setAttribute("y",-6),o.setAttribute("width",3),o.setAttribute("height",12),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o);const c=document.createElementNS(l,"polygon");return c.setAttribute("points","7,6 -2,0 7,-6"),c.setAttribute("style","stroke:white;fill:white;"),c.setAttribute("transform","translate(16,16)"),s.appendChild(c),s}function _e(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");let o=document.createElementNS(l,"polygon");return o.setAttribute("points","-6,7 1,0 -6,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),o=document.createElementNS(l,"polygon"),o.setAttribute("points","3,7 10,0 3,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function $e(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");let o=document.createElementNS(l,"polygon");return o.setAttribute("points","6,7 -1,0 6,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),o=document.createElementNS(l,"polygon"),o.setAttribute("points","-3,7 -10,0 -3,-7"),o.setAttribute("style","stroke:white;fill:white;"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Ve(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");const o=document.createElementNS(l,"path");return o.setAttribute("d","M 0 -8 A 8 8 -90 1 1 -8 0"),o.setAttribute("style","stroke:white;stroke-width:3;fill:none;"),o.setAttribute("marker-end","url(#markerarrow"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function Te(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");const o=document.createElementNS(l,"path");return o.setAttribute("d","M 0 -8 A 8 8 -90 1 1 -1 -8"),o.setAttribute("style","stroke:white;stroke-width:3;fill:none;"),o.setAttribute("marker-end","url(#markerarrow"),o.setAttribute("transform","translate(16,16)"),s.appendChild(o),s}function qe(e,t,i){const s=document.createElementNS(l,"svg");s.setAttribute("x",e),s.setAttribute("y",t),s.setAttribute("width",32),s.setAttribute("height",32);const n=document.createElementNS(l,"circle");s.appendChild(n),n.setAttribute("cx",16),n.setAttribute("cy",16),n.setAttribute("r",15);const r=i==="fonce"?"filtrebleu":"filtregris";n.setAttribute("style","stroke:none;fill:url(#radial"+i+"); filter:url(#"+r+");");const o=document.createElementNS(l,"text");return o.setAttribute("pointer-events","none"),o.appendChild(document.createTextNode("XML")),o.setAttribute("x",16),o.setAttribute("y",21),o.setAttribute("style","font-family:Arial;font-size:9pt;fill:white;text-anchor:middle"),s.appendChild(o),s}function At(e){return e.getAttribute("id")}function ct(e){return e.getAttribute("abscisse")}function ut(e){const t=e.getAttribute("ordonnee");return t===null?e.getAttribute("ordonnée"):t}function _(e){const t=e.getAttribute("couleur");return t?K(t):"black"}function us(e){const t=e.getAttribute("couleur_cadre");return t?K(t):null}function Qt(e){const t=e.getAttribute("couleur_fond");return t?K(t):null}function B(e){const t=e.getAttribute("epaisseur");return t===null||parseInt(t)===0?"1":t}function et(e){const t=e.getAttribute("opacite");return t===null?"100":t}function hs(e){const t=e.getAttribute("opacite");return t===null?"50":t}function ht(e){const t=e.getAttribute("pointille");return t??"continu"}function xt(e){const t=e.getAttribute("style");return t??"normal"}function A(e,t,i){this.svg=e,typeof i=="boolean"?(this.autoStart=i,i={}):(typeof i!="object"&&(i={}),this.autoStart=!!i.autoStart),this.debug=!!i.debug,this.windowxml=null;let s=t;s.search(/<?xml/gi)===-1&&(s='<?xml version="1.0" encoding="UTF-8"?>'+s),s=s.replace(/<action[_]\d*/gi,"<action"),s=s.replace(/<!--.*-->/g,""),s=s.replace(/(="[^"]*")([^ ])/g,"$1 $2").replace(/--/g,""),s=s.replace(/<</g,"<").replace(/>>/g,">"),s=s.replace(/<action(\w)/gi,"<action $1"),s=s.replace(/<commentaire\s*texte\s*=/gi,"<commentaire texteCommentaire ="),s=mi(s),this.codexml=s;const n=/<\s*INSTRUMENPOCHE[^>]*>(.*)<\s*\/INSTRUMENPOCHE/si.exec(s);if(!n)throw Error("script xml invalide");this.chdoc="<INSTRUMENPOCHE>"+n[1]+"</INSTRUMENPOCHE>",this.actions=[],this.elements=[],this.compasRetourne=!1,this.compasLeve=null,this.compas=new U(this),this.equerre=new se(this),this.rapporteur=new St(this),this.regle=new Et(this),this.requerre=new Ct(this),this.crayon=new ne(this),this.xmldoc=gi(this.chdoc),this.tabact=this.xmldoc.getElementsByTagName("action"),this.started=!1,this.animationEnCours=!0;const r={x:0,y:0,width:ye,height:Ae},o=this.xmldoc.getElementsByTagName("viewBox");if(o&&o.length){o.length>1&&console.error(Error("Il y a plusieurs tags viewBox dans le script, on prend le premier"),o);const a=o[0];Object.keys(r).forEach(h=>{const p=Number(a.getAttribute(h));Number.isFinite(p)&&(h.length<2||p>0)&&(r[h]=p)})}if(window.innerHeight>r.height*.6&&r.width/r.height<window.innerWidth/window.innerHeight)try{e.parentNode.style.width=window.innerHeight/r.height*r.width+"px"}catch(a){console.error(a)}try{e.parentNode.style.minWidth=r.width/2+"px",e.parentNode.style.minHeight=r.height/2+"px"}catch(a){console.error(a)}this.initialViewBox=r,e.setAttribute("viewBox",`${r.x} ${r.y} ${r.width} ${r.height}`),e.setAttribute("preserveAspectRatio","xMinYMin meet"),this.indiceActionEnCours=0,this.creeActions();const c=this;e.addEventListener("mousemove",function(a){c.mousemoveListenerSvg(a,a.clientX,a.clientY)},!1),e.addEventListener("mouseup",function(){c.mouseupListener()},!1),e.addEventListener("mouseleave",function(){c.mouseleaveListener()},!1),e.addEventListener("touchmove",function(a){c.mousemoveListenerSvg(a,a.touches[0].pageX,a.touches[0].pageY)},!1),e.addEventListener("touchend",function(){c.mouseupListener()},!1),e.addEventListener("touchcancel",function(){c.mouseupListener()},!1),e.addEventListener("touchleave",function(){c.mouseleaveListener()},!1),this.debug&&console.debug("iepDoc instancié :",this)}A.prototype.setViewBox=function(t){if(typeof t!="object"||Object.keys(this.initialViewBox).some(c=>!Number.isFinite(t[c])))throw TypeError("paramètre invalide (il faut passer un objet { x: number, y: number, width: number, height: number })");const{x:i,y:s,width:n,height:r}=t;if(n<10||r<10)return console.error(Error("width et height doivent être supérieur à 10"));const o=this.initialViewBox.width/n;this.svg.setAttribute("viewBox",`${i} ${s} ${n} ${r}`),this.barreIcones.setAttribute("transform",`translate(${i+this.xbarre/o}, ${s+this.ybarre/o}) scale(${1/o})`)};A.prototype.zoom=function(t,i,s){if(typeof t!="number"||t<1e-6||t>1e6)throw Error(`zoomFactor invalide : ${typeof t} ${t}`);if(t===1)return this.setViewBox(this.initialViewBox);let{x:n,y:r,width:o,height:c}=this.getViewBox();Number.isFinite(i)||(i=n+o/2),Number.isFinite(s)||(s=r+c/2),o=Math.round(o/t),c=Math.round(c/t),n=i-o/2,r=s-c/2,this.setViewBox({x:n,y:r,width:o,height:c})};A.prototype.isReadyAll=function(){if(this.debug){const t=this.actions.filter(i=>!i.isReady);t.length?console.debug(`${t.length} actions pas encore prêtes (sur ${this.actions.length})`):console.debug(`Les ${this.actions.length} actions sont prêtes`)}return this.actions.every(t=>t.isReady)};A.prototype.whenReady=function(t,i=30){const s=()=>setTimeout(n,100),n=()=>{if(this.isReadyAll())return t();if(Date.now()-r<i*1e3)return s();t(Error(`Après ${i}s d’attente l’animation n’est pas prête, échec du chargement…`))},r=Date.now();n()};A.prototype.getReadyPromise=function(t=30){return this.isReadyAll()?Promise.resolve():new Promise((i,s)=>{this.whenReady(n=>{n?s(n):i(this)},t)})};A.prototype.getWidth=function(){return this.getViewBox().width};A.prototype.getHeight=function(){return this.getViewBox().height};A.prototype.getViewBox=function(){try{const t=this.svg.getAttribute("viewBox");if(t){const i=t.split(" ").map(Number).filter(s=>!Number.isNaN(s));if(i.length===4){const[s,n,r,o]=i;if(r>0&&o>0)return{x:s,y:n,width:r,height:o}}}console.error(Error("viewBox invalide"),t)}catch(t){console.error(t)}return this.svg.setAttribute("viewBox",`0 0 ${ye} ${Ae}`),{x:0,y:0,width:ye,height:Ae}};A.prototype.goFast=function(t=100,i){const s=this,n=()=>{s.nextStep(),s.indiceActionEnCours<s.actions.length?setTimeout(()=>n(),t):i&&i()};this.getReadyPromise().then(()=>s.animationEnCours?(s.pause(),cs(500)):Promise.resolve()).then(()=>{s.reset(),n()}).catch(r=>{console.error(r),alert(r.message)})};A.prototype.creeElementsGraphiques=function(){this.actions.forEach(t=>t.creegElement())};A.prototype.initialiseOutils=function(){ai.forEach(t=>{this[t].initialisePosition(),this[t].montre(!1)}),this.compas.leve=!1};A.prototype.recreeOutils=function(){ai.forEach(t=>{this[t].updateg(),this[t].montre(!1)}),this.compasLeve=null};A.prototype.init=function(){this.started=!0,this.creeElementsGraphiques(),this.recreeOutils(),this.creeIcones(),this.autoStart?(this.montreIcones(["Pause"]),this.play()):this.montreIcones(["Play"])};A.prototype.creeIcones=function(){const i=this;this.barreIcones=document.createElementNS(l,"g"),this.creeElementsPourIcones(),this.iconReset=$e(0,0,"fonce"),this.iconResetGris=$e(0,0,"clair"),this.iconReset.onclick=this.reset.bind(this),this.barreIcones.appendChild(this.iconReset),this.barreIcones.appendChild(this.iconResetGris),this.iconPrevStep=je(32,0,"fonce"),this.iconPrevStepGris=je(32,0,"clair"),this.iconPrevStep.onclick=function(){i.prevStep()},this.barreIcones.appendChild(this.iconPrevStep),this.barreIcones.appendChild(this.iconPrevStepGris),this.iconPause=Le(64,0,"fonce"),this.iconPauseGris=Le(64,0,"clair"),this.iconPause.onclick=this.pause.bind(this),this.barreIcones.appendChild(this.iconPause),this.barreIcones.appendChild(this.iconPauseGris),this.iconPlay=me(96,0,"fonce"),this.iconPlayGris=me(96,0,"clair"),this.iconPlay.onclick=this.play.bind(this),this.barreIcones.appendChild(this.iconPlay),this.iconContinue=me(96,0,"rouge"),this.iconContinue.setAttribute("visibility","hidden"),this.iconContinue.onclick=this.continue.bind(this),this.barreIcones.appendChild(this.iconContinue),this.barreIcones.appendChild(this.iconPlayGris),this.iconRestart=Ve(128,0,"fonce"),this.iconRestartGris=Ve(128,0,"clair"),this.iconRestart.onclick=this.restart.bind(this),this.barreIcones.appendChild(this.iconRestart),this.barreIcones.appendChild(this.iconRestartGris),this.iconNextStep=Re(160,0,"fonce"),this.iconNextStepGris=Re(160,0,"clair"),this.iconNextStep.onclick=function(){i.nextStep()},this.barreIcones.appendChild(this.iconNextStep),this.barreIcones.appendChild(this.iconNextStepGris),this.iconGotoEnd=_e(192,0,"fonce"),this.iconGotoEndGris=_e(192,0,"clair"),this.iconGotoEnd.onclick=function(){i.gotoEnd()},this.barreIcones.appendChild(this.iconGotoEnd),this.barreIcones.appendChild(this.iconGotoEndGris),this.iconXML=qe(224,0,"fonce"),this.iconXMLGris=qe(224,0,"clair"),this.iconXML.onclick=function(){i.showXml()},this.barreIcones.appendChild(this.iconXML),this.barreIcones.appendChild(this.iconXMLGris),this.iconRepeat=Te(256,0,"fonce"),this.iconRepeatGris=Te(256,0,"clair"),this.iconRepeat.onclick=this.repeat.bind(this),this.barreIcones.appendChild(this.iconRepeat),this.barreIcones.appendChild(this.iconRepeatGris),this.hauteurBarre=32,this.demiLargeurBarre=8*16,this.xbarre=50,this.ybarre=4,this.barreIcones.setAttribute("transform",`translate(${this.xbarre}, ${this.ybarre})`),this.svg.appendChild(this.barreIcones),this.isDraggingBarre=!1,this.barreIcones.addEventListener("mousedown",function(s){i.mousedownListenerBarre(s.clientX,s.clientY)},!1),this.barreIcones.addEventListener("mousemove",function(s){i.mousemoveListenerBarre(s.clientX,s.clientY)},!1),this.barreIcones.addEventListener("touchstart",function(s){i.mousedownListenerBarre(s.touches[0].pageX,s.touches[0].pageY)},!1),this.barreIcones.addEventListener("touchmove",this.mousemoveListenerBarre.bind(this),!1),this.deltax=0,this.deltay=0};A.prototype.mousedownListenerBarre=function(t,i){this.animationEnCours||(this.isDraggingBarre=!0,this.xcapturebarre=t,this.ycapturebarre=i)};A.prototype.mousemoveListenerBarre=function(){this.animationEnCours?(this.barreIcones.style.cursor="default",this.isDraggingBarre=!1):this.barreIcones.style.cursor="pointer"};A.prototype.mousemoveListenerSvg=function(t,i,s){if(this.isDraggingBarre){const n=this.getWidth(),r=this.getHeight(),o=i-this.xcapturebarre,c=s-this.ycapturebarre,a=this.deltax+o,h=this.deltay+c,p=this.xbarre+a,f=this.ybarre+h;p<=n-2*this.demiLargeurBarre&&p>=0&&f>=0&&f<=r-this.hauteurBarre&&(this.barreIcones.setAttribute("transform","translate("+p+","+f+")"),this.deltax=a,this.deltay=h,this.xcapturebarre=i,this.ycapturebarre=s),t.preventDefault()}};A.prototype.mouseupListener=function(){this.isDraggingBarre=!1};A.prototype.mouseleaveListener=function(){this.isDraggingBarre=!1};A.prototype.showXml=function(){this.windowxml==null?this.windowxml=this.popup():this.windowxml.focus()};A.prototype.montreIcones=function(t){ls.forEach(i=>{const s=t.includes(i),n="icon"+i;this[n]?(this[n].setAttribute("visibility",s?"visible":"hidden"),this[n+"Gris"].setAttribute("visibility",s?"hidden":"visible")):console.error(`L’icone ${n} n’existe pas`)})};A.prototype.activeIconeContinuer=function(){this.montreIcones(["XML"]),this.iconPlayGris.setAttribute("visibility","hidden"),this.iconContinue.setAttribute("visibility","visible")};A.prototype.gotoEnd=function(){this.animationEnCours=!1,this.initialise(),this.montreIcones(["Reset","PrevStep","Restart","XML","Repeat"]),this.executeJusque(this.actions.length-1),this.indiceActionEnCours=this.actions.length};A.prototype.play=function(){this.animationEnCours=!0,this.montreIcones(["Pause"]),this.actions[this.indiceActionEnCours]?this.actions[this.indiceActionEnCours].execute(!1):console.error(Error(`Pas d'action ${this.indiceActionEnCours}`),this.actions)};A.prototype.continue=function(){if(this.indiceActionEnCours===this.actions.length){this.gotoEnd();return}this.iconContinue.setAttribute("visibility","hidden"),this.montreIcones(["Pause"]),this.animationEnCours=!0,this.indiceActionEnCours++,this.actions[this.indiceActionEnCours]?this.actions[this.indiceActionEnCours].execute(!1):console.error(Error(`Pas d'action ${this.indiceActionEnCours}`),this.actions)};A.prototype.reset=function(){this.animationEnCours=!1,this.initialise(),this.montreIcones(["Play","NextStep","GotoEnd","XML","Repeat"]),this.indiceActionEnCours=0,this.zoom(1)};A.prototype.restart=function(){if(this.animationEnCours){this.animationEnCours=!1,setTimeout(this.restart.bind(this),100);return}this.initialise(),this.indiceActionEnCours=0,this.zoom(1),this.play()};A.prototype.repeat=function(){if(this.animationEnCours){this.animationEnCours=!1,setTimeout(this.repeat.bind(this),100);return}this.animationEnCours=!0,this.animationEnBoucle=!0,this.initialise(),this.montreIcones(["Pause"]),this.indiceActionEnCours=0,this.zoom(1),this.actions[0].execute(!1)};A.prototype.pause=function(){this.animationEnBoucle=!1,this.animationEnCours=!1,setTimeout(()=>this.montreIcones(["Reset","PrevStep","Play","Restart","NextStep","GotoEnd","XML","Repeat"]),500)};A.prototype.nextStep=function(){const t=this.actions.length;this.animationEnCours=!1,this.indiceActionEnCours<t&&(this.actions[this.indiceActionEnCours].actionVisible()?this.indiceActionEnCours++:this.indiceActionEnCours=this.indiceProchaineActionVisible(this.indiceActionEnCours)+1,this.executeJusque(this.indiceActionEnCours-1));const i=this.indiceActionEnCours===this.actions.length,s=["Reset","PrevStep","Restart","XML","Repeat"];i?this.montreIcones(s):this.montreIcones(s.concat(["NextStep","GotoEnd","Play"]))};A.prototype.prevStep=function(){this.animationEnCours=!1,this.indiceActionEnCours=this.indicePrecedenteActionVisible(this.indiceActionEnCours-1),this.indiceActionEnCours>0&&this.executeJusque(this.indiceActionEnCours-1);const t=["Play","NextStep","GotoEnd","XML","Repeat"];this.indiceActionEnCours===0?this.montreIcones(t):this.montreIcones(t.concat(["Reset","PrevStep"]))};A.prototype.initialise=function(){let t,i;const s=this.svg;for(t=0;t<s.childNodes.length;t++)if(i=s.childNodes[t],i!==this.barreIcones)try{s.childNodes[t].setAttribute("visibility","hidden")}catch(n){console.error(n)}for(t=0;t<this.actions.length;t++){const n=this.actions[t];n instanceof $&&n.objet.initialisePosition()}this.initialiseOutils()};A.prototype.getInstrumentVisibility=function(t,i){if(i===-1)return!1;let s,n=!1;for(let r=0;r<=i;r++)s=this.actions[r],s instanceof zt?s.instrument===t&&(n=!0):s instanceof Tt&&s.instrument===t&&(n=!1);return n};A.prototype.getObjectVisibility=function(t,i){if(i===-1)return!1;let s,n=!1;for(let r=0;r<=i;r++)s=this.actions[r],s instanceof qt?s.objet===t&&(n=!0):s instanceof Vt&&s.objet===t&&(n=!1);return n};A.prototype.getCompasStatus=function(t){if(t===-1)return"couche";let i=!0,s;for(let n=0;n<=t;n++)s=this.actions[n],s instanceof jt?i=!0:s instanceof $t&&(i=!1);return i?"couche":"leve"};A.prototype.indiceProchaineActionVisible=function(t){if(t>=this.actions.length)return this.actions.length-1;for(let i=t;i<this.actions.length;i++)if(this.actions[i].actionVisible())return i;return this.actions.length-1};A.prototype.indicePrecedenteActionVisible=function(t){if(t<0)return 0;t===this.actions.length&&t--;for(let i=t;i>=0;i--)if(this.actions[i].actionVisible())return i;return 0};A.prototype.montreInstrumentsEtape=function(t){let i=this.getInstrumentVisibility(this.compas,t);this.compas.leve?this.compasLeve.montre(i):this.compas.montre(i),i=this.getInstrumentVisibility(this.crayon,t),this.crayon.montre(i),i=this.getInstrumentVisibility(this.equerre,t),this.equerre.montre(i),i=this.getInstrumentVisibility(this.rapporteur,t),this.rapporteur.montre(i),i=this.getInstrumentVisibility(this.regle,t),this.regle.montre(i),i=this.getInstrumentVisibility(this.requerre,t),this.requerre.montre(i)};A.prototype.executeJusque=function(t){if(!(t>=this.actions.length)){this.initialise(),this.initialiseOutils(),this.animationEnCours=!1;for(let i=0;i<=t;i++)this.actions[i].execute(!0);this.montreInstrumentsEtape(t)}};A.prototype.addElement=function(t){const i=this.elements.findIndex(s=>s.id===t.id&&s.objet===t.objet);i!==-1?this.elements[i]=t:this.elements.push(t)};A.prototype.pushElement=function(t){if(this.elements.some(i=>i.id===t.id&&i.objet===t.objet))throw Error(`Il y a déjà un élément ${t.id} désignant le même objet`);this.elements.push(t)};A.prototype.getElement=function(t,i){return this.elements.find(n=>n.objet===i?i==="quadrillage"?!0:n.id===t:!1)||null};A.prototype.setElement=function(t,i){const s=this.elements.findIndex(n=>n.id===t);return s!==-1?(this.elements[s]=i,!0):!1};A.prototype.ajouteAction=function(t){t.indice=this.actions.length,this.actions.push(t)};A.prototype.creeActions=function(){let t,i,s,n,r,o,c,a,h,p,f,d,g,b,u,w,y,S,j,M,I,O,E;for(t=0;t<this.tabact.length;t++){i=this.tabact[t],p=At(i),s=i.getAttribute("mouvement"),y=i.getAttribute("tempo");try{let F,X;switch(s){case"creer":if(n=i.getAttribute("objet"),this.getElement(p,n)!==null){console.error(`L'id ${p} existe déjà, action creer ignorée`,n);break}if(n!=null){switch(n){case"point":r=new lt(this,p,parseFloat(ct(i)),parseFloat(ut(i)),_(i),B(i)),o=new $(this,p,r,y);break;case"angle":r=new xe(this,p,ct(i),ut(i),i.getAttribute("rayon"),i.getAttribute("angle1"),i.getAttribute("angle2"),_(i),B(i),hs(i),i.getAttribute("forme")),o=new $(this,p,r,y);break;case"angle_droit":r=new ee(this,p,i.getAttribute("abscisse_sommet"),i.getAttribute("ordonnee_sommet"),i.getAttribute("abscisse_inter"),i.getAttribute("ordonnee_inter"),_(i),B(i)),o=new $(this,p,r,y);break;case"longueur":r=new Dt(this,p,ct(i),ut(i),_(i),B(i),i.getAttribute("forme")),o=new $(this,p,r,y);break;case"marque":r=new Gt(this,p,i.getAttribute("idSeg"),_(i),B(i),i.getAttribute("forme"),i.getAttribute("rayon")),o=new $(this,p,r,y);break;case"texte":r=new tt(this,p,ct(i),ut(i),_(i),i.getAttribute("taille")),o=new $(this,p,r,y);break;case"repere":r=new mt(this,i.getAttribute("hauteur"),i.getAttribute("largeur"),i.getAttribute("haut"),i.getAttribute("gauche"),i.getAttribute("Xgrad"),i.getAttribute("Ygrad"),i.getAttribute("Xmin"),i.getAttribute("Xmax"),i.getAttribute("Ymin"),i.getAttribute("Ymax"),_(i),i.getAttribute("grille"),i.getAttribute("axes"),i.getAttribute("etiquettes")),o=new $(this,p,r,y);break;case"quadrillage":if(F=i.getAttribute("abscisse_bas_droite"),F!=null){F=parseFloat(F)/30;const z=parseFloat(i.getAttribute("ordonnee_bas_droite"))/30,L=parseFloat(i.getAttribute("abscisse_haut_gauche"))/30,yt=parseFloat(i.getAttribute("ordonnee_haut_gauche"))/30;r=new Rt(this,i.getAttribute("quadrillage"),String(z-yt),String(F-L),yt,L,_(i)),o=new $(this,"quadrillageIEP",r,y)}else r=new Rt(this,i.getAttribute("quadrillage"),i.getAttribute("hauteur"),i.getAttribute("largeur"),i.getAttribute("haut"),i.getAttribute("gauche"),_(i));o=new $(this,"quadrillageIEP",r,y);break;case"axe":r=new ft(this,i.getAttribute("pente"),i.getAttribute("largeur"),i.getAttribute("haut"),i.getAttribute("gauche"),i.getAttribute("distanceBord"),i.getAttribute("Xgrad"),i.getAttribute("Xmin"),i.getAttribute("Xmax"),_(i)),o=new $(this,p,r,y);break;case"gabarit":X=i.getAttribute("ecart_angle"),X===null&&(X="-30"),r=new ot(this,p,i.getAttribute("abscisse"),i.getAttribute("ordonnee"),i.getAttribute("rayon"),X,_(i),B(i),Qt(i),et(i)),o=new $(this,p,r,y);break;default:console.error("objet inconnu => création ignorée"),o=null}o&&(this.ajouteAction(o),o.setReady())}break;case"montrer":n=i.getAttribute("objet"),Mt(n)?(b=i.getAttribute("abscisse"),u=i.getAttribute("ordonnee"),o=new zt(this,this[n],b,u,y),(n==="crayon"||n==="compas")&&b!=null&&u!=null&&this[n].translate(parseFloat(b),parseFloat(u))):o=new qt(this,p,n,y),this.ajouteAction(o),o.setReady();break;case"masquer":n=i.getAttribute("objet"),Mt(n)?o=new Tt(this,this[n],y):o=new Vt(this,p,n,y),this.ajouteAction(o),o.setReady();break;case"tracer":switch(n=i.getAttribute("objet"),E=i.getAttribute("cible"),E!=null?(r=this.getElement(E,"point"),b=r.xcons,u=r.ycons):(b=parseFloat(ct(i)),u=parseFloat(ut(i))),n){case"crayon":switch(c=i.getAttribute("forme"),a=this.crayon.x,h=this.crayon.y,p=At(i),c){case null:isNaN(b)||isNaN(u)?(r=new nt(this,p,this.crayon.x,this.crayon.y,i.getAttribute("abscisses"),i.getAttribute("ordonnees"),_(i),B(i),et(i),ht(i),xt(i)),S=r.abs.length,this.crayon.translate(r.abs[S-1],r.ord[S-1])):(r=new Lt(this,p,a,h,b,u,_(i),B(i),et(i),ht(i),xt(i)),this.crayon.translate(b,u));break;case"droite":if(isNaN(b)||isNaN(u))break;r=new gt(this,p,a,h,b,u,_(i),B(i),et(i),ht(i),xt(i)),this.crayon.translate(b,u);break;case"demidroite":if(isNaN(b)||isNaN(u))break;r=new we(this,p,a,h,b,u,_(i),B(i),et(i),ht(i),xt(i)),this.crayon.translate(b,u);break;case"polygone":if(w=i.getAttribute("cibles"),w===null)r=new rt(this,p,i.getAttribute("abscisses"),i.getAttribute("ordonnees"),_(i),B(i),Qt(i),i.getAttribute("opacite"));else{let z="",L="";w.split(",").forEach((yt,Pt)=>{const Ht=Pt===0?"":",",Jt=this.getElement(yt,"point");z+=Ht+Jt.xcons,L+=Ht+Jt.ycons}),r=new rt(this,p,z,L,_(i),B(i),Qt(i),i.getAttribute("opacite"))}S=r.abs.length,this.crayon.translate(r.abs[S-1],r.ord[S-1]);break;case"libre":r=new nt(this,p,this.crayon.x,this.crayon.y,i.getAttribute("abscisses"),i.getAttribute("ordonnees"),_(i),B(i),et(i),ht(i),xt(i)),S=r.abs.length,this.crayon.translate(r.abs[S-1],r.ord[S-1])}g=i.getAttribute("vitesse"),g==null&&(g="4"),o=new $(this,At(i),r,y,g),this.ajouteAction(o),o.setReady();break;case"trait":g=i.getAttribute("vitesse"),g===null&&(g=1e4),r=new Lt(this,p,i.getAttribute("abscisse1"),i.getAttribute("ordonnee1"),i.getAttribute("abscisse2"),i.getAttribute("ordonnee2"),_(i),B(i),et(i),ht(i),xt(i)),o=new $(this,At(i),r,y,g),this.ajouteAction(o),o.setReady();break;case"compas":r=new pt(this,p,this.compas.x,this.compas.y,this.compas.ecart,this.getAngle(i,"debut"),this.getAngle(i,"fin"),_(i),B(i),et(i),ht(i)),g=i.getAttribute("sens"),g==null&&(g="8"),o=new $(this,At(i),r,y,g),this.ajouteAction(o),o.setReady();break;case"angle_droit":r=new ee(this,p,i.getAttribute("abscisse_sommet"),i.getAttribute("ordonnee_sommet"),i.getAttribute("abscisse_inter"),i.getAttribute("ordonnee_inter"),_(i),B(i)),o=new $(this,At(i),r,y,g),this.ajouteAction(o),o.setReady();break}break;case"rotation":n=i.getAttribute("objet"),d=i.getAttribute("sens"),Mt(n)?(E=i.getAttribute("cible"),E!=null&&i.getAttribute("angle")===null?(r=this.getElement(E,"point"),b=r.xcons,u=r.ycons,M=new P(this[n].x,this[n].y,b,u),M.presqueNul()?f=0:f=-M.angle()):n==="compas"?f=this.getAngle(i,"angle"):f=i.getAttribute("angle"),o=new ce(this,this[n],f,y,d)):this.getElement(p,n)===null?o=null:(f=i.getAttribute("angle"),o=new he(this,p,f,n,y,d)),o!==null&&(this.ajouteAction(o),o.setReady());break;case"translation":n=i.getAttribute("objet"),E=i.getAttribute("cible"),E!=null?(r=this.getElement(E,"point"),b=r.xcons,u=r.ycons):(b=parseFloat(ct(i)),u=parseFloat(ut(i))),g=i.getAttribute("vitesse"),Mt(n)?(this[n].x=b,this[n].y=u,o=new de(this,this[n],b,u,y,g)):this.getElement(p,n)===null?o=null:(n==="point"&&(O=this.getElement(p,"point"),O.xcons=b,O.ycons=u),o=new pe(this,p,b,u,n,y,g)),o!==null&&(this.ajouteAction(o),(n==="crayon"||n==="compas")&&this[n].translate(b,u),o.setReady());break;case"zoom":n=i.getAttribute("objet"),g=i.getAttribute("vitesse"),Mt(n)?(I=i.getAttribute("echelle"),this[n].zoomfactor=parseFloat(I)/100,o=new fe(this,this[n],I,y,g)):n==="texte"||n==="image"?o=new ge(this,p,i.getAttribute("echelle"),n,y,g):o=null,o!==null&&(this.ajouteAction(o),o.setReady());break;case"ecarter":E=i.getAttribute("cible"),E!=null?(r=this.getElement(E,"point"),M=new P(this.compas.x,this.compas.y,r.xcons,r.ycons),j=M.norme()):j=parseFloat(i.getAttribute("ecart"))*this.compas.zoomfactor,this.compas.ecart=j,o=new re(this,j,y,i.getAttribute("vitesse")),this.ajouteAction(o),o.setReady();break;case"lever":o=new $t(this,y),this.ajouteAction(o),o.setReady();break;case"coucher":o=new jt(this,y),this.ajouteAction(o),o.setReady();break;case"masquer_nombres":o=new Ft(this,!1,y),this.ajouteAction(o),o.setReady();break;case"montrer_nombres":o=new Ft(this,!0,y),this.ajouteAction(o),o.setReady();break;case"graduations":n=i.getAttribute("objet"),o=new Ot(this,this[n],!0,y),this.ajouteAction(o),o.setReady();break;case"vide":n=i.getAttribute("objet"),o=new Ot(this,this[n],!1,y),this.ajouteAction(o),o.setReady();break;case"retourner":this.compasRetourne=!this.compasRetourne,o=new ue(this,y),this.ajouteAction(o),o.setReady();break;case"glisser":o=new oe(this,i.getAttribute("abscisse"),y,i.getAttribute("vitesse")),this.ajouteAction(o),o.setReady();break;case"chargement":r=new bt(this,p,i.getAttribute("url")),r.prepareAction();break;case"ecrire":o=new Y(this,p,_(i),i.getAttribute("taille"),i.getAttribute("texte"),i.getAttribute("style"),Qt(i),i.getAttribute("opacite_fond"),us(i),i.getAttribute("epaisseur_cadre"),i.getAttribute("marge"),i.getAttribute("marge_gauche"),i.getAttribute("marge_droite"),i.getAttribute("marge_haut"),i.getAttribute("marge_bas"),y),this.ajouteAction(o),o.prepare();break;case"nommer":if(this.getElement(p,"point")!==null){const z=i.getAttribute("nom");z!==""&&(r=new kt(this,p,ct(i),ut(i),z,_(i)),o=new Bt(this,r,y),this.ajouteAction(o),o.prepare())}break;case"pause":o=new le(this,y),this.ajouteAction(o),o.setReady();break;case"modifier_longueur":n=i.getAttribute("objet"),o=new ae(this,this[n],i.getAttribute("longueur"),y),this.ajouteAction(o),o.setReady();break;case"modifier_rayon":n=i.getAttribute("objet"),o=new be(this,p,i.getAttribute("rayon"),n,y),this.ajouteAction(o),o.setReady();break}}catch(F){console.error(F)}}this.getReadyPromise().then(this.init.bind(this)).catch(F=>{console.error(F),window.alert(F.message)})};A.prototype.execute=function(t){this.indiceActionEnCours=0,this.actions[0].execute(t)};A.prototype.actionSuivante=function(t){if(t=!!t,!this.animationEnCours&&!t)return;const i=this.actions[this.indiceActionEnCours];i.tempo===null||t?this.passageActionSuivante(t):setTimeout(this.passageActionSuivante.bind(this,t),i.tempo)};A.prototype.passageActionSuivante=function(t){if(!(this.indiceActionEnCours>=this.actions.length))if(this.indiceActionEnCours!==this.actions.length-1)this.indiceActionEnCours++,this.actions[this.indiceActionEnCours].execute(t);else if(this.animationEnBoucle){const i=this;setTimeout(function(){i.initialise(),i.indiceActionEnCours=0,i.actions[i.indiceActionEnCours].execute(t)},3e3)}else this.indiceActionEnCours++,this.montreIcones(["Reset","PrevStep","Restart","XML","Repeat"]),this.animationEnCours=!1};A.prototype.getAngle=function(t,i){const s=t.getAttribute(i);return s==null?null:this.compasRetourne?String(parseFloat(s)+180):s};A.prototype.creeElementsPourIcones=function(){let t=document.createElementNS(l,"defs");t.appendChild(this.radialGradiant("#9999FF","#000099","radialfonce")),this.svg.appendChild(t),t=document.createElementNS(l,"defs"),t.appendChild(this.radialGradiant("#CCCCCC","#666666","radialclair")),this.svg.appendChild(t),t=document.createElementNS(l,"defs"),t.appendChild(this.radialGradiant("#FF9999","#FF0000","radialrouge")),this.svg.appendChild(t),t=document.createElementNS(l,"defs"),t.appendChild(this.markerArrow("markerarrow")),this.barreIcones.appendChild(t),t=document.createElementNS(l,"defs"),t.appendChild(this.filtreEclairageIcone("filtrebleu")),this.barreIcones.appendChild(t),t=document.createElementNS(l,"defs"),t.appendChild(this.filtreEclairageIcone("filtregris")),this.barreIcones.appendChild(t)};A.prototype.radialGradiant=function(t,i,s){const n=document.createElementNS(l,"radialGradient");n.setAttribute("id",s);let r=document.createElementNS(l,"stop");return r.setAttribute("offset","0%"),r.setAttribute("style","stop-color:"+i+";"),n.appendChild(r),r=document.createElementNS(l,"stop"),r.setAttribute("offset","80%"),r.setAttribute("style","stop-color:"+t+";"),n.appendChild(r),r=document.createElementNS(l,"stop"),r.setAttribute("offset","100%"),r.setAttribute("style","stop-color:"+i+";"),n.appendChild(r),n};A.prototype.markerArrow=function(t){const i=document.createElementNS(l,"marker");i.setAttribute("id",t),i.setAttribute("markerWidth","4"),i.setAttribute("markerHeight","4"),i.setAttribute("refX","0"),i.setAttribute("refY","2"),i.setAttribute("orient","auto");const s=document.createElementNS(l,"path");return s.setAttribute("d","M 0 0 2 2 0 4 Z"),s.setAttribute("style","fill:white;"),i.appendChild(s),i};A.prototype.filtreEclairageIcone=function(t){const i=document.createElementNS(l,"filter");i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("color-interpolation-filters","sRGB");const s=document.createElementNS(l,"feDiffuseLighting");s.setAttribute("lighting-color","white"),s.setAttribute("surfaceScale","1"),s.setAttribute("diffuseConstant","1.2"),s.setAttribute("in","SourceGraphic"),s.setAttribute("result","diffOut");const n=document.createElementNS(l,"fePointLight");n.setAttribute("x","5"),n.setAttribute("y","5"),n.setAttribute("z","15"),s.appendChild(n),i.appendChild(s);const r=document.createElementNS(l,"feComposite");return r.setAttribute("in","SourceGraphic"),r.setAttribute("in2","diffOut"),r.setAttribute("operator","arithmetic"),r.setAttribute("k1","1"),r.setAttribute("k2","0"),r.setAttribute("k3","0"),r.setAttribute("k4","0"),i.appendChild(r),i.setAttribute("id",t),i};A.prototype.popup=function(){const t=window.open("","popup","width=700,height=450,toolbar=no,scrollbars=no,resizable=yes");t.iepDoc=this;const i=t.document;i.title="Code Xml de la figure";const s=i.createElement("div"),n=i.createElement("form");s.appendChild(n),s.setAttribute("align","center"),i.body.appendChild(s);const r=i.createElement("textarea");n.appendChild(r),r.setAttribute("cols",80),r.setAttribute("rows",25),r.setAttribute("readonly",!0),r.style.fontSize="13px",r.scrollIntoView();let o=this.codexml;o=o.replace(/>\s*</g,`>
<`),r.appendChild(document.createTextNode(o)),r.select();const c=this;return t.addEventListener("unload",()=>{c.windowxml=null}),t};function li(e){e.docs.forEach(t=>{t.windowxml&&t.windowxml.close()})}function Zt(e){this.debug=!!(e&&e.debug),this.debug&&console.debug("Mode debug activé"),this.docs=[],window.addEventListener("unload",li.bind(null,this))}Zt.prototype.addDoc=function(t,i,s=!0){if(typeof t=="string"&&(t=document.getElementById(t)),!t)return new Error("svg manquant");if(t.localName!=="svg")return new Error("svg incorrect");const n={autoStart:s,debug:this.debug},r=new A(t,i,n);return this.docs.push(r),t.iepDoc=r,r};Zt.prototype.flush=function(){li(this),this.docs.forEach(({svg:t})=>{t.parentNode?t.parentNode.removeChild(t):console.error("le svg",t,"n’a pas de parentNode")}),this.docs=[]};Zt.prototype.getDocs=function(){return this.docs};Zt.prototype.getLastDoc=function(){const t=this.docs.length;return t?this.docs[t-1]:null};const{addElement:ze,empty:ds,setStyles:ci}=oi;let Kt;function ps(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.classList.add("svgIep"),e.appendChild(t),ci(t,{margin:0,padding:0,width:"98%",height:"98%"}),t}function fs(e){const t=e.parentNode;t.style.resize="both",t.style.padding="0",t.style.border="1px solid black";const i={position:"absolute",zIndex:99,textAlign:"center",padding:0,width:"2.5em",height:"1.8em",left:"0.1em"};ze(t,"button",{style:{...i,top:"0.1em"}},"+").addEventListener("click",()=>e.iepDoc.zoom(1.1),!1),ze(t,"button",{style:{...i,top:"2em"}},"-").addEventListener("click",()=>e.iepDoc.zoom(.9),!1)}function gs(e){return window.location.protocol==="https:"&&e.substr(0,5)==="http:"?Promise.reject(Error(`Impossible de charger ici un script externe qui n’est pas en https (${e})`)):fetch(e,{Accept:"text/xml"}).catch(t=>{throw console.error(t),Error(`Impossible de récupérer le xml ${e}`)}).then(t=>{const{status:i,statusText:s,ok:n}=t;if(i>399)throw Error(`Impossible de récupérer le xml ${e} (erreur ${i} ${s})`);if(!n)throw Error(`Impossible de récupérer le xml ${e}`);return t.text()}).then(t=>{if(!t||!/<INSTRUMENPOCHE/.test(t))throw Error(`L’url ${e} ne retourne pas de script instrumenpoche en xml`);return t})}async function ms(e,t,i){if(typeof i!="object"&&(i={}),typeof window>"u"||!window.document)throw Error("iepLoad doit être utilisé dans un navigateur");if(typeof e=="string"&&(e=document.getElementById(e)),!(e instanceof HTMLElement))throw Error("Conteneur html manquant");if(typeof t!="string")throw Error("Script xml manquant");if(/^http/.test(t)&&(t=await gs(t)),!t||!/<INSTRUMENPOCHE/.test(t))throw Error("Ce n’est pas un script instrumenpoche valide");window.location.protocol==="https:"&&(t=t.replace(/http:\/\/([a-z]+.sesamath.net)/g,(o,c)=>`https://${c}`)),ds(e),ci(e,{position:"relative",overflow:"auto"});const s=ps(e),n={};i.debug&&(n.debug=!0),Kt||(Kt=new Zt(n));const r=typeof i.autostart=="boolean"?i.autostart:!0;return Kt.addDoc(s,t,r),i.zoom&&fs(s),Kt}export{ms as default};
