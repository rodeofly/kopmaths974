const a={UNITS_WIDTH:{sm:"2em",md:"5em",lg:"6em"},UNITS_HEIGHT:{sm:"2em",md:"2em",lg:"2em"},UNITS_TEXT_SIZE:{sm:"1em",md:"0.875em",lg:"1em"},PERIODS:{sm:["MILLE","MILLE","MILLE","UNITÉS","UNITÉS","UNITÉS","","",""],md:["MILLE","MILLE","MILLE","UNITÉS","UNITÉS","UNITÉS","","",""],lg:["MILLE","MILLE","MILLE","UNITÉS","UNITÉS","UNITÉS","","",""]},UNITS:{sm:["C","D","U","C","D","U","d","c","m"],md:["Centaines","Dizaines","Unités","Centaines","Dizaines","Unités","Dixièmes","Centièmes","Millièmes"],lg:["Centaines","Dizaines","Unités","Centaines","Dizaines","Unités","Dixièmes","Centièmes","Millièmes"]},UNIT_DIGIT_INDEX:5,HIGHLIGHTCOLOR:{primary:"bg-coopmaths-struct",secondary:"bg-coopmaths-struct-light"}};function w(n){const{table:t,overlay:i}=n,e=t.rows[t.rows.length-1];if(!e)return 0;const s=parseFloat(i.style.left),o=v(n);return(s-e.offsetLeft+o)/e.offsetWidth}function E(n,t){const i=n.table,e=i.rows[i.rows.length-1];if(!e)return 0;const s=v(n);return t*e.offsetWidth+e.offsetLeft+s}function u(n,t={}){const{table:i,overlay:e,initialPower:s}=n,o=i.rows[i.rows.length-1];if(!o)return 0;const r=o.cells.length,l=o.cells[0],c=parseFloat(window.getComputedStyle(l).width),h=parseFloat(window.getComputedStyle(l).borderWidth),d=v(n);e.style.top=`${o.offsetTop-d-h/4}px`,e.style.width=`${e.children.length*c}px`,e.style.height=`${o.offsetHeight+h/2}px`,(t.newLeft==null||Number.isNaN(t.newLeft))&&(t.newLeft=o.offsetLeft-(r-a.UNIT_DIGIT_INDEX+s-1)*c);const m=o.offsetLeft-(r-1)*c,f=o.offsetLeft,g=Math.max(m,Math.min(t.newLeft,f))-d;e.style.left=`${g}px`;const D=Math.round((g-m)/c);n.pow=a.UNIT_DIGIT_INDEX-s-D,n.handleCalculus({moveOverlayOriginRank:!!t.moveOverlayOriginRank}),n.handleZerosOfOverlay(),n.handleCommas(),n.lastPositionRatio=w(n)}function v(n){if(!/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return 0;const i=n.table,e=i.rows[i.rows.length-1].cells[0];return parseFloat(window.getComputedStyle(e).borderWidth)/2}function R(n){let t=!1,i,e;const{overlay:s,table:o}=n,r=o.rows[o.rows.length-1],l=d=>{n.animation===0&&(d.preventDefault(),t=!0,r.classList.remove("cursor-grab"),s.classList.remove("cursor-grab"),document.body.classList.add("cursor-grabbing"),i="touches"in d?d.touches[0].clientX:d.clientX,e=parseFloat(window.getComputedStyle(s).left)||0,document.addEventListener("mousemove",c),document.addEventListener("mouseup",h),document.addEventListener("touchmove",c),document.addEventListener("touchend",h))},c=d=>{if(!t)return;const f=("touches"in d?d.touches[0].clientX:d.clientX)-i,g=e+f;u(n,{newLeft:g})},h=()=>{if(!t)return;t=!1,r.classList.add("cursor-grab"),s.classList.add("cursor-grab"),document.body.classList.remove("cursor-grabbing"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",h);const d=w(n),f=Math.round(d*a.UNITS.lg.length)/a.UNITS.lg.length*r.offsetWidth+r.offsetLeft;s.style.transition="left 0.2s ease-out",u(n,{newLeft:f,moveOverlayOriginRank:!0}),s.addEventListener("transitionend",()=>{s.style.transition=""},{once:!0})};return r.classList.add("cursor-grab"),n.animation!==0&&(s.classList.remove("cursor-grab"),r.classList.remove("cursor-grab")),s.addEventListener("mousedown",l),s.addEventListener("touchstart",l,{passive:!1}),u(n,{moveOverlayOriginRank:!0}),()=>{document.body.classList.remove("cursor-grabbing"),r.classList.remove("cursor-grab"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",h),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",h),r.removeEventListener("mousedown",l),r.removeEventListener("touchstart",l),s.removeEventListener("mousedown",l),s.removeEventListener("touchstart",l)}}function x(n,t){if(!n)throw new Error("Table element not found");const i=n.rows[2];if(!i)throw new Error("Editable row not found");for(const e of i.cells)e.contentEditable="true",e.classList.add("text-center","text-coopmaths","font-bold"),e.setAttribute("inputmode","numeric"),e.addEventListener("focus",()=>{const s=window.getSelection();if(s){s.removeAllRanges();const o=document.createRange();e.firstChild&&e.firstChild.nodeType===Node.TEXT_NODE&&/\S/.test(e.firstChild.textContent?.charAt(0)||"")&&(o.setStart(e.firstChild,0),o.setEnd(e.firstChild,1),s.addRange(o))}}),e.addEventListener("keydown",s=>{s.preventDefault();const o=e.nextElementSibling;if(s.key==="ArrowLeft"||s.key==="Tab"&&s.shiftKey){const r=e.previousElementSibling;r instanceof HTMLTableCellElement&&r.focus()}else if(s.key==="Enter"||s.key==="ArrowRight"||s.key==="Tab")o instanceof HTMLTableCellElement&&o.focus();else if(s.key==="Backspace"||s.key==="Delete"){const r=Array.from(e.childNodes).find(l=>l.nodeType===Node.TEXT_NODE);r&&(r.nodeValue=" "),t(b(n))}else if(/^[0-9]$/.test(s.key)){const r=Array.from(e.childNodes).find(l=>l.nodeType===Node.TEXT_NODE);r?r.nodeValue=s.key:e.insertBefore(document.createTextNode(s.key),e.firstChild),o instanceof HTMLTableCellElement&&o.focus(),t(b(n))}})}function b(n){const t=n.rows[2];if(!t)throw new Error("Editable row not found");const i=new Array(a.UNITS.lg.length);for(let e=0;e<t.cells.length;e++){const s=t.cells[e].textContent?.trim().replace(",","");s!==""&&(i[e]=Number(s))}return i}const p=1,I=5,H=7,T=1e3;function y(n){if(n.animation===0)return;const t=_(n),i=S(n);setTimeout(()=>{const{animationState:e}=n;e==="pause"?n.animationStep>I||n.animationStep<=p?n.animationStep=p:n.animationStep=I:e==="play"&&(n.animationStep===p?(L(n,t,i,3*T),n.animationStep+=1):n.animationStep===I?(L(n,i,t,T/2),n.animationStep+=1):n.animationStep>=H?n.animationStep=p:n.animationStep+=1),y(n)},T)}function O(n){u(n,{newLeft:S(n),moveOverlayOriginRank:!0}),n.animationStep=I}function N(n){u(n,{newLeft:_(n),moveOverlayOriginRank:!0}),n.animationStep=p}function _(n){const{table:t,initialPower:i}=n,e=t.rows[t.rows.length-1];if(!e)return 0;const s=e.cells.length;return e.offsetLeft-(s-a.UNIT_DIGIT_INDEX+i-1)*C(n)}function S(n){const t=C(n);return _(n)-n.animation*t}function C(n){const{table:t}=n,i=t.rows[t.rows.length-1];if(!i)return 0;const e=i.cells[0];return parseFloat(window.getComputedStyle(e).width)}function L(n,t,i,e){const s=performance.now(),o=l=>-(Math.cos(Math.PI*l)-1)/2,r=l=>{if(n.animationState==="stop")return;const c=l-s,h=Math.min(c/e,1),d=o(h),m=t+(i-t)*d;c<e?(u(n,{newLeft:m}),requestAnimationFrame(r)):u(n,{newLeft:m,moveOverlayOriginRank:!0})};requestAnimationFrame(r)}class U extends HTMLElement{constructor(){super(...arguments),this.animation=0,this.animationState="play",this.animationStep=1,this.container=document.createElement("div"),this.divCalculus=document.createElement("div"),this.editableRowDigits=[],this.hasToHandleZeros=!0,this.hasToRemoveLeftZeros=!1,this.hasToShowComma1=!0,this.hasToShowComma2=!0,this.initialPower=0,this.lastPositionRatio=0,this.number=0,this.overlay=document.createElement("div"),this.overlayDigitSpans=[],this.pow=0,this.table=document.createElement("table"),this._comma1IsVisible=!0,this._comma2IsVisible=!0,this._isCalculusVisible=!1,this._currentSize="sm",this._onResize=()=>{this._updateSizes(),this.handleCalculus()},this._loopIcon=this._buildIcon(`
    <svg width="20px" height="20px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        d="M6.67 15H5.83C4.45 15 3.33 13.88 3.33 12.5V7.5C3.33 6.12 4.45 5 5.83 5H14.17C15.55 5 16.67 6.12 16.67 7.5V12.5C16.67 13.88 15.55 15 14.17 15H10M10 15L12.5 12.5M10 15L12.5 17.5"
      />
    </svg>`),this._pauseIcon=this._buildIcon(`
    <rect x="6" y="4" width="2.5" height="12"/>
    <rect x="11.5" y="4" width="2.5" height="12"/>`)}static get observedAttributes(){return["add-zeros","remove-left-zeros","number","show-comma1","show-comma2","initial-power","animation","show-calculus","orientation"]}connectedCallback(){if(this.container=document.createElement("div"),this.container.classList.add("relative","overflow-hidden","w-fit","flex","flex-col","items-center","justify-center"),this.table=this._buildTable(),this.container.appendChild(this.table),this.overlay=this._buildOverlay(),this.table.appendChild(this.overlay),this.divCalculus=this._buildDivCalculus(),this.appendChild(this.divCalculus),this.animation!==0){const t=this._buildAnimationControlButtons();this.container.appendChild(t)}return this.appendChild(this.container),this._setInitialNumber(),x(this.table,this._setDigits.bind(this)),R(this),this._startResizeObservation(),this._startAnimation(),()=>{this._stopResizeObservation,this._stopAnimation()}}attributeChangedCallback(t,i,e){i!==e&&(t==="add-zeros"&&(this.hasToHandleZeros=e==="true",this._writeDigits()),t==="remove-left-zeros"&&(this.hasToRemoveLeftZeros=e==="true",this._writeDigits()),t==="show-comma1"&&(this.hasToShowComma1=e==="true",this.handleCommas()),t==="show-comma2"&&(this.hasToShowComma2=e==="true",this.handleCommas()),t==="initial-power"&&(this.initialPower=parseInt(e)),t==="animation"&&(this.animation=parseInt(e)),t==="show-calculus"&&(this.isCalculusVisible=e==="true"))}handleCalculus({moveOverlayOriginRank:t=!1}={}){if(this.pow<0){const i=10**-this.pow;this.divCalculus.innerHTML=`<span class="font-semibold">÷</span> ${i.toLocaleString("fr-FR")}`}else if(this.pow>0){const i=10**this.pow;this.divCalculus.innerHTML=`<span style="font-size: 0.875em">✕</span> ${i.toLocaleString("fr-FR")}`}else this.divCalculus.innerHTML="";this._clearHighlights(),this._highlightTableOriginRank(),this._highlightTableMovingRank(),t&&this._highlightOverlayOriginRank(),this._moveDivCalculus()}_clearHighlights(){for(const t of this.table.rows[0].cells)t.classList.remove("text-coopmaths-struct");for(const t of this.table.rows[1].cells)t.classList.remove(a.HIGHLIGHTCOLOR.primary,"text-white");for(const t of this.overlayDigitSpans)t.classList.remove(a.HIGHLIGHTCOLOR.secondary)}_highlightTableOriginRank(){const t=this.table.rows[1].cells[a.UNIT_DIGIT_INDEX-this.initialPower];t?.classList.add("text-white",a.HIGHLIGHTCOLOR.secondary)}_highlightTableMovingRank(){const t=this._getMovingCell();if(!t)return;t.classList.remove(a.HIGHLIGHTCOLOR.secondary),t.classList.add("text-white",a.HIGHLIGHTCOLOR.primary),this._getPeriodCellFromUnitCell(t).classList.add("text-coopmaths-struct")}_highlightOverlayOriginRank(){const t=this.overlayDigitSpans[this.overlayUnitDigitIndex-this.initialPower+this.pow];t&&(t.classList.contains(a.HIGHLIGHTCOLOR.primary)||t.classList.add(a.HIGHLIGHTCOLOR.secondary))}_moveDivCalculus(){const t=this._getMovingCell();if(!t)return;const i=t.offsetLeft+t.offsetWidth/2;this.divCalculus.style.left=`${this.offsetLeft+this.table.offsetLeft+i}px`,this.divCalculus.style.top=`${this.offsetTop}px`,this.divCalculus.style.transform="translateX(-50%) translateY(25%)",this.divCalculus.style.width="auto"}_getMovingCell(){return this.table.rows[1].cells[a.UNIT_DIGIT_INDEX-this.pow-this.initialPower]}handleZerosOfOverlay(){this._handleZeros(this.overlayDigitSpans,this.overlayUnitDigitIndex+this.pow,this.overlayFirstSignificantDigitIndex,this.overlayLastSignificantDigitIndex)}handleCommas(){this.comma1IsVisible=this.hasToShowComma1,this.comma2IsVisible=this.hasToShowComma2}setContainerWidth(){const t=this.table.rows[this.table.rows.length-1].cells[0].offsetWidth;this.container.style.width=`${this.table.offsetWidth+2*t-2}px`}_startResizeObservation(){window.addEventListener("resize",this._onResize),this._resizeObserver=new ResizeObserver(()=>{this._onResize()}),this._resizeObserver.observe(this.table)}_stopResizeObservation(){window.removeEventListener("resize",this._onResize),this._resizeObserver?.disconnect()}_startAnimation(){this.animateTimeoutId===void 0&&(this.animateTimeoutId=window.setTimeout(()=>{this.animationState="play",y(this)},0))}_stopAnimation(){this.animateTimeoutId!==void 0&&(clearTimeout(this.animateTimeoutId),this.animationState="stop",this.animateTimeoutId=void 0)}_getPeriodCellFromUnitCell(t){const i=this.table.querySelector("#periods-row");if(!(i instanceof HTMLTableRowElement))throw new Error("Period row not found");let e=i.cells[0];for(const s of i.cells)t.offsetLeft>=s.offsetLeft&&(e=s);return e}_handleZerosOfEditableRow(){this.table.rows[2]&&this._handleZeros(Array.from(this.table.rows[2].cells),a.UNIT_DIGIT_INDEX,this.editableRowFirstSignificantDigitIndex,this.editableRowLastSignificantDigitIndex)}_handleZeros(t,i,e,s){if(!this.hasToHandleZeros){this._removeLeftZeros(t,i,e,s);return}for(let o=0;o<t.length;o++){const r=t[o],l=o>=e&&o<=s,c=o>=i&&o<e,h=o<=i&&o>s;l?this._isEmptyCommaSpan(r)&&(r.textContent="0",o===i&&o===a.UNIT_DIGIT_INDEX&&(r.innerHTML+=this._buildCommaSpan("red-500").outerHTML)):h||c?r.textContent="0":r.textContent=""}this._removeLeftZeros(t,i,e,s)}_removeLeftZeros(t,i,e,s){if(this.hasToRemoveLeftZeros)for(let o=0;o<s;o++){const r=t[o];if(r!=null){if(r.textContent==="0,"||r.textContent==="0")r.textContent="";else if(!this._isEmptyCommaSpan(r))break}}}_isEmptyCommaSpan(t){return t.textContent===""||t.textContent===" "||t.textContent===","||t.textContent===" ,"}_updateSizes(){const t=this._getSize();this._currentSize!==t&&(this._currentSize=t,this._setHeaders(t),this._setTableSizes(t)),this.setContainerWidth();const i=E(this,this.lastPositionRatio)-v(this);u(this,{newLeft:i,moveOverlayOriginRank:!0}),this.lastPositionRatio=w(this)}_getSize(){return window.innerWidth>1024?"lg":window.innerWidth>768?"md":"sm"}_setHeaders(t){this._setHeadersWidths(t),this._setPeriodsHeaders(t),this._setUnitsHeaders(t)}_setHeadersWidths(t){this.table.querySelectorAll("#units-row th div").forEach(i=>{if(i instanceof HTMLDivElement)switch(t){case"lg":i.style.width=a.UNITS_WIDTH.lg;break;case"md":i.style.width=a.UNITS_WIDTH.md;break;default:i.style.width=a.UNITS_WIDTH.sm;break}})}_setTableSizes(t){this.table.querySelectorAll("th div, tr td").forEach(i=>{if(i instanceof HTMLDivElement||i instanceof HTMLTableCellElement)switch(t){case"lg":i.style.lineHeight=a.UNITS_HEIGHT.lg,i.style.fontSize=a.UNITS_TEXT_SIZE.lg;break;case"md":i.style.lineHeight=a.UNITS_HEIGHT.md,i.style.fontSize=a.UNITS_TEXT_SIZE.md;break;default:i.style.lineHeight=a.UNITS_HEIGHT.sm,i.style.fontSize=a.UNITS_TEXT_SIZE.sm;break}})}_setPeriodsHeaders(t){let i=Array.from(new Set(a.PERIODS.sm));t==="lg"?i=Array.from(new Set(a.PERIODS.lg)):t==="md"&&(i=Array.from(new Set(a.PERIODS.md))),this.table.querySelectorAll("#periods-row th div").forEach((s,o)=>{s.innerHTML=i[o]})}_setUnitsHeaders(t){this.table.querySelectorAll("th div span").forEach((e,s)=>{t==="lg"?e.innerHTML=a.UNITS.lg[s]:t==="md"?e.innerHTML=a.UNITS.md[s]:e.innerHTML=a.UNITS.sm[s]})}_buildTable(){const t=document.createElement("table");t.classList.add("relative","m-auto","border-collapse"),t.style.marginTop="2.25em",t.style.marginBottom="1.25em";const i=this._buildThead();t.appendChild(i);const e=this._buildTbody();return t.appendChild(e),t.querySelectorAll("td, th").forEach(s=>{s instanceof HTMLTableCellElement&&(s.classList.add("border-coopmaths-struct"),s.style.borderWidth="0.15em")}),t}_buildThead(){const t=document.createElement("thead"),i=document.createElement("tr");i.id="periods-row";let e=document.createElement("th");for(let o=0;o<a.PERIODS.sm.length;o++){const r=a.PERIODS.sm[o];if(r===a.PERIODS.sm[o-1]){e.colSpan+=1;continue}e=document.createElement("th"),e.colSpan=1,e.classList.add("relative","h-8");const l=document.createElement("div");l.classList.add("flex","justify-center","whitespace-nowrap","font-semibold"),l.style.paddingTop="0.5em",l.style.paddingBottom="0.5em",l.innerHTML=r,e.appendChild(l),i.appendChild(e)}t.appendChild(i);const s=document.createElement("tr");return s.id="units-row",a.UNITS.sm.forEach(o=>{const r=document.createElement("th");r.classList.add("relative");const l=document.createElement("div");l.classList.add("flex","justify-center","items-center"),l.style.paddingTop="0.5em",l.style.paddingBottom="0.5em",l.style.width=a.UNITS_WIDTH.sm;const c=document.createElement("span");c.classList.add("whitespace-nowrap","font-semibold"),c.innerHTML=o,l.appendChild(c),r.appendChild(l),s.appendChild(r)}),t.appendChild(s),t}_buildTbody(){const t=document.createElement("tbody"),i=document.createElement("tr");for(let s=0;s<a.UNITS.sm.length;s++){const o=document.createElement("td");s===a.UNIT_DIGIT_INDEX&&o.classList.add("relative"),o.innerHTML="&nbsp;",o.style.paddingTop="0.25em",o.style.paddingBottom="0.25em",i.appendChild(o)}t.appendChild(i);const e=document.createElement("tr");for(let s=0;s<a.UNITS.sm.length;s++){const o=document.createElement("td");s===a.UNIT_DIGIT_INDEX?(o.id="overlay-comma-td",o.classList.add("relative"),o.innerHTML=this._buildCommaSpan("white").outerHTML):o.innerHTML="&nbsp;",o.style.paddingTop="0.25em",o.style.paddingBottom="0.25em",e.appendChild(o)}return t.appendChild(e),t}_buildOverlayDigitSpans(){const t=[];for(let e=0;e<this.overlayColumnCount;e++){const s=document.createElement("span");s.classList.add("font-semibold","text-white","flex","items-center","justify-center","w-full","h-full","border-coopmaths-struct"),s.style.borderWidth="0.075em",s.innerHTML="&nbsp;",t.push(s)}return t[this.overlayUnitDigitIndex-this.initialPower].classList.add(a.HIGHLIGHTCOLOR.primary),t}_buildOverlay(){const t=document.createElement("div");return t.classList.add("bg-coopmaths-lightest","grid","cursor-grab","items-center","justify-items-center","overflow-hidden","absolute","pointer-events-auto","border-collapse"),t.style.gridTemplateColumns=`repeat(${this.overlayColumnCount}, minmax(0, 1fr))`,this.overlayDigitSpans=this._buildOverlayDigitSpans(),this.overlayDigitSpans.forEach(i=>{t.appendChild(i)}),t}_buildDivCalculus(){const t=document.createElement("div");return t.classList.add("absolute","font-semibold","text-coopmaths-struct","text-center","whitespace-nowrap","overflow-visible"),t}_buildAnimationControlButtons(){const t=document.createElement("div");t.classList.add("flex","justify-center","items-center","gap-2");const i=this._buildPlayPauseButton(),e=this._buildPreviousButton(i),s=this._buildNextButton(i);return t.appendChild(e),t.appendChild(i),t.appendChild(s),t}_buildPreviousButton(t){return this._buildButton({hoverText:"Retourner au début de l’animation",innerSvg:`
        <polygon points="16,4 6,10 16,16" /> <!-- Reversed play arrow -->
        <rect x="3" y="4" width="2" height="12" /> <!-- Pause line on the left -->`,clickHandler:()=>{this.animationState="stop",t.title="Relancer l'animation",t.innerHTML=this._loopIcon,N(this)}})}_buildNextButton(t){return this._buildButton({hoverText:"Aller à la fin de l’animation",innerSvg:`
        <polygon points="4,4 14,10 4,16" /> <!-- Play arrow -->
        <rect x="15" y="4" width="2" height="12" /> <!-- Pause line -->`,clickHandler:()=>{this.animationState="stop",t.title="Relancer l'animation",t.innerHTML=this._loopIcon,O(this)}})}_buildPlayPauseButton(){const t=this._buildButton({hoverText:"Arrêter l'animation",innerSvg:this._pauseIcon,clickHandler:()=>{this.animationState=this.animationState==="play"?"pause":"play",t.title=this.animationState==="play"?"Arrêter l'animation":"Relancer l'animation",t.innerHTML=this.animationState==="play"?this._pauseIcon:this._loopIcon}});return t.innerHTML=this._pauseIcon,t}_buildButton(t){const i=document.createElement("button");return i.classList.add("flex","items-center","justify-center","cursor-pointer","border","rounded","text-coopmaths-action","hover:text-white","active:text-white","bg-white","hover:bg-coopmaths-action-light","active:bg-coopmaths-action","border-coopmaths-action","hover:border-coopmaths-action-light","active:border-coopmaths-action"),i.innerHTML=this._buildIcon(t.innerSvg),i.title=t.hoverText,i.addEventListener("click",t.clickHandler),i}_buildIcon(t){return`
      <svg xmlns="http://www.w3.org/2000/svg"
        class="inline"
        height="1.25em"
        width="1.25em"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        ${t}
      </svg>`}_setInitialNumber(){const t=this.getAttribute("number")?.replace(",",".").replace("{","").replace("}",""),i=t?.split(".")[1];i!=null&&i.length>3&&console.error("Le glisse-nombre ne gère que 3 chiffres après la virgule");const e=parseFloat(t||"0");this._setDigits(this._getDigitsFromNumber(e))}_buildCommaSpan(t){const i=document.createElement("span");return i.classList.add("absolute","right-0","bottom-0","font-semibold",`text-${t}`,"z-10"),i.style.fontSize="2.25em",i.textContent=",",i}_setDigits(t){this.setAttribute("number",this._getNumberFromDigits(t).toString()),this._setEditableRowDigits(t),this._writeDigits()}_writeDigits(){this._writeDigitsInEditableRow(),this._writeDigitsInOverlay(),this._handleZerosOfEditableRow(),this.handleZerosOfOverlay(),this.handleCommas()}_setEditableRowDigits(t){this.editableRowDigits=t}_getDigitsFromNumber(t){const i=a.UNITS.sm.length-a.UNIT_DIGIT_INDEX-1,e=Math.round(t*10**i),s=[];for(let o=0;o<a.UNITS.sm.length;o++)s.push(Math.floor(e/10**(a.UNITS.sm.length-1-o))%10);return s}_getNumberFromDigits(t){let i=0;for(let e=0;e<t.length;e++){const s=t[e];i+=s*10**(a.UNIT_DIGIT_INDEX-e)}return i}_writeDigitsInEditableRow(){let t=this.editableRowDigits.findIndex(e=>e!==0);t>a.UNIT_DIGIT_INDEX&&(t=a.UNIT_DIGIT_INDEX);let i=this.editableRowDigits.length-1;for(let e=this.editableRowDigits.length-1;e>=t&&this.editableRowDigits[e]===0;e--)i--;for(let e=t;e<=i;e++){const s=this.table?.rows[2]?.cells[e];s==null||this.editableRowDigits[e]==null||(s.textContent=this.editableRowDigits[e].toString(),e===a.UNIT_DIGIT_INDEX&&(s.innerHTML+=this._buildCommaSpan("red-500").outerHTML))}}_writeDigitsInOverlay(){for(let t=0;t<this.overlayDigitSpans.length;t++){const i=this.overlayDigitSpans[t];i!=null&&(t<this.overlayFirstSignificantDigitIndex||t>this.overlayLastSignificantDigitIndex?i.textContent=" ":i.textContent=this.overlayDigits[t]?.toString()??"")}}get comma1IsVisible(){return this._comma1IsVisible}set comma1IsVisible(t){this._comma1IsVisible=t;const i=this.table?.rows[2]?.cells[a.UNIT_DIGIT_INDEX];if(i==null)return;const e=i.querySelector("span");e!=null&&(t&&this.editableRowLastSignificantDigitIndex>a.UNIT_DIGIT_INDEX?e.classList.remove("hidden"):e.classList.add("hidden"))}get comma2IsVisible(){return this._comma2IsVisible}set comma2IsVisible(t){this._comma2IsVisible=t;const i=this.table?.rows[3]?.cells[a.UNIT_DIGIT_INDEX];if(i==null)return;const e=i.querySelector("span");if(e==null)return;const s=this.overlayUnitDigitIndex+this.pow,o=this.overlayDigitSpans[s];t&&this.overlayLastSignificantDigitIndex>s&&(o.innerHTML!==""||!this.hasToRemoveLeftZeros||s>this.overlayFirstSignificantDigitIndex)?e.classList.remove("hidden"):e.classList.add("hidden")}get overlayDigits(){return[...new Array(this.overlayLeftExtraCount).fill(0),...this.editableRowDigits]}get editableRowFirstSignificantDigitIndex(){for(let t=0;t<a.UNIT_DIGIT_INDEX;t++)if(this.table.rows[2]&&parseInt(this.table.rows[2].cells[t].textContent??"")>0)return t;return a.UNIT_DIGIT_INDEX}get editableRowLastSignificantDigitIndex(){for(let t=this.editableRowDigits.length-1;t>a.UNIT_DIGIT_INDEX;t--)if(this.editableRowDigits[t]>0)return t;return a.UNIT_DIGIT_INDEX}get isCalculusVisible(){return this._isCalculusVisible}set isCalculusVisible(t){this._isCalculusVisible=t,t?this.divCalculus.classList.remove("hidden"):this.divCalculus.classList.add("hidden")}get overlayFirstSignificantDigitIndex(){return this.editableRowFirstSignificantDigitIndex+a.UNITS.sm.length-a.UNIT_DIGIT_INDEX-1+this.initialPower}get overlayLastSignificantDigitIndex(){return this.editableRowLastSignificantDigitIndex+a.UNITS.sm.length-a.UNIT_DIGIT_INDEX-1+this.initialPower}get overlayLeftExtraCount(){return a.UNITS.sm.length-(a.UNIT_DIGIT_INDEX-this.initialPower+1)}get overlayRightExtraCount(){return a.UNIT_DIGIT_INDEX-this.initialPower}get overlayColumnCount(){return this.overlayLeftExtraCount+a.UNITS.sm.length+this.overlayRightExtraCount}get overlayUnitDigitIndex(){return this.overlayLeftExtraCount+a.UNIT_DIGIT_INDEX}}export{U as G};
